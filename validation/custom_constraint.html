        
<!DOCTYPE html>
<!--[if IE 8]>
<html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en"> <!--<![endif]-->
<head><base href="/">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
            
                                
    
    <link rel="stylesheet" href="assets/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/highlightjs.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/badge_only.css" type="text/css" />

</head>

<body class="wy-body-for-nav">
 <div class="wy-grid-for-nav">

        <nav data-toggle="wy-nav-shift" class="wy-nav-side">
        <div class="wy-side-scroll">
            <div class="wy-side-nav-search">
                
                                                                                                    
                                                                                                                                                                        </div>

            <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                                                                                                                                                                                                                                                                                                                            </div>
        </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

                                                        

        <div class="wy-nav-content">                <div class="rst-content">
                                        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">                            <div itemprop="articleBody">
                                    <div class="section">
<h1 id="how-to-create-a-custom-validation-constraint">
    How to Create a Custom Validation Constraint
    <a class="headerlink" href="#how-to-create-a-custom-validation-constraint" title="Permalink to this headline">¶</a>
</h1>
<p>You can create a custom constraint by extending the base constraint class,
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/Validator/Constraint.php" class="reference external" title="Symfony\Component\Validator\Constraint" rel="external noopener noreferrer" target="_blank">Constraint</a>. As an example you're
going to create a basic validator that checks if a string contains only
alphanumeric characters.</p>
<div class="section">
<h2 id="creating-the-constraint-class">
    Creating the Constraint Class
    <a class="headerlink" href="#creating-the-constraint-class" title="Permalink to this headline">¶</a>
</h2>
<p>First you need to create a Constraint class and extend <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/Validator/Constraint.php" class="reference external" title="Symfony\Component\Validator\Constraint" rel="external noopener noreferrer" target="_blank">Constraint</a>:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-1">
                    <button role="tab" type="button" data-language="php-attributes"
                aria-controls="configuration-block-tabpanel-5165b3fc3c07e1933d338f88f61f970a7a328d01" aria-selected="true"
                data-active="true" >
                <span>Attributes</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-5165b3fc3c07e1933d338f88f61f970a7a328d01" aria-label="Attributes" class="configuration-codeblock" data-language="php-attributes" style="">
            <div translate="no" class="highlight-php-attributes highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php-attributes php"><span class="hljs-comment">// src/Validator/ContainsAlphanumeric.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Validator</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Validator</span>\<span class="hljs-title">Constraint</span>;

<span class="hljs-comment">#[\Attribute]</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ContainsAlphanumeric</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Constraint</span>
</span>{
    <span class="hljs-keyword">public</span> string <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>message</span> = <span class="hljs-string">'The string "{{ string }}" contains an illegal character: it can only contain letters or numbers.'</span>;
    <span class="hljs-comment">// If the constraint has configuration options, define them as public properties</span>
    <span class="hljs-keyword">public</span> string <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>mode</span> = <span class="hljs-string">'strict'</span>;
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>Add <code translate="no" class="notranslate">#[\Attribute]</code> to the constraint class if you want to
use it as an attribute in other classes.</p>
<div class="admonition admonition-versionadded ">
    <p class="admonition-title">
                                    <span>6.1</span>
    </p><p>The <code translate="no" class="notranslate">#[HasNamedArguments]</code> attribute was introduced in Symfony 6.1.</p>
</div>
<p>You can use <code translate="no" class="notranslate">#[HasNamedArguments]</code> to make some constraint options required:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Validator/ContainsAlphanumeric.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Validator</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Validator</span>\<span class="hljs-title">Attribute</span>\<span class="hljs-title">HasNamedArguments</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Validator</span>\<span class="hljs-title">Constraint</span>;

<span class="hljs-comment">#[\Attribute]</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ContainsAlphanumeric</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Constraint</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>message</span> = <span class="hljs-string">'The string "{{ string }}" contains an illegal character: it can only contain letters or numbers.'</span>;

    <span class="hljs-comment">#[HasNamedArguments]</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(
        public string <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>mode</span>,
        array <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>groups</span> = null,
        mixed <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>payload</span> = null,
    )</span> </span>{
        <span class="hljs-keyword">parent</span><span class="hljs-operator">::</span>__construct([], <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>groups</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>payload</span>);
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
<div class="section">
<h2 id="creating-the-validator-itself">
    Creating the Validator itself
    <a class="headerlink" href="#creating-the-validator-itself" title="Permalink to this headline">¶</a>
</h2>
<p>As you can see, a constraint class is fairly minimal. The actual validation is
performed by another &quot;constraint validator&quot; class. The constraint validator
class is specified by the constraint's <code translate="no" class="notranslate">validatedBy()</code> method, which
has this default logic:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// in the base Symfony\Component\Validator\Constraint class</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validatedBy</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span><span class="hljs-operator">::</span>class.<span class="hljs-string">'Validator'</span>;
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>In other words, if you create a custom <code translate="no" class="notranslate">Constraint</code> (e.g. <code translate="no" class="notranslate">MyConstraint</code>),
Symfony will automatically look for another class, <code translate="no" class="notranslate">MyConstraintValidator</code>
when actually performing the validation.</p>
<p>The validator class only has one required method <code translate="no" class="notranslate">validate()</code>:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Validator/ContainsAlphanumericValidator.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Validator</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Validator</span>\<span class="hljs-title">Constraint</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Validator</span>\<span class="hljs-title">ConstraintValidator</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Validator</span>\<span class="hljs-title">Exception</span>\<span class="hljs-title">UnexpectedTypeException</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Validator</span>\<span class="hljs-title">Exception</span>\<span class="hljs-title">UnexpectedValueException</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ContainsAlphanumericValidator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConstraintValidator</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validate</span><span class="hljs-params">(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>value</span>, Constraint <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>constraint</span>)</span>: <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>constraint</span> <span class="hljs-keyword">instanceof</span> ContainsAlphanumeric) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UnexpectedTypeException(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>constraint</span>, ContainsAlphanumeric<span class="hljs-operator">::</span>class);
        }

        <span class="hljs-comment">// custom constraints should ignore null and empty values to allow</span>
        <span class="hljs-comment">// other constraints (NotBlank, NotNull, etc.) to take care of that</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> === <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>value</span> || <span class="hljs-string">''</span> === <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>value</span>) {
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">if</span> (!is_string(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>value</span>)) {
            <span class="hljs-comment">// throw this exception if your validator cannot handle the passed type so that it can be marked as invalid</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UnexpectedValueException(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>value</span>, <span class="hljs-string">'string'</span>);

            <span class="hljs-comment">// separate multiple types using pipes</span>
            <span class="hljs-comment">// throw new UnexpectedValueException($value, 'string|int');</span>
        }

        <span class="hljs-comment">// access your configuration options like this:</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-string">'strict'</span> === <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>constraint</span><span class="hljs-operator">-&gt;</span>mode) {
            <span class="hljs-comment">// ...</span>
        }

        <span class="hljs-keyword">if</span> (!preg_match(<span class="hljs-string">'/^[a-zA-Z0-9]+$/'</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>value</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>matches</span>)) {
            <span class="hljs-comment">// the argument must be a string or an object implementing __toString()</span>
            <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>context<span class="hljs-operator">-&gt;</span>buildViolation(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>constraint</span><span class="hljs-operator">-&gt;</span>message)
                <span class="hljs-operator">-&gt;</span>setParameter(<span class="hljs-string">'{{ string }}'</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>value</span>)
                <span class="hljs-operator">-&gt;</span>addViolation();
        }
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Inside <code translate="no" class="notranslate">validate()</code>, you don't need to return a value. Instead, you add violations
to the validator's <code translate="no" class="notranslate">context</code> property and a value will be considered valid
if it causes no violations. The <code translate="no" class="notranslate">buildViolation()</code> method takes the error
message as its argument and returns an instance of
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/Validator/Violation/ConstraintViolationBuilderInterface.php" class="reference external" title="Symfony\Component\Validator\Violation\ConstraintViolationBuilderInterface" rel="external noopener noreferrer" target="_blank">ConstraintViolationBuilderInterface</a>.
The <code translate="no" class="notranslate">addViolation()</code> method call finally adds the violation to the context.</p>
</div>
<div class="section">
<h2 id="using-the-new-validator">
    Using the new Validator
    <a class="headerlink" href="#using-the-new-validator" title="Permalink to this headline">¶</a>
</h2>
<p>You can use custom validators like the ones provided by Symfony itself:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-4">
                    <button role="tab" type="button" data-language="php-attributes"
                aria-controls="configuration-block-tabpanel-4bab560bee76a5530c7aa7596623e78ed92f6c9c" aria-selected="true"
                data-active="true" >
                <span>Attributes</span>
            </button>
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-98e3b01d433c2bf012b45548e01aba312454ba35" aria-selected="false"
                 tabindex="-1">
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-feb7158faff6966c2e26fce8a18c1ae3556e8265" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-e6eb02ba4b2b9c4c290ff926dc86980f3ab32c29" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-4bab560bee76a5530c7aa7596623e78ed92f6c9c" aria-label="Attributes" class="configuration-codeblock" data-language="php-attributes" style="">
            <div translate="no" class="highlight-php-attributes highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php-attributes php"><span class="hljs-comment">// src/Entity/AcmeEntity.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Entity</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Validator</span> <span class="hljs-title">as</span> <span class="hljs-title">AcmeAssert</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Validator</span>\<span class="hljs-title">Constraints</span> <span class="hljs-title">as</span> <span class="hljs-title">Assert</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AcmeEntity</span>
</span>{
    <span class="hljs-comment">// ...</span>

    <span class="hljs-comment">#[Assert\NotBlank]</span>
    <span class="hljs-comment">#[AcmeAssert\ContainsAlphanumeric(mode: 'loose')]</span>
    <span class="hljs-keyword">protected</span> string <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>name</span>;

    <span class="hljs-comment">// ...</span>
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-98e3b01d433c2bf012b45548e01aba312454ba35" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="display: none">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/validator/validation.yaml</span>
<span class="hljs-string">App\Entity\User:</span>
    <span class="hljs-attr">properties:</span>
        <span class="hljs-attr">name:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-attr">NotBlank:</span> <span class="hljs-string">~</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">App\Validator\ContainsAlphanumeric:</span>
                <span class="hljs-attr">mode:</span> <span class="hljs-string">'loose'</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-feb7158faff6966c2e26fce8a18c1ae3556e8265" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/validator/validation.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">constraint-mapping</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/constraint-mapping"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/constraint-mapping https://symfony.com/schema/dic/constraint-mapping/constraint-mapping-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">class</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"App\Entity\User"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"name"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">constraint</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"NotBlank"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">constraint</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"App\Validator\ContainsAlphanumeric"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"mode"</span>&gt;</span>loose<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">constraint</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">class</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">constraint-mapping</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-e6eb02ba4b2b9c4c290ff926dc86980f3ab32c29" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Entity/User.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Entity</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Validator</span>\<span class="hljs-title">ContainsAlphanumeric</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Validator</span>\<span class="hljs-title">Constraints</span>\<span class="hljs-title">NotBlank</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Validator</span>\<span class="hljs-title">Mapping</span>\<span class="hljs-title">ClassMetadata</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span>
</span>{
    <span class="hljs-keyword">protected</span> string <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>name</span> = <span class="hljs-string">''</span>;

    <span class="hljs-comment">// ...</span>

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadValidatorMetadata</span><span class="hljs-params">(ClassMetadata <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>metadata</span>)</span>: <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>metadata</span><span class="hljs-operator">-&gt;</span>addPropertyConstraint(<span class="hljs-string">'name'</span>, <span class="hljs-keyword">new</span> NotBlank());
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>metadata</span><span class="hljs-operator">-&gt;</span>addPropertyConstraint(<span class="hljs-string">'name'</span>, <span class="hljs-keyword">new</span> ContainsAlphanumeric([<span class="hljs-string">'mode'</span> =&gt; <span class="hljs-string">'loose'</span>]));
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>If your constraint contains options, then they should be public properties
on the custom Constraint class you created earlier. These options can be
configured like options on core Symfony constraints.</p>
<div class="section">
<h3 id="constraint-validators-with-dependencies">
    Constraint Validators with Dependencies
    <a class="headerlink" href="#constraint-validators-with-dependencies" title="Permalink to this headline">¶</a>
</h3>
<p>If you're using the <a href="../service_container.html#service-container-services-load-example" class="reference internal">default services.yaml configuration</a>,
then your validator is already registered as a service and <a href="../service_container/tags.html" class="reference internal">tagged</a>
with the necessary <code translate="no" class="notranslate">validator.constraint_validator</code>. This means you can
<a href="../service_container.html#services-constructor-injection" class="reference internal">inject services or configuration</a> like any other service.</p>
</div>
<div class="section">
<h3 id="create-a-reusable-set-of-constraints">
    Create a Reusable Set of Constraints
    <a class="headerlink" href="#create-a-reusable-set-of-constraints" title="Permalink to this headline">¶</a>
</h3>
<p>In case you need to consistently apply a common set of constraints
across your application, you can extend the <a href="../reference/constraints/Compound.html" class="reference internal">Compound constraint</a>.</p>
</div>
<div class="section">
<h3 id="class-constraint-validator">
    Class Constraint Validator
    <a class="headerlink" href="#class-constraint-validator" title="Permalink to this headline">¶</a>
</h3>
<p>Besides validating a single property, a constraint can have an entire class
as its scope.</p>
<p>For instance, imagine you also have a <code translate="no" class="notranslate">PaymentReceipt</code> entity and you
need to make sure the email of the receipt payload matches the user's
email. First, create a constraint and override the <code translate="no" class="notranslate">getTargets()</code> method:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Validator/ConfirmedPaymentReceipt.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Validator</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Validator</span>\<span class="hljs-title">Constraint</span>;

<span class="hljs-comment">#[\Attribute]</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConfirmedPaymentReceipt</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Constraint</span>
</span>{
    <span class="hljs-keyword">public</span> string <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>userDoesNotMatchMessage</span> = <span class="hljs-string">'User\'s e-mail address does not match that of the receipt'</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getTargets</span><span class="hljs-params">()</span>: <span class="hljs-title">string</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span><span class="hljs-operator">::</span>CLASS_CONSTRAINT;
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Now, the constraint validator will get an object as the first argument to
<code translate="no" class="notranslate">validate()</code>:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Validator/ConfirmedPaymentReceiptValidator.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Validator</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Validator</span>\<span class="hljs-title">Constraint</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Validator</span>\<span class="hljs-title">ConstraintValidator</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Validator</span>\<span class="hljs-title">Exception</span>\<span class="hljs-title">UnexpectedValueException</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConfirmedPaymentReceiptValidator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConstraintValidator</span>
</span>{
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@param</span> PaymentReceipt $receipt
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validate</span><span class="hljs-params">(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>receipt</span>, Constraint <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>constraint</span>)</span>: <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>receipt</span> <span class="hljs-keyword">instanceof</span> PaymentReceipt) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UnexpectedValueException(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>receipt</span>, PaymentReceipt<span class="hljs-operator">::</span>class);
        }

        <span class="hljs-keyword">if</span> (!<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>constraint</span> <span class="hljs-keyword">instanceof</span> ConfirmedPaymentReceipt) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UnexpectedValueException(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>constraint</span>, ConfirmedPaymentReceipt<span class="hljs-operator">::</span>class);
        }

        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>receiptEmail</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>receipt</span><span class="hljs-operator">-&gt;</span>getPayload()[<span class="hljs-string">'email'</span>] ?? <span class="hljs-keyword">null</span>;
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>userEmail</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>receipt</span><span class="hljs-operator">-&gt;</span>getUser()<span class="hljs-operator">-&gt;</span>getEmail();

        <span class="hljs-keyword">if</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>userEmail</span> !== <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>receiptEmail</span>) {
            <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>context
                <span class="hljs-operator">-&gt;</span>buildViolation(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>constraint</span><span class="hljs-operator">-&gt;</span>userDoesNotMatchMessage)
                <span class="hljs-operator">-&gt;</span>atPath(<span class="hljs-string">'user.email'</span>)
                <span class="hljs-operator">-&gt;</span>addViolation();
        }
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-tip ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                <span>Tip</span>
    </p><p>The <code translate="no" class="notranslate">atPath()</code> method defines the property with which the validation error is
associated. Use any <a href="../components/property_access.html" class="reference internal">valid PropertyAccess syntax</a>
to define that property.</p>
</div>
<p>A class constraint validator must be applied to the class itself:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-4">
                    <button role="tab" type="button" data-language="php-attributes"
                aria-controls="configuration-block-tabpanel-7e3f36784959f3a3c5895be9d653010b32216959" aria-selected="true"
                data-active="true" >
                <span>Attributes</span>
            </button>
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-2cfd71a3bf2f31c769ea30dbe4332c9c8d7b1263" aria-selected="false"
                 tabindex="-1">
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-e4d726da42f94f8cd5071b0576b498f060f02362" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-317fe1a1792f176347725f6fd0d83e68f7a862eb" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-7e3f36784959f3a3c5895be9d653010b32216959" aria-label="Attributes" class="configuration-codeblock" data-language="php-attributes" style="">
            <div translate="no" class="highlight-php-attributes highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php-attributes php"><span class="hljs-comment">// src/Entity/AcmeEntity.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Entity</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Validator</span> <span class="hljs-title">as</span> <span class="hljs-title">AcmeAssert</span>;

<span class="hljs-comment">#[AcmeAssert\ProtocolClass]</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AcmeEntity</span>
</span>{
    <span class="hljs-comment">// ...</span>
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-2cfd71a3bf2f31c769ea30dbe4332c9c8d7b1263" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="display: none">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/validator/validation.yaml</span>
<span class="hljs-string">App\Entity\PaymentReceipt:</span>
    <span class="hljs-attr">constraints:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">App\Validator\ConfirmedPaymentReceipt:</span> <span class="hljs-string">~</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-e4d726da42f94f8cd5071b0576b498f060f02362" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/validator/validation.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">constraint-mapping</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/constraint-mapping"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/constraint-mapping
        https://symfony.com/schema/dic/constraint-mapping/constraint-mapping-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">class</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"App\Entity\PaymentReceipt"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">constraint</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"App\Validator\ConfirmedPaymentReceipt"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">class</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">constraint-mapping</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-317fe1a1792f176347725f6fd0d83e68f7a862eb" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Entity/PaymentReceipt.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Entity</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Validator</span>\<span class="hljs-title">ConfirmedPaymentReceipt</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Validator</span>\<span class="hljs-title">Mapping</span>\<span class="hljs-title">ClassMetadata</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PaymentReceipt</span>
</span>{
    <span class="hljs-comment">// ...</span>

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadValidatorMetadata</span><span class="hljs-params">(ClassMetadata <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>metadata</span>)</span>: <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>metadata</span><span class="hljs-operator">-&gt;</span>addConstraint(<span class="hljs-keyword">new</span> ConfirmedPaymentReceipt());
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
</div>
</div>
<div class="section">
<h2 id="testing-custom-constraints">
    Testing Custom Constraints
    <a class="headerlink" href="#testing-custom-constraints" title="Permalink to this headline">¶</a>
</h2>
<p>Use the <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/Validator/Test/ConstraintValidatorTestCase.php" class="reference external" title="Symfony\Component\Validator\Test\ConstraintValidatorTestCase" rel="external noopener noreferrer" target="_blank">ConstraintValidatorTestCase</a>`
class to simplify writing unit tests for your custom constraints:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// tests/Validator/ContainsAlphanumericValidatorTest.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Tests</span>\<span class="hljs-title">Validator</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Validator</span>\<span class="hljs-title">ContainsAlphanumeric</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Validator</span>\<span class="hljs-title">ContainsAlphanumericValidator</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Validator</span>\<span class="hljs-title">Test</span>\<span class="hljs-title">ConstraintValidatorTestCase</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ContainsAlphanumericValidatorTest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConstraintValidatorTestCase</span>
</span>{
    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createValidator</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ContainsAlphanumericValidator();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testNullIsValid</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>validator<span class="hljs-operator">-&gt;</span>validate(<span class="hljs-keyword">null</span>, <span class="hljs-keyword">new</span> ContainsAlphanumeric());

        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>assertNoViolation();
    }

    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@dataProvider</span> provideInvalidConstraints
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testTrueIsInvalid</span><span class="hljs-params">(ContainsAlphanumeric <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>constraint</span>)</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>validator<span class="hljs-operator">-&gt;</span>validate(<span class="hljs-string">'...'</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>constraint</span>);

        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>buildViolation(<span class="hljs-string">'myMessage'</span>)
            <span class="hljs-operator">-&gt;</span>setParameter(<span class="hljs-string">'{{ string }}'</span>, <span class="hljs-string">'...'</span>)
            <span class="hljs-operator">-&gt;</span>assertRaised();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">provideInvalidConstraints</span><span class="hljs-params">()</span>: <span class="hljs-title">iterable</span>
    </span>{
        <span class="hljs-keyword">yield</span> [<span class="hljs-keyword">new</span> ContainsAlphanumeric(message: <span class="hljs-string">'myMessage'</span>)];
        <span class="hljs-comment">// ...</span>
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
</div>

                            </div>                    </div>
                                    </div>        </div>

    </section>

</div>


<script type="text/javascript" src="assets/js/theme.js"></script>
<script type="text/javascript" src="assets/js/badge_only.js"></script>

 
</body>
</html>