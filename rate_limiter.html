        
<!DOCTYPE html>
<!--[if IE 8]>
<html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en"> <!--<![endif]-->
<head><base href="/">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
            
                                
    
    <link rel="stylesheet" href="assets/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/highlightjs.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/badge_only.css" type="text/css" />

</head>

<body class="wy-body-for-nav">
 <div class="wy-grid-for-nav">

        <nav data-toggle="wy-nav-shift" class="wy-nav-side">
        <div class="wy-side-scroll">
            <div class="wy-side-nav-search">
                
                                                                                                    
                                                                                                                                                                        </div>

            <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                                                                                                                                                                                                                                                                                                                            </div>
        </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

                                                        

        <div class="wy-nav-content">                <div class="rst-content">
                                        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">                            <div itemprop="articleBody">
                                    <div class="section">
<h1 id="rate-limiter">
    Rate Limiter
    <a class="headerlink" href="#rate-limiter" title="Permalink to this headline">¶</a>
</h1>
<p>A &quot;rate limiter&quot; controls how frequently some event (e.g. an HTTP request or a
login attempt) is allowed to happen. Rate limiting is commonly used as a
defensive measure to protect services from excessive use (intended or not) and
maintain their availability. It's also useful to control your internal or
outbound processes (e.g. limit the number of simultaneously processed messages).</p>
<p>Symfony uses these rate limiters in built-in features like <a href="security.html#security-login-throttling" class="reference internal">login throttling</a>,
which limits how many failed login attempts a user can make in a given period of
time, but you can use them for your own features too.</p>
<div class="admonition admonition-caution ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                <span>Caution</span>
    </p><p>By definition, the Symfony rate limiters require Symfony to be booted
in a PHP process. This makes them not useful to protect against <a href="https://cheatsheetseries.owasp.org/cheatsheets/Denial_of_Service_Cheat_Sheet.html" class="reference external" rel="external noopener noreferrer" target="_blank">DoS attacks</a>.
Such protections must consume the least resources possible. Consider
using <a href="https://httpd.apache.org/docs/current/mod/mod_ratelimit.html" class="reference external" rel="external noopener noreferrer" target="_blank">Apache mod_ratelimit</a>, <a href="https://www.nginx.com/blog/rate-limiting-nginx/" class="reference external" rel="external noopener noreferrer" target="_blank">NGINX rate limiting</a> or proxies (like
AWS or Cloudflare) to prevent your server from being overwhelmed.</p>
</div>
<span id="rate-limiter-policies"></span>
<div class="section">
<h2 id="rate-limiting-policies">
    Rate Limiting Policies
    <a class="headerlink" href="#rate-limiting-policies" title="Permalink to this headline">¶</a>
</h2>
<p>Symfony's rate limiter implements some of the most common policies to enforce
rate limits: <strong>fixed window</strong>, <strong>sliding window</strong>, <strong>token bucket</strong>.</p>
<div class="section">
<h3 id="fixed-window-rate-limiter">
    Fixed Window Rate Limiter
    <a class="headerlink" href="#fixed-window-rate-limiter" title="Permalink to this headline">¶</a>
</h3>
<p>This is the simplest technique and it's based on setting a limit for a given
interval of time (e.g. 5,000 requests per hour or 3 login attempts every 15
minutes).</p>
<p>In the diagram below, the limit is set to &quot;5 tokens per hour&quot;. Each window
starts at the first hit (i.e. 10:15, 11:30 and 12:30). As soon as there are
5 hits (the blue squares) in a window, all others will be rejected (red
squares).</p>
<object data="_images/rate_limiter/fixed_window.svg" type="image/svg+xml"></object>
<p>Its main drawback is that resource usage is not evenly distributed in time and
it can overload the server at the window edges. In the previous example,
there were 6 accepted requests between 11:00 and 12:00.</p>
<p>This is more significant with bigger limits. For instance, with 5,000 requests
per hour, a user could make the 4,999 requests in the last minute of some
hour and another 5,000 requests during the first minute of the next hour,
making 9,999 requests in total in two minutes and possibly overloading the
server. These periods of excessive usage are called &quot;bursts&quot;.</p>
</div>
<div class="section">
<h3 id="sliding-window-rate-limiter">
    Sliding Window Rate Limiter
    <a class="headerlink" href="#sliding-window-rate-limiter" title="Permalink to this headline">¶</a>
</h3>
<p>The sliding window algorithm is an alternative to the fixed window algorithm
designed to reduce bursts. This is the same example as above, but then
using a 1 hour window that slides over the timeline:</p>
<object data="_images/rate_limiter/sliding_window.svg" type="image/svg+xml"></object>
<p>As you can see, this removes the edges of the window and would prevent the
6th request at 11:45.</p>
<p>To achieve this, the rate limit is approximated based on the current window and
the previous window.</p>
<p>For example: the limit is 5,000 requests per hour; a user made 4,000 requests
the previous hour and 500 requests this hour. 15 minutes in to the current hour
(25% of the window) the hit count would be calculated as: 75% * 4,000 + 500 = 3,500.
At this point in time the user can only do 1,500 more requests.</p>
<p>The math shows that the closer the last window is, the more the hit count
of the last window will affect the current limit. This will make sure that a user can
do 5,000 requests per hour but only if they are evenly spread out.</p>
</div>
<div class="section">
<h3 id="token-bucket-rate-limiter">
    Token Bucket Rate Limiter
    <a class="headerlink" href="#token-bucket-rate-limiter" title="Permalink to this headline">¶</a>
</h3>
<p>This technique implements the <a href="https://en.wikipedia.org/wiki/Token_bucket" class="reference external" rel="external noopener noreferrer" target="_blank">token bucket algorithm</a>, which defines
continuously updating the budget of resource usage. It roughly works like this:</p>
<ul>
    <li>A bucket is created with an initial set of tokens;</li>
<li>A new token is added to the bucket with a predefined frequency (e.g. every second);</li>
<li>Allowing an event consumes one or more tokens;</li>
<li>If the bucket still contains tokens, the event is allowed; otherwise, it's denied;</li>
<li>If the bucket is at full capacity, new tokens are discarded.</li>
</ul>
<p>The below diagram shows a token bucket of size 4 that is filled with a rate
of 1 token per 15 minutes:</p>
<object data="_images/rate_limiter/token_bucket.svg" type="image/svg+xml"></object>
<p>This algorithm handles more complex back-off burst management.
For instance, it can allow a user to try a password 5 times and then only
allow 1 every 15 minutes (unless the user waits 75 minutes and they will be
allowed 5 tries again).</p>
</div>
</div>
<div class="section">
<h2 id="installation">
    Installation
    <a class="headerlink" href="#installation" title="Permalink to this headline">¶</a>
</h2>
<p>Before using a rate limiter for the first time, run the following command to
install the associated Symfony Component in your application:</p>
<div translate="no" class="highlight-terminal highlight-bash notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs terminal bash"><span class="hljs-prompt">$ </span>composer require symfony/rate-limiter</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
<div class="section">
<h2 id="configuration">
    Configuration
    <a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a>
</h2>
<p>The following example creates two different rate limiters for an API service, to
enforce different levels of service (free or paid):</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-05789ca4eb01e24d138da29c95b030004a6aed64" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-f85aa1b877efeb68b25be62b249a9e7a6e353d7a" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-35b664c71dbb1e0fdc68d79c2d972e60d4166644" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-05789ca4eb01e24d138da29c95b030004a6aed64" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/rate_limiter.yaml</span>
<span class="hljs-attr">framework:</span>
    <span class="hljs-attr">rate_limiter:</span>
        <span class="hljs-attr">anonymous_api:</span>
            <span class="hljs-comment"># use 'sliding_window' if you prefer that policy</span>
            <span class="hljs-attr">policy:</span> <span class="hljs-string">'fixed_window'</span>
            <span class="hljs-attr">limit:</span> <span class="hljs-number">100</span>
            <span class="hljs-attr">interval:</span> <span class="hljs-string">'60 minutes'</span>
        <span class="hljs-attr">authenticated_api:</span>
            <span class="hljs-attr">policy:</span> <span class="hljs-string">'token_bucket'</span>
            <span class="hljs-attr">limit:</span> <span class="hljs-number">5000</span>
            <span class="hljs-attr">rate:</span> <span class="hljs-string">{</span> <span class="hljs-attr">interval:</span> <span class="hljs-string">'15 minutes'</span><span class="hljs-string">,</span> <span class="hljs-attr">amount:</span> <span class="hljs-number">500</span> <span class="hljs-string">}</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-f85aa1b877efeb68b25be62b249a9e7a6e353d7a" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/packages/rate_limiter.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:framework</span>=<span class="hljs-string">"http://symfony.com/schema/dic/symfony"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd
        http://symfony.com/schema/dic/symfony
        https://symfony.com/schema/dic/symfony/symfony-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">framework:config</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">framework:rate-limiter</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- policy: use 'sliding_window' if you prefer that policy --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">framework:limiter</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"anonymous_api"</span>
                <span class="hljs-attr">policy</span>=<span class="hljs-string">"fixed_window"</span>
                <span class="hljs-attr">limit</span>=<span class="hljs-string">"100"</span>
                <span class="hljs-attr">interval</span>=<span class="hljs-string">"60 minutes"</span>
            /&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-name">framework:limiter</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"authenticated_api"</span>
                <span class="hljs-attr">policy</span>=<span class="hljs-string">"token_bucket"</span>
                <span class="hljs-attr">limit</span>=<span class="hljs-string">"5000"</span>
            &gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">framework:rate</span> <span class="hljs-attr">interval</span>=<span class="hljs-string">"15 minutes"</span>
                    <span class="hljs-attr">amount</span>=<span class="hljs-string">"500"</span>
                /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">framework:limiter</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">framework:rate-limiter</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">framework:config</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-35b664c71dbb1e0fdc68d79c2d972e60d4166644" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/packages/rate_limiter.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Config</span>\<span class="hljs-title">FrameworkConfig</span>;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(FrameworkConfig <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span><span class="hljs-operator">-&gt;</span>rateLimiter()
        <span class="hljs-operator">-&gt;</span>limiter(<span class="hljs-string">'anonymous_api'</span>)
            <span class="hljs-comment">// use 'sliding_window' if you prefer that policy</span>
            <span class="hljs-operator">-&gt;</span>policy(<span class="hljs-string">'fixed_window'</span>)
            <span class="hljs-operator">-&gt;</span>limit(<span class="hljs-number">100</span>)
            <span class="hljs-operator">-&gt;</span>interval(<span class="hljs-string">'60 minutes'</span>)
        ;

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span><span class="hljs-operator">-&gt;</span>rateLimiter()
        <span class="hljs-operator">-&gt;</span>limiter(<span class="hljs-string">'authenticated_api'</span>)
            <span class="hljs-operator">-&gt;</span>policy(<span class="hljs-string">'token_bucket'</span>)
            <span class="hljs-operator">-&gt;</span>limit(<span class="hljs-number">5000</span>)
            <span class="hljs-operator">-&gt;</span>rate()
                <span class="hljs-operator">-&gt;</span>interval(<span class="hljs-string">'15 minutes'</span>)
                <span class="hljs-operator">-&gt;</span>amount(<span class="hljs-number">500</span>)
        ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>The value of the <code translate="no" class="notranslate">interval</code> option must be a number followed by any of the
units accepted by the <a href="https://www.php.net/datetime.formats.relative" class="reference external" rel="external noopener noreferrer" target="_blank">PHP date relative formats</a> (e.g. <code translate="no" class="notranslate">3 seconds</code>,
<code translate="no" class="notranslate">10 hours</code>, <code translate="no" class="notranslate">1 day</code>, etc.)</p>
</div>
<p>In the <code translate="no" class="notranslate">anonymous_api</code> limiter, after making the first HTTP request, you can
make up to 100 requests in the next 60 minutes. After that time, the counter
resets and you have another 100 requests for the following 60 minutes.</p>
<p>In the <code translate="no" class="notranslate">authenticated_api</code> limiter, after making the first HTTP request you
are allowed to make up to 5,000 HTTP requests in total, and this number grows
at a rate of another 500 requests every 15 minutes. If you don't make that
number of requests, the unused ones don't accumulate (the <code translate="no" class="notranslate">limit</code> option
prevents that number from being higher than 5,000).</p>
</div>
<div class="section">
<h2 id="rate-limiting-in-action">
    Rate Limiting in Action
    <a class="headerlink" href="#rate-limiting-in-action" title="Permalink to this headline">¶</a>
</h2>
<p>After having installed and configured the rate limiter, inject it in any service
or controller and call the <code translate="no" class="notranslate">consume()</code> method to try to consume a given number
of tokens. For example, this controller uses the previous rate limiter to control
the number of requests to the API:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Controller/ApiController.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Controller</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Bundle</span>\<span class="hljs-title">FrameworkBundle</span>\<span class="hljs-title">Controller</span>\<span class="hljs-title">AbstractController</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Request</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpKernel</span>\<span class="hljs-title">Exception</span>\<span class="hljs-title">TooManyRequestsHttpException</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">RateLimiter</span>\<span class="hljs-title">RateLimiterFactory</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApiController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractController</span>
</span>{
    <span class="hljs-comment">// if you're using service autowiring, the variable name must be:</span>
    <span class="hljs-comment">// "rate limiter name" (in camelCase) + "Limiter" suffix</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span><span class="hljs-params">(Request <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span>, RateLimiterFactory <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>anonymousApiLimiter</span>)</span>
    </span>{
        <span class="hljs-comment">// create a limiter based on a unique identifier of the client</span>
        <span class="hljs-comment">// (e.g. the client's IP address, a username/email, an API key, etc.)</span>
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>limiter</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>anonymousApiLimiter</span><span class="hljs-operator">-&gt;</span>create(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span><span class="hljs-operator">-&gt;</span>getClientIp());

        <span class="hljs-comment">// the argument of consume() is the number of tokens to consume</span>
        <span class="hljs-comment">// and returns an object of type Limit</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">false</span> === <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>limiter</span><span class="hljs-operator">-&gt;</span>consume(<span class="hljs-number">1</span>)<span class="hljs-operator">-&gt;</span>isAccepted()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> TooManyRequestsHttpException();
        }

        <span class="hljs-comment">// you can also use the ensureAccepted() method - which throws a</span>
        <span class="hljs-comment">// RateLimitExceededException if the limit has been reached</span>
        <span class="hljs-comment">// $limiter-&gt;consume(1)-&gt;ensureAccepted();</span>

        <span class="hljs-comment">// to reset the counter</span>
        <span class="hljs-comment">// $limiter-&gt;reset();</span>

        <span class="hljs-comment">// ...</span>
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>In a real application, instead of checking the rate limiter in all the API
controller methods, create an <a href="event_dispatcher.html" class="reference internal">event listener or subscriber</a>
for the <a href="components/http_kernel.html#component-http-kernel-kernel-request" class="reference internal">kernel.request event</a>
and check the rate limiter once for all requests.</p>
</div>
<div class="section">
<h3 id="wait-until-a-token-is-available">
    Wait until a Token is Available
    <a class="headerlink" href="#wait-until-a-token-is-available" title="Permalink to this headline">¶</a>
</h3>
<p>Instead of dropping a request or process when the limit has been reached,
you might want to wait until a new token is available. This can be achieved
using the <code translate="no" class="notranslate">reserve()</code> method:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Controller/ApiController.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Controller</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Bundle</span>\<span class="hljs-title">FrameworkBundle</span>\<span class="hljs-title">Controller</span>\<span class="hljs-title">AbstractController</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Request</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">RateLimiter</span>\<span class="hljs-title">RateLimiterFactory</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApiController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractController</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">registerUser</span><span class="hljs-params">(Request <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span>, RateLimiterFactory <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>authenticatedApiLimiter</span>)</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>apiKey</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span><span class="hljs-operator">-&gt;</span>headers<span class="hljs-operator">-&gt;</span>get(<span class="hljs-string">'apikey'</span>);
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>limiter</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>authenticatedApiLimiter</span><span class="hljs-operator">-&gt;</span>create(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>apiKey</span>);

        <span class="hljs-comment">// this blocks the application until the given number of tokens can be consumed</span>
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>limiter</span><span class="hljs-operator">-&gt;</span>reserve(<span class="hljs-number">1</span>)<span class="hljs-operator">-&gt;</span>wait();

        <span class="hljs-comment">// optional, pass a maximum wait time (in seconds), a MaxWaitDurationExceededException</span>
        <span class="hljs-comment">// is thrown if the process has to wait longer. E.g. to wait at most 20 seconds:</span>
        <span class="hljs-comment">//$limiter-&gt;reserve(1, 20)-&gt;wait();</span>

        <span class="hljs-comment">// ...</span>
    }

    <span class="hljs-comment">// ...</span>
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>The <code translate="no" class="notranslate">reserve()</code> method is able to reserve a token in the future. Only use
this method if you're planning to wait, otherwise you will block other
processes by reserving unused tokens.</p>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>Not all strategies allow reserving tokens in the future. These
strategies may throw a <code translate="no" class="notranslate">ReserveNotSupportedException</code> when calling
<code translate="no" class="notranslate">reserve()</code>.</p>
<p>In these cases, you can use <code translate="no" class="notranslate">consume()</code> together with <code translate="no" class="notranslate">wait()</code>, but
there is no guarantee that a token is available after the wait:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// ...</span>
<span class="hljs-keyword">do</span> {
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>limit</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>limiter</span><span class="hljs-operator">-&gt;</span>consume(<span class="hljs-number">1</span>);
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>limit</span><span class="hljs-operator">-&gt;</span>wait();
} <span class="hljs-keyword">while</span> (!<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>limit</span><span class="hljs-operator">-&gt;</span>isAccepted());</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
</div>
<div class="section">
<h3 id="exposing-the-rate-limiter-status">
    Exposing the Rate Limiter Status
    <a class="headerlink" href="#exposing-the-rate-limiter-status" title="Permalink to this headline">¶</a>
</h3>
<p>When using a rate limiter in APIs, it's common to include some standard HTTP
headers in the response to expose the limit status (e.g. remaining tokens, when
new tokens will be available, etc.)</p>
<p>Use the <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/RateLimiter/RateLimit.php" class="reference external" title="Symfony\Component\RateLimiter\RateLimit" rel="external noopener noreferrer" target="_blank">RateLimit</a> object returned by
the <code translate="no" class="notranslate">consume()</code> method (also available via the <code translate="no" class="notranslate">getRateLimit()</code> method of
the <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/RateLimiter/Reservation.php" class="reference external" title="Symfony\Component\RateLimiter\Reservation" rel="external noopener noreferrer" target="_blank">Reservation</a> object returned by the
<code translate="no" class="notranslate">reserve()</code> method) to get the value of those HTTP headers:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Controller/ApiController.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Controller</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Bundle</span>\<span class="hljs-title">FrameworkBundle</span>\<span class="hljs-title">Controller</span>\<span class="hljs-title">AbstractController</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Request</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Response</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">RateLimiter</span>\<span class="hljs-title">RateLimiterFactory</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApiController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractController</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span><span class="hljs-params">(Request <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span>, RateLimiterFactory <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>anonymousApiLimiter</span>)</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>limiter</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>anonymousApiLimiter</span><span class="hljs-operator">-&gt;</span>create(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span><span class="hljs-operator">-&gt;</span>getClientIp());
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>limit</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>limiter</span><span class="hljs-operator">-&gt;</span>consume();
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>headers</span> = [
            <span class="hljs-string">'X-RateLimit-Remaining'</span> =&gt; <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>limit</span><span class="hljs-operator">-&gt;</span>getRemainingTokens(),
            <span class="hljs-string">'X-RateLimit-Retry-After'</span> =&gt; <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>limit</span><span class="hljs-operator">-&gt;</span>getRetryAfter()<span class="hljs-operator">-&gt;</span>getTimestamp(),
            <span class="hljs-string">'X-RateLimit-Limit'</span> =&gt; <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>limit</span><span class="hljs-operator">-&gt;</span>getLimit(),
        ];

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">false</span> === <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>limit</span><span class="hljs-operator">-&gt;</span>isAccepted()) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Response(<span class="hljs-keyword">null</span>, Response<span class="hljs-operator">::</span>HTTP_TOO_MANY_REQUESTS, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>headers</span>);
        }

        <span class="hljs-comment">// ...</span>

        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = <span class="hljs-keyword">new</span> Response(<span class="hljs-string">'...'</span>);
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>headers<span class="hljs-operator">-&gt;</span>add(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>headers</span>);

        <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span>;
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<span id="rate-limiter-storage"></span>
</div>
</div>
<div class="section">
<h2 id="storing-rate-limiter-state">
    Storing Rate Limiter State
    <a class="headerlink" href="#storing-rate-limiter-state" title="Permalink to this headline">¶</a>
</h2>
<p>All rate limiter policies require to store their state (e.g. how many hits were
already made in the current time window). By default, all limiters use the
<code translate="no" class="notranslate">cache.rate_limiter</code> cache pool created with the <a href="cache.html" class="reference internal">Cache component</a>.
This means that every time you clear the cache, the rate limiter will be reset.</p>
<p>You can use the <code translate="no" class="notranslate">cache_pool</code> option to override the cache used by a specific limiter
(or even <a href="cache.html#cache-create-pools" class="reference internal">create a new cache pool</a> for it):</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-8a31380dc704ce3dc1a475902bffdae46048d888" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-9f573902aa777bcb1fb786a63192095377cb8ea2" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-f51490d93a2d977a5f7289e006fc9e191ae1a62d" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-8a31380dc704ce3dc1a475902bffdae46048d888" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/rate_limiter.yaml</span>
<span class="hljs-attr">framework:</span>
    <span class="hljs-attr">rate_limiter:</span>
        <span class="hljs-attr">anonymous_api:</span>
            <span class="hljs-comment"># ...</span>

            <span class="hljs-comment"># use the "cache.anonymous_rate_limiter" cache pool</span>
            <span class="hljs-attr">cache_pool:</span> <span class="hljs-string">'cache.anonymous_rate_limiter'</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-9f573902aa777bcb1fb786a63192095377cb8ea2" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/packages/rate_limiter.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:framework</span>=<span class="hljs-string">"http://symfony.com/schema/dic/symfony"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd
        http://symfony.com/schema/dic/symfony
        https://symfony.com/schema/dic/symfony/symfony-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">framework:config</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">framework:rate-limiter</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- cache-pool: use the "cache.anonymous_rate_limiter" cache pool --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">framework:limiter</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"anonymous_api"</span>
                <span class="hljs-attr">policy</span>=<span class="hljs-string">"fixed_window"</span>
                <span class="hljs-attr">limit</span>=<span class="hljs-string">"100"</span>
                <span class="hljs-attr">interval</span>=<span class="hljs-string">"60 minutes"</span>
                <span class="hljs-attr">cache-pool</span>=<span class="hljs-string">"cache.anonymous_rate_limiter"</span>
            /&gt;</span>

            <span class="hljs-comment">&lt;!-- ... --&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">framework:rate-limiter</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">framework:config</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-f51490d93a2d977a5f7289e006fc9e191ae1a62d" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/packages/rate_limiter.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Config</span>\<span class="hljs-title">FrameworkConfig</span>;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(FrameworkConfig <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span><span class="hljs-operator">-&gt;</span>rateLimiter()
        <span class="hljs-operator">-&gt;</span>limiter(<span class="hljs-string">'anonymous_api'</span>)
            <span class="hljs-comment">// ...</span>

            <span class="hljs-comment">// use the "cache.anonymous_rate_limiter" cache pool</span>
            <span class="hljs-operator">-&gt;</span>cachePool(<span class="hljs-string">'cache.anonymous_rate_limiter'</span>)
        ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>Instead of using the Cache component, you can also implement a custom
storage. Create a PHP class that implements the
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/RateLimiter/Storage/StorageInterface.php" class="reference external" title="Symfony\Component\RateLimiter\Storage\StorageInterface" rel="external noopener noreferrer" target="_blank">StorageInterface</a> and
use the <code translate="no" class="notranslate">storage_service</code> setting of each limiter to the service ID
of this class.</p>
</div>
</div>
<div class="section">
<h2 id="using-locks-to-prevent-race-conditions">
    Using Locks to Prevent Race Conditions
    <a class="headerlink" href="#using-locks-to-prevent-race-conditions" title="Permalink to this headline">¶</a>
</h2>
<p><a href="https://en.wikipedia.org/wiki/Race_condition" class="reference external" rel="external noopener noreferrer" target="_blank">Race conditions</a> can happen when the same rate limiter is used by multiple
simultaneous requests (e.g. three servers of a company hitting your API at the
same time). Rate limiters use <a href="lock.html" class="reference internal">locks</a> to protect their operations
against these race conditions.</p>
<p>By default, Symfony uses the global lock configured by <code translate="no" class="notranslate">framework.lock</code>, but
you can use a specific <a href="lock.html#lock-named-locks" class="reference internal">named lock</a> via the
<code translate="no" class="notranslate">lock_factory</code> option (or none at all):</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-2b50add58f09306539bf68fc0f3382665d5822cc" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-82ec39b9db18174843f9cfa64fbc26726e89f9cf" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-0809cf7aeaf0f1e889f536faab9843eaed5bf2b2" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-2b50add58f09306539bf68fc0f3382665d5822cc" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/rate_limiter.yaml</span>
<span class="hljs-attr">framework:</span>
    <span class="hljs-attr">rate_limiter:</span>
        <span class="hljs-attr">anonymous_api:</span>
            <span class="hljs-comment"># ...</span>

            <span class="hljs-comment"># use the "lock.rate_limiter.factory" for this limiter</span>
            <span class="hljs-attr">lock_factory:</span> <span class="hljs-string">'lock.rate_limiter.factory'</span>

            <span class="hljs-comment"># or don't use any lock mechanism</span>
            <span class="hljs-attr">lock_factory:</span> <span class="hljs-literal">null</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-82ec39b9db18174843f9cfa64fbc26726e89f9cf" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/packages/rate_limiter.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:framework</span>=<span class="hljs-string">"http://symfony.com/schema/dic/symfony"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd
        http://symfony.com/schema/dic/symfony
        https://symfony.com/schema/dic/symfony/symfony-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">framework:config</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">framework:rate-limiter</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- limiter-factory: use the "lock.rate_limiter.factory" for this limiter --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">framework:limiter</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"anonymous_api"</span>
                <span class="hljs-attr">policy</span>=<span class="hljs-string">"fixed_window"</span>
                <span class="hljs-attr">limit</span>=<span class="hljs-string">"100"</span>
                <span class="hljs-attr">interval</span>=<span class="hljs-string">"60 minutes"</span>
                <span class="hljs-attr">lock-factory</span>=<span class="hljs-string">"lock.rate_limiter.factory"</span>
            /&gt;</span>

            <span class="hljs-comment">&lt;!-- limiter-factory: or don't use any lock mechanism --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">framework:limiter</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"anonymous_api"</span>
                <span class="hljs-attr">policy</span>=<span class="hljs-string">"fixed_window"</span>
                <span class="hljs-attr">limit</span>=<span class="hljs-string">"100"</span>
                <span class="hljs-attr">interval</span>=<span class="hljs-string">"60 minutes"</span>
                <span class="hljs-attr">lock-factory</span>=<span class="hljs-string">"null"</span>
            /&gt;</span>

            <span class="hljs-comment">&lt;!-- ... --&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">framework:rate-limiter</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">framework:config</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-0809cf7aeaf0f1e889f536faab9843eaed5bf2b2" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/packages/rate_limiter.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Config</span>\<span class="hljs-title">FrameworkConfig</span>;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(FrameworkConfig <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span><span class="hljs-operator">-&gt;</span>rateLimiter()
        <span class="hljs-operator">-&gt;</span>limiter(<span class="hljs-string">'anonymous_api'</span>)
            <span class="hljs-comment">// ...</span>

            <span class="hljs-comment">// use the "lock.rate_limiter.factory" for this limiter</span>
            <span class="hljs-operator">-&gt;</span>lockFactory(<span class="hljs-string">'lock.rate_limiter.factory'</span>)

            <span class="hljs-comment">// or don't use any lock mechanism</span>
            <span class="hljs-operator">-&gt;</span>lockFactory(<span class="hljs-keyword">null</span>)
        ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
</div>
</div>

                            </div>                    </div>
                                    </div>        </div>

    </section>

</div>


<script type="text/javascript" src="assets/js/theme.js"></script>
<script type="text/javascript" src="assets/js/badge_only.js"></script>

 
</body>
</html>