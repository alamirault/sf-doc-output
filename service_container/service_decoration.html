        
<!DOCTYPE html>
<!--[if IE 8]>
<html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en"> <!--<![endif]-->
<head><base href="/">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
            
                                
    
    <link rel="stylesheet" href="assets/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/highlightjs.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/badge_only.css" type="text/css" />

</head>

<body class="wy-body-for-nav">
 <div class="wy-grid-for-nav">

        <nav data-toggle="wy-nav-shift" class="wy-nav-side">
        <div class="wy-side-scroll">
            <div class="wy-side-nav-search">
                
                                                                                                    
                                                                                                                                                                        </div>

            <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                                                                                                                                                                                                                                                                                                                            </div>
        </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

                                                        

        <div class="wy-nav-content">                <div class="rst-content">
                                        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">                            <div itemprop="articleBody">
                                    <div class="section">
<h1 id="how-to-decorate-services">
    How to Decorate Services
    <a class="headerlink" href="#how-to-decorate-services" title="Permalink to this headline">¶</a>
</h1>
<p>When overriding an existing definition, the original service is lost:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-7205213c185ce663efc779be8fc8b919d87c5c99" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-d380b8e64890816caf77faac6cc378f8ca12098b" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-c0b5c0e81e855c0cd2e42bc1edbb191b5e94871e" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-7205213c185ce663efc779be8fc8b919d87c5c99" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/services.yaml</span>
<span class="hljs-attr">services:</span>
    <span class="hljs-string">App\Mailer:</span> <span class="hljs-string">~</span>

    <span class="hljs-comment"># this replaces the old App\Mailer definition with the new one, the</span>
    <span class="hljs-comment"># old definition is lost</span>
    <span class="hljs-string">App\Mailer:</span>
        <span class="hljs-attr">class:</span> <span class="hljs-string">App\NewMailer</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-d380b8e64890816caf77faac6cc378f8ca12098b" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/services.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsd</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xsd:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services https://symfony.com/schema/dic/services/services-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">services</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"App\Mailer"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- this replaces the old App\Mailer definition with the new
             one, the old definition is lost --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"App\Mailer"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"App\NewMailer"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">services</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-c0b5c0e81e855c0cd2e42bc1edbb191b5e94871e" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/services.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Loader</span>\<span class="hljs-title">Configurator</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Mailer</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">NewMailer</span>;

<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ContainerConfigurator <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span><span class="hljs-operator">-&gt;</span>services();

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span><span class="hljs-operator">-&gt;</span>set(Mailer<span class="hljs-operator">::</span>class);

    <span class="hljs-comment">// this replaces the old App\Mailer definition with the new one, the</span>
    <span class="hljs-comment">// old definition is lost</span>
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span><span class="hljs-operator">-&gt;</span>set(Mailer<span class="hljs-operator">::</span>class, NewMailer<span class="hljs-operator">::</span>class);
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>Most of the time, that's exactly what you want to do. But sometimes,
you might want to decorate the old one instead (i.e. apply the <a href="https://en.wikipedia.org/wiki/Decorator_pattern" class="reference external" rel="external noopener noreferrer" target="_blank">Decorator pattern</a>).
In this case, the old service should be kept around to be able to reference
it in the new one. This configuration replaces <code translate="no" class="notranslate">App\Mailer</code> with a new one,
but keeps a reference of the old one as <code translate="no" class="notranslate">.inner</code>:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-4">
                    <button role="tab" type="button" data-language="php-attributes"
                aria-controls="configuration-block-tabpanel-b82355dc8bef377ae9c65ceb0b6f1627a5fd934a" aria-selected="true"
                data-active="true" >
                <span>Attributes</span>
            </button>
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-e5c152a883b0d614e0a4f7392ba5948a08df1ffd" aria-selected="false"
                 tabindex="-1">
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-057dac38825d4e20b15066404378caf9766f28f4" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-b78dbb2870b9c3f7d6473461a92d9b5ad03c4f39" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-b82355dc8bef377ae9c65ceb0b6f1627a5fd934a" aria-label="Attributes" class="configuration-codeblock" data-language="php-attributes" style="">
            <div translate="no" class="highlight-php-attributes highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php-attributes php"><span class="hljs-comment">// src/DecoratingMailer.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>;

<span class="hljs-comment">// ...</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Attribute</span>\<span class="hljs-title">AsDecorator</span>;

<span class="hljs-comment">#[AsDecorator(decorates: Mailer::class)]</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DecoratingMailer</span>
</span>{
    <span class="hljs-comment">// ...</span>
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-e5c152a883b0d614e0a4f7392ba5948a08df1ffd" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="display: none">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/services.yaml</span>
<span class="hljs-attr">services:</span>
    <span class="hljs-string">App\Mailer:</span> <span class="hljs-string">~</span>

    <span class="hljs-string">App\DecoratingMailer:</span>
        <span class="hljs-comment"># overrides the App\Mailer service</span>
        <span class="hljs-comment"># but that service is still available as ".inner"</span>
        <span class="hljs-attr">decorates:</span> <span class="hljs-string">App\Mailer</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-057dac38825d4e20b15066404378caf9766f28f4" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/services.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsd</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xsd:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services https://symfony.com/schema/dic/services/services-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">services</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"App\Mailer"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- overrides the App\Mailer service
             but that service is still available as ".inner" --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"App\DecoratingMailer"</span>
            <span class="hljs-attr">decorates</span>=<span class="hljs-string">"App\Mailer"</span>
        /&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-name">services</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-b78dbb2870b9c3f7d6473461a92d9b5ad03c4f39" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/services.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Loader</span>\<span class="hljs-title">Configurator</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">DecoratingMailer</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Mailer</span>;

<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ContainerConfigurator <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span><span class="hljs-operator">-&gt;</span>services();

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span><span class="hljs-operator">-&gt;</span>set(Mailer<span class="hljs-operator">::</span>class);

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span><span class="hljs-operator">-&gt;</span>set(DecoratingMailer<span class="hljs-operator">::</span>class)
        <span class="hljs-comment">// overrides the App\Mailer service</span>
        <span class="hljs-comment">// but that service is still available as ".inner"</span>
        <span class="hljs-operator">-&gt;</span>decorate(Mailer<span class="hljs-operator">::</span>class);
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<div class="admonition admonition-versionadded ">
    <p class="admonition-title">
                                    <span>6.1</span>
    </p><p>The <code translate="no" class="notranslate">#[AsDecorator]</code> attribute was introduced in Symfony 6.1.</p>
</div>
<p>The <code translate="no" class="notranslate">decorates</code> option tells the container that the <code translate="no" class="notranslate">App\DecoratingMailer</code>
service replaces the <code translate="no" class="notranslate">App\Mailer</code> service. If you're using the
<a href="../service_container.html#service-container-services-load-example" class="reference internal">default services.yaml configuration</a>,
the decorated service is automatically injected when the constructor of the
decorating service has one argument type-hinted with the decorated service class.</p>
<p>If you are not using autowiring or the decorating service has more than one
constructor argument type-hinted with the decorated service class, you must
inject the decorated service explicitly (the ID of the decorated service is
automatically changed to <code translate="no" class="notranslate">&#039;.inner&#039;</code>):</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-4">
                    <button role="tab" type="button" data-language="php-attributes"
                aria-controls="configuration-block-tabpanel-a7ef40bad38ba73d0639d039d408814379cd4574" aria-selected="true"
                data-active="true" >
                <span>Attributes</span>
            </button>
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-db0640ff17e5b7fa0846e41f51b08f06ee0ce07d" aria-selected="false"
                 tabindex="-1">
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-3b43bc58bcba494a01073401ed1b15126d10ae9d" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-427cb4d4a7513b5800dd06522c8b7923df230f35" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-a7ef40bad38ba73d0639d039d408814379cd4574" aria-label="Attributes" class="configuration-codeblock" data-language="php-attributes" style="">
            <div translate="no" class="highlight-php-attributes highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php-attributes php"><span class="hljs-comment">// src/DecoratingMailer.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>;

<span class="hljs-comment">// ...</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Attribute</span>\<span class="hljs-title">AsDecorator</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Attribute</span>\<span class="hljs-title">AutowireDecorated</span>;

<span class="hljs-comment">#[AsDecorator(decorates: Mailer::class)]</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DecoratingMailer</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(
        private #[AutowireDecorated] <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>inner</span>,
    )</span> </span>{
    }

    <span class="hljs-comment">// ...</span>
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-db0640ff17e5b7fa0846e41f51b08f06ee0ce07d" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="display: none">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/services.yaml</span>
<span class="hljs-attr">services:</span>
    <span class="hljs-string">App\Mailer:</span> <span class="hljs-string">~</span>

    <span class="hljs-string">App\DecoratingMailer:</span>
        <span class="hljs-attr">decorates:</span> <span class="hljs-string">App\Mailer</span>
        <span class="hljs-comment"># pass the old service as an argument</span>
        <span class="hljs-attr">arguments:</span> <span class="hljs-string">['@.inner']</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-3b43bc58bcba494a01073401ed1b15126d10ae9d" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/services.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsd</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xsd:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services https://symfony.com/schema/dic/services/services-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">services</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"App\Mailer"</span>/&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"App\DecoratingMailer"</span>
            <span class="hljs-attr">decorates</span>=<span class="hljs-string">"App\Mailer"</span>
        &gt;</span>
            <span class="hljs-comment">&lt;!-- pass the old service as an argument --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"service"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">".inner"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">services</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-427cb4d4a7513b5800dd06522c8b7923df230f35" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/services.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Loader</span>\<span class="hljs-title">Configurator</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">DecoratingMailer</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Mailer</span>;

<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ContainerConfigurator <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span><span class="hljs-operator">-&gt;</span>services();

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span><span class="hljs-operator">-&gt;</span>set(Mailer<span class="hljs-operator">::</span>class);

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span><span class="hljs-operator">-&gt;</span>set(DecoratingMailer<span class="hljs-operator">::</span>class)
        <span class="hljs-operator">-&gt;</span>decorate(Mailer<span class="hljs-operator">::</span>class)
        <span class="hljs-comment">// pass the old service as an argument</span>
        <span class="hljs-operator">-&gt;</span>args([service(<span class="hljs-string">'.inner'</span>)]);
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<div class="admonition admonition-deprecated ">
    <p class="admonition-title">
                                    <span>6.3</span>
    </p><p>The <code translate="no" class="notranslate">#[MapDecorated]</code> attribute is deprecated since Symfony 6.3.
Instead, use the
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/DependencyInjection/Attribute/AutowireDecorated.php" class="reference external" title="Symfony\Component\DependencyInjection\Attribute\AutowireDecorated" rel="external noopener noreferrer" target="_blank">#[AutowireDecorated]</a> attribute.</p>
</div>
<div class="admonition admonition-tip ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                <span>Tip</span>
    </p><p>The visibility of the decorated <code translate="no" class="notranslate">App\Mailer</code> service (which is an alias
for the new service) will still be the same as the original <code translate="no" class="notranslate">App\Mailer</code>
visibility.</p>
</div>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>The generated inner id is based on the id of the decorator service
(<code translate="no" class="notranslate">App\DecoratingMailer</code> here), not of the decorated service (<code translate="no" class="notranslate">App\Mailer</code>
here). You can control the inner service name via the <code translate="no" class="notranslate">decoration_inner_name</code>
option:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-e91765fddd26922dec1a4df01335319f1cfa066c" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-286b12b9224cd12c4b4fd51ea99fc49db0529f7c" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-c157708bab19c2eedc4002065804e76cd83c6e40" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-e91765fddd26922dec1a4df01335319f1cfa066c" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/services.yaml</span>
<span class="hljs-attr">services:</span>
    <span class="hljs-string">App\DecoratingMailer:</span>
        <span class="hljs-comment"># ...</span>
        <span class="hljs-attr">decoration_inner_name:</span> <span class="hljs-string">App\DecoratingMailer.wooz</span>
        <span class="hljs-attr">arguments:</span> <span class="hljs-string">['@App\DecoratingMailer.wooz']</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-286b12b9224cd12c4b4fd51ea99fc49db0529f7c" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/services.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsd</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xsd:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services https://symfony.com/schema/dic/services/services-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">services</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- ... --&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">service</span>
            <span class="hljs-attr">id</span>=<span class="hljs-string">"App\DecoratingMailer"</span>
            <span class="hljs-attr">decorates</span>=<span class="hljs-string">"App\Mailer"</span>
            <span class="hljs-attr">decoration-inner-name</span>=<span class="hljs-string">"App\DecoratingMailer.wooz"</span>
            <span class="hljs-attr">public</span>=<span class="hljs-string">"false"</span>
        &gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"service"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"App\DecoratingMailer.wooz"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-name">services</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-c157708bab19c2eedc4002065804e76cd83c6e40" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/services.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Loader</span>\<span class="hljs-title">Configurator</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">DecoratingMailer</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Mailer</span>;

<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ContainerConfigurator <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span><span class="hljs-operator">-&gt;</span>services();

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span><span class="hljs-operator">-&gt;</span>set(Mailer<span class="hljs-operator">::</span>class);

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span><span class="hljs-operator">-&gt;</span>set(DecoratingMailer<span class="hljs-operator">::</span>class)
        <span class="hljs-operator">-&gt;</span>decorate(Mailer<span class="hljs-operator">::</span>class, DecoratingMailer<span class="hljs-operator">::</span>class.<span class="hljs-string">'.wooz'</span>)
        <span class="hljs-operator">-&gt;</span>args([service(DecoratingMailer<span class="hljs-operator">::</span>class.<span class="hljs-string">'.wooz'</span>)]);
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
</div>
<div class="section">
<h2 id="decoration-priority">
    Decoration Priority
    <a class="headerlink" href="#decoration-priority" title="Permalink to this headline">¶</a>
</h2>
<p>When applying multiple decorators to a service, you can control their order with
the <code translate="no" class="notranslate">decoration_priority</code> option. Its value is an integer that defaults to
<code translate="no" class="notranslate">0</code> and higher priorities mean that decorators will be applied earlier.</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-4">
                    <button role="tab" type="button" data-language="php-attributes"
                aria-controls="configuration-block-tabpanel-0ef61bfdf9b239819fe64873ac7bf2584fe53707" aria-selected="true"
                data-active="true" >
                <span>Attributes</span>
            </button>
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-f20a0fc99b7768f64e253c12b9f0eacf0eb47745" aria-selected="false"
                 tabindex="-1">
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-77f5b014a19c5fa4059c3d08e3b0200b98cda76a" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-b0f158ce3ecc297cefa2fba7d2f026544f64cc0b" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-0ef61bfdf9b239819fe64873ac7bf2584fe53707" aria-label="Attributes" class="configuration-codeblock" data-language="php-attributes" style="">
            <div translate="no" class="highlight-php-attributes highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php-attributes php"><span class="hljs-comment">// ...</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Attribute</span>\<span class="hljs-title">AsDecorator</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Attribute</span>\<span class="hljs-title">AutowireDecorated</span>;

<span class="hljs-comment">#[AsDecorator(decorates: Foo::class, priority: 5)]</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Bar</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(
        private #[AutowireDecorated] <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>inner</span>,
    )</span> </span>{
    }
    <span class="hljs-comment">// ...</span>
}

<span class="hljs-comment">#[AsDecorator(decorates: Foo::class, priority: 1)]</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Baz</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(
        private #[AutowireDecorated] <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>inner</span>,
    )</span> </span>{
    }

    <span class="hljs-comment">// ...</span>
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-f20a0fc99b7768f64e253c12b9f0eacf0eb47745" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="display: none">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/services.yaml</span>
<span class="hljs-attr">services:</span>
    <span class="hljs-attr">Foo:</span> <span class="hljs-string">~</span>

    <span class="hljs-attr">Bar:</span>
        <span class="hljs-attr">decorates:</span> <span class="hljs-string">Foo</span>
        <span class="hljs-attr">decoration_priority:</span> <span class="hljs-number">5</span>
        <span class="hljs-attr">arguments:</span> <span class="hljs-string">['@.inner']</span>

    <span class="hljs-attr">Baz:</span>
        <span class="hljs-attr">decorates:</span> <span class="hljs-string">Foo</span>
        <span class="hljs-attr">decoration_priority:</span> <span class="hljs-number">1</span>
        <span class="hljs-attr">arguments:</span> <span class="hljs-string">['@.inner']</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-77f5b014a19c5fa4059c3d08e3b0200b98cda76a" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/services.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services https://symfony.com/schema/dic/services/services-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">services</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Foo"</span>/&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Bar"</span> <span class="hljs-attr">decorates</span>=<span class="hljs-string">"Foo"</span> <span class="hljs-attr">decoration-priority</span>=<span class="hljs-string">"5"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"service"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">".inner"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Baz"</span> <span class="hljs-attr">decorates</span>=<span class="hljs-string">"Foo"</span> <span class="hljs-attr">decoration-priority</span>=<span class="hljs-string">"1"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"service"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">".inner"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">services</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-b0f158ce3ecc297cefa2fba7d2f026544f64cc0b" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/services.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Loader</span>\<span class="hljs-title">Configurator</span>;

<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ContainerConfigurator <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span><span class="hljs-operator">-&gt;</span>services();

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span><span class="hljs-operator">-&gt;</span>set(\Foo<span class="hljs-operator">::</span>class);

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span><span class="hljs-operator">-&gt;</span>set(\Bar<span class="hljs-operator">::</span>class)
        <span class="hljs-operator">-&gt;</span>decorate(\Foo<span class="hljs-operator">::</span>class, <span class="hljs-keyword">null</span>, <span class="hljs-number">5</span>)
        <span class="hljs-operator">-&gt;</span>args([service(<span class="hljs-string">'.inner'</span>)]);

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span><span class="hljs-operator">-&gt;</span>set(\Baz<span class="hljs-operator">::</span>class)
        <span class="hljs-operator">-&gt;</span>decorate(\Foo<span class="hljs-operator">::</span>class, <span class="hljs-keyword">null</span>, <span class="hljs-number">1</span>)
        <span class="hljs-operator">-&gt;</span>args([service(<span class="hljs-string">'.inner'</span>)]);
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>The generated code will be the following:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>services[Foo<span class="hljs-operator">::</span>class] = <span class="hljs-keyword">new</span> Baz(<span class="hljs-keyword">new</span> Bar(<span class="hljs-keyword">new</span> Foo()));</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
<div class="section">
<h2 id="stacking-decorators">
    Stacking Decorators
    <a class="headerlink" href="#stacking-decorators" title="Permalink to this headline">¶</a>
</h2>
<p>An alternative to using decoration priorities is to create a <code translate="no" class="notranslate">stack</code> of
ordered services, each one decorating the next:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-78bfa49d0b0e3cb974f1ba2729d87337057d6c2c" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-ffbd75966d52a3933750733addff968ebfcf6666" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-2df173d61c8521d4d3ca36d43e7fc4fa061bffe9" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-78bfa49d0b0e3cb974f1ba2729d87337057d6c2c" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/services.yaml</span>
<span class="hljs-attr">services:</span>
    <span class="hljs-attr">decorated_foo_stack:</span>
        <span class="hljs-attr">stack:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-attr">class:</span> <span class="hljs-string">Baz</span>
              <span class="hljs-attr">arguments:</span> <span class="hljs-string">['@.inner']</span>
            <span class="hljs-bullet">-</span> <span class="hljs-attr">class:</span> <span class="hljs-string">Bar</span>
              <span class="hljs-attr">arguments:</span> <span class="hljs-string">['@.inner']</span>
            <span class="hljs-bullet">-</span> <span class="hljs-attr">class:</span> <span class="hljs-string">Foo</span>

    <span class="hljs-comment"># using the short syntax:</span>
    <span class="hljs-attr">decorated_foo_stack:</span>
        <span class="hljs-attr">stack:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-attr">Baz:</span> <span class="hljs-string">['@.inner']</span>
            <span class="hljs-bullet">-</span> <span class="hljs-attr">Bar:</span> <span class="hljs-string">['@.inner']</span>
            <span class="hljs-bullet">-</span> <span class="hljs-attr">Foo:</span> <span class="hljs-string">~</span>

    <span class="hljs-comment"># can be simplified when autowiring is enabled:</span>
    <span class="hljs-attr">decorated_foo_stack:</span>
        <span class="hljs-attr">stack:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-attr">Baz:</span> <span class="hljs-string">~</span>
            <span class="hljs-bullet">-</span> <span class="hljs-attr">Bar:</span> <span class="hljs-string">~</span>
            <span class="hljs-bullet">-</span> <span class="hljs-attr">Foo:</span> <span class="hljs-string">~</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-ffbd75966d52a3933750733addff968ebfcf6666" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/services.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd"</span>
&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">services</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">stack</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"decorated_foo_stack"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"Baz"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"service"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">".inner"</span>/&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"Bar"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"service"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">".inner"</span>/&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"Foo"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">stack</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- can be simplified when autowiring is enabled: --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">stack</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"decorated_foo_stack"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"Baz"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"Bar"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"Foo"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">stack</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">services</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-2df173d61c8521d4d3ca36d43e7fc4fa061bffe9" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/services.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Loader</span>\<span class="hljs-title">Configurator</span>;

<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ContainerConfigurator <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span><span class="hljs-operator">-&gt;</span>services()
        <span class="hljs-operator">-&gt;</span>stack(<span class="hljs-string">'decorated_foo_stack'</span>, [
            inline_service(\Baz<span class="hljs-operator">::</span>class)<span class="hljs-operator">-&gt;</span>args([service(<span class="hljs-string">'.inner'</span>)]),
            inline_service(\Bar<span class="hljs-operator">::</span>class)<span class="hljs-operator">-&gt;</span>args([service(<span class="hljs-string">'.inner'</span>)]),
            inline_service(\Foo<span class="hljs-operator">::</span>class),
        ])

        <span class="hljs-comment">// can be simplified when autowiring is enabled:</span>
        <span class="hljs-operator">-&gt;</span>stack(<span class="hljs-string">'decorated_foo_stack'</span>, [
            inline_service(\Baz<span class="hljs-operator">::</span>class),
            inline_service(\Bar<span class="hljs-operator">::</span>class),
            inline_service(\Foo<span class="hljs-operator">::</span>class),
        ])
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>The result will be the same as in the previous section:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>services[<span class="hljs-string">'decorated_foo_stack'</span>] = <span class="hljs-keyword">new</span> Baz(<span class="hljs-keyword">new</span> Bar(<span class="hljs-keyword">new</span> Foo()));</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Like aliases, a <code translate="no" class="notranslate">stack</code> can only use <code translate="no" class="notranslate">public</code> and <code translate="no" class="notranslate">deprecated</code> attributes.</p>
<p>Each frame of the <code translate="no" class="notranslate">stack</code> can be either an inlined service, a reference or a
child definition.
The latter allows embedding <code translate="no" class="notranslate">stack</code> definitions into each others, here's an
advanced example of composition:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-a4ca676d7ca967ffe6b83f9eb146d7f272012920" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-8728c228f8c196a56a844e57ea4df943bb8b029a" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-4ed15db91195a993ca9a98b8fff0698a4f2804e8" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-a4ca676d7ca967ffe6b83f9eb146d7f272012920" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/services.yaml</span>
<span class="hljs-attr">services:</span>
    <span class="hljs-attr">some_decorator:</span>
        <span class="hljs-attr">class:</span> <span class="hljs-string">App\Decorator</span>

    <span class="hljs-attr">embedded_stack:</span>
        <span class="hljs-attr">stack:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-attr">alias:</span> <span class="hljs-string">some_decorator</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">App\Decorated:</span> <span class="hljs-string">~</span>

    <span class="hljs-attr">decorated_foo_stack:</span>
        <span class="hljs-attr">stack:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-attr">parent:</span> <span class="hljs-string">embedded_stack</span>
            <span class="hljs-bullet">-</span> <span class="hljs-attr">Baz:</span> <span class="hljs-string">~</span>
            <span class="hljs-bullet">-</span> <span class="hljs-attr">Bar:</span> <span class="hljs-string">~</span>
            <span class="hljs-bullet">-</span> <span class="hljs-attr">Foo:</span> <span class="hljs-string">~</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-8728c228f8c196a56a844e57ea4df943bb8b029a" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/services.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd"</span>
&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">services</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"some_decorator"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"App\Decorator"</span>/&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">stack</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"embedded_stack"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">"some_decorator"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"App\Decorated"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">stack</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">stack</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"decorated_foo_stack"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">parent</span>=<span class="hljs-string">"embedded_stack"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"Baz"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"Bar"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"Foo"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">stack</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">services</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-4ed15db91195a993ca9a98b8fff0698a4f2804e8" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/services.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Loader</span>\<span class="hljs-title">Configurator</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Decorated</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Decorator</span>;

<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ContainerConfigurator <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span><span class="hljs-operator">-&gt;</span>services()
        <span class="hljs-operator">-&gt;</span>set(<span class="hljs-string">'some_decorator'</span>, Decorator<span class="hljs-operator">::</span>class)

        <span class="hljs-operator">-&gt;</span>stack(<span class="hljs-string">'embedded_stack'</span>, [
            service(<span class="hljs-string">'some_decorator'</span>),
            inline_service(Decorated<span class="hljs-operator">::</span>class),
        ])

        <span class="hljs-operator">-&gt;</span>stack(<span class="hljs-string">'decorated_foo_stack'</span>, [
            inline_service()<span class="hljs-operator">-&gt;</span><span class="hljs-keyword">parent</span>(<span class="hljs-string">'embedded_stack'</span>),
            inline_service(\Baz<span class="hljs-operator">::</span>class),
            inline_service(\Bar<span class="hljs-operator">::</span>class),
            inline_service(\Foo<span class="hljs-operator">::</span>class),
        ])
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>The result will be:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>services[<span class="hljs-string">'decorated_foo_stack'</span>] = <span class="hljs-keyword">new</span> App\Decorator(<span class="hljs-keyword">new</span> App\Decorated(<span class="hljs-keyword">new</span> Baz(<span class="hljs-keyword">new</span> Bar(<span class="hljs-keyword">new</span> Foo()))));</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>To change existing stacks (i.e. from a compiler pass), you can access each
frame by its generated id with the following structure:
<code translate="no" class="notranslate">.stack_id.frame_key</code>.
From the example above, <code translate="no" class="notranslate">.decorated_foo_stack.1</code> would be a reference to
the inlined <code translate="no" class="notranslate">Baz</code> service and <code translate="no" class="notranslate">.decorated_foo_stack.0</code> to the embedded
stack.
To get more explicit ids, you can give a name to each frame:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-dfa63b4684b93dfef0b11faade29b4d7fcca57cb" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-f5bacd9c726a997b3642bcceef16022d933055f8" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-3b2770dc7fba6a42d1bb12fc3fb648678ab9231e" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-dfa63b4684b93dfef0b11faade29b4d7fcca57cb" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># ...</span>
<span class="hljs-attr">decorated_foo_stack:</span>
    <span class="hljs-attr">stack:</span>
        <span class="hljs-attr">first:</span>
            <span class="hljs-attr">parent:</span> <span class="hljs-string">embedded_stack</span>
        <span class="hljs-attr">second:</span>
            <span class="hljs-attr">Baz:</span> <span class="hljs-string">~</span>
        <span class="hljs-comment"># ...</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-f5bacd9c726a997b3642bcceef16022d933055f8" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- ... --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">stack</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"decorated_foo_stack"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"first"</span> <span class="hljs-attr">parent</span>=<span class="hljs-string">"embedded_stack"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"second"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"Baz"</span>/&gt;</span>
    <span class="hljs-comment">&lt;!-- ... --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">stack</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-3b2770dc7fba6a42d1bb12fc3fb648678ab9231e" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// ...</span>
<span class="hljs-operator">-&gt;</span>stack(<span class="hljs-string">'decorated_foo_stack'</span>, [
    <span class="hljs-string">'first'</span> =&gt; inline_service()<span class="hljs-operator">-&gt;</span><span class="hljs-keyword">parent</span>(<span class="hljs-string">'embedded_stack'</span>),
    <span class="hljs-string">'second'</span> =&gt; inline_service(\Baz<span class="hljs-operator">::</span>class),
    <span class="hljs-comment">// ...</span>
])</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>The <code translate="no" class="notranslate">Baz</code> frame id will now be <code translate="no" class="notranslate">.decorated_foo_stack.second</code>.</p>
</div>
</div>
<div class="section">
<h2 id="control-the-behavior-when-the-decorated-service-does-not-exist">
    Control the Behavior When the Decorated Service Does Not Exist
    <a class="headerlink" href="#control-the-behavior-when-the-decorated-service-does-not-exist" title="Permalink to this headline">¶</a>
</h2>
<p>When you decorate a service that doesn't exist, the <code translate="no" class="notranslate">decoration_on_invalid</code>
option allows you to choose the behavior to adopt.</p>
<p>Three different behaviors are available:</p>
<ul>
    <li><code translate="no" class="notranslate">exception</code>: A <code translate="no" class="notranslate">ServiceNotFoundException</code> will be thrown telling that decorator's dependency is missing. (default)</li>
<li><code translate="no" class="notranslate">ignore</code>: The container will remove the decorator.</li>
<li><code translate="no" class="notranslate">null</code>: The container will keep the decorator service and will set the decorated one to <code translate="no" class="notranslate">null</code>.</li>
</ul>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-4">
                    <button role="tab" type="button" data-language="php-attributes"
                aria-controls="configuration-block-tabpanel-1abd6697d450bcb507db1f727d1aa789f0d66198" aria-selected="true"
                data-active="true" >
                <span>Attributes</span>
            </button>
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-3ff548719284ffddc23d0be2533b45f0e7203d61" aria-selected="false"
                 tabindex="-1">
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-0df348a6262abbb1b5b092eb51cdf8de15819cb3" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-938aeaed44ec176d3d051df2df521f9ce60f5f0d" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-1abd6697d450bcb507db1f727d1aa789f0d66198" aria-label="Attributes" class="configuration-codeblock" data-language="php-attributes" style="">
            <div translate="no" class="highlight-php-attributes highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php-attributes php"><span class="hljs-comment">// ...</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Attribute</span>\<span class="hljs-title">AsDecorator</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Attribute</span>\<span class="hljs-title">AutowireDecorated</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">ContainerInterface</span>;

<span class="hljs-comment">#[AsDecorator(decorates: Mailer::class, onInvalid: ContainerInterface::IGNORE_ON_INVALID_REFERENCE)]</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Bar</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(
        private #[AutowireDecorated] <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>inner</span>,
    )</span> </span>{
    }

    <span class="hljs-comment">// ...</span>
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-3ff548719284ffddc23d0be2533b45f0e7203d61" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="display: none">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/services.yaml</span>
<span class="hljs-attr">Foo:</span> <span class="hljs-string">~</span>

<span class="hljs-attr">Bar:</span>
    <span class="hljs-attr">decorates:</span> <span class="hljs-string">Foo</span>
    <span class="hljs-attr">decoration_on_invalid:</span> <span class="hljs-string">ignore</span>
    <span class="hljs-attr">arguments:</span> <span class="hljs-string">['@.inner']</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-0df348a6262abbb1b5b092eb51cdf8de15819cb3" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/services.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services https://symfony.com/schema/dic/services/services-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">services</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Foo"</span>/&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Bar"</span> <span class="hljs-attr">decorates</span>=<span class="hljs-string">"Foo"</span> <span class="hljs-attr">decoration-on-invalid</span>=<span class="hljs-string">"ignore"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"service"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">".inner"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">services</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-938aeaed44ec176d3d051df2df521f9ce60f5f0d" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/services.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Loader</span>\<span class="hljs-title">Configurator</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">ContainerInterface</span>;

<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ContainerConfigurator <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span><span class="hljs-operator">-&gt;</span>services();

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span><span class="hljs-operator">-&gt;</span>set(Foo<span class="hljs-operator">::</span>class);

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span><span class="hljs-operator">-&gt;</span>set(Bar<span class="hljs-operator">::</span>class)
        <span class="hljs-operator">-&gt;</span>decorate(Foo<span class="hljs-operator">::</span>class, <span class="hljs-keyword">null</span>, <span class="hljs-number">0</span>, ContainerInterface<span class="hljs-operator">::</span>IGNORE_ON_INVALID_REFERENCE)
        <span class="hljs-operator">-&gt;</span>args([service(<span class="hljs-string">'.inner'</span>)])
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<div class="admonition admonition-caution ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                <span>Caution</span>
    </p><p>When using <code translate="no" class="notranslate">null</code>, you may have to update the decorator constructor in
order to make decorated dependency nullable:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Service/DecoratorService.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Service</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Acme</span>\<span class="hljs-title">OptionalBundle</span>\<span class="hljs-title">Service</span>\<span class="hljs-title">OptionalService</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DecoratorService</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(
        private ?OptionalService <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>decorated</span>,
    )</span> </span>{
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">tellInterestingStuff</span><span class="hljs-params">()</span>: <span class="hljs-title">string</span>
    </span>{
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>decorated) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">'Just one interesting thing'</span>;
        }

        <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>decorated<span class="hljs-operator">-&gt;</span>tellInterestingStuff().<span class="hljs-string">' + one more interesting thing'</span>;
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>Sometimes, you may want to add a compiler pass that creates service
definitions on the fly. If you want to decorate such a service,
be sure that your compiler pass is registered with <code translate="no" class="notranslate">PassConfig::TYPE_BEFORE_OPTIMIZATION</code>
type so that the decoration pass will be able to find the created services.</p>
</div>
</div>
</div>

                            </div>                    </div>
                                    </div>        </div>

    </section>

</div>


<script type="text/javascript" src="assets/js/theme.js"></script>
<script type="text/javascript" src="assets/js/badge_only.js"></script>

 
</body>
</html>