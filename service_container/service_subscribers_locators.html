        
<!DOCTYPE html>
<!--[if IE 8]>
<html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en"> <!--<![endif]-->
<head><base href="/">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
            
                                
    
    <link rel="stylesheet" href="assets/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/highlightjs.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/badge_only.css" type="text/css" />

</head>

<body class="wy-body-for-nav">
 <div class="wy-grid-for-nav">

        <nav data-toggle="wy-nav-shift" class="wy-nav-side">
        <div class="wy-side-scroll">
            <div class="wy-side-nav-search">
                
                                                                                                    
                                                                                                                                                                        </div>

            <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                                                                                                                                                                                                                                                                                                                            </div>
        </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

                                                        

        <div class="wy-nav-content">                <div class="rst-content">
                                        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">                            <div itemprop="articleBody">
                                    <span id="service-locators"></span>
<div class="section">
<h1 id="service-subscribers-locators">
    Service Subscribers &amp; Locators
    <a class="headerlink" href="#service-subscribers-locators" title="Permalink to this headline">¶</a>
</h1>
<p>Sometimes, a service needs access to several other services without being sure
that all of them will actually be used. In those cases, you may want the
instantiation of the services to be lazy. However, that's not possible using
the explicit dependency injection since services are not all meant to
be <code translate="no" class="notranslate">lazy</code> (see <a href="lazy_services.html" class="reference internal">Lazy Services</a>).</p>
<div class="admonition admonition-seealso ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" /></svg>
                <span>See also</span>
    </p><p>Another way to inject services lazily is via a
<a href="service_closures.html" class="reference internal">service closure</a>.</p>
</div>
<p>This can typically be the case in your controllers, where you may inject several
services in the constructor, but the action called only uses some of them.
Another example are applications that implement the <a href="https://en.wikipedia.org/wiki/Command_pattern" class="reference external" rel="external noopener noreferrer" target="_blank">Command pattern</a>
using a CommandBus to map command handlers by Command class names and use them
to handle their respective command when it is asked for:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/CommandBus.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>;

<span class="hljs-comment">// ...</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CommandBus</span>
</span>{
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@param</span> CommandHandler[] $handlerMap
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(
        private array <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>handlerMap</span>,
    )</span> </span>{
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span><span class="hljs-params">(Command <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>command</span>)</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>commandClass</span> = get_class(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>command</span>);

        <span class="hljs-keyword">if</span> (!<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>handler</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>handlerMap[<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>commandClass</span>] ?? <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>handler</span><span class="hljs-operator">-&gt;</span>handle(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>command</span>);
    }
}

<span class="hljs-comment">// ...</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>commandBus</span><span class="hljs-operator">-&gt;</span>handle(<span class="hljs-keyword">new</span> FooCommand());</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Considering that only one command is handled at a time, instantiating all the
other command handlers is unnecessary. A possible solution to lazy-load the
handlers could be to inject the main dependency injection container.</p>
<p>However, injecting the entire container is discouraged because it gives too
broad access to existing services and it hides the actual dependencies of the
services. Doing so also requires services to be made public, which isn't the
case by default in Symfony applications.</p>
<p><strong>Service Subscribers</strong> are intended to solve this problem by giving access to a
set of predefined services while instantiating them only when actually needed
through a <strong>Service Locator</strong>, a separate lazy-loaded container.</p>
<div class="section">
<h2 id="defining-a-service-subscriber">
    Defining a Service Subscriber
    <a class="headerlink" href="#defining-a-service-subscriber" title="Permalink to this headline">¶</a>
</h2>
<p>First, turn <code translate="no" class="notranslate">CommandBus</code> into an implementation of <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Contracts/Service/ServiceSubscriberInterface.php" class="reference external" title="Symfony\Contracts\Service\ServiceSubscriberInterface" rel="external noopener noreferrer" target="_blank">ServiceSubscriberInterface</a>.
Use its <code translate="no" class="notranslate">getSubscribedServices()</code> method to include as many services as needed
in the service subscriber:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/CommandBus.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">CommandHandler</span>\<span class="hljs-title">BarHandler</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">CommandHandler</span>\<span class="hljs-title">FooHandler</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Psr</span>\<span class="hljs-title">Container</span>\<span class="hljs-title">ContainerInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">Service</span>\<span class="hljs-title">ServiceSubscriberInterface</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CommandBus</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ServiceSubscriberInterface</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(
        private ContainerInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>locator</span>,
    )</span> </span>{
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSubscribedServices</span><span class="hljs-params">()</span>: <span class="hljs-title">array</span>
    </span>{
        <span class="hljs-keyword">return</span> [
            <span class="hljs-string">'App\FooCommand'</span> =&gt; FooHandler<span class="hljs-operator">::</span>class,
            <span class="hljs-string">'App\BarCommand'</span> =&gt; BarHandler<span class="hljs-operator">::</span>class,
        ];
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span><span class="hljs-params">(Command <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>command</span>)</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>commandClass</span> = get_class(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>command</span>);

        <span class="hljs-keyword">if</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>locator<span class="hljs-operator">-&gt;</span>has(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>commandClass</span>)) {
            <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>handler</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>locator<span class="hljs-operator">-&gt;</span>get(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>commandClass</span>);

            <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>handler</span><span class="hljs-operator">-&gt;</span>handle(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>command</span>);
        }
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-tip ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                <span>Tip</span>
    </p><p>If the container does <em>not</em> contain the subscribed services, double-check
that you have <a href="../service_container.html#services-autoconfigure" class="reference internal">autoconfigure</a> enabled. You
can also manually add the <code translate="no" class="notranslate">container.service_subscriber</code> tag.</p>
</div>
<p>The injected service is an instance of <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/DependencyInjection/ServiceLocator.php" class="reference external" title="Symfony\Component\DependencyInjection\ServiceLocator" rel="external noopener noreferrer" target="_blank">ServiceLocator</a>
which implements both the PSR-11 <code translate="no" class="notranslate">ContainerInterface</code> and <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Contracts/Service/ServiceProviderInterface.php" class="reference external" title="Symfony\Contracts\Service\ServiceProviderInterface" rel="external noopener noreferrer" target="_blank">ServiceProviderInterface</a>.
It is also a callable and a countable:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// ...</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>numberOfHandlers</span> = count(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>locator);
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>nameOfHandlers</span> = array_keys(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>locator<span class="hljs-operator">-&gt;</span>getProvidedServices());
<span class="hljs-comment">// ...</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>handler</span> = (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>locator)(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>commandClass</span>);

<span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>handler</span><span class="hljs-operator">-&gt;</span>handle(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>command</span>);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
<div class="section">
<h2 id="including-services">
    Including Services
    <a class="headerlink" href="#including-services" title="Permalink to this headline">¶</a>
</h2>
<p>In order to add a new dependency to the service subscriber, use the
<code translate="no" class="notranslate">getSubscribedServices()</code> method to add service types to include in the
service locator:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Psr</span>\<span class="hljs-title">Log</span>\<span class="hljs-title">LoggerInterface</span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSubscribedServices</span><span class="hljs-params">()</span>: <span class="hljs-title">array</span>
</span>{
    <span class="hljs-keyword">return</span> [
        <span class="hljs-comment">// ...</span>
        LoggerInterface<span class="hljs-operator">::</span>class,
    ];
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Service types can also be keyed by a service name for internal use:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Psr</span>\<span class="hljs-title">Log</span>\<span class="hljs-title">LoggerInterface</span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSubscribedServices</span><span class="hljs-params">()</span>: <span class="hljs-title">array</span>
</span>{
    <span class="hljs-keyword">return</span> [
        <span class="hljs-comment">// ...</span>
        <span class="hljs-string">'logger'</span> =&gt; LoggerInterface<span class="hljs-operator">::</span>class,
    ];
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>When extending a class that also implements <code translate="no" class="notranslate">ServiceSubscriberInterface</code>,
it's your responsibility to call the parent when overriding the method. This
typically happens when extending <code translate="no" class="notranslate">AbstractController</code>:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Psr</span>\<span class="hljs-title">Log</span>\<span class="hljs-title">LoggerInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Bundle</span>\<span class="hljs-title">FrameworkBundle</span>\<span class="hljs-title">Controller</span>\<span class="hljs-title">AbstractController</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractController</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSubscribedServices</span><span class="hljs-params">()</span>: <span class="hljs-title">array</span>
    </span>{
        <span class="hljs-keyword">return</span> array_merge(<span class="hljs-keyword">parent</span><span class="hljs-operator">::</span>getSubscribedServices(), [
            <span class="hljs-comment">// ...</span>
            <span class="hljs-string">'logger'</span> =&gt; LoggerInterface<span class="hljs-operator">::</span>class,
        ]);
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="section">
<h3 id="optional-services">
    Optional Services
    <a class="headerlink" href="#optional-services" title="Permalink to this headline">¶</a>
</h3>
<p>For optional dependencies, prepend the service type with a <code translate="no" class="notranslate">?</code> to prevent
errors if there's no matching service found in the service container:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Psr</span>\<span class="hljs-title">Log</span>\<span class="hljs-title">LoggerInterface</span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSubscribedServices</span><span class="hljs-params">()</span>: <span class="hljs-title">array</span>
</span>{
    <span class="hljs-keyword">return</span> [
        <span class="hljs-comment">// ...</span>
        <span class="hljs-string">'?'</span>.LoggerInterface<span class="hljs-operator">::</span>class,
    ];
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>Make sure an optional service exists by calling <code translate="no" class="notranslate">has()</code> on the service
locator before calling the service itself.</p>
</div>
</div>
<div class="section">
<h3 id="aliased-services">
    Aliased Services
    <a class="headerlink" href="#aliased-services" title="Permalink to this headline">¶</a>
</h3>
<p>By default, autowiring is used to match a service type to a service from the
service container. If you don't use autowiring or need to add a non-traditional
service as a dependency, use the <code translate="no" class="notranslate">container.service_subscriber</code> tag to map a
service type to a service.</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-8068e8345048637f3b1a02b5bf1e0b8321efa195" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-2f232efb49b756c18edb16b4538cbf7ab768cd44" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-685a0af9cfe10dc21e94cb59151b692375596303" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-8068e8345048637f3b1a02b5bf1e0b8321efa195" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/services.yaml</span>
<span class="hljs-attr">services:</span>
    <span class="hljs-string">App\CommandBus:</span>
        <span class="hljs-attr">tags:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">{</span> <span class="hljs-attr">name:</span> <span class="hljs-string">'container.service_subscriber'</span><span class="hljs-string">,</span> <span class="hljs-attr">key:</span> <span class="hljs-string">'logger'</span><span class="hljs-string">,</span> <span class="hljs-attr">id:</span> <span class="hljs-string">'monolog.logger.event'</span> <span class="hljs-string">}</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-2f232efb49b756c18edb16b4538cbf7ab768cd44" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/services.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services https://symfony.com/schema/dic/services/services-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">services</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"App\CommandBus"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tag</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"container.service_subscriber"</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"logger"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"monolog.logger.event"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-name">services</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-685a0af9cfe10dc21e94cb59151b692375596303" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/services.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Loader</span>\<span class="hljs-title">Configurator</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">CommandBus</span>;

<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ContainerConfigurator <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span><span class="hljs-operator">-&gt;</span>services();

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span><span class="hljs-operator">-&gt;</span>set(CommandBus<span class="hljs-operator">::</span>class)
        <span class="hljs-operator">-&gt;</span>tag(<span class="hljs-string">'container.service_subscriber'</span>, [<span class="hljs-string">'key'</span> =&gt; <span class="hljs-string">'logger'</span>, <span class="hljs-string">'id'</span> =&gt; <span class="hljs-string">'monolog.logger.event'</span>]);
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<div class="admonition admonition-tip ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                <span>Tip</span>
    </p><p>The <code translate="no" class="notranslate">key</code> attribute can be omitted if the service name internally is the
same as in the service container.</p>
</div>
</div>
<div class="section">
<h3 id="add-dependency-injection-attributes">
    Add Dependency Injection Attributes
    <a class="headerlink" href="#add-dependency-injection-attributes" title="Permalink to this headline">¶</a>
</h3>
<div class="admonition admonition-versionadded ">
    <p class="admonition-title">
                                    <span>6.2</span>
    </p><p>The ability to add attributes was introduced in Symfony 6.2.</p>
</div>
<p>As an alternate to aliasing services in your configuration, you can also configure
the following dependency injection attributes in the <code translate="no" class="notranslate">getSubscribedServices()</code>
method directly:</p>
<ul>
    <li><a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/DependencyInjection/Attribute/Autowire.php" class="reference external" title="Symfony\Component\DependencyInjection\Attribute\Autowire" rel="external noopener noreferrer" target="_blank">Autowire</a></li>
<li><a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/DependencyInjection/Attribute/TaggedIterator.php" class="reference external" title="Symfony\Component\DependencyInjection\Attribute\TaggedIterator" rel="external noopener noreferrer" target="_blank">TaggedIterator</a></li>
<li><a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/DependencyInjection/Attribute/TaggedLocator.php" class="reference external" title="Symfony\Component\DependencyInjection\Attribute\TaggedLocator" rel="external noopener noreferrer" target="_blank">TaggedLocator</a></li>
<li><a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/DependencyInjection/Attribute/Target.php" class="reference external" title="Symfony\Component\DependencyInjection\Attribute\Target" rel="external noopener noreferrer" target="_blank">Target</a></li>
<li><a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/DependencyInjection/Attribute/AutowireDecorated.php" class="reference external" title="Symfony\Component\DependencyInjection\Attribute\AutowireDecorated" rel="external noopener noreferrer" target="_blank">AutowireDecorated</a></li>
</ul>
<p>This is done by having <code translate="no" class="notranslate">getSubscribedServices()</code> return an array of
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Contracts/Service/Attribute/SubscribedService.php" class="reference external" title="Symfony\Contracts\Service\Attribute\SubscribedService" rel="external noopener noreferrer" target="_blank">SubscribedService</a> objects
(these can be combined with standard <code translate="no" class="notranslate">string[]</code> values):</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Psr</span>\<span class="hljs-title">Container</span>\<span class="hljs-title">ContainerInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Psr</span>\<span class="hljs-title">Log</span>\<span class="hljs-title">LoggerInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Attribute</span>\<span class="hljs-title">Autowire</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Attribute</span>\<span class="hljs-title">TaggedIterator</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Attribute</span>\<span class="hljs-title">TaggedLocator</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Attribute</span>\<span class="hljs-title">Target</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">Service</span>\<span class="hljs-title">Attribute</span>\<span class="hljs-title">SubscribedService</span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSubscribedServices</span><span class="hljs-params">()</span>: <span class="hljs-title">array</span>
</span>{
    <span class="hljs-keyword">return</span> [
        <span class="hljs-comment">// ...</span>
        <span class="hljs-keyword">new</span> SubscribedService(<span class="hljs-string">'logger'</span>, LoggerInterface<span class="hljs-operator">::</span>class, attributes: <span class="hljs-keyword">new</span> Autowire(service: <span class="hljs-string">'monolog.logger.event'</span>)),

        <span class="hljs-comment">// can event use parameters</span>
        <span class="hljs-keyword">new</span> SubscribedService(<span class="hljs-string">'env'</span>, <span class="hljs-string">'string'</span>, attributes: <span class="hljs-keyword">new</span> Autowire(<span class="hljs-string">'%kernel.environment%'</span>)),

        <span class="hljs-comment">// Target</span>
        <span class="hljs-keyword">new</span> SubscribedService(<span class="hljs-string">'event.logger'</span>, LoggerInterface<span class="hljs-operator">::</span>class, attributes: <span class="hljs-keyword">new</span> Target(<span class="hljs-string">'eventLogger'</span>)),

        <span class="hljs-comment">// TaggedIterator</span>
        <span class="hljs-keyword">new</span> SubscribedService(<span class="hljs-string">'loggers'</span>, <span class="hljs-string">'iterable'</span>, attributes: <span class="hljs-keyword">new</span> TaggedIterator(<span class="hljs-string">'logger.tag'</span>)),

        <span class="hljs-comment">// TaggedLocator</span>
        <span class="hljs-keyword">new</span> SubscribedService(<span class="hljs-string">'handlers'</span>, ContainerInterface<span class="hljs-operator">::</span>class, attributes: <span class="hljs-keyword">new</span> TaggedLocator(<span class="hljs-string">'handler.tag'</span>)),
    ];
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>The above example requires using <code translate="no" class="notranslate">3.2</code> version or newer of <code translate="no" class="notranslate">symfony/service-contracts</code>.</p>
</div>
<span id="service-subscribers-locators_defining-service-locator"></span>
</div>
</div>
<div class="section">
<h2 id="defining-a-service-locator">
    Defining a Service Locator
    <a class="headerlink" href="#defining-a-service-locator" title="Permalink to this headline">¶</a>
</h2>
<p>To manually define a service locator and inject it to another service, create an
argument of type <code translate="no" class="notranslate">service_locator</code>.</p>
<p>Consider the following <code translate="no" class="notranslate">CommandBus</code> class where you want to inject
some services into it via a service locator:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/CommandBus.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Psr</span>\<span class="hljs-title">Container</span>\<span class="hljs-title">ContainerInterface</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CommandBus</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(
        private ContainerInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>locator</span>,
    )</span> </span>{
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Symfony allows you to inject the service locator using YAML/XML/PHP configuration
or directly via PHP attributes:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-4">
                    <button role="tab" type="button" data-language="php-attributes"
                aria-controls="configuration-block-tabpanel-e50038b520a6b6e21c92e336dc126faa47aa3c06" aria-selected="true"
                data-active="true" >
                <span>Attributes</span>
            </button>
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-1915ed4496e2d6bf8bef1218f4c8259188f67605" aria-selected="false"
                 tabindex="-1">
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-7d861c3169b3182034bfef74e56a1557d95c57a2" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-db074d9723d2570fd3758957aae58fae0a9fb70e" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-e50038b520a6b6e21c92e336dc126faa47aa3c06" aria-label="Attributes" class="configuration-codeblock" data-language="php-attributes" style="">
            <div translate="no" class="highlight-php-attributes highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php-attributes php"><span class="hljs-comment">// src/CommandBus.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Psr</span>\<span class="hljs-title">Container</span>\<span class="hljs-title">ContainerInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Attribute</span>\<span class="hljs-title">TaggedLocator</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CommandBus</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(
        // creates a service locator with all the services tagged with <span class="hljs-string">'app.handler'</span>
        #[TaggedLocator<span class="hljs-params">(<span class="hljs-string">'app.handler'</span>)</span>]
        private ContainerInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>locator</span>,
    )</span> </span>{
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-1915ed4496e2d6bf8bef1218f4c8259188f67605" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="display: none">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/services.yaml</span>
<span class="hljs-attr">services:</span>
    <span class="hljs-string">App\CommandBus:</span>
        <span class="hljs-attr">arguments:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-type">!service_locator</span>
              <span class="hljs-string">App\FooCommand:</span> <span class="hljs-string">'@app.command_handler.foo'</span>
              <span class="hljs-string">App\BarCommand:</span> <span class="hljs-string">'@app.command_handler.bar'</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-7d861c3169b3182034bfef74e56a1557d95c57a2" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/services.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services https://symfony.com/schema/dic/services/services-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">services</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"App\CommandBus"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"service_locator"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"App\FooCommand"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"service"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app.command_handler.foo"</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"App\BarCommand"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"service"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app.command_handler.bar"</span>/&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">services</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-db074d9723d2570fd3758957aae58fae0a9fb70e" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/services.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Loader</span>\<span class="hljs-title">Configurator</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">CommandBus</span>;

<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ContainerConfigurator <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span><span class="hljs-operator">-&gt;</span>services();

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span><span class="hljs-operator">-&gt;</span>set(CommandBus<span class="hljs-operator">::</span>class)
        <span class="hljs-operator">-&gt;</span>args([service_locator([
            <span class="hljs-string">'App\FooCommand'</span> =&gt; service(<span class="hljs-string">'app.command_handler.foo'</span>),
            <span class="hljs-string">'App\BarCommand'</span> =&gt; service(<span class="hljs-string">'app.command_handler.bar'</span>),
        ])]);
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>As shown in the previous sections, the constructor of the <code translate="no" class="notranslate">CommandBus</code> class
must type-hint its argument with <code translate="no" class="notranslate">ContainerInterface</code>. Then, you can get any of
the service locator services via their ID (e.g. <code translate="no" class="notranslate">$this-&gt;locator-&gt;get(&#039;App\FooCommand&#039;)</code>).</p>
<div class="section">
<h3 id="reusing-a-service-locator-in-multiple-services">
    Reusing a Service Locator in Multiple Services
    <a class="headerlink" href="#reusing-a-service-locator-in-multiple-services" title="Permalink to this headline">¶</a>
</h3>
<p>If you inject the same service locator in several services, it's better to
define the service locator as a stand-alone service and then inject it in the
other services. To do so, create a new service definition using the
<code translate="no" class="notranslate">ServiceLocator</code> class:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-03757088a21c9bb4f1afe0c661faa4652aa86238" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-0402100fb46771cfe2820ff25ce82a5a0729e419" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-8bfde1e94af50f5def41b892c8c12a920565b525" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-03757088a21c9bb4f1afe0c661faa4652aa86238" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/services.yaml</span>
<span class="hljs-attr">services:</span>
    <span class="hljs-attr">app.command_handler_locator:</span>
        <span class="hljs-attr">class:</span> <span class="hljs-string">Symfony\Component\DependencyInjection\ServiceLocator</span>
        <span class="hljs-attr">arguments:</span>
            <span class="hljs-bullet">-</span>
                <span class="hljs-string">App\FooCommand:</span> <span class="hljs-string">'@app.command_handler.foo'</span>
                <span class="hljs-string">App\BarCommand:</span> <span class="hljs-string">'@app.command_handler.bar'</span>
        <span class="hljs-comment"># if you are not using the default service autoconfiguration,</span>
        <span class="hljs-comment"># add the following tag to the service definition:</span>
        <span class="hljs-comment"># tags: ['container.service_locator']</span>

    <span class="hljs-comment"># if the element has no key, the ID of the original service is used</span>
    <span class="hljs-attr">app.another_command_handler_locator:</span>
        <span class="hljs-attr">class:</span> <span class="hljs-string">Symfony\Component\DependencyInjection\ServiceLocator</span>
        <span class="hljs-attr">arguments:</span>
            <span class="hljs-bullet">-</span>
                <span class="hljs-bullet">-</span> <span class="hljs-string">'@app.command_handler.baz'</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-0402100fb46771cfe2820ff25ce82a5a0729e419" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/services.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services https://symfony.com/schema/dic/services/services-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">services</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app.command_handler_locator"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"Symfony\Component\DependencyInjection\ServiceLocator"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"collection"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"App\FooCommand"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"service"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app.command_handler.foo"</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"App\BarCommand"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"service"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app.command_handler.bar"</span>/&gt;</span>
                <span class="hljs-comment">&lt;!-- if the element has no key, the ID of the original service is used --&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"service"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app.command_handler.baz"</span>/&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
            <span class="hljs-comment">&lt;!--
                if you are not using the default service autoconfiguration,
                add the following tag to the service definition:
                &lt;tag name="container.service_locator"/&gt;
            --&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-name">services</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-8bfde1e94af50f5def41b892c8c12a920565b525" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/services.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Loader</span>\<span class="hljs-title">Configurator</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">ServiceLocator</span>;

<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ContainerConfigurator <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span><span class="hljs-operator">-&gt;</span>services();

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span><span class="hljs-operator">-&gt;</span>set(<span class="hljs-string">'app.command_handler_locator'</span>, ServiceLocator<span class="hljs-operator">::</span>class)
        <span class="hljs-operator">-&gt;</span>args([[
            <span class="hljs-string">'App\FooCommand'</span> =&gt; service(<span class="hljs-string">'app.command_handler.foo'</span>),
            <span class="hljs-string">'App\BarCommand'</span> =&gt; service(<span class="hljs-string">'app.command_handler.bar'</span>),
        ]])
        <span class="hljs-comment">// if you are not using the default service autoconfiguration,</span>
        <span class="hljs-comment">// add the following tag to the service definition:</span>
        <span class="hljs-comment">// -&gt;tag('container.service_locator')</span>
    ;

    <span class="hljs-comment">// if the element has no key, the ID of the original service is used</span>
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span><span class="hljs-operator">-&gt;</span>set(<span class="hljs-string">'app.another_command_handler_locator'</span>, ServiceLocator<span class="hljs-operator">::</span>class)
        <span class="hljs-operator">-&gt;</span>args([[
            service(<span class="hljs-string">'app.command_handler.baz'</span>),
        ]])
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>The services defined in the service locator argument must include keys,
which later become their unique identifiers inside the locator.</p>
</div>
<p>Now you can inject the service locator in any other services:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-c76697541276ec85b88d549989e41cd169502475" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-b5ae54d47d3e0d3ece96dc61e6e0ec9975ef94a9" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-fd38c78aab0c50f66cb6e4f771a6cdf982d34982" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-c76697541276ec85b88d549989e41cd169502475" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/services.yaml</span>
<span class="hljs-attr">services:</span>
    <span class="hljs-string">App\CommandBus:</span>
        <span class="hljs-attr">arguments:</span> <span class="hljs-string">['@app.command_handler_locator']</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-b5ae54d47d3e0d3ece96dc61e6e0ec9975ef94a9" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/services.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services https://symfony.com/schema/dic/services/services-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">services</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"App\CommandBus"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"service"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app.command_handler_locator"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-name">services</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-fd38c78aab0c50f66cb6e4f771a6cdf982d34982" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/services.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Loader</span>\<span class="hljs-title">Configurator</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">CommandBus</span>;

<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ContainerConfigurator <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span><span class="hljs-operator">-&gt;</span>services();

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span><span class="hljs-operator">-&gt;</span>set(CommandBus<span class="hljs-operator">::</span>class)
        <span class="hljs-operator">-&gt;</span>args([service(<span class="hljs-string">'app.command_handler_locator'</span>)]);
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
</div>
<div class="section">
<h3 id="using-service-locators-in-compiler-passes">
    Using Service Locators in Compiler Passes
    <a class="headerlink" href="#using-service-locators-in-compiler-passes" title="Permalink to this headline">¶</a>
</h3>
<p>In <a href="compiler_passes.html" class="reference internal">compiler passes</a> it's recommended
to use the <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/DependencyInjection/Compiler/ServiceLocatorTagPass.php#method_register" class="reference external" title="Symfony\Component\DependencyInjection\Compiler\ServiceLocatorTagPass::register()" rel="external noopener noreferrer" target="_blank">register()</a>
method to create the service locators. This will save you some boilerplate and
will share identical locators among all the services referencing them:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Compiler</span>\<span class="hljs-title">ServiceLocatorTagPass</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">ContainerBuilder</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Reference</span>;

<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">process</span><span class="hljs-params">(ContainerBuilder <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerBuilder</span>)</span>: <span class="hljs-title">void</span>
</span>{
    <span class="hljs-comment">// ...</span>

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>locateableServices</span> = [
        <span class="hljs-comment">// ...</span>
        <span class="hljs-string">'logger'</span> =&gt; <span class="hljs-keyword">new</span> Reference(<span class="hljs-string">'logger'</span>),
    ];

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>myService</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerBuilder</span><span class="hljs-operator">-&gt;</span>findDefinition(MyService<span class="hljs-operator">::</span>class);

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>myService</span><span class="hljs-operator">-&gt;</span>addArgument(ServiceLocatorTagPass<span class="hljs-operator">::</span>register(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerBuilder</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>locateableServices</span>));
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
<div class="section">
<h3 id="indexing-the-collection-of-services">
    Indexing the Collection of Services
    <a class="headerlink" href="#indexing-the-collection-of-services" title="Permalink to this headline">¶</a>
</h3>
<p>Services passed to the service locator can define their own index using an
arbitrary attribute whose name is defined as <code translate="no" class="notranslate">index_by</code> in the service locator.</p>
<p>In the following example, the <code translate="no" class="notranslate">App\Handler\HandlerCollection</code> locator receives
all services tagged with <code translate="no" class="notranslate">app.handler</code> and they are indexed using the value
of the <code translate="no" class="notranslate">key</code> tag attribute (as defined in the <code translate="no" class="notranslate">index_by</code> locator option):</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-4">
                    <button role="tab" type="button" data-language="php-attributes"
                aria-controls="configuration-block-tabpanel-8bd2b2c0f6d402d1138d063a89bb07670cdef5b2" aria-selected="true"
                data-active="true" >
                <span>Attributes</span>
            </button>
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-5b90f30d39bd0f5626abcd53441561e084f5fe76" aria-selected="false"
                 tabindex="-1">
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-6f6496f05e3fef68270ff1a4812042b07f8be0fb" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-4f93e0686647a2ab15012a0933adb1c24e3e7ad3" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-8bd2b2c0f6d402d1138d063a89bb07670cdef5b2" aria-label="Attributes" class="configuration-codeblock" data-language="php-attributes" style="">
            <div translate="no" class="highlight-php-attributes highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php-attributes php"><span class="hljs-comment">// src/CommandBus.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Psr</span>\<span class="hljs-title">Container</span>\<span class="hljs-title">ContainerInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Attribute</span>\<span class="hljs-title">TaggedLocator</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CommandBus</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(
        #[TaggedLocator<span class="hljs-params">(<span class="hljs-string">'app.handler'</span>, indexAttribute: <span class="hljs-string">'key'</span>)</span>]
        private ContainerInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>locator</span>,
    )</span> </span>{
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-5b90f30d39bd0f5626abcd53441561e084f5fe76" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="display: none">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/services.yaml</span>
<span class="hljs-attr">services:</span>
    <span class="hljs-string">App\Handler\One:</span>
        <span class="hljs-attr">tags:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">{</span> <span class="hljs-attr">name:</span> <span class="hljs-string">'app.handler'</span><span class="hljs-string">,</span> <span class="hljs-attr">key:</span> <span class="hljs-string">'handler_one'</span> <span class="hljs-string">}</span>

    <span class="hljs-string">App\Handler\Two:</span>
        <span class="hljs-attr">tags:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">{</span> <span class="hljs-attr">name:</span> <span class="hljs-string">'app.handler'</span><span class="hljs-string">,</span> <span class="hljs-attr">key:</span> <span class="hljs-string">'handler_two'</span> <span class="hljs-string">}</span>

    <span class="hljs-string">App\Handler\HandlerCollection:</span>
        <span class="hljs-comment"># inject all services tagged with app.handler as first argument</span>
        <span class="hljs-attr">arguments:</span> <span class="hljs-string">[!tagged_locator</span> <span class="hljs-string">{</span> <span class="hljs-attr">tag:</span> <span class="hljs-string">'app.handler'</span><span class="hljs-string">,</span> <span class="hljs-attr">index_by:</span> <span class="hljs-string">'key'</span> <span class="hljs-string">}]</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-6f6496f05e3fef68270ff1a4812042b07f8be0fb" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/services.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">services</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"App\Handler\One"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tag</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"app.handler"</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"handler_one"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"App\Handler\Two"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tag</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"app.handler"</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"handler_two"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"App\HandlerCollection"</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- inject all services tagged with app.handler as first argument --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"tagged_locator"</span> <span class="hljs-attr">tag</span>=<span class="hljs-string">"app.handler"</span> <span class="hljs-attr">index-by</span>=<span class="hljs-string">"key"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">services</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-4f93e0686647a2ab15012a0933adb1c24e3e7ad3" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/services.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Loader</span>\<span class="hljs-title">Configurator</span>;

<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ContainerConfigurator <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span><span class="hljs-operator">-&gt;</span>services();

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span><span class="hljs-operator">-&gt;</span>set(App\Handler\One<span class="hljs-operator">::</span>class)
        <span class="hljs-operator">-&gt;</span>tag(<span class="hljs-string">'app.handler'</span>, [<span class="hljs-string">'key'</span> =&gt; <span class="hljs-string">'handler_one'</span>])
    ;

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span><span class="hljs-operator">-&gt;</span>set(App\Handler\Two<span class="hljs-operator">::</span>class)
        <span class="hljs-operator">-&gt;</span>tag(<span class="hljs-string">'app.handler'</span>, [<span class="hljs-string">'key'</span> =&gt; <span class="hljs-string">'handler_two'</span>])
    ;

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span><span class="hljs-operator">-&gt;</span>set(App\Handler\HandlerCollection<span class="hljs-operator">::</span>class)
        <span class="hljs-comment">// inject all services tagged with app.handler as first argument</span>
        <span class="hljs-operator">-&gt;</span>args([tagged_locator(<span class="hljs-string">'app.handler'</span>, <span class="hljs-string">'key'</span>)])
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>Inside this locator you can retrieve services by index using the value of the
<code translate="no" class="notranslate">key</code> attribute. For example, to get the <code translate="no" class="notranslate">App\Handler\Two</code> service:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Handler/HandlerCollection.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Handler</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Psr</span>\<span class="hljs-title">Container</span>\<span class="hljs-title">ContainerInterface</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HandlerCollection</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getHandlerTwo</span><span class="hljs-params">(ContainerInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>locator</span>)</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>locator</span><span class="hljs-operator">-&gt;</span>get(<span class="hljs-string">'handler_two'</span>);
    }

    <span class="hljs-comment">// ...</span>
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Instead of defining the index in the service definition, you can return its
value in a method called <code translate="no" class="notranslate">getDefaultIndexName()</code> inside the class associated
to the service:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Handler/One.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Handler</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">One</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getDefaultIndexName</span><span class="hljs-params">()</span>: <span class="hljs-title">string</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">'handler_one'</span>;
    }

    <span class="hljs-comment">// ...</span>
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>If you prefer to use another method name, add a <code translate="no" class="notranslate">default_index_method</code>
attribute to the locator service defining the name of this custom method:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-4">
                    <button role="tab" type="button" data-language="php-attributes"
                aria-controls="configuration-block-tabpanel-62051d9ecdc80a61e1fe1a0346ea8217644f01c1" aria-selected="true"
                data-active="true" >
                <span>Attributes</span>
            </button>
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-d0f062fec01766542ed8ed78c7ce627a7a6d127e" aria-selected="false"
                 tabindex="-1">
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-67504fcc573192717d5e1c5897150d489e89fbf7" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-49dc6bbba7197baaf6dd79b4741798b19ac756cc" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-62051d9ecdc80a61e1fe1a0346ea8217644f01c1" aria-label="Attributes" class="configuration-codeblock" data-language="php-attributes" style="">
            <div translate="no" class="highlight-php-attributes highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php-attributes php"><span class="hljs-comment">// src/CommandBus.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Psr</span>\<span class="hljs-title">Container</span>\<span class="hljs-title">ContainerInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Attribute</span>\<span class="hljs-title">TaggedLocator</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CommandBus</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(
        #[TaggedLocator<span class="hljs-params">(<span class="hljs-string">'app.handler'</span>, <span class="hljs-string">'key'</span>, defaultIndexMethod: <span class="hljs-string">'myOwnMethodName'</span>)</span>]
        private ContainerInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>locator</span>,
    )</span> </span>{
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-d0f062fec01766542ed8ed78c7ce627a7a6d127e" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="display: none">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/services.yaml</span>
<span class="hljs-attr">services:</span>
    <span class="hljs-comment"># ...</span>

    <span class="hljs-string">App\HandlerCollection:</span>
        <span class="hljs-attr">arguments:</span> <span class="hljs-string">[!tagged_locator</span> <span class="hljs-string">{</span> <span class="hljs-attr">tag:</span> <span class="hljs-string">'app.handler'</span><span class="hljs-string">,</span> <span class="hljs-attr">index_by:</span> <span class="hljs-string">'key'</span><span class="hljs-string">,</span> <span class="hljs-attr">default_index_method:</span> <span class="hljs-string">'myOwnMethodName'</span> <span class="hljs-string">}]</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-67504fcc573192717d5e1c5897150d489e89fbf7" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/services.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">services</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- ... --&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"App\HandlerCollection"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"tagged_locator"</span> <span class="hljs-attr">tag</span>=<span class="hljs-string">"app.handler"</span> <span class="hljs-attr">index-by</span>=<span class="hljs-string">"key"</span> <span class="hljs-attr">default-index-method</span>=<span class="hljs-string">"myOwnMethodName"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">services</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-49dc6bbba7197baaf6dd79b4741798b19ac756cc" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/services.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Loader</span>\<span class="hljs-title">Configurator</span>;

<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ContainerConfigurator <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span><span class="hljs-operator">-&gt;</span>services()
        <span class="hljs-operator">-&gt;</span>set(App\HandlerCollection<span class="hljs-operator">::</span>class)
            <span class="hljs-operator">-&gt;</span>args([tagged_locator(<span class="hljs-string">'app.handler'</span>, <span class="hljs-string">'key'</span>, <span class="hljs-string">'myOwnMethodName'</span>)])
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>Since code should not be responsible for defining how the locators are
going to be used, a configuration key (<code translate="no" class="notranslate">key</code> in the example above) must
be set so the custom method may be called as a fallback.</p>
</div>
<span id="service-subscribers-service-subscriber-trait"></span>
</div>
</div>
<div class="section">
<h2 id="service-subscriber-trait">
    Service Subscriber Trait
    <a class="headerlink" href="#service-subscriber-trait" title="Permalink to this headline">¶</a>
</h2>
<p>The <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Contracts/Service/ServiceSubscriberTrait.php" class="reference external" title="Symfony\Contracts\Service\ServiceSubscriberTrait" rel="external noopener noreferrer" target="_blank">ServiceSubscriberTrait</a> provides an
implementation for <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Contracts/Service/ServiceSubscriberInterface.php" class="reference external" title="Symfony\Contracts\Service\ServiceSubscriberInterface" rel="external noopener noreferrer" target="_blank">ServiceSubscriberInterface</a>
that looks through all methods in your class that are marked with the
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Contracts/Service/Attribute/SubscribedService.php" class="reference external" title="Symfony\Contracts\Service\Attribute\SubscribedService" rel="external noopener noreferrer" target="_blank">SubscribedService</a> attribute. It
describes the services needed by the class based on each method's return type.
The service id is <code translate="no" class="notranslate">__METHOD__</code>. This allows you to add dependencies to your
services based on type-hinted helper methods:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Service/MyService.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Service</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Psr</span>\<span class="hljs-title">Log</span>\<span class="hljs-title">LoggerInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Routing</span>\<span class="hljs-title">RouterInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">Service</span>\<span class="hljs-title">Attribute</span>\<span class="hljs-title">SubscribedService</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">Service</span>\<span class="hljs-title">ServiceSubscriberInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">Service</span>\<span class="hljs-title">ServiceSubscriberTrait</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ServiceSubscriberInterface</span>
</span>{
    <span class="hljs-keyword">use</span> <span class="hljs-title">ServiceSubscriberTrait</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doSomething</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-comment">// $this-&gt;router() ...</span>
        <span class="hljs-comment">// $this-&gt;logger() ...</span>
    }

    <span class="hljs-comment">#[SubscribedService]</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">router</span><span class="hljs-params">()</span>: <span class="hljs-title">RouterInterface</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>container<span class="hljs-operator">-&gt;</span>get(<span class="hljs-keyword">__METHOD__</span>);
    }

    <span class="hljs-comment">#[SubscribedService]</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">logger</span><span class="hljs-params">()</span>: <span class="hljs-title">LoggerInterface</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>container<span class="hljs-operator">-&gt;</span>get(<span class="hljs-keyword">__METHOD__</span>);
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>This  allows you to create helper traits like RouterAware, LoggerAware, etc...
and compose your services with them:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Service/LoggerAware.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Service</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Psr</span>\<span class="hljs-title">Log</span>\<span class="hljs-title">LoggerInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">Service</span>\<span class="hljs-title">Attribute</span>\<span class="hljs-title">SubscribedService</span>;

<span class="hljs-keyword">trait</span> LoggerAware
{
    <span class="hljs-comment">#[SubscribedService]</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">logger</span><span class="hljs-params">()</span>: <span class="hljs-title">LoggerInterface</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>container<span class="hljs-operator">-&gt;</span>get(<span class="hljs-keyword">__CLASS__</span>.<span class="hljs-string">'::'</span>.<span class="hljs-keyword">__FUNCTION__</span>);
    }
}

<span class="hljs-comment">// src/Service/RouterAware.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Service</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Routing</span>\<span class="hljs-title">RouterInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">Service</span>\<span class="hljs-title">Attribute</span>\<span class="hljs-title">SubscribedService</span>;

<span class="hljs-keyword">trait</span> RouterAware
{
    <span class="hljs-comment">#[SubscribedService]</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">router</span><span class="hljs-params">()</span>: <span class="hljs-title">RouterInterface</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>container<span class="hljs-operator">-&gt;</span>get(<span class="hljs-keyword">__CLASS__</span>.<span class="hljs-string">'::'</span>.<span class="hljs-keyword">__FUNCTION__</span>);
    }
}

<span class="hljs-comment">// src/Service/MyService.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Service</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">Service</span>\<span class="hljs-title">ServiceSubscriberInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">Service</span>\<span class="hljs-title">ServiceSubscriberTrait</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ServiceSubscriberInterface</span>
</span>{
    <span class="hljs-keyword">use</span> <span class="hljs-title">ServiceSubscriberTrait</span>, <span class="hljs-title">LoggerAware</span>, <span class="hljs-title">RouterAware</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doSomething</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-comment">// $this-&gt;router() ...</span>
        <span class="hljs-comment">// $this-&gt;logger() ...</span>
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-caution ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                <span>Caution</span>
    </p><p>When creating these helper traits, the service id cannot be <code translate="no" class="notranslate">__METHOD__</code>
as this will include the trait name, not the class name. Instead, use
<code translate="no" class="notranslate">__CLASS__.&#039;::&#039;.__FUNCTION__</code> as the service id.</p>
</div>
<div class="section">
<h3 id="subscribedservice-attributes">
    <code translate="no" class="notranslate">SubscribedService</code> Attributes
    <a class="headerlink" href="#subscribedservice-attributes" title="Permalink to this headline">¶</a>
</h3>
<div class="admonition admonition-versionadded ">
    <p class="admonition-title">
                                    <span>6.2</span>
    </p><p>The ability to add attributes was introduced in Symfony 6.2.</p>
</div>
<p>You can use the <code translate="no" class="notranslate">attributes</code> argument of <code translate="no" class="notranslate">SubscribedService</code> to add any
of the following dependency injection attributes:</p>
<ul>
    <li><a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/DependencyInjection/Attribute/Autowire.php" class="reference external" title="Symfony\Component\DependencyInjection\Attribute\Autowire" rel="external noopener noreferrer" target="_blank">Autowire</a></li>
<li><a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/DependencyInjection/Attribute/TaggedIterator.php" class="reference external" title="Symfony\Component\DependencyInjection\Attribute\TaggedIterator" rel="external noopener noreferrer" target="_blank">TaggedIterator</a></li>
<li><a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/DependencyInjection/Attribute/TaggedLocator.php" class="reference external" title="Symfony\Component\DependencyInjection\Attribute\TaggedLocator" rel="external noopener noreferrer" target="_blank">TaggedLocator</a></li>
<li><a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/DependencyInjection/Attribute/Target.php" class="reference external" title="Symfony\Component\DependencyInjection\Attribute\Target" rel="external noopener noreferrer" target="_blank">Target</a></li>
<li><a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/DependencyInjection/Attribute/AutowireDecorated.php" class="reference external" title="Symfony\Component\DependencyInjection\Attribute\AutowireDecorated" rel="external noopener noreferrer" target="_blank">AutowireDecorated</a></li>
</ul>
<p>Here's an example:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Service/MyService.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Service</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Psr</span>\<span class="hljs-title">Log</span>\<span class="hljs-title">LoggerInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Attribute</span>\<span class="hljs-title">Autowire</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Attribute</span>\<span class="hljs-title">Target</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Routing</span>\<span class="hljs-title">RouterInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">Service</span>\<span class="hljs-title">Attribute</span>\<span class="hljs-title">SubscribedService</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">Service</span>\<span class="hljs-title">ServiceSubscriberInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">Service</span>\<span class="hljs-title">ServiceSubscriberTrait</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ServiceSubscriberInterface</span>
</span>{
    <span class="hljs-keyword">use</span> <span class="hljs-title">ServiceSubscriberTrait</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doSomething</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-comment">// $this-&gt;environment() ...</span>
        <span class="hljs-comment">// $this-&gt;router() ...</span>
        <span class="hljs-comment">// $this-&gt;logger() ...</span>
    }

    <span class="hljs-comment">#[SubscribedService(attributes: new Autowire('%kernel.environment%'))]</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">environment</span><span class="hljs-params">()</span>: <span class="hljs-title">string</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>container<span class="hljs-operator">-&gt;</span>get(<span class="hljs-keyword">__METHOD__</span>);
    }

    <span class="hljs-comment">#[SubscribedService(attributes: new Autowire(service: 'router'))]</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">router</span><span class="hljs-params">()</span>: <span class="hljs-title">RouterInterface</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>container<span class="hljs-operator">-&gt;</span>get(<span class="hljs-keyword">__METHOD__</span>);
    }

    <span class="hljs-comment">#[SubscribedService(attributes: new Target('requestLogger'))]</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">logger</span><span class="hljs-params">()</span>: <span class="hljs-title">LoggerInterface</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>container<span class="hljs-operator">-&gt;</span>get(<span class="hljs-keyword">__METHOD__</span>);
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>The above example requires using <code translate="no" class="notranslate">3.2</code> version or newer of <code translate="no" class="notranslate">symfony/service-contracts</code>.</p>
</div>
</div>
</div>
<div class="section">
<h2 id="testing-a-service-subscriber">
    Testing a Service Subscriber
    <a class="headerlink" href="#testing-a-service-subscriber" title="Permalink to this headline">¶</a>
</h2>
<p>To unit test a service subscriber, you can create a fake container:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">Service</span>\<span class="hljs-title">ServiceLocatorTrait</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">Service</span>\<span class="hljs-title">ServiceProviderInterface</span>;

<span class="hljs-comment">// Create the fake services</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>foo</span> = <span class="hljs-keyword">new</span> stdClass();
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>bar</span> = <span class="hljs-keyword">new</span> stdClass();
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>bar</span><span class="hljs-operator">-&gt;</span>foo = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>foo</span>;

<span class="hljs-comment">// Create the fake container</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>container</span> = <span class="hljs-keyword">new</span> <span class="hljs-class"><span class="hljs-keyword">class</span>([
    '<span class="hljs-title">foo</span>' =&gt; <span class="hljs-title">fn</span> () =&gt; $<span class="hljs-title">foo</span>,
    '<span class="hljs-title">bar</span>' =&gt; <span class="hljs-title">fn</span> () =&gt; $<span class="hljs-title">bar</span>,
]) <span class="hljs-keyword">implements</span> <span class="hljs-title">ServiceProviderInterface</span> </span>{
    <span class="hljs-keyword">use</span> <span class="hljs-title">ServiceLocatorTrait</span>;
};

<span class="hljs-comment">// Create the service subscriber</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>serviceSubscriber</span> = <span class="hljs-keyword">new</span> MyService(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>container</span>);
<span class="hljs-comment">// ...</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Another alternative is to mock it using <code translate="no" class="notranslate">PHPUnit</code>:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Psr</span>\<span class="hljs-title">Container</span>\<span class="hljs-title">ContainerInterface</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>container</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>createMock(ContainerInterface<span class="hljs-operator">::</span>class);
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>container</span><span class="hljs-operator">-&gt;</span>expects(<span class="hljs-keyword">self</span><span class="hljs-operator">::</span>any())
    <span class="hljs-operator">-&gt;</span>method(<span class="hljs-string">'get'</span>)
    <span class="hljs-operator">-&gt;</span>willReturnMap([
        [<span class="hljs-string">'foo'</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>createStub(Foo<span class="hljs-operator">::</span>class)],
        [<span class="hljs-string">'bar'</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>createStub(Bar<span class="hljs-operator">::</span>class)],
    ])
;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>serviceSubscriber</span> = <span class="hljs-keyword">new</span> MyService(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>container</span>);
<span class="hljs-comment">// ...</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
</div>

                            </div>                    </div>
                                    </div>        </div>

    </section>

</div>


<script type="text/javascript" src="assets/js/theme.js"></script>
<script type="text/javascript" src="assets/js/badge_only.js"></script>

 
</body>
</html>