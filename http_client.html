        
<!DOCTYPE html>
<!--[if IE 8]>
<html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en"> <!--<![endif]-->
<head><base href="/">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
            
                                
    
    <link rel="stylesheet" href="assets/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/highlightjs.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/badge_only.css" type="text/css" />

</head>

<body class="wy-body-for-nav">
 <div class="wy-grid-for-nav">

        <nav data-toggle="wy-nav-shift" class="wy-nav-side">
        <div class="wy-side-scroll">
            <div class="wy-side-nav-search">
                
                                                                                                    
                                                                                                                                                                        </div>

            <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                                                                                                                                                                                                                                                                                                                            </div>
        </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

                                                        

        <div class="wy-nav-content">                <div class="rst-content">
                                        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">                            <div itemprop="articleBody">
                                    <div class="section">
<h1 id="http-client">
    HTTP Client
    <a class="headerlink" href="#http-client" title="Permalink to this headline">¶</a>
</h1>
<div class="section">
<h2 id="installation">
    Installation
    <a class="headerlink" href="#installation" title="Permalink to this headline">¶</a>
</h2>
<p>The HttpClient component is a low-level HTTP client with support for both
PHP stream wrappers and cURL. It provides utilities to consume APIs and
supports synchronous and asynchronous operations. You can install it with:</p>
<div translate="no" class="highlight-terminal highlight-bash notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs terminal bash"><span class="hljs-prompt">$ </span>composer require symfony/http-client</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
<div class="section">
<h2 id="basic-usage">
    Basic Usage
    <a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a>
</h2>
<p>Use the <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpClient/HttpClient.php" class="reference external" title="Symfony\Component\HttpClient\HttpClient" rel="external noopener noreferrer" target="_blank">HttpClient</a> class to make
requests. In the Symfony framework, this class is available as the
<code translate="no" class="notranslate">http_client</code> service. This service will be <a href="service_container/autowiring.html" class="reference internal">autowired</a>
automatically when type-hinting for <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Contracts/HttpClient/HttpClientInterface.php" class="reference external" title="Symfony\Contracts\HttpClient\HttpClientInterface" rel="external noopener noreferrer" target="_blank">HttpClientInterface</a>:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-2">
                    <button role="tab" type="button" data-language="php-symfony"
                aria-controls="configuration-block-tabpanel-2b2ffef2afe35c1a688ad3b8fc6455350d759fab" aria-selected="true"
                data-active="true" >
                <span>Framework Use</span>
            </button>
                    <button role="tab" type="button" data-language="php-standalone"
                aria-controls="configuration-block-tabpanel-7aaa396f486255e601de3841d6ddc6eda4de8582" aria-selected="false"
                 tabindex="-1">
                <span>Standalone Use</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-2b2ffef2afe35c1a688ad3b8fc6455350d759fab" aria-label="Framework Use" class="configuration-codeblock" data-language="php-symfony" style="">
            <div translate="no" class="highlight-php-symfony highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php-symfony php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">HttpClientInterface</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SymfonyDocs</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(
        private HttpClientInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span>,
    )</span> </span>{
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fetchGitHubInformation</span><span class="hljs-params">()</span>: <span class="hljs-title">array</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>client<span class="hljs-operator">-&gt;</span>request(
            <span class="hljs-string">'GET'</span>,
            <span class="hljs-string">'https://api.github.com/repos/symfony/symfony-docs'</span>
        );

        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>statusCode</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>getStatusCode();
        <span class="hljs-comment">// $statusCode = 200</span>
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>contentType</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>getHeaders()[<span class="hljs-string">'content-type'</span>][<span class="hljs-number">0</span>];
        <span class="hljs-comment">// $contentType = 'application/json'</span>
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>content</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>getContent();
        <span class="hljs-comment">// $content = '{"id":521583, "name":"symfony-docs", ...}'</span>
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>content</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>toArray();
        <span class="hljs-comment">// $content = ['id' =&gt; 521583, 'name' =&gt; 'symfony-docs', ...]</span>

        <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>content</span>;
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-7aaa396f486255e601de3841d6ddc6eda4de8582" aria-label="Standalone Use" class="configuration-codeblock" data-language="php-standalone" style="display: none">
            <div translate="no" class="highlight-php-standalone highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php-standalone php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">HttpClient</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span> = HttpClient<span class="hljs-operator">::</span>create();
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'https://api.github.com/repos/symfony/symfony-docs'</span>);

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>statusCode</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>getStatusCode();
<span class="hljs-comment">// $statusCode = 200</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>contentType</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>getHeaders()[<span class="hljs-string">'content-type'</span>][<span class="hljs-number">0</span>];
<span class="hljs-comment">// $contentType = 'application/json'</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>content</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>getContent();
<span class="hljs-comment">// $content = '{"id":521583, "name":"symfony-docs", ...}'</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>content</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>toArray();
<span class="hljs-comment">// $content = ['id' =&gt; 521583, 'name' =&gt; 'symfony-docs', ...]</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<div class="admonition admonition-tip ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                <span>Tip</span>
    </p><p>The HTTP client is interoperable with many common HTTP client abstractions in
PHP. You can also use any of these abstractions to profit from autowirings.
See <a href="http_client.html#interoperability" class="reference internal">Interoperability</a> for more information.</p>
</div>
</div>
<div class="section">
<h2 id="configuration">
    Configuration
    <a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a>
</h2>
<p>The HTTP client contains many options you might need to take full control of
the way the request is performed, including DNS pre-resolution, SSL parameters,
public key pinning, etc. They can be defined globally in the configuration (to
apply it to all requests) and to each request (which overrides any global
configuration).</p>
<p>You can configure the global options using the <code translate="no" class="notranslate">default_options</code> option:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-4">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-e849953c104a7d913ec3e7b4b4ebf7b316b3549f" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-8559ad0429cd951229644d9d2575553e69cf11c9" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-e836b2df96c11cb632dda6b499619ac77cdb3e38" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
                    <button role="tab" type="button" data-language="php-standalone"
                aria-controls="configuration-block-tabpanel-c107f06e003267ee66da83d1ca730153488555f1" aria-selected="false"
                 tabindex="-1">
                <span>Standalone Use</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-e849953c104a7d913ec3e7b4b4ebf7b316b3549f" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/framework.yaml</span>
<span class="hljs-attr">framework:</span>
    <span class="hljs-attr">http_client:</span>
        <span class="hljs-attr">default_options:</span>
            <span class="hljs-attr">max_redirects:</span> <span class="hljs-number">7</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-8559ad0429cd951229644d9d2575553e69cf11c9" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/packages/framework.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:framework</span>=<span class="hljs-string">"http://symfony.com/schema/dic/symfony"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd
        http://symfony.com/schema/dic/symfony https://symfony.com/schema/dic/symfony/symfony-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">framework:config</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">framework:http-client</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">framework:default-options</span> <span class="hljs-attr">max-redirects</span>=<span class="hljs-string">"7"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">framework:http-client</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">framework:config</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-e836b2df96c11cb632dda6b499619ac77cdb3e38" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/packages/framework.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Config</span>\<span class="hljs-title">FrameworkConfig</span>;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(FrameworkConfig <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span><span class="hljs-operator">-&gt;</span>httpClient()
        <span class="hljs-operator">-&gt;</span>defaultOptions()
            <span class="hljs-operator">-&gt;</span>maxRedirects(<span class="hljs-number">7</span>)
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-c107f06e003267ee66da83d1ca730153488555f1" aria-label="Standalone Use" class="configuration-codeblock" data-language="php-standalone" style="display: none">
            <div translate="no" class="highlight-php-standalone highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php-standalone php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span> = HttpClient<span class="hljs-operator">::</span>create([
     <span class="hljs-string">'max_redirects'</span> =&gt; <span class="hljs-number">7</span>,
]);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>You can also use the <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Contracts/HttpClient/HttpClientInterface.php#method_withOptions" class="reference external" title="Symfony\Contracts\HttpClient\HttpClientInterface::withOptions()" rel="external noopener noreferrer" target="_blank">withOptions()</a>
method to retrieve a new instance of the client with new default options:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>client = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>withOptions([
    <span class="hljs-string">'base_uri'</span> =&gt; <span class="hljs-string">'https://...'</span>,
    <span class="hljs-string">'headers'</span> =&gt; [<span class="hljs-string">'header-name'</span> =&gt; <span class="hljs-string">'header-value'</span>],
    <span class="hljs-string">'extra'</span> =&gt; [<span class="hljs-string">'my-key'</span> =&gt; <span class="hljs-string">'my-value'</span>],
]);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Some options are described in this guide:</p>
<ul>
    <li><a href="http_client.html#authentication" class="reference internal">Authentication</a></li>
<li><a href="http_client.html#query-string-parameters" class="reference internal">Query String Parameters</a></li>
<li><a href="http_client.html#headers" class="reference internal">Headers</a></li>
<li><a href="http_client.html#redirects" class="reference internal">Redirects</a></li>
<li><a href="http_client.html#retry-failed-requests" class="reference internal">Retry Failed Requests</a></li>
<li><a href="http_client.html#http-proxies" class="reference internal">HTTP Proxies</a></li>
<li><a href="http_client.html#using-uri-templates" class="reference internal">Using URI Templates</a></li>
</ul>
<p>Check out the full <a href="reference/configuration/framework.html#reference-http-client" class="reference internal">http_client config reference</a>
to learn about all the options.</p>
<p>The HTTP client also has one configuration option called
<code translate="no" class="notranslate">max_host_connections</code>, this option can not be overridden by a request:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-4">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-f17e92892971a633ec9c18b9cb899ec1ca80e129" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-d2d3d1a38fe9fb99d7a52b17569d29f5b625b0ac" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-20be7edcc70d66ee8525fed96b9f22895f3860c4" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
                    <button role="tab" type="button" data-language="php-standalone"
                aria-controls="configuration-block-tabpanel-0b19c55ba85dbd0fae9b1c722b35e1c765509087" aria-selected="false"
                 tabindex="-1">
                <span>Standalone Use</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-f17e92892971a633ec9c18b9cb899ec1ca80e129" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/framework.yaml</span>
<span class="hljs-attr">framework:</span>
    <span class="hljs-attr">http_client:</span>
        <span class="hljs-attr">max_host_connections:</span> <span class="hljs-number">10</span>
        <span class="hljs-comment"># ...</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-d2d3d1a38fe9fb99d7a52b17569d29f5b625b0ac" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/packages/framework.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:framework</span>=<span class="hljs-string">"http://symfony.com/schema/dic/symfony"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd
        http://symfony.com/schema/dic/symfony https://symfony.com/schema/dic/symfony/symfony-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">framework:config</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">framework:http-client</span> <span class="hljs-attr">max-host-connections</span>=<span class="hljs-string">"10"</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- ... --&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">framework:http-client</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">framework:config</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-20be7edcc70d66ee8525fed96b9f22895f3860c4" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/packages/framework.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Config</span>\<span class="hljs-title">FrameworkConfig</span>;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(FrameworkConfig <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span><span class="hljs-operator">-&gt;</span>httpClient()
        <span class="hljs-operator">-&gt;</span>maxHostConnections(<span class="hljs-number">10</span>)
        <span class="hljs-comment">// ...</span>
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-0b19c55ba85dbd0fae9b1c722b35e1c765509087" aria-label="Standalone Use" class="configuration-codeblock" data-language="php-standalone" style="display: none">
            <div translate="no" class="highlight-php-standalone highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php-standalone php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span> = HttpClient<span class="hljs-operator">::</span>create([], <span class="hljs-number">10</span>);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<div class="section">
<h3 id="scoping-client">
    Scoping Client
    <a class="headerlink" href="#scoping-client" title="Permalink to this headline">¶</a>
</h3>
<p>It's common that some of the HTTP client options depend on the URL of the
request (e.g. you must set some headers when making requests to GitHub API but
not for other hosts). If that's your case, the component provides scoped
clients (using <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpClient/ScopingHttpClient.php" class="reference external" title="Symfony\Component\HttpClient\ScopingHttpClient" rel="external noopener noreferrer" target="_blank">ScopingHttpClient</a>) to
autoconfigure the HTTP client based on the requested URL:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-4">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-24e917686bdf87d5350e1ba0c083b70a6851736a" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-a4adca24b0c0218258e80c781c09a2b617585968" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-52879ac2f8140b2efe90c50e0fb2492fa4af6784" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
                    <button role="tab" type="button" data-language="php-standalone"
                aria-controls="configuration-block-tabpanel-185c33b481ed6c681b1199180a5bb397a2d4d7b5" aria-selected="false"
                 tabindex="-1">
                <span>Standalone Use</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-24e917686bdf87d5350e1ba0c083b70a6851736a" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/framework.yaml</span>
<span class="hljs-attr">framework:</span>
    <span class="hljs-attr">http_client:</span>
        <span class="hljs-attr">scoped_clients:</span>
            <span class="hljs-comment"># only requests matching scope will use these options</span>
            <span class="hljs-attr">github.client:</span>
                <span class="hljs-attr">scope:</span> <span class="hljs-string">'https://api\.github\.com'</span>
                <span class="hljs-attr">headers:</span>
                    <span class="hljs-attr">Accept:</span> <span class="hljs-string">'application/vnd.github.v3+json'</span>
                    <span class="hljs-attr">Authorization:</span> <span class="hljs-string">'token %env(GITHUB_API_TOKEN)%'</span>
                <span class="hljs-comment"># ...</span>

            <span class="hljs-comment"># using base_uri, relative URLs (e.g. request("GET", "/repos/symfony/symfony-docs"))</span>
            <span class="hljs-comment"># will default to these options</span>
            <span class="hljs-attr">github.client:</span>
                <span class="hljs-attr">base_uri:</span> <span class="hljs-string">'https://api.github.com'</span>
                <span class="hljs-attr">headers:</span>
                    <span class="hljs-attr">Accept:</span> <span class="hljs-string">'application/vnd.github.v3+json'</span>
                    <span class="hljs-attr">Authorization:</span> <span class="hljs-string">'token %env(GITHUB_API_TOKEN)%'</span>
                <span class="hljs-comment"># ...</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-a4adca24b0c0218258e80c781c09a2b617585968" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/packages/framework.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:framework</span>=<span class="hljs-string">"http://symfony.com/schema/dic/symfony"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd
        http://symfony.com/schema/dic/symfony https://symfony.com/schema/dic/symfony/symfony-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">framework:config</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">framework:http-client</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- only requests matching scope will use these options --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">framework:scoped-client</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"github.client"</span>
                <span class="hljs-attr">scope</span>=<span class="hljs-string">"https://api\.github\.com"</span>
            &gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">framework:header</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"Accept"</span>&gt;</span>application/vnd.github.v3+json<span class="hljs-tag">&lt;/<span class="hljs-name">framework:header</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">framework:header</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"Authorization"</span>&gt;</span>token %env(GITHUB_API_TOKEN)%<span class="hljs-tag">&lt;/<span class="hljs-name">framework:header</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">framework:scoped-client</span>&gt;</span>

            <span class="hljs-comment">&lt;!-- using base-uri, relative URLs (e.g. request("GET", "/repos/symfony/symfony-docs"))
                 will default to these options --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">framework:scoped-client</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"github.client"</span>
                <span class="hljs-attr">base-uri</span>=<span class="hljs-string">"https://api.github.com"</span>
            &gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">framework:header</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"Accept"</span>&gt;</span>application/vnd.github.v3+json<span class="hljs-tag">&lt;/<span class="hljs-name">framework:header</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">framework:header</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"Authorization"</span>&gt;</span>token %env(GITHUB_API_TOKEN)%<span class="hljs-tag">&lt;/<span class="hljs-name">framework:header</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">framework:scoped-client</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">framework:http-client</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">framework:config</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-52879ac2f8140b2efe90c50e0fb2492fa4af6784" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/packages/framework.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Config</span>\<span class="hljs-title">FrameworkConfig</span>;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(FrameworkConfig <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span>)</span> </span>{
    <span class="hljs-comment">// only requests matching scope will use these options</span>
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span><span class="hljs-operator">-&gt;</span>httpClient()<span class="hljs-operator">-&gt;</span>scopedClient(<span class="hljs-string">'github.client'</span>)
        <span class="hljs-operator">-&gt;</span>scope(<span class="hljs-string">'https://api\.github\.com'</span>)
        <span class="hljs-operator">-&gt;</span>header(<span class="hljs-string">'Accept'</span>, <span class="hljs-string">'application/vnd.github.v3+json'</span>)
        <span class="hljs-operator">-&gt;</span>header(<span class="hljs-string">'Authorization'</span>, <span class="hljs-string">'token %env(GITHUB_API_TOKEN)%'</span>)
        <span class="hljs-comment">// ...</span>
    ;

    <span class="hljs-comment">// using base_url, relative URLs (e.g. request("GET", "/repos/symfony/symfony-docs"))</span>
    <span class="hljs-comment">// will default to these options</span>
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span><span class="hljs-operator">-&gt;</span>httpClient()<span class="hljs-operator">-&gt;</span>scopedClient(<span class="hljs-string">'github.client'</span>)
        <span class="hljs-operator">-&gt;</span>baseUri(<span class="hljs-string">'https://api.github.com'</span>)
        <span class="hljs-operator">-&gt;</span>header(<span class="hljs-string">'Accept'</span>, <span class="hljs-string">'application/vnd.github.v3+json'</span>)
        <span class="hljs-operator">-&gt;</span>header(<span class="hljs-string">'Authorization'</span>, <span class="hljs-string">'token %env(GITHUB_API_TOKEN)%'</span>)
        <span class="hljs-comment">// ...</span>
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-185c33b481ed6c681b1199180a5bb397a2d4d7b5" aria-label="Standalone Use" class="configuration-codeblock" data-language="php-standalone" style="display: none">
            <div translate="no" class="highlight-php-standalone highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php-standalone php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">HttpClient</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">ScopingHttpClient</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span> = HttpClient<span class="hljs-operator">::</span>create();
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span> = <span class="hljs-keyword">new</span> ScopingHttpClient(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span>, [
    <span class="hljs-comment">// the options defined as values apply only to the URLs matching</span>
    <span class="hljs-comment">// the regular expressions defined as keys</span>
    <span class="hljs-string">'https://api\.github\.com/'</span> =&gt; [
        <span class="hljs-string">'headers'</span> =&gt; [
            <span class="hljs-string">'Accept'</span> =&gt; <span class="hljs-string">'application/vnd.github.v3+json'</span>,
            <span class="hljs-string">'Authorization'</span> =&gt; <span class="hljs-string">'token '</span>.<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>githubToken</span>,
        ],
    ],
    <span class="hljs-comment">// ...</span>
]);

<span class="hljs-comment">// relative URLs will use the 2nd argument as base URI and use the options of the 3rd argument</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span> = ScopingHttpClient<span class="hljs-operator">::</span>forBaseUri(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span>, <span class="hljs-string">'https://api.github.com/'</span>, [
    <span class="hljs-string">'headers'</span> =&gt; [
        <span class="hljs-string">'Accept'</span> =&gt; <span class="hljs-string">'application/vnd.github.v3+json'</span>,
        <span class="hljs-string">'Authorization'</span> =&gt; <span class="hljs-string">'token '</span>.<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>githubToken</span>,
    ],
]);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>You can define several scopes, so that each set of options is added only if a
requested URL matches one of the regular expressions set by the <code translate="no" class="notranslate">scope</code> option.</p>
<p>If you use scoped clients in the Symfony framework, you must use any of the
methods defined by Symfony to <a href="service_container.html#services-wire-specific-service" class="reference internal">choose a specific service</a>.
Each client has a unique service named after its configuration.</p>
<p>Each scoped client also defines a corresponding named autowiring alias.
If you use for example
<code translate="no" class="notranslate">Symfony\Contracts\HttpClient\HttpClientInterface $githubClient</code>
as the type and name of an argument, autowiring will inject the <code translate="no" class="notranslate">github.client</code>
service into your autowired classes.</p>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>Read the <a href="reference/configuration/framework.html#reference-http-client-base-uri" class="reference internal">base_uri option docs</a> to
learn the rules applied when merging relative URIs into the base URI of the
scoped client.</p>
</div>
</div>
</div>
<div class="section">
<h2 id="making-requests">
    Making Requests
    <a class="headerlink" href="#making-requests" title="Permalink to this headline">¶</a>
</h2>
<p>The HTTP client provides a single <code translate="no" class="notranslate">request()</code> method to perform all kinds of
HTTP requests:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'https://...'</span>);
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'POST'</span>, <span class="hljs-string">'https://...'</span>);
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'PUT'</span>, <span class="hljs-string">'https://...'</span>);
<span class="hljs-comment">// ...</span>

<span class="hljs-comment">// you can add request options (or override global ones) using the 3rd argument</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'https://...'</span>, [
    <span class="hljs-string">'headers'</span> =&gt; [
        <span class="hljs-string">'Accept'</span> =&gt; <span class="hljs-string">'application/json'</span>,
    ],
]);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Responses are always asynchronous, so that the call to the method returns
immediately instead of waiting to receive the response:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// code execution continues immediately; it doesn't wait to receive the response</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'http://releases.ubuntu.com/18.04.2/ubuntu-18.04.2-desktop-amd64.iso'</span>);

<span class="hljs-comment">// getting the response headers waits until they arrive</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>contentType</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>getHeaders()[<span class="hljs-string">'content-type'</span>][<span class="hljs-number">0</span>];

<span class="hljs-comment">// trying to get the response content will block the execution until</span>
<span class="hljs-comment">// the full response content is received</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>content</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>getContent();</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>This component also supports <a href="http_client.html#http-client-streaming-responses" class="reference internal">streaming responses</a>
for full asynchronous applications.</p>
<div class="section">
<h3 id="authentication">
    Authentication
    <a class="headerlink" href="#authentication" title="Permalink to this headline">¶</a>
</h3>
<p>The HTTP client supports different authentication mechanisms. They can be
defined globally in the configuration (to apply it to all requests) and to
each request (which overrides any global authentication):</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-4">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-60bde358f42887f38f3ccef0e07179a1905f80dc" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-8c7f2046f69ff4a91e8aa5ff8233ffaa50f3a42f" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-6bb8307f4966169d612f9d0f733a8bd648cfa348" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
                    <button role="tab" type="button" data-language="php-standalone"
                aria-controls="configuration-block-tabpanel-e64613c3724ca72c63692e7097b3d3561793a041" aria-selected="false"
                 tabindex="-1">
                <span>Standalone Use</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-60bde358f42887f38f3ccef0e07179a1905f80dc" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/framework.yaml</span>
<span class="hljs-attr">framework:</span>
    <span class="hljs-attr">http_client:</span>
        <span class="hljs-attr">scoped_clients:</span>
            <span class="hljs-attr">example_api:</span>
                <span class="hljs-attr">base_uri:</span> <span class="hljs-string">'https://example.com/'</span>

                <span class="hljs-comment"># HTTP Basic authentication</span>
                <span class="hljs-attr">auth_basic:</span> <span class="hljs-string">'the-username:the-password'</span>

                <span class="hljs-comment"># HTTP Bearer authentication (also called token authentication)</span>
                <span class="hljs-attr">auth_bearer:</span> <span class="hljs-string">the-bearer-token</span>

                <span class="hljs-comment"># Microsoft NTLM authentication</span>
                <span class="hljs-attr">auth_ntlm:</span> <span class="hljs-string">'the-username:the-password'</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-8c7f2046f69ff4a91e8aa5ff8233ffaa50f3a42f" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/packages/framework.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:framework</span>=<span class="hljs-string">"http://symfony.com/schema/dic/symfony"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd
        http://symfony.com/schema/dic/symfony https://symfony.com/schema/dic/symfony/symfony-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">framework:config</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">framework:http-client</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- Available authentication options:
                 auth-basic: HTTP Basic authentication
                 auth-bearer: HTTP Bearer authentication (also called token authentication)
                 auth-ntlm: Microsoft NTLM authentication --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">framework:scoped-client</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"example_api"</span>
                <span class="hljs-attr">base-uri</span>=<span class="hljs-string">"https://example.com/"</span>
                <span class="hljs-attr">auth-basic</span>=<span class="hljs-string">"the-username:the-password"</span>
                <span class="hljs-attr">auth-bearer</span>=<span class="hljs-string">"the-bearer-token"</span>
                <span class="hljs-attr">auth-ntlm</span>=<span class="hljs-string">"the-username:the-password"</span>
            /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">framework:http-client</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">framework:config</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-6bb8307f4966169d612f9d0f733a8bd648cfa348" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/packages/framework.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Config</span>\<span class="hljs-title">FrameworkConfig</span>;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(FrameworkConfig <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span><span class="hljs-operator">-&gt;</span>httpClient()<span class="hljs-operator">-&gt;</span>scopedClient(<span class="hljs-string">'example_api'</span>)
        <span class="hljs-operator">-&gt;</span>baseUri(<span class="hljs-string">'https://example.com/'</span>)
        <span class="hljs-comment">// HTTP Basic authentication</span>
        <span class="hljs-operator">-&gt;</span>authBasic(<span class="hljs-string">'the-username:the-password'</span>)

        <span class="hljs-comment">// HTTP Bearer authentication (also called token authentication)</span>
        <span class="hljs-operator">-&gt;</span>authBearer(<span class="hljs-string">'the-bearer-token'</span>)

        <span class="hljs-comment">// Microsoft NTLM authentication</span>
        <span class="hljs-operator">-&gt;</span>authNtlm(<span class="hljs-string">'the-username:the-password'</span>)
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-e64613c3724ca72c63692e7097b3d3561793a041" aria-label="Standalone Use" class="configuration-codeblock" data-language="php-standalone" style="display: none">
            <div translate="no" class="highlight-php-standalone highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php-standalone php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span> = HttpClient<span class="hljs-operator">::</span>createForBaseUri(<span class="hljs-string">'https://example.com/'</span>, [
    <span class="hljs-comment">// HTTP Basic authentication (there are multiple ways of configuring it)</span>
    <span class="hljs-string">'auth_basic'</span> =&gt; [<span class="hljs-string">'the-username'</span>],
    <span class="hljs-string">'auth_basic'</span> =&gt; [<span class="hljs-string">'the-username'</span>, <span class="hljs-string">'the-password'</span>],
    <span class="hljs-string">'auth_basic'</span> =&gt; <span class="hljs-string">'the-username:the-password'</span>,

    <span class="hljs-comment">// HTTP Bearer authentication (also called token authentication)</span>
    <span class="hljs-string">'auth_bearer'</span> =&gt; <span class="hljs-string">'the-bearer-token'</span>,

    <span class="hljs-comment">// Microsoft NTLM authentication (there are multiple ways of configuring it)</span>
    <span class="hljs-string">'auth_ntlm'</span> =&gt; [<span class="hljs-string">'the-username'</span>],
    <span class="hljs-string">'auth_ntlm'</span> =&gt; [<span class="hljs-string">'the-username'</span>, <span class="hljs-string">'the-password'</span>],
    <span class="hljs-string">'auth_ntlm'</span> =&gt; <span class="hljs-string">'the-username:the-password'</span>,
]);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'https://...'</span>, [
    <span class="hljs-comment">// use a different HTTP Basic authentication only for this request</span>
    <span class="hljs-string">'auth_basic'</span> =&gt; [<span class="hljs-string">'the-username'</span>, <span class="hljs-string">'the-password'</span>],

    <span class="hljs-comment">// ...</span>
]);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>The NTLM authentication mechanism requires using the cURL transport.
By using <code translate="no" class="notranslate">HttpClient::createForBaseUri()</code>, we ensure that the auth credentials
won't be sent to any other hosts than <a href="https://example.com/" class="reference external" rel="external noopener noreferrer" target="_blank">https://example.com/</a>.</p>
</div>
</div>
<div class="section">
<h3 id="query-string-parameters">
    Query String Parameters
    <a class="headerlink" href="#query-string-parameters" title="Permalink to this headline">¶</a>
</h3>
<p>You can either append them manually to the requested URL, or define them as an
associative array via the <code translate="no" class="notranslate">query</code> option, that will be merged with the URL:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// it makes an HTTP GET request to https://httpbin.org/get?token=...&amp;name=...</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'https://httpbin.org/get'</span>, [
    <span class="hljs-comment">// these values are automatically encoded before including them in the URL</span>
    <span class="hljs-string">'query'</span> =&gt; [
        <span class="hljs-string">'token'</span> =&gt; <span class="hljs-string">'...'</span>,
        <span class="hljs-string">'name'</span> =&gt; <span class="hljs-string">'...'</span>,
    ],
]);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
<div class="section">
<h3 id="headers">
    Headers
    <a class="headerlink" href="#headers" title="Permalink to this headline">¶</a>
</h3>
<p>Use the <code translate="no" class="notranslate">headers</code> option to define the default headers added to all requests:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-4">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-1a8db84851044fff8b858ce6e0ba5aa3fbec1d52" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-d9806fce080a27cf420df6491c4f08fd1ef1a899" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-d7e6b8812445eb796a442ccece61167fa4e86ddc" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
                    <button role="tab" type="button" data-language="php-standalone"
                aria-controls="configuration-block-tabpanel-bd38ca1aabf3271481ecbd5917ccf2347b47c705" aria-selected="false"
                 tabindex="-1">
                <span>Standalone Use</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-1a8db84851044fff8b858ce6e0ba5aa3fbec1d52" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/framework.yaml</span>
<span class="hljs-attr">framework:</span>
    <span class="hljs-attr">http_client:</span>
        <span class="hljs-attr">default_options:</span>
            <span class="hljs-attr">headers:</span>
                <span class="hljs-attr">'User-Agent':</span> <span class="hljs-string">'My Fancy App'</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-d9806fce080a27cf420df6491c4f08fd1ef1a899" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/packages/framework.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:framework</span>=<span class="hljs-string">"http://symfony.com/schema/dic/symfony"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd
        http://symfony.com/schema/dic/symfony https://symfony.com/schema/dic/symfony/symfony-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">framework:config</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">framework:http-client</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">framework:default-options</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">framework:header</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"User-Agent"</span>&gt;</span>My Fancy App<span class="hljs-tag">&lt;/<span class="hljs-name">framework:header</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">framework:default-options</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">framework:http-client</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">framework:config</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-d7e6b8812445eb796a442ccece61167fa4e86ddc" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/packages/framework.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Config</span>\<span class="hljs-title">FrameworkConfig</span>;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(FrameworkConfig <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span><span class="hljs-operator">-&gt;</span>httpClient()
        <span class="hljs-operator">-&gt;</span>defaultOptions()
            <span class="hljs-operator">-&gt;</span>header(<span class="hljs-string">'User-Agent'</span>, <span class="hljs-string">'My Fancy App'</span>)
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-bd38ca1aabf3271481ecbd5917ccf2347b47c705" aria-label="Standalone Use" class="configuration-codeblock" data-language="php-standalone" style="display: none">
            <div translate="no" class="highlight-php-standalone highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php-standalone php"><span class="hljs-comment">// this header is added to all requests made by this client</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span> = HttpClient<span class="hljs-operator">::</span>create([
    <span class="hljs-string">'headers'</span> =&gt; [
        <span class="hljs-string">'User-Agent'</span> =&gt; <span class="hljs-string">'My Fancy App'</span>,
    ],
]);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>You can also set new headers or override the default ones for specific requests:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// this header is only included in this request and overrides the value</span>
<span class="hljs-comment">// of the same header if defined globally by the HTTP client</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'POST'</span>, <span class="hljs-string">'https://...'</span>, [
    <span class="hljs-string">'headers'</span> =&gt; [
        <span class="hljs-string">'Content-Type'</span> =&gt; <span class="hljs-string">'text/plain'</span>,
    ],
]);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
<div class="section">
<h3 id="uploading-data">
    Uploading Data
    <a class="headerlink" href="#uploading-data" title="Permalink to this headline">¶</a>
</h3>
<p>This component provides several methods for uploading data using the <code translate="no" class="notranslate">body</code>
option. You can use regular strings, closures, iterables and resources and they'll be
processed automatically when making the requests:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'POST'</span>, <span class="hljs-string">'https://...'</span>, [
    <span class="hljs-comment">// defining data using a regular string</span>
    <span class="hljs-string">'body'</span> =&gt; <span class="hljs-string">'raw data'</span>,

    <span class="hljs-comment">// defining data using an array of parameters</span>
    <span class="hljs-string">'body'</span> =&gt; [<span class="hljs-string">'parameter1'</span> =&gt; <span class="hljs-string">'value1'</span>, <span class="hljs-string">'...'</span>],

    <span class="hljs-comment">// using a closure to generate the uploaded data</span>
    <span class="hljs-string">'body'</span> =&gt; <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(int <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>size</span>)</span>: <span class="hljs-title">string</span> </span>{
        <span class="hljs-comment">// ...</span>
    },

    <span class="hljs-comment">// using a resource to get the data from it</span>
    <span class="hljs-string">'body'</span> =&gt; fopen(<span class="hljs-string">'/path/to/file'</span>, <span class="hljs-string">'r'</span>),
]);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>When uploading data with the <code translate="no" class="notranslate">POST</code> method, if you don't define the
<code translate="no" class="notranslate">Content-Type</code> HTTP header explicitly, Symfony assumes that you're uploading
form data and adds the required
<code translate="no" class="notranslate">&#039;Content-Type: application/x-www-form-urlencoded&#039;</code> header for you.</p>
<p>When the <code translate="no" class="notranslate">body</code> option is set as a closure, it will be called several times until
it returns the empty string, which signals the end of the body. Each time, the
closure should return a string smaller than the amount requested as argument.</p>
<p>A generator or any <code translate="no" class="notranslate">Traversable</code> can also be used instead of a closure.</p>
<div class="admonition admonition-tip ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                <span>Tip</span>
    </p><p>When uploading JSON payloads, use the <code translate="no" class="notranslate">json</code> option instead of <code translate="no" class="notranslate">body</code>. The
given content will be JSON-encoded automatically and the request will add the
<code translate="no" class="notranslate">Content-Type: application/json</code> automatically too:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'POST'</span>, <span class="hljs-string">'https://...'</span>, [
    <span class="hljs-string">'json'</span> =&gt; [<span class="hljs-string">'param1'</span> =&gt; <span class="hljs-string">'value1'</span>, <span class="hljs-string">'...'</span>],
]);

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>decodedPayload</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>toArray();</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
<p>To submit a form with file uploads, it is your responsibility to encode the body
according to the <code translate="no" class="notranslate">multipart/form-data</code> content-type. The
<a href="components/mime.html" class="reference internal">Symfony Mime</a> component makes it a few lines of code:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Mime</span>\<span class="hljs-title">Part</span>\<span class="hljs-title">DataPart</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Mime</span>\<span class="hljs-title">Part</span>\<span class="hljs-title">Multipart</span>\<span class="hljs-title">FormDataPart</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>formFields</span> = [
    <span class="hljs-string">'regular_field'</span> =&gt; <span class="hljs-string">'some value'</span>,
    <span class="hljs-string">'file_field'</span> =&gt; DataPart<span class="hljs-operator">::</span>fromPath(<span class="hljs-string">'/path/to/uploaded/file'</span>),
];
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>formData</span> = <span class="hljs-keyword">new</span> FormDataPart(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>formFields</span>);
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'POST'</span>, <span class="hljs-string">'https://...'</span>, [
    <span class="hljs-string">'headers'</span> =&gt; <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>formData</span><span class="hljs-operator">-&gt;</span>getPreparedHeaders()<span class="hljs-operator">-&gt;</span>toArray(),
    <span class="hljs-string">'body'</span> =&gt; <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>formData</span><span class="hljs-operator">-&gt;</span>bodyToIterable(),
]);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-tip ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                <span>Tip</span>
    </p><p>When using multidimensional arrays the <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/Mime/Part/Multipart/FormDataPart.php" class="reference external" title="Symfony\Component\Mime\Part\Multipart\FormDataPart" rel="external noopener noreferrer" target="_blank">FormDataPart</a>
class automatically appends <code translate="no" class="notranslate">[key]</code> to the name of the field:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>formData</span> = <span class="hljs-keyword">new</span> FormDataPart([
    <span class="hljs-string">'array_field'</span> =&gt; [
        <span class="hljs-string">'some value'</span>,
        <span class="hljs-string">'other value'</span>,
    ],
]);

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>formData</span><span class="hljs-operator">-&gt;</span>getParts(); <span class="hljs-comment">// Returns two instances of TextPart</span>
                       <span class="hljs-comment">// with the names "array_field[0]" and "array_field[1]"</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>This behavior can be bypassed by using the following array structure:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>formData</span> = <span class="hljs-keyword">new</span> FormDataPart([
    [<span class="hljs-string">'array_field'</span> =&gt; <span class="hljs-string">'some value'</span>],
    [<span class="hljs-string">'array_field'</span> =&gt; <span class="hljs-string">'other value'</span>],
]);

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>formData</span><span class="hljs-operator">-&gt;</span>getParts(); <span class="hljs-comment">// Returns two instances of TextPart both</span>
                       <span class="hljs-comment">// with the name "array_field"</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
<p>By default, HttpClient streams the body contents when uploading them. This might
not work with all servers, resulting in HTTP status code 411 (&quot;Length Required&quot;)
because there is no <code translate="no" class="notranslate">Content-Length</code> header. The solution is to turn the body
into a string with the following method (which will increase memory consumption
when the streams are large):</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'POST'</span>, <span class="hljs-string">'https://...'</span>, [
    <span class="hljs-comment">// ...</span>
    <span class="hljs-string">'body'</span> =&gt; <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>formData</span><span class="hljs-operator">-&gt;</span>bodyToString(),
]);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>If you need to add a custom HTTP header to the upload, you can do:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>headers</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>formData</span><span class="hljs-operator">-&gt;</span>getPreparedHeaders()<span class="hljs-operator">-&gt;</span>toArray();
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>headers</span>[] = <span class="hljs-string">'X-Foo: bar'</span>;</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
<div class="section">
<h3 id="cookies">
    Cookies
    <a class="headerlink" href="#cookies" title="Permalink to this headline">¶</a>
</h3>
<p>The HTTP client provided by this component is stateless but handling cookies
requires a stateful storage (because responses can update cookies and they must
be used for subsequent requests). That's why this component doesn't handle
cookies automatically.</p>
<p>You can either <a href="components/browser_kit.html#component-browserkit-sending-cookies" class="reference internal">send cookies with the BrowserKit component</a>,
which integrates seamlessly with the HttpClient component, or manually setting
the <code translate="no" class="notranslate">Cookie</code> HTTP header as follows:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">HttpClient</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Cookie</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span> = HttpClient<span class="hljs-operator">::</span>create([
    <span class="hljs-string">'headers'</span> =&gt; [
        <span class="hljs-string">'Cookie'</span> =&gt; <span class="hljs-keyword">new</span> Cookie(<span class="hljs-string">'flavor'</span>, <span class="hljs-string">'chocolate'</span>, strtotime(<span class="hljs-string">'+1 day'</span>)),

        <span class="hljs-comment">// you can also pass the cookie contents as a string</span>
        <span class="hljs-string">'Cookie'</span> =&gt; <span class="hljs-string">'flavor=chocolate; expires=Sat, 11 Feb 2023 12:18:13 GMT; Max-Age=86400; path=/'</span>
    ],
]);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
<div class="section">
<h3 id="redirects">
    Redirects
    <a class="headerlink" href="#redirects" title="Permalink to this headline">¶</a>
</h3>
<p>By default, the HTTP client follows redirects, up to a maximum of 20, when
making a request. Use the <code translate="no" class="notranslate">max_redirects</code> setting to configure this behavior
(if the number of redirects is higher than the configured value, you'll get a
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpClient/Exception/RedirectionException.php" class="reference external" title="Symfony\Component\HttpClient\Exception\RedirectionException" rel="external noopener noreferrer" target="_blank">RedirectionException</a>):</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'https://...'</span>, [
    <span class="hljs-comment">// 0 means to not follow any redirect</span>
    <span class="hljs-string">'max_redirects'</span> =&gt; <span class="hljs-number">0</span>,
]);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
<div class="section">
<h3 id="retry-failed-requests">
    Retry Failed Requests
    <a class="headerlink" href="#retry-failed-requests" title="Permalink to this headline">¶</a>
</h3>
<p>Sometimes, requests fail because of network issues or temporary server errors.
Symfony's HttpClient allows to retry failed requests automatically using the
<a href="reference/configuration/framework.html#reference-http-client-retry-failed" class="reference internal">retry_failed option</a>.</p>
<p>By default, failed requests are retried up to 3 times, with an exponential delay
between retries (first retry = 1 second; third retry: 4 seconds) and only for
the following HTTP status codes: <code translate="no" class="notranslate">423</code>, <code translate="no" class="notranslate">425</code>, <code translate="no" class="notranslate">429</code>, <code translate="no" class="notranslate">502</code> and <code translate="no" class="notranslate">503</code>
when using any HTTP method and <code translate="no" class="notranslate">500</code>, <code translate="no" class="notranslate">504</code>, <code translate="no" class="notranslate">507</code> and <code translate="no" class="notranslate">510</code> when using
an HTTP <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Idempotent_methods" class="reference external" rel="external noopener noreferrer" target="_blank">idempotent method</a>.</p>
<p>Check out the full list of configurable <a href="reference/configuration/framework.html#reference-http-client-retry-failed" class="reference internal">retry_failed options</a>
to learn how to tweak each of them to fit your application needs.</p>
<p>When using the HttpClient outside of a Symfony application, use the
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpClient/RetryableHttpClient.php" class="reference external" title="Symfony\Component\HttpClient\RetryableHttpClient" rel="external noopener noreferrer" target="_blank">RetryableHttpClient</a> class to wrap your
original HTTP client:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">RetryableHttpClient</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span> = <span class="hljs-keyword">new</span> RetryableHttpClient(HttpClient<span class="hljs-operator">::</span>create());</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>The <code translate="no" class="notranslate">RetryableHttpClient</code> uses a
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpClient/Retry/RetryStrategyInterface.php" class="reference external" title="Symfony\Component\HttpClient\Retry\RetryStrategyInterface" rel="external noopener noreferrer" target="_blank">RetryStrategyInterface</a> to
decide if the request should be retried, and to define the waiting time between
each retry.</p>
</div>
<div class="section">
<h3 id="http-proxies">
    HTTP Proxies
    <a class="headerlink" href="#http-proxies" title="Permalink to this headline">¶</a>
</h3>
<p>By default, this component honors the standard environment variables that your
Operating System defines to direct the HTTP traffic through your local proxy.
This means there is usually nothing to configure to have the client work with
proxies, provided these env vars are properly configured.</p>
<p>You can still set or override these settings using the <code translate="no" class="notranslate">proxy</code> and <code translate="no" class="notranslate">no_proxy</code>
options:</p>
<ul>
    <li><code translate="no" class="notranslate">proxy</code> should be set to the <code translate="no" class="notranslate">http://...</code> URL of the proxy to get through</li>
<li><code translate="no" class="notranslate">no_proxy</code> disables the proxy for a comma-separated list of hosts that do not
require it to get reached.</li>
</ul>
</div>
<div class="section">
<h3 id="progress-callback">
    Progress Callback
    <a class="headerlink" href="#progress-callback" title="Permalink to this headline">¶</a>
</h3>
<p>By providing a callable to the <code translate="no" class="notranslate">on_progress</code> option, one can track
uploads/downloads as they complete. This callback is guaranteed to be called on
DNS resolution, on arrival of headers and on completion; additionally it is
called when new data is uploaded or downloaded and at least once per second:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'https://...'</span>, [
    <span class="hljs-string">'on_progress'</span> =&gt; <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(int <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>dlNow</span>, int <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>dlSize</span>, array <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>info</span>)</span>: <span class="hljs-title">void</span> </span>{
        <span class="hljs-comment">// $dlNow is the number of bytes downloaded so far</span>
        <span class="hljs-comment">// $dlSize is the total size to be downloaded or -1 if it is unknown</span>
        <span class="hljs-comment">// $info is what $response-&gt;getInfo() would return at this very time</span>
    },
]);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Any exceptions thrown from the callback will be wrapped in an instance of
<code translate="no" class="notranslate">TransportExceptionInterface</code> and will abort the request.</p>
</div>
<div class="section">
<h3 id="https-certificates">
    HTTPS Certificates
    <a class="headerlink" href="#https-certificates" title="Permalink to this headline">¶</a>
</h3>
<p>HttpClient uses the system's certificate store to validate SSL certificates
(while browsers use their own stores). When using self-signed certificates
during development, it's recommended to create your own certificate authority
(CA) and add it to your system's store.</p>
<p>Alternatively, you can also disable <code translate="no" class="notranslate">verify_host</code> and <code translate="no" class="notranslate">verify_peer</code> (see
<a href="reference/configuration/framework.html#reference-http-client" class="reference internal">http_client config reference</a>), but this is not
recommended in production.</p>
</div>
<div class="section">
<h3 id="ssrf-server-side-request-forgery-handling">
    SSRF (Server-side request forgery) Handling
    <a class="headerlink" href="#ssrf-server-side-request-forgery-handling" title="Permalink to this headline">¶</a>
</h3>
<p><a href="https://portswigger.net/web-security/ssrf" class="reference external" rel="external noopener noreferrer" target="_blank">SSRF</a> allows an attacker to induce the backend application to make HTTP
requests to an arbitrary domain. These attacks can also target the internal
hosts and IPs of the attacked server.</p>
<p>If you use an <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpClient/HttpClient.php" class="reference external" title="Symfony\Component\HttpClient\HttpClient" rel="external noopener noreferrer" target="_blank">HttpClient</a> together
with user-provided URIs, it is probably a good idea to decorate it with a
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpClient/NoPrivateNetworkHttpClient.php" class="reference external" title="Symfony\Component\HttpClient\NoPrivateNetworkHttpClient" rel="external noopener noreferrer" target="_blank">NoPrivateNetworkHttpClient</a>. This will
ensure local networks are made inaccessible to the HTTP client:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">HttpClient</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">NoPrivateNetworkHttpClient</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span> = <span class="hljs-keyword">new</span> NoPrivateNetworkHttpClient(HttpClient<span class="hljs-operator">::</span>create());
<span class="hljs-comment">// nothing changes when requesting public networks</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'https://example.com/'</span>);

<span class="hljs-comment">// however, all requests to private networks are now blocked by default</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'http://localhost/'</span>);

<span class="hljs-comment">// the second optional argument defines the networks to block</span>
<span class="hljs-comment">// in this example, requests from 104.26.14.0 to 104.26.15.255 will result in an exception</span>
<span class="hljs-comment">// but all the other requests, including other internal networks, will be allowed</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span> = <span class="hljs-keyword">new</span> NoPrivateNetworkHttpClient(HttpClient<span class="hljs-operator">::</span>create(), [<span class="hljs-string">'104.26.14.0/23'</span>]);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
<div class="section">
<h3 id="profiling">
    Profiling
    <a class="headerlink" href="#profiling" title="Permalink to this headline">¶</a>
</h3>
<p>When you are using the <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpClient/TraceableHttpClient.php" class="reference external" title="Symfony\Component\HttpClient\TraceableHttpClient" rel="external noopener noreferrer" target="_blank">TraceableHttpClient</a>,
responses content will be kept in memory and may exhaust it.</p>
<p>You can disable this behavior by setting the <code translate="no" class="notranslate">extra.trace_content</code> option to <code translate="no" class="notranslate">false</code>
in your requests:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'https://...'</span>, [
    <span class="hljs-string">'extra'</span> =&gt; [<span class="hljs-string">'trace_content'</span> =&gt; <span class="hljs-keyword">false</span>],
]);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>This setting won’t affect other clients.</p>
</div>
<div class="section">
<h3 id="using-uri-templates">
    Using URI Templates
    <a class="headerlink" href="#using-uri-templates" title="Permalink to this headline">¶</a>
</h3>
<p>The <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpClient/UriTemplateHttpClient.php" class="reference external" title="Symfony\Component\HttpClient\UriTemplateHttpClient" rel="external noopener noreferrer" target="_blank">UriTemplateHttpClient</a> provides
a client that eases the use of URI templates, as described in the <a href="https://www.rfc-editor.org/rfc/rfc6570" class="reference external" rel="external noopener noreferrer" target="_blank">RFC 6570</a>:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span> = <span class="hljs-keyword">new</span> UriTemplateHttpClient();

<span class="hljs-comment">// this will make a request to the URL http://example.org/users?page=1</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'http://example.org/{resource}{?page}'</span>, [
    <span class="hljs-string">'vars'</span> =&gt; [
        <span class="hljs-string">'resource'</span> =&gt; <span class="hljs-string">'users'</span>,
        <span class="hljs-string">'page'</span> =&gt; <span class="hljs-number">1</span>,
    ],
]);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>When using this client in the framework context, all existing HTTP clients
are decorated by the <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpClient/UriTemplateHttpClient.php" class="reference external" title="Symfony\Component\HttpClient\UriTemplateHttpClient" rel="external noopener noreferrer" target="_blank">UriTemplateHttpClient</a>.
This means that URI template feature is enabled by default for all HTTP clients
you may use in your application.</p>
<p>You can configure variables that will be replaced globally in all URI templates
of your application:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-ff0cbb1d73976174c8ace927f667819644fabd93" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-c3a4d5c34ec7fef7dc25672463212da4ce12ddd5" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-6b7e8ec3dd3359f90f47aca07d7a31e315560a7b" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-ff0cbb1d73976174c8ace927f667819644fabd93" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/framework.yaml</span>
<span class="hljs-attr">framework:</span>
    <span class="hljs-attr">http_client:</span>
        <span class="hljs-attr">default_options:</span>
            <span class="hljs-attr">vars:</span>
                <span class="hljs-bullet">-</span> <span class="hljs-attr">secret:</span> <span class="hljs-string">'secret-token'</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-c3a4d5c34ec7fef7dc25672463212da4ce12ddd5" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/packages/framework.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:framework</span>=<span class="hljs-string">"http://symfony.com/schema/dic/symfony"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd
        http://symfony.com/schema/dic/symfony https://symfony.com/schema/dic/symfony/symfony-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">framework:config</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">framework:http-client</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">framework:default-options</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">framework:vars</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"secret"</span>&gt;</span>secret-token<span class="hljs-tag">&lt;/<span class="hljs-name">framework:vars</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">framework:default-options</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">framework:http-client</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">framework:config</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-6b7e8ec3dd3359f90f47aca07d7a31e315560a7b" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/packages/framework.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Config</span>\<span class="hljs-title">FrameworkConfig</span>;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(FrameworkConfig <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span><span class="hljs-operator">-&gt;</span>httpClient()
        <span class="hljs-operator">-&gt;</span>defaultOptions()
            <span class="hljs-operator">-&gt;</span>vars([<span class="hljs-string">'secret'</span> =&gt; <span class="hljs-string">'secret-token'</span>])
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>If you want to define your own logic to handle variables of URI templates, you
can do so by redefining the <code translate="no" class="notranslate">http_client.uri_template_expander</code> alias. Your
service must be invokable.</p>
<div class="admonition admonition-versionadded ">
    <p class="admonition-title">
                                    <span>6.3</span>
    </p><p>The <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpClient/UriTemplateHttpClient.php" class="reference external" title="Symfony\Component\HttpClient\UriTemplateHttpClient" rel="external noopener noreferrer" target="_blank">UriTemplateHttpClient</a> was
introduced in Symfony 6.3.</p>
</div>
</div>
</div>
<div class="section">
<h2 id="performance">
    Performance
    <a class="headerlink" href="#performance" title="Permalink to this headline">¶</a>
</h2>
<p>The component is built for maximum HTTP performance. By design, it is compatible
with HTTP/2 and with doing concurrent asynchronous streamed and multiplexed
requests/responses. Even when doing regular synchronous calls, this design
allows keeping connections to remote hosts open between requests, improving
performance by saving repetitive DNS resolution, SSL negotiation, etc.
To leverage all these design benefits, the cURL extension is needed.</p>
<div class="section">
<h3 id="enabling-curl-support">
    Enabling cURL Support
    <a class="headerlink" href="#enabling-curl-support" title="Permalink to this headline">¶</a>
</h3>
<p>This component supports both the native PHP streams and cURL to make the HTTP
requests. Although both are interchangeable and provide the same features,
including concurrent requests, HTTP/2 is only supported when using cURL.</p>
<p><code translate="no" class="notranslate">HttpClient::create()</code> selects the cURL transport if the <a href="https://www.php.net/curl" class="reference external" rel="external noopener noreferrer" target="_blank">cURL PHP extension</a>
is enabled and falls back to PHP streams otherwise. If you prefer to select
the transport explicitly, use the following classes to create the client:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">CurlHttpClient</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">NativeHttpClient</span>;

<span class="hljs-comment">// uses native PHP streams</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span> = <span class="hljs-keyword">new</span> NativeHttpClient();

<span class="hljs-comment">// uses the cURL PHP extension</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span> = <span class="hljs-keyword">new</span> CurlHttpClient();</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>When using this component in a full-stack Symfony application, this behavior is
not configurable and cURL will be used automatically if the cURL PHP extension
is installed and enabled. Otherwise, the native PHP streams will be used.</p>
</div>
<div class="section">
<h3 id="configuring-curlhttpclient-options">
    Configuring CurlHttpClient Options
    <a class="headerlink" href="#configuring-curlhttpclient-options" title="Permalink to this headline">¶</a>
</h3>
<p>PHP allows to configure lots of <a href="https://www.php.net/manual/en/function.curl-setopt.php" class="reference external" rel="external noopener noreferrer" target="_blank">cURL options</a> via the <a href="https://secure.php.net/manual/en/function.curl-setopt.php" class="reference external" title="curl_setopt" rel="external noopener noreferrer" target="_blank">curl_setopt</a>
function. In order to make the component more portable when not using cURL, the
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpClient/CurlHttpClient.php" class="reference external" title="Symfony\Component\HttpClient\CurlHttpClient" rel="external noopener noreferrer" target="_blank">CurlHttpClient</a> only uses some of those
options (and they are ignored in the rest of clients).</p>
<p>Add an <code translate="no" class="notranslate">extra.curl</code> option in your configuration to pass those extra options:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">CurlHttpClient</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span> = <span class="hljs-keyword">new</span> CurlHttpClient();

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'POST'</span>, <span class="hljs-string">'https://...'</span>, [
    <span class="hljs-comment">// ...</span>
    <span class="hljs-string">'extra'</span> =&gt; [
        <span class="hljs-string">'curl'</span> =&gt; [
            CURLOPT_IPRESOLVE =&gt; CURL_IPRESOLVE_V6,
        ],
    ],
]);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>Some cURL options are impossible to override (e.g. because of thread safety)
and you'll get an exception when trying to override them.</p>
</div>
</div>
<div class="section">
<h3 id="http-compression">
    HTTP Compression
    <a class="headerlink" href="#http-compression" title="Permalink to this headline">¶</a>
</h3>
<p>The HTTP header <code translate="no" class="notranslate">Accept-Encoding: gzip</code> is added automatically if:</p>
<ul>
    <li>When using cURL client: cURL was compiled with ZLib support (see <code translate="no" class="notranslate">php --ri curl</code>)</li>
<li>When using the native HTTP client: <a href="https://www.php.net/zlib" class="reference external" rel="external noopener noreferrer" target="_blank">Zlib PHP extension</a> is installed</li>
</ul>
<p>If the server does respond with a gzipped response, it's decoded transparently.
To disable HTTP compression, send an <code translate="no" class="notranslate">Accept-Encoding: identity</code> HTTP header.</p>
<p>Chunked transfer encoding is enabled automatically if both your PHP runtime and
the remote server supports it.</p>
</div>
<div class="section">
<h3 id="http-2-support">
    HTTP/2 Support
    <a class="headerlink" href="#http-2-support" title="Permalink to this headline">¶</a>
</h3>
<p>When requesting an <code translate="no" class="notranslate">https</code> URL, HTTP/2 is enabled by default if one of the
following tools is installed:</p>
<ul>
    <li>The <a href="https://curl.haxx.se/libcurl/" class="reference external" rel="external noopener noreferrer" target="_blank">libcurl</a> package version 7.36 or higher;</li>
<li>The <a href="https://packagist.org/packages/amphp/http-client" class="reference external" rel="external noopener noreferrer" target="_blank">amphp/http-client</a> Packagist package version 4.2 or higher.</li>
</ul>
<p>To force HTTP/2 for <code translate="no" class="notranslate">http</code> URLs, you need to enable it explicitly via the
<code translate="no" class="notranslate">http_version</code> option:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-4">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-916adffb7807743a98413c1fc208ef265a6ffe4e" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-988ca71a7958cd5af7d7fd7b7597ccb0b2e1d6ee" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-a0e4c47f65e8ad88239b140303e38f48a86302fc" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
                    <button role="tab" type="button" data-language="php-standalone"
                aria-controls="configuration-block-tabpanel-58b78c3917578e45cff5b00039539d5b65157d1b" aria-selected="false"
                 tabindex="-1">
                <span>Standalone Use</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-916adffb7807743a98413c1fc208ef265a6ffe4e" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/framework.yaml</span>
<span class="hljs-attr">framework:</span>
    <span class="hljs-attr">http_client:</span>
        <span class="hljs-attr">default_options:</span>
            <span class="hljs-attr">http_version:</span> <span class="hljs-string">'2.0'</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-988ca71a7958cd5af7d7fd7b7597ccb0b2e1d6ee" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/packages/framework.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:framework</span>=<span class="hljs-string">"http://symfony.com/schema/dic/symfony"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd
        http://symfony.com/schema/dic/symfony https://symfony.com/schema/dic/symfony/symfony-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">framework:config</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">framework:http-client</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">framework:default-options</span> <span class="hljs-attr">http-version</span>=<span class="hljs-string">"2.0"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">framework:http-client</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">framework:config</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-a0e4c47f65e8ad88239b140303e38f48a86302fc" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/packages/framework.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Config</span>\<span class="hljs-title">FrameworkConfig</span>;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(FrameworkConfig <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span><span class="hljs-operator">-&gt;</span>httpClient()
        <span class="hljs-operator">-&gt;</span>defaultOptions()
            <span class="hljs-operator">-&gt;</span>httpVersion(<span class="hljs-string">'2.0'</span>)
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-58b78c3917578e45cff5b00039539d5b65157d1b" aria-label="Standalone Use" class="configuration-codeblock" data-language="php-standalone" style="display: none">
            <div translate="no" class="highlight-php-standalone highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php-standalone php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span> = HttpClient<span class="hljs-operator">::</span>create([<span class="hljs-string">'http_version'</span> =&gt; <span class="hljs-string">'2.0'</span>]);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>Support for HTTP/2 PUSH works out of the box when libcurl &gt;= 7.61 is used with
PHP &gt;= 7.2.17 / 7.3.4: pushed responses are put into a temporary cache and are
used when a subsequent request is triggered for the corresponding URLs.</p>
</div>
</div>
<div class="section">
<h2 id="processing-responses">
    Processing Responses
    <a class="headerlink" href="#processing-responses" title="Permalink to this headline">¶</a>
</h2>
<p>The response returned by all HTTP clients is an object of type
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Contracts/HttpClient/ResponseInterface.php" class="reference external" title="Symfony\Contracts\HttpClient\ResponseInterface" rel="external noopener noreferrer" target="_blank">ResponseInterface</a> which provides the
following methods:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'https://...'</span>);

<span class="hljs-comment">// gets the HTTP status code of the response</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>statusCode</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>getStatusCode();

<span class="hljs-comment">// gets the HTTP headers as string[][] with the header names lower-cased</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>headers</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>getHeaders();

<span class="hljs-comment">// gets the response body as a string</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>content</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>getContent();

<span class="hljs-comment">// casts the response JSON content to a PHP array</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>content</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>toArray();

<span class="hljs-comment">// casts the response content to a PHP stream resource</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>content</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>toStream();

<span class="hljs-comment">// cancels the request/response</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>cancel();

<span class="hljs-comment">// returns info coming from the transport layer, such as "response_headers",</span>
<span class="hljs-comment">// "redirect_count", "start_time", "redirect_url", etc.</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>httpInfo</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>getInfo();

<span class="hljs-comment">// you can get individual info too</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>startTime</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>getInfo(<span class="hljs-string">'start_time'</span>);
<span class="hljs-comment">// e.g. this returns the final response URL (resolving redirections if needed)</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>url</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>getInfo(<span class="hljs-string">'url'</span>);

<span class="hljs-comment">// returns detailed logs about the requests and responses of the HTTP transaction</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>httpLogs</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>getInfo(<span class="hljs-string">'debug'</span>);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p><code translate="no" class="notranslate">$response-&gt;toStream()</code> is part of <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpClient/Response/StreamableInterface.php" class="reference external" title="Symfony\Component\HttpClient\Response\StreamableInterface" rel="external noopener noreferrer" target="_blank">StreamableInterface</a>.</p>
</div>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p><code translate="no" class="notranslate">$response-&gt;getInfo()</code> is non-blocking: it returns <em>live</em> information
about the response. Some of them might not be known yet (e.g. <code translate="no" class="notranslate">http_code</code>)
when you'll call it.</p>
</div>
<span id="http-client-streaming-responses"></span>
<div class="section">
<h3 id="streaming-responses">
    Streaming Responses
    <a class="headerlink" href="#streaming-responses" title="Permalink to this headline">¶</a>
</h3>
<p>Call the <code translate="no" class="notranslate">stream()</code> method of the HTTP client to get <em>chunks</em> of the
response sequentially instead of waiting for the entire response:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>url</span> = <span class="hljs-string">'https://releases.ubuntu.com/18.04.1/ubuntu-18.04.1-desktop-amd64.iso'</span>;
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'GET'</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>url</span>);

<span class="hljs-comment">// Responses are lazy: this code is executed as soon as headers are received</span>
<span class="hljs-keyword">if</span> (<span class="hljs-number">200</span> !== <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>getStatusCode()) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> \<span class="hljs-keyword">Exception</span>(<span class="hljs-string">'...'</span>);
}

<span class="hljs-comment">// get the response content in chunks and save them in a file</span>
<span class="hljs-comment">// response chunks implement Symfony\Contracts\HttpClient\ChunkInterface</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>fileHandler</span> = fopen(<span class="hljs-string">'/ubuntu.iso'</span>, <span class="hljs-string">'w'</span>);
<span class="hljs-keyword">foreach</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>stream(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span>) <span class="hljs-keyword">as</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>chunk</span>) {
    fwrite(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>fileHandler</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>chunk</span><span class="hljs-operator">-&gt;</span>getContent());
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>By default, <code translate="no" class="notranslate">text/*</code>, JSON and XML response bodies are buffered in a local
<code translate="no" class="notranslate">php://temp</code> stream. You can control this behavior by using the <code translate="no" class="notranslate">buffer</code>
option: set it to <code translate="no" class="notranslate">true</code>/<code translate="no" class="notranslate">false</code> to enable/disable buffering, or to a
closure that should return the same based on the response headers it receives
as an argument.</p>
</div>
</div>
<div class="section">
<h3 id="canceling-responses">
    Canceling Responses
    <a class="headerlink" href="#canceling-responses" title="Permalink to this headline">¶</a>
</h3>
<p>To abort a request (e.g. because it didn't complete in due time, or you want to
fetch only the first bytes of the response, etc.), you can either use the
<code translate="no" class="notranslate">cancel()</code> method of
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Contracts/HttpClient/ResponseInterface.php" class="reference external" title="Symfony\Contracts\HttpClient\ResponseInterface" rel="external noopener noreferrer" target="_blank">ResponseInterface</a>:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>cancel();</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Or throw an exception from a progress callback:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'https://...'</span>, [
    <span class="hljs-string">'on_progress'</span> =&gt; <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(int <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>dlNow</span>, int <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>dlSize</span>, array <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>info</span>)</span>: <span class="hljs-title">void</span> </span>{
        <span class="hljs-comment">// ...</span>

        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> \MyException();
    },
]);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>The exception will be wrapped in an instance of
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Contracts/HttpClient/Exception/TransportExceptionInterface.php" class="reference external" title="Symfony\Contracts\HttpClient\Exception\TransportExceptionInterface" rel="external noopener noreferrer" target="_blank">TransportExceptionInterface</a>
and will abort the request.</p>
<p>In case the response was canceled using <code translate="no" class="notranslate">$response-&gt;cancel()</code>,
<code translate="no" class="notranslate">$response-&gt;getInfo(&#039;canceled&#039;)</code> will return <code translate="no" class="notranslate">true</code>.</p>
</div>
<div class="section">
<h3 id="handling-exceptions">
    Handling Exceptions
    <a class="headerlink" href="#handling-exceptions" title="Permalink to this headline">¶</a>
</h3>
<p>There are three types of exceptions, all of which implement the
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Contracts/HttpClient/Exception/ExceptionInterface.php" class="reference external" title="Symfony\Contracts\HttpClient\Exception\ExceptionInterface" rel="external noopener noreferrer" target="_blank">ExceptionInterface</a>:</p>
<ul>
    <li>Exceptions implementing the <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Contracts/HttpClient/Exception/HttpExceptionInterface.php" class="reference external" title="Symfony\Contracts\HttpClient\Exception\HttpExceptionInterface" rel="external noopener noreferrer" target="_blank">HttpExceptionInterface</a>
are thrown when your code does not handle the status codes in the 300-599 range.</li>
<li>Exceptions implementing the <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Contracts/HttpClient/Exception/TransportExceptionInterface.php" class="reference external" title="Symfony\Contracts\HttpClient\Exception\TransportExceptionInterface" rel="external noopener noreferrer" target="_blank">TransportExceptionInterface</a>
are thrown when a lower level issue occurs.</li>
<li>Exceptions implementing the <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Contracts/HttpClient/Exception/DecodingExceptionInterface.php" class="reference external" title="Symfony\Contracts\HttpClient\Exception\DecodingExceptionInterface" rel="external noopener noreferrer" target="_blank">DecodingExceptionInterface</a>
are thrown when a content-type cannot be decoded to the expected representation.</li>
</ul>
<p>When the HTTP status code of the response is in the 300-599 range (i.e. 3xx,
4xx or 5xx), the <code translate="no" class="notranslate">getHeaders()</code>, <code translate="no" class="notranslate">getContent()</code> and <code translate="no" class="notranslate">toArray()</code> methods
throw an appropriate exception, all of which implement the
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Contracts/HttpClient/Exception/HttpExceptionInterface.php" class="reference external" title="Symfony\Contracts\HttpClient\Exception\HttpExceptionInterface" rel="external noopener noreferrer" target="_blank">HttpExceptionInterface</a>.</p>
<p>To opt-out from this exception and deal with 300-599 status codes on your own,
pass <code translate="no" class="notranslate">false</code> as the optional argument to every call of those methods,
e.g. <code translate="no" class="notranslate">$response-&gt;getHeaders(false);</code>.</p>
<p>If you do not call any of these 3 methods at all, the exception will still be thrown
when the <code translate="no" class="notranslate">$response</code> object is destructed.</p>
<p>Calling <code translate="no" class="notranslate">$response-&gt;getStatusCode()</code> is enough to disable this behavior
(but then don't miss checking the status code yourself).</p>
<p>While responses are lazy, their destructor will always wait for headers to come
back. This means that the following request <em>will</em> complete; and if e.g. a 404
is returned, an exception will be thrown:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// because the returned value is not assigned to a variable, the destructor</span>
<span class="hljs-comment">// of the returned response will be called immediately and will throw if the</span>
<span class="hljs-comment">// status code is in the 300-599 range</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'POST'</span>, <span class="hljs-string">'https://...'</span>);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>This in turn means that unassigned responses will fallback to synchronous requests.
If you want to make these requests concurrent, you can store their corresponding
responses in an array:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>responses</span>[] = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'POST'</span>, <span class="hljs-string">'https://.../path1'</span>);
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>responses</span>[] = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'POST'</span>, <span class="hljs-string">'https://.../path2'</span>);
<span class="hljs-comment">// ...</span>

<span class="hljs-comment">// This line will trigger the destructor of all responses stored in the array;</span>
<span class="hljs-comment">// they will complete concurrently and an exception will be thrown in case a</span>
<span class="hljs-comment">// status code in the 300-599 range is returned</span>
<span class="hljs-keyword">unset</span>(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>responses</span>);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>This behavior provided at destruction-time is part of the fail-safe design of the
component. No errors will be unnoticed: if you don't write the code to handle
errors, exceptions will notify you when needed. On the other hand, if you write
the error-handling code (by calling <code translate="no" class="notranslate">$response-&gt;getStatusCode()</code>), you will
opt-out from these fallback mechanisms as the destructor won't have anything
remaining to do.</p>
</div>
</div>
<div class="section">
<h2 id="concurrent-requests">
    Concurrent Requests
    <a class="headerlink" href="#concurrent-requests" title="Permalink to this headline">¶</a>
</h2>
<p>Thanks to responses being lazy, requests are always managed concurrently.
On a fast enough network, the following code makes 379 requests in less than
half a second when cURL is used:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>responses</span> = [];
<span class="hljs-keyword">for</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>i</span> &lt; <span class="hljs-number">379</span>; ++<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>i</span>) {
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>uri</span> = <span class="hljs-string">"https://http2.akamai.com/demo/tile-$i.png"</span>;
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>responses</span>[] = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'GET'</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>uri</span>);
}

<span class="hljs-keyword">foreach</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>responses</span> <span class="hljs-keyword">as</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span>) {
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>content</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>getContent();
    <span class="hljs-comment">// ...</span>
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>As you can read in the first &quot;for&quot; loop, requests are issued but are not consumed
yet. That's the trick when concurrency is desired: requests should be sent
first and be read later on. This will allow the client to monitor all pending
requests while your code waits for a specific one, as done in each iteration of
the above &quot;foreach&quot; loop.</p>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>The maximum number of concurrent requests that you can perform depends on
the resources of your machine (e.g. your operating system may limit the
number of simultaneous reads of the file that stores the certificates
file). Make your requests in batches to avoid these issues.</p>
</div>
<div class="section">
<h3 id="multiplexing-responses">
    Multiplexing Responses
    <a class="headerlink" href="#multiplexing-responses" title="Permalink to this headline">¶</a>
</h3>
<p>If you look again at the snippet above, responses are read in requests' order.
But maybe the 2nd response came back before the 1st? Fully asynchronous operations
require being able to deal with the responses in whatever order they come back.</p>
<p>In order to do so, the <code translate="no" class="notranslate">stream()</code> method of HTTP clients accepts a list of
responses to monitor. As mentioned <a href="http_client.html#http-client-streaming-responses" class="reference internal">previously</a>,
this method yields response chunks as they arrive from the network. By replacing
the &quot;foreach&quot; in the snippet with this one, the code becomes fully async:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">foreach</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>stream(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>responses</span>) <span class="hljs-keyword">as</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> =&gt; <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>chunk</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>chunk</span><span class="hljs-operator">-&gt;</span>isFirst()) {
        <span class="hljs-comment">// headers of $response just arrived</span>
        <span class="hljs-comment">// $response-&gt;getHeaders() is now a non-blocking call</span>
    } <span class="hljs-keyword">elseif</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>chunk</span><span class="hljs-operator">-&gt;</span>isLast()) {
        <span class="hljs-comment">// the full content of $response just completed</span>
        <span class="hljs-comment">// $response-&gt;getContent() is now a non-blocking call</span>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// $chunk-&gt;getContent() will return a piece</span>
        <span class="hljs-comment">// of the response body that just arrived</span>
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-tip ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                <span>Tip</span>
    </p><p>Use the <code translate="no" class="notranslate">user_data</code> option combined with <code translate="no" class="notranslate">$response-&gt;getInfo(&#039;user_data&#039;)</code>
to track the identity of the responses in your foreach loops.</p>
</div>
</div>
<div class="section">
<h3 id="dealing-with-network-timeouts">
    Dealing with Network Timeouts
    <a class="headerlink" href="#dealing-with-network-timeouts" title="Permalink to this headline">¶</a>
</h3>
<p>This component allows dealing with both request and response timeouts.</p>
<p>A timeout can happen when e.g. DNS resolution takes too much time, when the TCP
connection cannot be opened in the given time budget, or when the response
content pauses for too long. This can be configured with the <code translate="no" class="notranslate">timeout</code> request
option:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// A TransportExceptionInterface will be issued if nothing</span>
<span class="hljs-comment">// happens for 2.5 seconds when accessing from the $response</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'https://...'</span>, [<span class="hljs-string">'timeout'</span> =&gt; <span class="hljs-number">2.5</span>]);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>The <code translate="no" class="notranslate">default_socket_timeout</code> PHP ini setting is used if the option is not set.</p>
<p>The option can be overridden by using the 2nd argument of the <code translate="no" class="notranslate">stream()</code> method.
This allows monitoring several responses at once and applying the timeout to all
of them in a group. If all responses become inactive for the given duration, the
method will yield a special chunk whose <code translate="no" class="notranslate">isTimeout()</code> will return <code translate="no" class="notranslate">true</code>:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">foreach</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>stream(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>responses</span>, <span class="hljs-number">1.5</span>) <span class="hljs-keyword">as</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> =&gt; <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>chunk</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>chunk</span><span class="hljs-operator">-&gt;</span>isTimeout()) {
        <span class="hljs-comment">// $response stale for more than 1.5 seconds</span>
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>A timeout is not necessarily an error: you can decide to stream again the
response and get remaining contents that might come back in a new timeout, etc.</p>
<div class="admonition admonition-tip ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                <span>Tip</span>
    </p><p>Passing <code translate="no" class="notranslate">0</code> as timeout allows monitoring responses in a non-blocking way.</p>
</div>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>Timeouts control how long one is willing to wait <em>while the HTTP transaction
is idle</em>. Big responses can last as long as needed to complete, provided they
remain active during the transfer and never pause for longer than specified.</p>
<p>Use the <code translate="no" class="notranslate">max_duration</code> option to limit the time a full request/response can last.</p>
</div>
<span id="http-client_network-errors"></span>
</div>
<div class="section">
<h3 id="dealing-with-network-errors">
    Dealing with Network Errors
    <a class="headerlink" href="#dealing-with-network-errors" title="Permalink to this headline">¶</a>
</h3>
<p>Network errors (broken pipe, failed DNS resolution, etc.) are thrown as instances
of <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Contracts/HttpClient/Exception/TransportExceptionInterface.php" class="reference external" title="Symfony\Contracts\HttpClient\Exception\TransportExceptionInterface" rel="external noopener noreferrer" target="_blank">TransportExceptionInterface</a>.</p>
<p>First of all, you don't <em>have</em> to deal with them: letting errors bubble to your
generic exception-handling stack might be really fine in most use cases.</p>
<p>If you want to handle them, here is what you need to know:</p>
<p>To catch errors, you need to wrap calls to <code translate="no" class="notranslate">$client-&gt;request()</code> but also calls
to any methods of the returned responses. This is because responses are lazy, so
that network errors can happen when calling e.g. <code translate="no" class="notranslate">getStatusCode()</code> too:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">Exception</span>\<span class="hljs-title">TransportExceptionInterface</span>;

<span class="hljs-comment">// ...</span>
<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// both lines can potentially throw</span>
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-comment">/* ... */</span>);
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>headers</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>getHeaders();
    <span class="hljs-comment">// ...</span>
} <span class="hljs-keyword">catch</span> (TransportExceptionInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>e</span>) {
    <span class="hljs-comment">// ...</span>
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>Because <code translate="no" class="notranslate">$response-&gt;getInfo()</code> is non-blocking, it shouldn't throw by design.</p>
</div>
<p>When multiplexing responses, you can deal with errors for individual streams by
catching <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Contracts/HttpClient/Exception/TransportExceptionInterface.php" class="reference external" title="Symfony\Contracts\HttpClient\Exception\TransportExceptionInterface" rel="external noopener noreferrer" target="_blank">TransportExceptionInterface</a>
in the foreach loop:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">foreach</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>stream(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>responses</span>) <span class="hljs-keyword">as</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> =&gt; <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>chunk</span>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>chunk</span><span class="hljs-operator">-&gt;</span>isTimeout()) {
            <span class="hljs-comment">// ... decide what to do when a timeout occurs</span>
            <span class="hljs-comment">// if you want to stop a response that timed out, don't miss</span>
            <span class="hljs-comment">// calling $response-&gt;cancel() or the destructor of the response</span>
            <span class="hljs-comment">// will try to complete it one more time</span>
        } <span class="hljs-keyword">elseif</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>chunk</span><span class="hljs-operator">-&gt;</span>isFirst()) {
            <span class="hljs-comment">// if you want to check the status code, you must do it when the</span>
            <span class="hljs-comment">// first chunk arrived, using $response-&gt;getStatusCode();</span>
            <span class="hljs-comment">// not doing so might trigger an HttpExceptionInterface</span>
        } <span class="hljs-keyword">elseif</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>chunk</span><span class="hljs-operator">-&gt;</span>isLast()) {
            <span class="hljs-comment">// ... do something with $response</span>
        }
    } <span class="hljs-keyword">catch</span> (TransportExceptionInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>e</span>) {
        <span class="hljs-comment">// ...</span>
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
</div>
<div class="section">
<h2 id="caching-requests-and-responses">
    Caching Requests and Responses
    <a class="headerlink" href="#caching-requests-and-responses" title="Permalink to this headline">¶</a>
</h2>
<p>This component provides a <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpClient/CachingHttpClient.php" class="reference external" title="Symfony\Component\HttpClient\CachingHttpClient" rel="external noopener noreferrer" target="_blank">CachingHttpClient</a>
decorator that allows caching responses and serving them from the local storage
for next requests. The implementation leverages the
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpKernel/HttpCache/HttpCache.php" class="reference external" title="Symfony\Component\HttpKernel\HttpCache\HttpCache" rel="external noopener noreferrer" target="_blank">HttpCache</a> class under the hood
so that the <a href="components/http_kernel.html" class="reference internal">HttpKernel component</a> needs to be
installed in your application:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">CachingHttpClient</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">HttpClient</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpKernel</span>\<span class="hljs-title">HttpCache</span>\<span class="hljs-title">Store</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>store</span> = <span class="hljs-keyword">new</span> Store(<span class="hljs-string">'/path/to/cache/storage/'</span>);
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span> = HttpClient<span class="hljs-operator">::</span>create();
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span> = <span class="hljs-keyword">new</span> CachingHttpClient(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>store</span>);

<span class="hljs-comment">// this won't hit the network if the resource is already in the cache</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'https://example.com/cacheable-resource'</span>);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p><code translate="no" class="notranslate">CachingHttpClient</code> accepts a third argument to set the options of the <code translate="no" class="notranslate">HttpCache</code>.</p>
</div>
<div class="section">
<h2 id="consuming-server-sent-events">
    Consuming Server-Sent Events
    <a class="headerlink" href="#consuming-server-sent-events" title="Permalink to this headline">¶</a>
</h2>
<p><a href="https://html.spec.whatwg.org/multipage/server-sent-events.html" class="reference external" rel="external noopener noreferrer" target="_blank">Server-sent events</a> is an Internet standard used to push data to web pages.
Its JavaScript API is built around an <a href="https://www.w3.org/TR/eventsource/#eventsource" class="reference external" rel="external noopener noreferrer" target="_blank">EventSource</a> object, which listens to
the events sent from some URL. The events are a stream of data (served with the
<code translate="no" class="notranslate">text/event-stream</code> MIME type) with the following format:</p>
<div translate="no" class="highlight-text notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs text">data: This is the first message.

data: This is the second message, it
data: has two lines.

data: This is the third message.</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Symfony's HTTP client provides an EventSource implementation to consume these
server-sent events. Use the <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpClient/EventSourceHttpClient.php" class="reference external" title="Symfony\Component\HttpClient\EventSourceHttpClient" rel="external noopener noreferrer" target="_blank">EventSourceHttpClient</a>
to wrap your HTTP client, open a connection to a server that responds with a
<code translate="no" class="notranslate">text/event-stream</code> content type and consume the stream as follows:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">Chunk</span>\<span class="hljs-title">ServerSentEvent</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">EventSourceHttpClient</span>;

<span class="hljs-comment">// the second optional argument is the reconnection time in seconds (default = 10)</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span> = <span class="hljs-keyword">new</span> EventSourceHttpClient(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span>, <span class="hljs-number">10</span>);
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>source</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>connect(<span class="hljs-string">'https://localhost:8080/events'</span>);
<span class="hljs-keyword">while</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>source</span>) {
    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>stream(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>source</span>, <span class="hljs-number">2</span>) <span class="hljs-keyword">as</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>r</span> =&gt; <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>chunk</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>chunk</span><span class="hljs-operator">-&gt;</span>isTimeout()) {
            <span class="hljs-comment">// ...</span>
            <span class="hljs-keyword">continue</span>;
        }

        <span class="hljs-keyword">if</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>chunk</span><span class="hljs-operator">-&gt;</span>isLast()) {
            <span class="hljs-comment">// ...</span>

            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-comment">// this is a special ServerSentEvent chunk holding the pushed message</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>chunk</span> <span class="hljs-keyword">instanceof</span> ServerSentEvent) {
            <span class="hljs-comment">// do something with the server event ...</span>
        }
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
<div class="section">
<h2 id="interoperability">
    Interoperability
    <a class="headerlink" href="#interoperability" title="Permalink to this headline">¶</a>
</h2>
<p>The component is interoperable with four different abstractions for HTTP
clients: <a href="https://github.com/symfony/contracts" class="reference external" rel="external noopener noreferrer" target="_blank">Symfony Contracts</a>, <a href="https://www.php-fig.org/psr/psr-18/" class="reference external" rel="external noopener noreferrer" target="_blank">PSR-18</a>, <a href="https://github.com/php-http/httplug/#readme" class="reference external" rel="external noopener noreferrer" target="_blank">HTTPlug</a> v1/v2 and native PHP streams.
If your application uses libraries that need any of them, the component is compatible
with all of them. They also benefit from <a href="service_container/autowiring.html#service-autowiring-alias" class="reference internal">autowiring aliases</a>
when the <a href="reference/configuration/framework.html#framework-bundle-configuration" class="reference internal">framework bundle</a> is used.</p>
<p>If you are writing or maintaining a library that makes HTTP requests, you can
decouple it from any specific HTTP client implementations by coding against
either Symfony Contracts (recommended), PSR-18 or HTTPlug v2.</p>
<div class="section">
<h3 id="symfony-contracts">
    Symfony Contracts
    <a class="headerlink" href="#symfony-contracts" title="Permalink to this headline">¶</a>
</h3>
<p>The interfaces found in the <code translate="no" class="notranslate">symfony/http-client-contracts</code> package define
the primary abstractions implemented by the component. Its entry point is the
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Contracts/HttpClient/HttpClientInterface.php" class="reference external" title="Symfony\Contracts\HttpClient\HttpClientInterface" rel="external noopener noreferrer" target="_blank">HttpClientInterface</a>. That's the
interface you need to code against when a client is needed:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">HttpClientInterface</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApiLayer</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(
        private HttpClientInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span>,
    )</span> </span>{
    }

    <span class="hljs-comment">// [...]</span>
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>All request options mentioned above (e.g. timeout management) are also defined
in the wordings of the interface, so that any compliant implementations (like
this component) is guaranteed to provide them. That's a major difference with
the other abstractions, which provide none related to the transport itself.</p>
<p>Another major feature covered by the Symfony Contracts is async/multiplexing,
as described in the previous sections.</p>
</div>
<div class="section">
<h3 id="psr-18-and-psr-17">
    PSR-18 and PSR-17
    <a class="headerlink" href="#psr-18-and-psr-17" title="Permalink to this headline">¶</a>
</h3>
<p>This component implements the <a href="https://www.php-fig.org/psr/psr-18/" class="reference external" rel="external noopener noreferrer" target="_blank">PSR-18</a> (HTTP Client) specifications via the
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpClient/Psr18Client.php" class="reference external" title="Symfony\Component\HttpClient\Psr18Client" rel="external noopener noreferrer" target="_blank">Psr18Client</a> class, which is an adapter
to turn a Symfony <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Contracts/HttpClient/HttpClientInterface.php" class="reference external" title="Symfony\Contracts\HttpClient\HttpClientInterface" rel="external noopener noreferrer" target="_blank">HttpClientInterface</a>
into a PSR-18 <code translate="no" class="notranslate">ClientInterface</code>. This class also implements the relevant
methods of <a href="https://www.php-fig.org/psr/psr-17/" class="reference external" rel="external noopener noreferrer" target="_blank">PSR-17</a> to ease creating request objects.</p>
<p>To use it, you need the <code translate="no" class="notranslate">psr/http-client</code> package and a <a href="https://www.php-fig.org/psr/psr-17/" class="reference external" rel="external noopener noreferrer" target="_blank">PSR-17</a> implementation:</p>
<div translate="no" class="highlight-terminal highlight-bash notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs terminal bash"><span class="hljs-comment"># installs the PSR-18 ClientInterface</span>
<span class="hljs-prompt">$ </span>composer require psr/http-client

<span class="hljs-comment"># installs an efficient implementation of response and stream factories</span>
<span class="hljs-comment"># with autowiring aliases provided by Symfony Flex</span>
<span class="hljs-prompt">$ </span>composer require nyholm/psr7

<span class="hljs-comment"># alternatively, install the php-http/discovery package to auto-discover</span>
<span class="hljs-comment"># any already installed implementations from common vendors:</span>
<span class="hljs-comment"># composer require php-http/discovery</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Now you can make HTTP requests with the PSR-18 client as follows:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-2">
                    <button role="tab" type="button" data-language="php-symfony"
                aria-controls="configuration-block-tabpanel-a3e3ae3278c87b595937f99cc4e18d2939450b28" aria-selected="true"
                data-active="true" >
                <span>Framework Use</span>
            </button>
                    <button role="tab" type="button" data-language="php-standalone"
                aria-controls="configuration-block-tabpanel-50cd2419e1bd37b2f9674f860f6f640debeae47d" aria-selected="false"
                 tabindex="-1">
                <span>Standalone Use</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-a3e3ae3278c87b595937f99cc4e18d2939450b28" aria-label="Framework Use" class="configuration-codeblock" data-language="php-symfony" style="">
            <div translate="no" class="highlight-php-symfony highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php-symfony php"><span class="hljs-keyword">use</span> <span class="hljs-title">Psr</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Client</span>\<span class="hljs-title">ClientInterface</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Symfony</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(
        private ClientInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span>,
    )</span> </span>{
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getAvailableVersions</span><span class="hljs-params">()</span>: <span class="hljs-title">array</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>client<span class="hljs-operator">-&gt;</span>createRequest(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'https://symfony.com/versions.json'</span>);
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>client<span class="hljs-operator">-&gt;</span>sendRequest(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span>);

        <span class="hljs-keyword">return</span> json_decode(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>getBody()<span class="hljs-operator">-&gt;</span>getContents(), <span class="hljs-keyword">true</span>);
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-50cd2419e1bd37b2f9674f860f6f640debeae47d" aria-label="Standalone Use" class="configuration-codeblock" data-language="php-standalone" style="display: none">
            <div translate="no" class="highlight-php-standalone highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php-standalone php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">Psr18Client</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span> = <span class="hljs-keyword">new</span> Psr18Client();

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>createRequest(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'https://symfony.com/versions.json'</span>);
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>sendRequest(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span>);

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>content</span> = json_decode(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>getBody()<span class="hljs-operator">-&gt;</span>getContents(), <span class="hljs-keyword">true</span>);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>You can also pass a set of default options to your client thanks to the
<code translate="no" class="notranslate">Psr18Client::withOptions()</code> method:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">Psr18Client</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span> = (<span class="hljs-keyword">new</span> Psr18Client())
    <span class="hljs-operator">-&gt;</span>withOptions([
        <span class="hljs-string">'base_uri'</span> =&gt; <span class="hljs-string">'https://symfony.com'</span>,
        <span class="hljs-string">'headers'</span> =&gt; [
            <span class="hljs-string">'Accept'</span> =&gt; <span class="hljs-string">'application/json'</span>,
        ],
    ]);

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>createRequest(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'/versions.json'</span>);

<span class="hljs-comment">// ...</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-versionadded ">
    <p class="admonition-title">
                                    <span>6.2</span>
    </p><p>The <code translate="no" class="notranslate">Psr18Client::withOptions()</code> method was introduced in Symfony 6.2.</p>
</div>
</div>
<div class="section">
<h3 id="httplug">
    HTTPlug
    <a class="headerlink" href="#httplug" title="Permalink to this headline">¶</a>
</h3>
<p>The <a href="https://github.com/php-http/httplug/#readme" class="reference external" rel="external noopener noreferrer" target="_blank">HTTPlug</a> v1 specification was published before PSR-18 and is superseded by
it. As such, you should not use it in newly written code. The component is still
interoperable with libraries that require it thanks to the
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpClient/HttplugClient.php" class="reference external" title="Symfony\Component\HttpClient\HttplugClient" rel="external noopener noreferrer" target="_blank">HttplugClient</a> class. Similarly to
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpClient/Psr18Client.php" class="reference external" title="Symfony\Component\HttpClient\Psr18Client" rel="external noopener noreferrer" target="_blank">Psr18Client</a> implementing relevant parts of PSR-17,
<code translate="no" class="notranslate">HttplugClient</code> also implements the factory methods defined in the related
<code translate="no" class="notranslate">php-http/message-factory</code> package.</p>
<div translate="no" class="highlight-terminal highlight-bash notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs terminal bash"><span class="hljs-comment"># Let's suppose php-http/httplug is already required by the lib you want to use</span>

<span class="hljs-comment"># installs an efficient implementation of response and stream factories</span>
<span class="hljs-comment"># with autowiring aliases provided by Symfony Flex</span>
<span class="hljs-prompt">$ </span>composer require nyholm/psr7

<span class="hljs-comment"># alternatively, install the php-http/discovery package to auto-discover</span>
<span class="hljs-comment"># any already installed implementations from common vendors:</span>
<span class="hljs-comment"># composer require php-http/discovery</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Let's say you want to instantiate a class with the following constructor,
that requires HTTPlug dependencies:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Http</span>\<span class="hljs-title">Client</span>\<span class="hljs-title">HttpClient</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Http</span>\<span class="hljs-title">Message</span>\<span class="hljs-title">RequestFactory</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Http</span>\<span class="hljs-title">Message</span>\<span class="hljs-title">StreamFactory</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SomeSdk</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(
        HttpClient <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>httpClient</span>,
        RequestFactory <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>requestFactory</span>,
        StreamFactory <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>streamFactory</span>
    )</span>
    // [...]
}</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Because <code translate="no" class="notranslate">HttplugClient</code> implements the three interfaces, you can use it this way:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">HttplugClient</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>httpClient</span> = <span class="hljs-keyword">new</span> HttplugClient();
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>apiClient</span> = <span class="hljs-keyword">new</span> SomeSdk(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>httpClient</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>httpClient</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>httpClient</span>);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>If you'd like to work with promises, <code translate="no" class="notranslate">HttplugClient</code> also implements the
<code translate="no" class="notranslate">HttpAsyncClient</code> interface. To use it, you need to install the
<code translate="no" class="notranslate">guzzlehttp/promises</code> package:</p>
<div translate="no" class="highlight-terminal highlight-bash notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs terminal bash"><span class="hljs-prompt">$ </span>composer require guzzlehttp/promises</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Then you're ready to go:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Psr</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Message</span>\<span class="hljs-title">ResponseInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">HttplugClient</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>httpClient</span> = <span class="hljs-keyword">new</span> HttplugClient();
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>httpClient</span><span class="hljs-operator">-&gt;</span>createRequest(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'https://my.api.com/'</span>);
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>promise</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>httpClient</span><span class="hljs-operator">-&gt;</span>sendAsyncRequest(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span>)
    <span class="hljs-operator">-&gt;</span>then(
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ResponseInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span>)</span> </span>{
            <span class="hljs-keyword">echo</span> <span class="hljs-string">'Got status '</span>.<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>getStatusCode();

            <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span>;
        },
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(\Throwable <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>exception</span>)</span> </span>{
            <span class="hljs-keyword">echo</span> <span class="hljs-string">'Error: '</span>.<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>exception</span><span class="hljs-operator">-&gt;</span>getMessage();

            <span class="hljs-keyword">throw</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>exception</span>;
        }
    );

<span class="hljs-comment">// after you're done with sending several requests,</span>
<span class="hljs-comment">// you must wait for them to complete concurrently</span>

<span class="hljs-comment">// wait for a specific promise to resolve while monitoring them all</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>promise</span><span class="hljs-operator">-&gt;</span>wait();

<span class="hljs-comment">// wait maximum 1 second for pending promises to resolve</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>httpClient</span><span class="hljs-operator">-&gt;</span>wait(<span class="hljs-number">1.0</span>);

<span class="hljs-comment">// wait for all remaining promises to resolve</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>httpClient</span><span class="hljs-operator">-&gt;</span>wait();</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>You can also pass a set of default options to your client thanks to the
<code translate="no" class="notranslate">HttplugClient::withOptions()</code> method:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Psr</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Message</span>\<span class="hljs-title">ResponseInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">HttplugClient</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>httpClient</span> = (<span class="hljs-keyword">new</span> HttplugClient())
    <span class="hljs-operator">-&gt;</span>withOptions([
        <span class="hljs-string">'base_uri'</span> =&gt; <span class="hljs-string">'https://my.api.com'</span>,
    ]);
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>httpClient</span><span class="hljs-operator">-&gt;</span>createRequest(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'/'</span>);

<span class="hljs-comment">// ...</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-versionadded ">
    <p class="admonition-title">
                                    <span>6.2</span>
    </p><p>The <code translate="no" class="notranslate">HttplugClient::withOptions()</code> method was introduced in Symfony 6.2.</p>
</div>
</div>
<div class="section">
<h3 id="native-php-streams">
    Native PHP Streams
    <a class="headerlink" href="#native-php-streams" title="Permalink to this headline">¶</a>
</h3>
<p>Responses implementing <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Contracts/HttpClient/ResponseInterface.php" class="reference external" title="Symfony\Contracts\HttpClient\ResponseInterface" rel="external noopener noreferrer" target="_blank">ResponseInterface</a>
can be cast to native PHP streams with
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpClient/Response/StreamWrapper.php#method_createResource" class="reference external" title="Symfony\Component\HttpClient\Response\StreamWrapper::createResource()" rel="external noopener noreferrer" target="_blank">createResource()</a>.
This allows using them where native PHP streams are needed:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">HttpClient</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">Response</span>\<span class="hljs-title">StreamWrapper</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span> = HttpClient<span class="hljs-operator">::</span>create();
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'https://symfony.com/versions.json'</span>);

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>streamResource</span> = StreamWrapper<span class="hljs-operator">::</span>createResource(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span>);

<span class="hljs-comment">// alternatively and contrary to the previous one, this returns</span>
<span class="hljs-comment">// a resource that is seekable and potentially stream_select()-able</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>streamResource</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>toStream();

<span class="hljs-keyword">echo</span> stream_get_contents(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>streamResource</span>); <span class="hljs-comment">// outputs the content of the response</span>

<span class="hljs-comment">// later on if you need to, you can access the response from the stream</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = stream_get_meta_data(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>streamResource</span>)[<span class="hljs-string">'wrapper_data'</span>]<span class="hljs-operator">-&gt;</span>getResponse();</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
</div>
<div class="section">
<h2 id="extensibility">
    Extensibility
    <a class="headerlink" href="#extensibility" title="Permalink to this headline">¶</a>
</h2>
<p>If you want to extend the behavior of a base HTTP client, you can use
<a href="service_container/service_decoration.html" class="reference internal">service decoration</a>:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyExtendedHttpClient</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">HttpClientInterface</span>
</span>{
    <span class="hljs-keyword">private</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>decoratedClient</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(HttpClientInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>decoratedClient</span> = null)</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>decoratedClient = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>decoratedClient</span> ?? HttpClient<span class="hljs-operator">::</span>create();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">request</span><span class="hljs-params">(string <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>method</span>, string <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>url</span>, array <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>options</span> = [])</span>: <span class="hljs-title">ResponseInterface</span>
    </span>{
        <span class="hljs-comment">// process and/or change the $method, $url and/or $options as needed</span>
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>decoratedClient<span class="hljs-operator">-&gt;</span>request(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>method</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>url</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>options</span>);

        <span class="hljs-comment">// if you call here any method on $response, the HTTP request</span>
        <span class="hljs-comment">// won't be async; see below for a better way</span>

        <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stream</span><span class="hljs-params">(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>responses</span>, float <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>timeout</span> = null)</span>: <span class="hljs-title">ResponseStreamInterface</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>decoratedClient<span class="hljs-operator">-&gt;</span>stream(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>responses</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>timeout</span>);
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>A decorator like this one is useful in cases where processing the requests'
arguments is enough. By decorating the <code translate="no" class="notranslate">on_progress</code> option, you can
even implement basic monitoring of the response. However, since calling
responses' methods forces synchronous operations, doing so inside <code translate="no" class="notranslate">request()</code>
will break async.</p>
<p>The solution is to also decorate the response object itself.
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpClient/TraceableHttpClient.php" class="reference external" title="Symfony\Component\HttpClient\TraceableHttpClient" rel="external noopener noreferrer" target="_blank">TraceableHttpClient</a> and
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpClient/Response/TraceableResponse.php" class="reference external" title="Symfony\Component\HttpClient\Response\TraceableResponse" rel="external noopener noreferrer" target="_blank">TraceableResponse</a> are good
examples as a starting point.</p>
<p>In order to help writing more advanced response processors, the component provides
an <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpClient/AsyncDecoratorTrait.php" class="reference external" title="Symfony\Component\HttpClient\AsyncDecoratorTrait" rel="external noopener noreferrer" target="_blank">AsyncDecoratorTrait</a>. This trait allows
processing the stream of chunks as they come back from the network:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyExtendedHttpClient</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">HttpClientInterface</span>
</span>{
    <span class="hljs-keyword">use</span> <span class="hljs-title">AsyncDecoratorTrait</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">request</span><span class="hljs-params">(string <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>method</span>, string <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>url</span>, array <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>options</span> = [])</span>: <span class="hljs-title">ResponseInterface</span>
    </span>{
        <span class="hljs-comment">// process and/or change the $method, $url and/or $options as needed</span>

        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>passthru</span> = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ChunkInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>chunk</span>, AsyncContext <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>context</span>)</span> </span>{
            <span class="hljs-comment">// do what you want with chunks, e.g. split them</span>
            <span class="hljs-comment">// in smaller chunks, group them, skip some, etc.</span>

            <span class="hljs-keyword">yield</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>chunk</span>;
        };

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> AsyncResponse(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>client, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>method</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>url</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>options</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>passthru</span>);
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Because the trait already implements a constructor and the <code translate="no" class="notranslate">stream()</code> method,
you don't need to add them. The <code translate="no" class="notranslate">request()</code> method should still be defined;
it shall return an
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpClient/Response/AsyncResponse.php" class="reference external" title="Symfony\Component\HttpClient\Response\AsyncResponse" rel="external noopener noreferrer" target="_blank">AsyncResponse</a>.</p>
<p>The custom processing of chunks should happen in <code translate="no" class="notranslate">$passthru</code>: this generator
is where you need to write your logic. It will be called for each chunk yielded
by the underlying client. A <code translate="no" class="notranslate">$passthru</code> that does nothing would just <code translate="no" class="notranslate">yield
$chunk;</code>. You could also yield a modified chunk, split the chunk into many
ones by yielding several times, or even skip a chunk altogether by issuing a
<code translate="no" class="notranslate">return;</code> instead of yielding.</p>
<p>In order to control the stream, the chunk passthru receives an
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpClient/Response/AsyncContext.php" class="reference external" title="Symfony\Component\HttpClient\Response\AsyncContext" rel="external noopener noreferrer" target="_blank">AsyncContext</a> as second
argument. This context object has methods to read the current state of the
response. It also allows altering the response stream with methods to create
new chunks of content, pause the stream, cancel the stream, change the info of
the response, replace the current request by another one or change the chunk
passthru itself.</p>
<p>Checking the test cases implemented in
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpClient/Tests/AsyncDecoratorTraitTest.php" class="reference external" title="Symfony\Component\HttpClient\Tests\AsyncDecoratorTraitTest" rel="external noopener noreferrer" target="_blank">AsyncDecoratorTraitTest</a>
might be a good start to get various working examples for a better understanding.
Here are the use cases that it simulates:</p>
<ul>
    <li>retry a failed request;</li>
<li>send a preflight request, e.g. for authentication needs;</li>
<li>issue subrequests and include their content in the main response's body.</li>
</ul>
<p>The logic in <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpClient/Response/AsyncResponse.php" class="reference external" title="Symfony\Component\HttpClient\Response\AsyncResponse" rel="external noopener noreferrer" target="_blank">AsyncResponse</a>
has many safety checks that will throw a <code translate="no" class="notranslate">LogicException</code> if the chunk
passthru doesn't behave correctly; e.g. if a chunk is yielded after an <code translate="no" class="notranslate">isLast()</code>
one, or if a content chunk is yielded before an <code translate="no" class="notranslate">isFirst()</code> one, etc.</p>
</div>
<div class="section">
<h2 id="testing">
    Testing
    <a class="headerlink" href="#testing" title="Permalink to this headline">¶</a>
</h2>
<p>This component includes the <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpClient/MockHttpClient.php" class="reference external" title="Symfony\Component\HttpClient\MockHttpClient" rel="external noopener noreferrer" target="_blank">MockHttpClient</a>
and <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpClient/Response/MockResponse.php" class="reference external" title="Symfony\Component\HttpClient\Response\MockResponse" rel="external noopener noreferrer" target="_blank">MockResponse</a> classes to use
in tests that shouldn't make actual HTTP requests. Such tests can be useful, as they
will run faster and produce consistent results, since they're not dependent on an
external service. By not making actual HTTP requests there is no need to worry about
the service being online or the request changing state, for example deleting
a resource.</p>
<p><code translate="no" class="notranslate">MockHttpClient</code> implements the <code translate="no" class="notranslate">HttpClientInterface</code>, just like any actual
HTTP client in this component. When you type-hint with <code translate="no" class="notranslate">HttpClientInterface</code>
your code will accept the real client outside tests, while replacing it with
<code translate="no" class="notranslate">MockHttpClient</code> in the test.</p>
<p>When the <code translate="no" class="notranslate">request</code> method is used on <code translate="no" class="notranslate">MockHttpClient</code>, it will respond with
the supplied <code translate="no" class="notranslate">MockResponse</code>. There are a few ways to use it, as described
below.</p>
<div class="section">
<h3 id="http-client-and-responses">
    HTTP Client and Responses
    <a class="headerlink" href="#http-client-and-responses" title="Permalink to this headline">¶</a>
</h3>
<p>The first way of using <code translate="no" class="notranslate">MockHttpClient</code> is to pass a list of responses to its
constructor. These will be yielded in order when requests are made:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">MockHttpClient</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">Response</span>\<span class="hljs-title">MockResponse</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>responses</span> = [
    <span class="hljs-keyword">new</span> MockResponse(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>body1</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>info1</span>),
    <span class="hljs-keyword">new</span> MockResponse(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>body2</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>info2</span>),
];

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span> = <span class="hljs-keyword">new</span> MockHttpClient(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>responses</span>);
<span class="hljs-comment">// responses are returned in the same order as passed to MockHttpClient</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response1</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'...'</span>); <span class="hljs-comment">// returns $responses[0]</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response2</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'...'</span>); <span class="hljs-comment">// returns $responses[1]</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Another way of using <code translate="no" class="notranslate">MockHttpClient</code> is to pass a callback that generates the
responses dynamically when it's called:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">MockHttpClient</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">Response</span>\<span class="hljs-title">MockResponse</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>callback</span> = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>method</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>url</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>options</span>)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MockResponse(<span class="hljs-string">'...'</span>);
};

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span> = <span class="hljs-keyword">new</span> MockHttpClient(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>callback</span>);
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'...'</span>); <span class="hljs-comment">// calls $callback to get the response</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>You can also pass a list of callbacks if you need to perform specific
assertions on the request before returning the mocked response:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>expectedRequests</span> = [
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>method</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>url</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>options</span>)</span> </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>assertSame(<span class="hljs-string">'GET'</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>method</span>);
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>assertSame(<span class="hljs-string">'https://example.com/api/v1/customer'</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>url</span>);

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MockResponse(<span class="hljs-string">'...'</span>);
    },
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>method</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>url</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>options</span>)</span> </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>assertSame(<span class="hljs-string">'POST'</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>method</span>);
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>assertSame(<span class="hljs-string">'https://example.com/api/v1/customer/1/products'</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>url</span>);

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MockResponse(<span class="hljs-string">'...'</span>);
    },
];

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span> = <span class="hljs-keyword">new</span> MockHttpClient(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>expectedRequest</span>);

<span class="hljs-comment">// ...</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-tip ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                <span>Tip</span>
    </p><p>Instead of using the first argument, you can also set the (list of)
responses or callbacks using the <code translate="no" class="notranslate">setResponseFactory()</code> method:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>responses</span> = [
    <span class="hljs-keyword">new</span> MockResponse(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>body1</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>info1</span>),
    <span class="hljs-keyword">new</span> MockResponse(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>body2</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>info2</span>),
];

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span> = <span class="hljs-keyword">new</span> MockHttpClient();
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>setResponseFactory(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>responses</span>);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
<p>If you need to test responses with HTTP status codes different than 200,
define the <code translate="no" class="notranslate">http_code</code> option:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">MockHttpClient</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">Response</span>\<span class="hljs-title">MockResponse</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span> = <span class="hljs-keyword">new</span> MockHttpClient([
    <span class="hljs-keyword">new</span> MockResponse(<span class="hljs-string">'...'</span>, [<span class="hljs-string">'http_code'</span> =&gt; <span class="hljs-number">500</span>]),
    <span class="hljs-keyword">new</span> MockResponse(<span class="hljs-string">'...'</span>, [<span class="hljs-string">'http_code'</span> =&gt; <span class="hljs-number">404</span>]),
]);

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>client</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'...'</span>);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>The responses provided to the mock client don't have to be instances of
<code translate="no" class="notranslate">MockResponse</code>. Any class implementing <code translate="no" class="notranslate">ResponseInterface</code> will work (e.g.
<code translate="no" class="notranslate">$this-&gt;createMock(ResponseInterface::class)</code>).</p>
<p>However, using <code translate="no" class="notranslate">MockResponse</code> allows simulating chunked responses and timeouts:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>body</span> = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">yield</span> <span class="hljs-string">'hello'</span>;
    <span class="hljs-comment">// empty strings are turned into timeouts so that they are easy to test</span>
    <span class="hljs-keyword">yield</span> <span class="hljs-string">''</span>;
    <span class="hljs-keyword">yield</span> <span class="hljs-string">'world'</span>;
};

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>mockResponse</span> = <span class="hljs-keyword">new</span> MockResponse(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>body</span>());</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Finally, you can also create an invokable or iterable class that generates the
responses and use it as a callback in functional tests:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Tests</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">Response</span>\<span class="hljs-title">MockResponse</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">ResponseInterface</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MockClientCallback</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span><span class="hljs-params">(string <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>method</span>, string <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>url</span>, array <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>options</span> = [])</span>: <span class="hljs-title">ResponseInterface</span>
    </span>{
        <span class="hljs-comment">// load a fixture file or generate data</span>
        <span class="hljs-comment">// ...</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MockResponse(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>data</span>);
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Then configure Symfony to use your callback:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-d13c0df81eb7bbdcc056d8e769853995094dce6a" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-3b3e4008263b7e80a1bb8fa34baaeb7d094004ab" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-efcffc1a1be85e75771fba223d5713e009edb9a2" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-d13c0df81eb7bbdcc056d8e769853995094dce6a" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/services_test.yaml</span>
<span class="hljs-attr">services:</span>
    <span class="hljs-comment"># ...</span>
    <span class="hljs-string">App\Tests\MockClientCallback:</span> <span class="hljs-string">~</span>

<span class="hljs-comment"># config/packages/test/framework.yaml</span>
<span class="hljs-attr">framework:</span>
    <span class="hljs-attr">http_client:</span>
        <span class="hljs-attr">mock_response_factory:</span> <span class="hljs-string">App\Tests\MockClientCallback</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-3b3e4008263b7e80a1bb8fa34baaeb7d094004ab" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/services_test.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsd</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xsd:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services https://symfony.com/schema/dic/services/services-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">services</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"App\Tests\MockClientCallback"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">services</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span>

<span class="hljs-comment">&lt;!-- config/packages/framework.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:framework</span>=<span class="hljs-string">"http://symfony.com/schema/dic/symfony"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd
        http://symfony.com/schema/dic/symfony https://symfony.com/schema/dic/symfony/symfony-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">framework:config</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">framework:http-client</span> <span class="hljs-attr">mock-response-factory</span>=<span class="hljs-string">"App\Tests\MockClientCallback"</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- ... --&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">framework-http-client</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">framework:config</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-efcffc1a1be85e75771fba223d5713e009edb9a2" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/packages/framework.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Config</span>\<span class="hljs-title">FrameworkConfig</span>;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(FrameworkConfig <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span><span class="hljs-operator">-&gt;</span>httpClient()
        <span class="hljs-operator">-&gt;</span>mockResponseFactory(MockClientCallback<span class="hljs-operator">::</span>class)
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
</div>
<div class="section">
<h3 id="testing-request-data">
    Testing Request Data
    <a class="headerlink" href="#testing-request-data" title="Permalink to this headline">¶</a>
</h3>
<p>The <code translate="no" class="notranslate">MockResponse</code> class comes with some helper methods to test the request:</p>
<ul>
    <li><code translate="no" class="notranslate">getRequestMethod()</code> - returns the HTTP method;</li>
<li><code translate="no" class="notranslate">getRequestUrl()</code> - returns the URL the request would be sent to;</li>
<li><code translate="no" class="notranslate">getRequestOptions()</code> - returns an array containing other information about
the request such as headers, query parameters, body content etc.</li>
</ul>
<p>Usage example:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>mockResponse</span> = <span class="hljs-keyword">new</span> MockResponse(<span class="hljs-string">''</span>, [<span class="hljs-string">'http_code'</span> =&gt; <span class="hljs-number">204</span>]);
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>httpClient</span> = <span class="hljs-keyword">new</span> MockHttpClient(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>mockResponse</span>, <span class="hljs-string">'https://example.com'</span>);

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>httpClient</span><span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'DELETE'</span>, <span class="hljs-string">'api/article/1337'</span>, [
    <span class="hljs-string">'headers'</span> =&gt; [
        <span class="hljs-string">'Accept: */*'</span>,
        <span class="hljs-string">'Authorization: Basic YWxhZGRpbjpvcGVuc2VzYW1l'</span>,
    ],
]);

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>mockResponse</span><span class="hljs-operator">-&gt;</span>getRequestMethod();
<span class="hljs-comment">// returns "DELETE"</span>

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>mockResponse</span><span class="hljs-operator">-&gt;</span>getRequestUrl();
<span class="hljs-comment">// returns "https://example.com/api/article/1337"</span>

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>mockResponse</span><span class="hljs-operator">-&gt;</span>getRequestOptions()[<span class="hljs-string">'headers'</span>];
<span class="hljs-comment">// returns ["Accept: */*", "Authorization: Basic YWxhZGRpbjpvcGVuc2VzYW1l"]</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
<div class="section">
<h3 id="full-example">
    Full Example
    <a class="headerlink" href="#full-example" title="Permalink to this headline">¶</a>
</h3>
<p>The following standalone example demonstrates a way to use the HTTP client and
test it in a real application:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// ExternalArticleService.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">HttpClientInterface</span>;

<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExternalArticleService</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(
        private HttpClientInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>httpClient</span>,
    )</span> </span>{
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createArticle</span><span class="hljs-params">(array <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>requestData</span>)</span>: <span class="hljs-title">array</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>requestJson</span> = json_encode(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>requestData</span>, JSON_THROW_ON_ERROR);

        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>httpClient<span class="hljs-operator">-&gt;</span>request(<span class="hljs-string">'POST'</span>, <span class="hljs-string">'api/article'</span>, [
            <span class="hljs-string">'headers'</span> =&gt; [
                <span class="hljs-string">'Content-Type: application/json'</span>,
                <span class="hljs-string">'Accept: application/json'</span>,
            ],
            <span class="hljs-string">'body'</span> =&gt; <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>requestJson</span>,
        ]);

        <span class="hljs-keyword">if</span> (<span class="hljs-number">201</span> !== <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>getStatusCode()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-keyword">Exception</span>(<span class="hljs-string">'Response status code is different than expected.'</span>);
        }

        <span class="hljs-comment">// ... other checks</span>

        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>responseJson</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>getContent();
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>responseData</span> = json_decode(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>responseJson</span>, <span class="hljs-keyword">true</span>, <span class="hljs-number">512</span>, JSON_THROW_ON_ERROR);

        <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>responseData</span>;
    }
}

<span class="hljs-comment">// ExternalArticleServiceTest.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">PHPUnit</span>\<span class="hljs-title">Framework</span>\<span class="hljs-title">TestCase</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">MockHttpClient</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">Response</span>\<span class="hljs-title">MockResponse</span>;

<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExternalArticleServiceTest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">TestCase</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testSubmitData</span><span class="hljs-params">()</span>: <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-comment">// Arrange</span>
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>requestData</span> = [<span class="hljs-string">'title'</span> =&gt; <span class="hljs-string">'Testing with Symfony HTTP Client'</span>];
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>expectedRequestData</span> = json_encode(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>requestData</span>, JSON_THROW_ON_ERROR);

        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>expectedResponseData</span> = [<span class="hljs-string">'id'</span> =&gt; <span class="hljs-number">12345</span>];
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>mockResponseJson</span> = json_encode(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>expectedResponseData</span>, JSON_THROW_ON_ERROR);
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>mockResponse</span> = <span class="hljs-keyword">new</span> MockResponse(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>mockResponseJson</span>, [
            <span class="hljs-string">'http_code'</span> =&gt; <span class="hljs-number">201</span>,
            <span class="hljs-string">'response_headers'</span> =&gt; [<span class="hljs-string">'Content-Type: application/json'</span>],
        ]);

        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>httpClient</span> = <span class="hljs-keyword">new</span> MockHttpClient(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>mockResponse</span>, <span class="hljs-string">'https://example.com'</span>);
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>service</span> = <span class="hljs-keyword">new</span> ExternalArticleService(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>httpClient</span>);

        <span class="hljs-comment">// Act</span>
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>responseData</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>service</span><span class="hljs-operator">-&gt;</span>createArticle(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>requestData</span>);

        <span class="hljs-comment">// Assert</span>
        <span class="hljs-keyword">self</span><span class="hljs-operator">::</span>assertSame(<span class="hljs-string">'POST'</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>mockResponse</span><span class="hljs-operator">-&gt;</span>getRequestMethod());
        <span class="hljs-keyword">self</span><span class="hljs-operator">::</span>assertSame(<span class="hljs-string">'https://example.com/api/article'</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>mockResponse</span><span class="hljs-operator">-&gt;</span>getRequestUrl());
        <span class="hljs-keyword">self</span><span class="hljs-operator">::</span>assertContains(
            <span class="hljs-string">'Content-Type: application/json'</span>,
            <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>mockResponse</span><span class="hljs-operator">-&gt;</span>getRequestOptions()[<span class="hljs-string">'headers'</span>]
        );
        <span class="hljs-keyword">self</span><span class="hljs-operator">::</span>assertSame(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>expectedRequestData</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>mockResponse</span><span class="hljs-operator">-&gt;</span>getRequestOptions()[<span class="hljs-string">'body'</span>]);

        <span class="hljs-keyword">self</span><span class="hljs-operator">::</span>assertSame(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>responseData</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>expectedResponseData</span>);
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
<div class="section">
<h3 id="testing-network-transport-exceptions">
    Testing Network Transport Exceptions
    <a class="headerlink" href="#testing-network-transport-exceptions" title="Permalink to this headline">¶</a>
</h3>
<p>As explained in the <a href="http_client.html#http-client_network-errors" class="reference internal">Network Errors section</a>,
when making HTTP requests you might face errors at transport level.</p>
<p>That's why it's useful to test how your application behaves in case of a transport
error. <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpClient/Response/MockResponse.php" class="reference external" title="Symfony\Component\HttpClient\Response\MockResponse" rel="external noopener noreferrer" target="_blank">MockResponse</a> allows
you to do so, by yielding the exception from its body:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// ExternalArticleServiceTest.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">PHPUnit</span>\<span class="hljs-title">Framework</span>\<span class="hljs-title">TestCase</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">MockHttpClient</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpClient</span>\<span class="hljs-title">Response</span>\<span class="hljs-title">MockResponse</span>;

<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExternalArticleServiceTest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">TestCase</span>
</span>{
    <span class="hljs-comment">// ...</span>

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testTransportLevelError</span><span class="hljs-params">()</span>: <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>requestData</span> = [<span class="hljs-string">'title'</span> =&gt; <span class="hljs-string">'Testing with Symfony HTTP Client'</span>];
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>httpClient</span> = <span class="hljs-keyword">new</span> MockHttpClient([
            <span class="hljs-comment">// You can create the exception directly in the body...</span>
            <span class="hljs-keyword">new</span> MockResponse([<span class="hljs-keyword">new</span> \RuntimeException(<span class="hljs-string">'Error at transport level'</span>)]),

            <span class="hljs-comment">// ... or you can yield the exception from a callback</span>
            <span class="hljs-keyword">new</span> MockResponse((<span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span>: \<span class="hljs-title">Generator</span> </span>{
                <span class="hljs-keyword">yield</span> <span class="hljs-keyword">new</span> TransportException(<span class="hljs-string">'Error at transport level'</span>);
            })()),
        ]);

        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>service</span> = <span class="hljs-keyword">new</span> ExternalArticleService(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>httpClient</span>);

        <span class="hljs-keyword">try</span> {
            <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>service</span><span class="hljs-operator">-&gt;</span>createArticle(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>requestData</span>);

            <span class="hljs-comment">// An exception should have been thrown in `createArticle()`, so this line should never be reached</span>
            <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>fail();
        } <span class="hljs-keyword">catch</span> (TransportException <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>e</span>) {
            <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>assertEquals(<span class="hljs-keyword">new</span> \RuntimeException(<span class="hljs-string">'Error at transport level'</span>), <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>e</span><span class="hljs-operator">-&gt;</span>getPrevious());
            <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>assertSame(<span class="hljs-string">'Error at transport level'</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>e</span><span class="hljs-operator">-&gt;</span>getMessage());
        }
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-versionadded ">
    <p class="admonition-title">
                                    <span>6.1</span>
    </p><p>Being allowed to pass an exception directly to the body of a
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpClient/Response/MockResponse.php" class="reference external" title="Symfony\Component\HttpClient\Response\MockResponse" rel="external noopener noreferrer" target="_blank">MockResponse</a> was
introduced in Symfony 6.1.</p>
</div>
</div>
</div>
</div>

                            </div>                    </div>
                                    </div>        </div>

    </section>

</div>


<script type="text/javascript" src="assets/js/theme.js"></script>
<script type="text/javascript" src="assets/js/badge_only.js"></script>

 
</body>
</html>