        
<!DOCTYPE html>
<!--[if IE 8]>
<html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en"> <!--<![endif]-->
<head><base href="/">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
            
                                
    
    <link rel="stylesheet" href="assets/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/highlightjs.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/badge_only.css" type="text/css" />

</head>

<body class="wy-body-for-nav">
 <div class="wy-grid-for-nav">

        <nav data-toggle="wy-nav-shift" class="wy-nav-side">
        <div class="wy-side-scroll">
            <div class="wy-side-nav-search">
                
                                                                                                    
                                                                                                                                                                        </div>

            <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                                                                                                                                                                                                                                                                                                                            </div>
        </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

                                                        

        <div class="wy-nav-content">                <div class="rst-content">
                                        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">                            <div itemprop="articleBody">
                                    <span id="security-access-control-explanation"></span>
<div class="section">
<h1 id="how-does-the-security-access-control-work">
    How Does the Security access_control Work?
    <a class="headerlink" href="#how-does-the-security-access-control-work" title="Permalink to this headline">¶</a>
</h1>
<p>For each incoming request, Symfony checks each <code translate="no" class="notranslate">access_control</code> entry
to find <em>one</em> that matches the current request. As soon as it finds a matching
<code translate="no" class="notranslate">access_control</code> entry, it stops - only the <strong>first</strong> matching <code translate="no" class="notranslate">access_control</code>
is used to enforce access.</p>
<p>Each <code translate="no" class="notranslate">access_control</code> has several options that configure two different
things:</p>
<ol class="arabic">
    <li><a href="access_control.html#security-access-control-matching-options" class="reference internal">should the incoming request match this access control entry</a></li>
<li><a href="access_control.html#security-access-control-enforcement-options" class="reference internal">once it matches, should some sort of access restriction be enforced</a>:</li>
</ol>
<span id="security-access-control-matching-options"></span>
<div class="section">
<h2 id="1-matching-options">
    1. Matching Options
    <a class="headerlink" href="#1-matching-options" title="Permalink to this headline">¶</a>
</h2>
<p>Symfony creates an instance of <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpFoundation/RequestMatcher.php" class="reference external" title="Symfony\Component\HttpFoundation\RequestMatcher" rel="external noopener noreferrer" target="_blank">RequestMatcher</a>
for each <code translate="no" class="notranslate">access_control</code> entry, which determines whether or not a given
access control should be used on this request. The following <code translate="no" class="notranslate">access_control</code>
options are used for matching:</p>
<ul>
    <li><code translate="no" class="notranslate">path</code>: a regular expression (without delimiters)</li>
<li><code translate="no" class="notranslate">ip</code> or <code translate="no" class="notranslate">ips</code>: netmasks are also supported (can be a comma-separated string)</li>
<li><code translate="no" class="notranslate">port</code>: an integer</li>
<li><code translate="no" class="notranslate">host</code>: a regular expression</li>
<li><code translate="no" class="notranslate">methods</code>: one or many HTTP methods</li>
<li><code translate="no" class="notranslate">request_matcher</code>: a service implementing <code translate="no" class="notranslate">RequestMatcherInterface</code></li>
<li><code translate="no" class="notranslate">attributes</code>: an array, which can be used to specify one or more <a href="../components/http_foundation.html#accessing-request-data" class="reference internal">request attributes</a> that must match exactly</li>
<li><code translate="no" class="notranslate">route</code>: a route name</li>
</ul>
<div class="admonition admonition-versionadded ">
    <p class="admonition-title">
                                    <span>6.1</span>
    </p><p>The <code translate="no" class="notranslate">request_matcher</code> option was introduced in Symfony 6.1.</p>
</div>
<div class="admonition admonition-versionadded ">
    <p class="admonition-title">
                                    <span>6.2</span>
    </p><p>The <code translate="no" class="notranslate">route</code> and <code translate="no" class="notranslate">attributes</code> options were introduced in Symfony 6.2.</p>
</div>
<p>Take the following <code translate="no" class="notranslate">access_control</code> entries as an example:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-cec3868e70eae7c729d37ee41c3535cec394aa3b" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-6b6b5c46eb68d45f4c7e3562b6ea7e65615f254b" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-c2b00149f2afea9d62dbfb046caef3d5e8c6b791" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-cec3868e70eae7c729d37ee41c3535cec394aa3b" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/security.yaml</span>
<span class="hljs-attr">parameters:</span>
    <span class="hljs-string">env(TRUSTED_IPS):</span> <span class="hljs-string">'10.0.0.1, 10.0.0.2'</span>

<span class="hljs-attr">security:</span>
    <span class="hljs-comment"># ...</span>
    <span class="hljs-attr">access_control:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">{</span> <span class="hljs-attr">path:</span> <span class="hljs-string">'^/admin'</span><span class="hljs-string">,</span> <span class="hljs-attr">roles:</span> <span class="hljs-string">ROLE_USER_PORT,</span> <span class="hljs-attr">ip:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">,</span> <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span> <span class="hljs-string">}</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">{</span> <span class="hljs-attr">path:</span> <span class="hljs-string">'^/admin'</span><span class="hljs-string">,</span> <span class="hljs-attr">roles:</span> <span class="hljs-string">ROLE_USER_IP,</span> <span class="hljs-attr">ip:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span> <span class="hljs-string">}</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">{</span> <span class="hljs-attr">path:</span> <span class="hljs-string">'^/admin'</span><span class="hljs-string">,</span> <span class="hljs-attr">roles:</span> <span class="hljs-string">ROLE_USER_HOST,</span> <span class="hljs-attr">host:</span> <span class="hljs-string">symfony\.com$</span> <span class="hljs-string">}</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">{</span> <span class="hljs-attr">path:</span> <span class="hljs-string">'^/admin'</span><span class="hljs-string">,</span> <span class="hljs-attr">roles:</span> <span class="hljs-string">ROLE_USER_METHOD,</span> <span class="hljs-attr">methods:</span> <span class="hljs-string">[POST,</span> <span class="hljs-string">PUT]</span> <span class="hljs-string">}</span>

        <span class="hljs-comment"># ips can be comma-separated, which is especially useful when using env variables</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">{</span> <span class="hljs-attr">path:</span> <span class="hljs-string">'^/admin'</span><span class="hljs-string">,</span> <span class="hljs-attr">roles:</span> <span class="hljs-string">ROLE_USER_IP,</span> <span class="hljs-attr">ips:</span> <span class="hljs-string">'%env(TRUSTED_IPS)%'</span> <span class="hljs-string">}</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">{</span> <span class="hljs-attr">path:</span> <span class="hljs-string">'^/admin'</span><span class="hljs-string">,</span> <span class="hljs-attr">roles:</span> <span class="hljs-string">ROLE_USER_IP,</span> <span class="hljs-attr">ips:</span> <span class="hljs-string">[127.0.0.1,</span> <span class="hljs-string">::1,</span> <span class="hljs-string">'%env(TRUSTED_IPS)%'</span><span class="hljs-string">]</span> <span class="hljs-string">}</span>

        <span class="hljs-comment"># for custom matching needs, use a request matcher service</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">{</span> <span class="hljs-attr">roles:</span> <span class="hljs-string">ROLE_USER,</span> <span class="hljs-attr">request_matcher:</span> <span class="hljs-string">App\Security\RequestMatcher\MyRequestMatcher</span> <span class="hljs-string">}</span>

        <span class="hljs-comment"># require ROLE_ADMIN for 'admin' route. You can use the shortcut "route: "xxx", instead of "attributes": ["_route": "xxx"]</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">{</span> <span class="hljs-attr">attributes:</span> <span class="hljs-string">{'_route':</span> <span class="hljs-string">'admin'</span><span class="hljs-string">},</span> <span class="hljs-attr">roles:</span> <span class="hljs-string">ROLE_ADMIN</span> <span class="hljs-string">}</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">{</span> <span class="hljs-attr">route:</span> <span class="hljs-string">'admin'</span><span class="hljs-string">,</span> <span class="hljs-attr">roles:</span> <span class="hljs-string">ROLE_ADMIN</span> <span class="hljs-string">}</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-6b6b5c46eb68d45f4c7e3562b6ea7e65615f254b" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">srv:container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/security"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:srv</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd
        http://symfony.com/schema/dic/security
        https://symfony.com/schema/dic/security/security-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">srv:parameters</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">srv:parameter</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"env(TRUSTED_IPS)"</span>&gt;</span>10.0.0.1, 10.0.0.2<span class="hljs-tag">&lt;/<span class="hljs-name">srv:parameter</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">srv:parameters</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">config</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- ... --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">rule</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"^/admin"</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"ROLE_USER_PORT"</span> <span class="hljs-attr">ip</span>=<span class="hljs-string">"127.0.0.1"</span> <span class="hljs-attr">port</span>=<span class="hljs-string">"8080"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">rule</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"^/admin"</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"ROLE_USER_IP"</span> <span class="hljs-attr">ip</span>=<span class="hljs-string">"127.0.0.1"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">rule</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"^/admin"</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"ROLE_USER_HOST"</span> <span class="hljs-attr">host</span>=<span class="hljs-string">"symfony\.com$"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">rule</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"^/admin"</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"ROLE_USER_METHOD"</span> <span class="hljs-attr">methods</span>=<span class="hljs-string">"POST, PUT"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- ips can be comma-separated, which is especially useful when using env variables --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">rule</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"^/admin"</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"ROLE_USER_IP"</span> <span class="hljs-attr">ip</span>=<span class="hljs-string">"%env(TRUSTED_IPS)%"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">rule</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"^/admin"</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"ROLE_USER_IP"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">ip</span>&gt;</span>127.0.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">ip</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">ip</span>&gt;</span>::1<span class="hljs-tag">&lt;/<span class="hljs-name">ip</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">ip</span>&gt;</span>%env(TRUSTED_IPS)%<span class="hljs-tag">&lt;/<span class="hljs-name">ip</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">rule</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- for custom matching needs, use a request matcher service --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">rule</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"ROLE_USER"</span> <span class="hljs-attr">request-matcher</span>=<span class="hljs-string">"App\Security\RequestMatcher\MyRequestMatcher"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- require ROLE_ADMIN for 'admin' route. You can use the shortcut route="xxx" --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">rule</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"ROLE_ADMIN"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">attribute</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"_route"</span>&gt;</span>admin<span class="hljs-tag">&lt;/<span class="hljs-name">attribute</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">rule</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">rule</span> <span class="hljs-attr">route</span>=<span class="hljs-string">"admin"</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"ROLE_ADMIN"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">config</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">srv:container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-c2b00149f2afea9d62dbfb046caef3d5e8c6b791" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/packages/security.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">ContainerBuilder</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Config</span>\<span class="hljs-title">SecurityConfig</span>;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ContainerBuilder <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerBuilder</span>, SecurityConfig <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerBuilder</span><span class="hljs-operator">-&gt;</span>setParameter(<span class="hljs-string">'env(TRUSTED_IPS)'</span>, <span class="hljs-string">'10.0.0.1, 10.0.0.2'</span>);
    <span class="hljs-comment">// ...</span>

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span><span class="hljs-operator">-&gt;</span>accessControl()
        <span class="hljs-operator">-&gt;</span>path(<span class="hljs-string">'^/admin'</span>)
        <span class="hljs-operator">-&gt;</span>roles([<span class="hljs-string">'ROLE_USER_PORT'</span>])
        <span class="hljs-operator">-&gt;</span>ips([<span class="hljs-string">'127.0.0.1'</span>])
        <span class="hljs-operator">-&gt;</span>port(<span class="hljs-number">8080</span>)
    ;
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span><span class="hljs-operator">-&gt;</span>accessControl()
        <span class="hljs-operator">-&gt;</span>path(<span class="hljs-string">'^/admin'</span>)
        <span class="hljs-operator">-&gt;</span>roles([<span class="hljs-string">'ROLE_USER_IP'</span>])
        <span class="hljs-operator">-&gt;</span>ips([<span class="hljs-string">'127.0.0.1'</span>])
    ;
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span><span class="hljs-operator">-&gt;</span>accessControl()
        <span class="hljs-operator">-&gt;</span>path(<span class="hljs-string">'^/admin'</span>)
        <span class="hljs-operator">-&gt;</span>roles([<span class="hljs-string">'ROLE_USER_HOST'</span>])
        <span class="hljs-operator">-&gt;</span>host(<span class="hljs-string">'symfony\.com$'</span>)
    ;
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span><span class="hljs-operator">-&gt;</span>accessControl()
        <span class="hljs-operator">-&gt;</span>path(<span class="hljs-string">'^/admin'</span>)
        <span class="hljs-operator">-&gt;</span>roles([<span class="hljs-string">'ROLE_USER_METHOD'</span>])
        <span class="hljs-operator">-&gt;</span>methods([<span class="hljs-string">'POST'</span>, <span class="hljs-string">'PUT'</span>])
    ;
    <span class="hljs-comment">// ips can be comma-separated, which is especially useful when using env variables</span>
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span><span class="hljs-operator">-&gt;</span>accessControl()
        <span class="hljs-operator">-&gt;</span>path(<span class="hljs-string">'^/admin'</span>)
        <span class="hljs-operator">-&gt;</span>roles([<span class="hljs-string">'ROLE_USER_IP'</span>])
        <span class="hljs-operator">-&gt;</span>ips([env(<span class="hljs-string">'TRUSTED_IPS'</span>)])
    ;
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span><span class="hljs-operator">-&gt;</span>accessControl()
        <span class="hljs-operator">-&gt;</span>path(<span class="hljs-string">'^/admin'</span>)
        <span class="hljs-operator">-&gt;</span>roles([<span class="hljs-string">'ROLE_USER_IP'</span>])
        <span class="hljs-operator">-&gt;</span>ips([<span class="hljs-string">'127.0.0.1'</span>, <span class="hljs-string">'::1'</span>, env(<span class="hljs-string">'TRUSTED_IPS'</span>)])
    ;

    <span class="hljs-comment">// for custom matching needs, use a request matcher service</span>
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span><span class="hljs-operator">-&gt;</span>accessControl()
        <span class="hljs-operator">-&gt;</span>roles([<span class="hljs-string">'ROLE_USER'</span>])
        <span class="hljs-operator">-&gt;</span>requestMatcher(<span class="hljs-string">'App\Security\RequestMatcher\MyRequestMatcher'</span>)
    ;

    <span class="hljs-comment">// require ROLE_ADMIN for 'admin' route. You can use the shortcut route('xxx') mehtod,</span>
    <span class="hljs-comment">// instead of attributes(['_route' =&gt; 'xxx']) method</span>
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span><span class="hljs-operator">-&gt;</span>accessControl()
        <span class="hljs-operator">-&gt;</span>roles([<span class="hljs-string">'ROLE_ADMIN'</span>])
        <span class="hljs-operator">-&gt;</span>attributes([<span class="hljs-string">'_route'</span> =&gt; <span class="hljs-string">'admin'</span>])
    ;
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span><span class="hljs-operator">-&gt;</span>accessControl()
        <span class="hljs-operator">-&gt;</span>roles([<span class="hljs-string">'ROLE_ADMIN'</span>])
        <span class="hljs-operator">-&gt;</span>route(<span class="hljs-string">'admin'</span>)
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>For each incoming request, Symfony will decide which <code translate="no" class="notranslate">access_control</code>
to use based on the URI, the client's IP address, the incoming host name,
and the request method. Remember, the first rule that matches is used, and
if <code translate="no" class="notranslate">ip</code>, <code translate="no" class="notranslate">port</code>, <code translate="no" class="notranslate">host</code> or <code translate="no" class="notranslate">method</code> are not specified for an entry, that
<code translate="no" class="notranslate">access_control</code> will match any <code translate="no" class="notranslate">ip</code>, <code translate="no" class="notranslate">port</code>, <code translate="no" class="notranslate">host</code> or <code translate="no" class="notranslate">method</code>:</p>
<div class="table-wrapper">
<table>
            <thead>
                            <tr>
                                            <th>URI</th>
                                            <th>IP</th>
                                            <th>PORT</th>
                                            <th>HOST</th>
                                            <th>METHOD</th>
                                            <th><code translate="no" class="notranslate">access_control</code></th>
                                            <th>Why?</th>
                                    </tr>
                    </thead>
        <tbody>
                    <tr>
                                    <td><code translate="no" class="notranslate">/admin/user</code></td>
                                    <td>127.0.0.1</td>
                                    <td>80</td>
                                    <td>example.com</td>
                                    <td>GET</td>
                                    <td>rule #2 (<code translate="no" class="notranslate">ROLE_USER_IP</code>)</td>
                                    <td>The URI matches <code translate="no" class="notranslate">path</code> and the IP matches <code translate="no" class="notranslate">ip</code>.</td>
                            </tr>
                    <tr>
                                    <td><code translate="no" class="notranslate">/admin/user</code></td>
                                    <td>127.0.0.1</td>
                                    <td>80</td>
                                    <td>symfony.com</td>
                                    <td>GET</td>
                                    <td>rule #2 (<code translate="no" class="notranslate">ROLE_USER_IP</code>)</td>
                                    <td>The <code translate="no" class="notranslate">path</code> and <code translate="no" class="notranslate">ip</code> still match. This would also match
the <code translate="no" class="notranslate">ROLE_USER_HOST</code> entry, but <em>only</em> the <strong>first</strong>
<code translate="no" class="notranslate">access_control</code> match is used.</td>
                            </tr>
                    <tr>
                                    <td><code translate="no" class="notranslate">/admin/user</code></td>
                                    <td>127.0.0.1</td>
                                    <td>8080</td>
                                    <td>symfony.com</td>
                                    <td>GET</td>
                                    <td>rule #1 (<code translate="no" class="notranslate">ROLE_USER_PORT</code>)</td>
                                    <td>The <code translate="no" class="notranslate">path</code>, <code translate="no" class="notranslate">ip</code> and <code translate="no" class="notranslate">port</code> match.</td>
                            </tr>
                    <tr>
                                    <td><code translate="no" class="notranslate">/admin/user</code></td>
                                    <td>168.0.0.1</td>
                                    <td>80</td>
                                    <td>symfony.com</td>
                                    <td>GET</td>
                                    <td>rule #3 (<code translate="no" class="notranslate">ROLE_USER_HOST</code>)</td>
                                    <td>The <code translate="no" class="notranslate">ip</code> doesn't match neither the first rule nor the
second rule. So the third rule (which matches) is used.</td>
                            </tr>
                    <tr>
                                    <td><code translate="no" class="notranslate">/admin/user</code></td>
                                    <td>168.0.0.1</td>
                                    <td>80</td>
                                    <td>symfony.com</td>
                                    <td>POST</td>
                                    <td>rule #3 (<code translate="no" class="notranslate">ROLE_USER_HOST</code>)</td>
                                    <td>The third rule still matches. This would also match the
fourth rule (<code translate="no" class="notranslate">ROLE_USER_METHOD</code>), but only the <strong>first</strong>
matched <code translate="no" class="notranslate">access_control</code> is used.</td>
                            </tr>
                    <tr>
                                    <td><code translate="no" class="notranslate">/admin/user</code></td>
                                    <td>168.0.0.1</td>
                                    <td>80</td>
                                    <td>example.com</td>
                                    <td>POST</td>
                                    <td>rule #4 (<code translate="no" class="notranslate">ROLE_USER_METHOD</code>)</td>
                                    <td>The <code translate="no" class="notranslate">ip</code> and <code translate="no" class="notranslate">host</code> don't match the first three
entries, but the fourth - <code translate="no" class="notranslate">ROLE_USER_METHOD</code> - matches
and is used.</td>
                            </tr>
                    <tr>
                                    <td><code translate="no" class="notranslate">/foo</code></td>
                                    <td>127.0.0.1</td>
                                    <td>80</td>
                                    <td>symfony.com</td>
                                    <td>POST</td>
                                    <td>matches no entries</td>
                                    <td>This doesn't match any <code translate="no" class="notranslate">access_control</code> rules, since its
URI doesn't match any of the <code translate="no" class="notranslate">path</code> values.</td>
                            </tr>
            </tbody>
</table>
</div>
<div class="admonition admonition-caution ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                <span>Caution</span>
    </p><p>Matching the URI is done without <code translate="no" class="notranslate">$_GET</code> parameters.
<a href="../security.html#security-securing-controller" class="reference internal">Deny access in PHP code</a> if you want
to disallow access based on <code translate="no" class="notranslate">$_GET</code> parameter values.</p>
</div>
<span id="security-access-control-enforcement-options"></span>
</div>
<div class="section">
<h2 id="2-access-enforcement">
    2. Access Enforcement
    <a class="headerlink" href="#2-access-enforcement" title="Permalink to this headline">¶</a>
</h2>
<p>Once Symfony has decided which <code translate="no" class="notranslate">access_control</code> entry matches (if any),
it then <em>enforces</em> access restrictions based on the <code translate="no" class="notranslate">roles</code>, <code translate="no" class="notranslate">allow_if</code> and <code translate="no" class="notranslate">requires_channel</code>
options:</p>
<ul>
    <li><code translate="no" class="notranslate">roles</code> If the user does not have the given role, then access is denied
(internally, an <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/Security/Core/Exception/AccessDeniedException.php" class="reference external" title="Symfony\Component\Security\Core\Exception\AccessDeniedException" rel="external noopener noreferrer" target="_blank">AccessDeniedException</a>
is thrown).</li>
<li><code translate="no" class="notranslate">allow_if</code> If the expression returns false, then access is denied;</li>
<li><code translate="no" class="notranslate">requires_channel</code> If the incoming request's channel (e.g. <code translate="no" class="notranslate">http</code>)
does not match this value (e.g. <code translate="no" class="notranslate">https</code>), the user will be redirected
(e.g. redirected from <code translate="no" class="notranslate">http</code> to <code translate="no" class="notranslate">https</code>, or vice versa).</li>
</ul>
<div class="admonition admonition-tip ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                <span>Tip</span>
    </p><p>Behind the scenes, the array value of <code translate="no" class="notranslate">roles</code> is passed as the
<code translate="no" class="notranslate">$attributes</code> argument to each voter in the application with the
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpFoundation/Request.php" class="reference external" title="Symfony\Component\HttpFoundation\Request" rel="external noopener noreferrer" target="_blank">Request</a> as <code translate="no" class="notranslate">$subject</code>. You
can learn how to use your custom attributes by reading
<a href="voters.html#security/custom-voter" class="reference internal">How to Use Voters to Check User Permissions</a>.</p>
</div>
<div class="admonition admonition-caution ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                <span>Caution</span>
    </p><p>If you define both <code translate="no" class="notranslate">roles</code> and <code translate="no" class="notranslate">allow_if</code>, and your Access Decision
Strategy is the default one (<code translate="no" class="notranslate">affirmative</code>), then the user will be granted
access if there's at least one valid condition. If this behavior doesn't fit
your needs, <a href="voters.html#security-voters-change-strategy" class="reference internal">change the Access Decision Strategy</a>.</p>
</div>
<div class="admonition admonition-tip ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                <span>Tip</span>
    </p><p>If access is denied, the system will try to authenticate the user if not
already (e.g. redirect the user to the login page). If the user is already
logged in, the 403 &quot;access denied&quot; error page will be shown. See
<a href="../controller/error_pages.html" class="reference internal">How to Customize Error Pages</a> for more information.</p>
</div>
</div>
<div class="section">
<h2 id="matching-access-control-by-ip">
    Matching access_control By IP
    <a class="headerlink" href="#matching-access-control-by-ip" title="Permalink to this headline">¶</a>
</h2>
<p>Certain situations may arise when you need to have an <code translate="no" class="notranslate">access_control</code>
entry that <em>only</em> matches requests coming from some IP address or range.
For example, this <em>could</em> be used to deny access to a URL pattern to all
requests <em>except</em> those from a trusted, internal server.</p>
<div class="admonition admonition-caution ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                <span>Caution</span>
    </p><p>As you'll read in the explanation below the example, the <code translate="no" class="notranslate">ips</code> option
does not restrict to a specific IP address. Instead, using the <code translate="no" class="notranslate">ips</code>
key means that the <code translate="no" class="notranslate">access_control</code> entry will only match this IP address,
and users accessing it from a different IP address will continue down
the <code translate="no" class="notranslate">access_control</code> list.</p>
</div>
<p>Here is an example of how you configure some example <code translate="no" class="notranslate">/internal*</code> URL
pattern so that it is only accessible by requests from the local server itself:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-e79d2223a70665a88661f08a1213fb1a5f38da0e" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-e4e94f54dd66391312d76a93cb04ab72ba3637fe" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-61112ec9e82aef51a93f871106372189451fa6e8" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-e79d2223a70665a88661f08a1213fb1a5f38da0e" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/security.yaml</span>
<span class="hljs-attr">security:</span>
    <span class="hljs-comment"># ...</span>
    <span class="hljs-attr">access_control:</span>
        <span class="hljs-comment">#</span>
        <span class="hljs-comment"># the 'ips' option supports IP addresses and subnet masks</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">{</span> <span class="hljs-attr">path:</span> <span class="hljs-string">'^/internal'</span><span class="hljs-string">,</span> <span class="hljs-attr">roles:</span> <span class="hljs-string">PUBLIC_ACCESS,</span> <span class="hljs-attr">ips:</span> <span class="hljs-string">[127.0.0.1,</span> <span class="hljs-string">::1,</span> <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">/24]</span> <span class="hljs-string">}</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">{</span> <span class="hljs-attr">path:</span> <span class="hljs-string">'^/internal'</span><span class="hljs-string">,</span> <span class="hljs-attr">roles:</span> <span class="hljs-string">ROLE_NO_ACCESS</span> <span class="hljs-string">}</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-e4e94f54dd66391312d76a93cb04ab72ba3637fe" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">srv:container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/security"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:srv</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd
        http://symfony.com/schema/dic/security
        https://symfony.com/schema/dic/security/security-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">config</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- ... --&gt;</span>

        <span class="hljs-comment">&lt;!-- the 'ips' option supports IP addresses and subnet masks --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">rule</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"^/internal"</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"PUBLIC_ACCESS"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">ip</span>&gt;</span>127.0.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">ip</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">ip</span>&gt;</span>::1<span class="hljs-tag">&lt;/<span class="hljs-name">ip</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">rule</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">rule</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"^/internal"</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"ROLE_NO_ACCESS"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">config</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">srv:container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-61112ec9e82aef51a93f871106372189451fa6e8" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/packages/security.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Config</span>\<span class="hljs-title">SecurityConfig</span>;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(SecurityConfig <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span>)</span> </span>{
    <span class="hljs-comment">// ...</span>

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span><span class="hljs-operator">-&gt;</span>accessControl()
        <span class="hljs-operator">-&gt;</span>path(<span class="hljs-string">'^/internal'</span>)
        <span class="hljs-operator">-&gt;</span>roles([<span class="hljs-string">'PUBLIC_ACCESS'</span>])
        <span class="hljs-comment">// the 'ips' option supports IP addresses and subnet masks</span>
        <span class="hljs-operator">-&gt;</span>ips([<span class="hljs-string">'127.0.0.1'</span>, <span class="hljs-string">'::1'</span>])
    ;

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span><span class="hljs-operator">-&gt;</span>accessControl()
        <span class="hljs-operator">-&gt;</span>path(<span class="hljs-string">'^/internal'</span>)
        <span class="hljs-operator">-&gt;</span>roles([<span class="hljs-string">'ROLE_NO_ACCESS'</span>])
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>Here is how it works when the path is <code translate="no" class="notranslate">/internal/something</code> coming from
the external IP address <code translate="no" class="notranslate">10.0.0.1</code>:</p>
<ul>
    <li>The first access control rule is ignored as the <code translate="no" class="notranslate">path</code> matches but the
IP address does not match either of the IPs listed;</li>
<li>The second access control rule is enabled (the only restriction being the
<code translate="no" class="notranslate">path</code>) and so it matches. If you make sure that no users ever have
<code translate="no" class="notranslate">ROLE_NO_ACCESS</code>, then access is denied (<code translate="no" class="notranslate">ROLE_NO_ACCESS</code> can be anything
that does not match an existing role, it only serves as a trick to always
deny access).</li>
</ul>
<p>But if the same request comes from <code translate="no" class="notranslate">127.0.0.1</code> or <code translate="no" class="notranslate">::1</code> (the IPv6 loopback
address):</p>
<ul>
    <li>Now, the first access control rule is enabled as both the <code translate="no" class="notranslate">path</code> and the
<code translate="no" class="notranslate">ip</code> match: access is allowed as the user always has the
<code translate="no" class="notranslate">PUBLIC_ACCESS</code> role.</li>
<li>The second access rule is not examined as the first rule matched.</li>
</ul>
<span id="security-allow-if"></span>
<div class="section">
<h3 id="securing-by-an-expression">
    Securing by an Expression
    <a class="headerlink" href="#securing-by-an-expression" title="Permalink to this headline">¶</a>
</h3>
<p>Once an <code translate="no" class="notranslate">access_control</code> entry is matched, you can deny access via the
<code translate="no" class="notranslate">roles</code> key or use more complex logic with an expression in the <code translate="no" class="notranslate">allow_if</code>
key:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-0272a5264a0e7f3f3032eabc2f7c3c060ac2d64d" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-e34773bdce4f1062415a95299c091ad2df2b04fd" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-ac2889afd18a3c83c8c6e718cf4e79f0f64ffedd" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-0272a5264a0e7f3f3032eabc2f7c3c060ac2d64d" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/security.yaml</span>
<span class="hljs-attr">security:</span>
    <span class="hljs-comment"># ...</span>
    <span class="hljs-attr">access_control:</span>
        <span class="hljs-bullet">-</span>
            <span class="hljs-attr">path:</span> <span class="hljs-string">^/_internal/secure</span>
            <span class="hljs-comment"># the 'roles' and 'allow_if' options work like an OR expression, so</span>
            <span class="hljs-comment"># access is granted if the expression is TRUE or the user has ROLE_ADMIN</span>
            <span class="hljs-attr">roles:</span> <span class="hljs-string">'ROLE_ADMIN'</span>
            <span class="hljs-attr">allow_if:</span> <span class="hljs-string">"'127.0.0.1' == request.getClientIp() or request.headers.has('X-Secure-Access')"</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-e34773bdce4f1062415a95299c091ad2df2b04fd" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">srv:container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/security"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:srv</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd
        http://symfony.com/schema/dic/security
        https://symfony.com/schema/dic/security/security-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">config</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- ... --&gt;</span>
        <span class="hljs-comment">&lt;!-- the 'role' and 'allow-if' options work like an OR expression, so
             access is granted if the expression is TRUE or the user has ROLE_ADMIN --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">rule</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"^/_internal/secure"</span>
            <span class="hljs-attr">role</span>=<span class="hljs-string">"ROLE_ADMIN"</span>
            <span class="hljs-attr">allow-if</span>=<span class="hljs-string">"'127.0.0.1' == request.getClientIp() or request.headers.has('X-Secure-Access')"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">config</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">srv:container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-ac2889afd18a3c83c8c6e718cf4e79f0f64ffedd" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/packages/security.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Config</span>\<span class="hljs-title">SecurityConfig</span>;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(SecurityConfig <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span>)</span> </span>{
    <span class="hljs-comment">// ...</span>

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span><span class="hljs-operator">-&gt;</span>accessControl()
        <span class="hljs-operator">-&gt;</span>path(<span class="hljs-string">'^/_internal/secure'</span>)
        <span class="hljs-comment">// the 'role' and 'allow-if' options work like an OR expression, so</span>
        <span class="hljs-comment">// access is granted if the expression is TRUE or the user has ROLE_ADMIN</span>
        <span class="hljs-operator">-&gt;</span>roles([<span class="hljs-string">'ROLE_ADMIN'</span>])
        <span class="hljs-operator">-&gt;</span>allowIf(<span class="hljs-string">'"127.0.0.1" == request.getClientIp() or request.headers.has("X-Secure-Access")'</span>)
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>In this case, when the user tries to access any URL starting with
<code translate="no" class="notranslate">/_internal/secure</code>, they will only be granted access if the IP address is
<code translate="no" class="notranslate">127.0.0.1</code> or a secure header, or if the user has the <code translate="no" class="notranslate">ROLE_ADMIN</code> role.</p>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>Internally <code translate="no" class="notranslate">allow_if</code> triggers the built-in
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/Security/Core/Authorization/Voter/ExpressionVoter.php" class="reference external" title="Symfony\Component\Security\Core\Authorization\Voter\ExpressionVoter" rel="external noopener noreferrer" target="_blank">ExpressionVoter</a>
as like it was part of the attributes defined in the <code translate="no" class="notranslate">roles</code> option.</p>
</div>
<p>Inside the expression, you have access to a number of different variables
and functions including <code translate="no" class="notranslate">request</code>, which is the Symfony
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpFoundation/Request.php" class="reference external" title="Symfony\Component\HttpFoundation\Request" rel="external noopener noreferrer" target="_blank">Request</a> object (see
<a href="../components/http_foundation.html#component-http-foundation-request" class="reference internal">The HttpFoundation Component</a>).</p>
<p>For a list of the other functions and variables, see
<a href="expressions.html#security-expression-variables" class="reference internal">functions and variables</a>.</p>
<div class="admonition admonition-tip ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                <span>Tip</span>
    </p><p>The <code translate="no" class="notranslate">allow_if</code> expressions can also contain custom functions registered
with <a href="../components/expression_language.html#components-expression-language-provider" class="reference internal">expression providers</a>.</p>
</div>
</div>
</div>
<div class="section">
<h2 id="restrict-to-a-port">
    Restrict to a port
    <a class="headerlink" href="#restrict-to-a-port" title="Permalink to this headline">¶</a>
</h2>
<p>Add the <code translate="no" class="notranslate">port</code> option to any <code translate="no" class="notranslate">access_control</code> entries to require users to
access those URLs via a specific port. This could be useful for example for
<code translate="no" class="notranslate">localhost:8080</code>.</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-4e7a9d3f78bc2985a48acf558d354f60397901a0" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-ba5b826efdbb22323be6e2025d8f8fadaba9abcf" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-d2bc1349c59bbd832d36415a1cf26efcc3ebc162" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-4e7a9d3f78bc2985a48acf558d354f60397901a0" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/security.yaml</span>
<span class="hljs-attr">security:</span>
    <span class="hljs-comment"># ...</span>
    <span class="hljs-attr">access_control:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">{</span> <span class="hljs-attr">path:</span> <span class="hljs-string">^/cart/checkout,</span> <span class="hljs-attr">roles:</span> <span class="hljs-string">PUBLIC_ACCESS,</span> <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span> <span class="hljs-string">}</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-ba5b826efdbb22323be6e2025d8f8fadaba9abcf" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">srv:container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/security"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:srv</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd
        http://symfony.com/schema/dic/security
        https://symfony.com/schema/dic/security/security-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">config</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- ... --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">rule</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"^/cart/checkout"</span>
            <span class="hljs-attr">role</span>=<span class="hljs-string">"PUBLIC_ACCESS"</span>
            <span class="hljs-attr">port</span>=<span class="hljs-string">"8080"</span>
        /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">config</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">srv:container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-d2bc1349c59bbd832d36415a1cf26efcc3ebc162" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/packages/security.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Config</span>\<span class="hljs-title">SecurityConfig</span>;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(SecurityConfig <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span>)</span> </span>{
    <span class="hljs-comment">// ...</span>

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span><span class="hljs-operator">-&gt;</span>accessControl()
        <span class="hljs-operator">-&gt;</span>path(<span class="hljs-string">'^/cart/checkout'</span>)
        <span class="hljs-operator">-&gt;</span>roles([<span class="hljs-string">'PUBLIC_ACCESS'</span>])
        <span class="hljs-operator">-&gt;</span>port(<span class="hljs-number">8080</span>)
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
</div>
<div class="section">
<h2 id="forcing-a-channel-http-https">
    Forcing a Channel (http, https)
    <a class="headerlink" href="#forcing-a-channel-http-https" title="Permalink to this headline">¶</a>
</h2>
<p>You can also require a user to access a URL via SSL; use the
<code translate="no" class="notranslate">requires_channel</code> argument in any <code translate="no" class="notranslate">access_control</code> entries. If this
<code translate="no" class="notranslate">access_control</code> is matched and the request is using the <code translate="no" class="notranslate">http</code> channel,
the user will be redirected to <code translate="no" class="notranslate">https</code>:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-1c3a128a6b12371ee0c3ea629fb965c125d418e8" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-565f0013c5dbff93b2b6f30726322826c45d92ce" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-07fa7b40a341d2b3c282489b297d1cfd710c1710" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-1c3a128a6b12371ee0c3ea629fb965c125d418e8" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/security.yaml</span>
<span class="hljs-attr">security:</span>
    <span class="hljs-comment"># ...</span>
    <span class="hljs-attr">access_control:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">{</span> <span class="hljs-attr">path:</span> <span class="hljs-string">^/cart/checkout,</span> <span class="hljs-attr">roles:</span> <span class="hljs-string">PUBLIC_ACCESS,</span> <span class="hljs-attr">requires_channel:</span> <span class="hljs-string">https</span> <span class="hljs-string">}</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-565f0013c5dbff93b2b6f30726322826c45d92ce" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">srv:container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/security"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:srv</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd
        http://symfony.com/schema/dic/security
        https://symfony.com/schema/dic/security/security-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">config</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- ... --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">rule</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"^/cart/checkout"</span>
            <span class="hljs-attr">role</span>=<span class="hljs-string">"PUBLIC_ACCESS"</span>
            <span class="hljs-attr">requires-channel</span>=<span class="hljs-string">"https"</span>
        /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">config</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">srv:container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-07fa7b40a341d2b3c282489b297d1cfd710c1710" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/packages/security.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Config</span>\<span class="hljs-title">SecurityConfig</span>;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(SecurityConfig <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span>)</span> </span>{
    <span class="hljs-comment">// ...</span>

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span><span class="hljs-operator">-&gt;</span>accessControl()
        <span class="hljs-operator">-&gt;</span>path(<span class="hljs-string">'^/cart/checkout'</span>)
        <span class="hljs-operator">-&gt;</span>roles([<span class="hljs-string">'PUBLIC_ACCESS'</span>])
        <span class="hljs-operator">-&gt;</span>requiresChannel(<span class="hljs-string">'https'</span>)
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
</div>
</div>

                            </div>                    </div>
                                    </div>        </div>

    </section>

</div>


<script type="text/javascript" src="assets/js/theme.js"></script>
<script type="text/javascript" src="assets/js/badge_only.js"></script>

 
</body>
</html>