        
<!DOCTYPE html>
<!--[if IE 8]>
<html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en"> <!--<![endif]-->
<head><base href="/">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
            
                                
    
    <link rel="stylesheet" href="assets/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/highlightjs.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/badge_only.css" type="text/css" />

</head>

<body class="wy-body-for-nav">
 <div class="wy-grid-for-nav">

        <nav data-toggle="wy-nav-shift" class="wy-nav-side">
        <div class="wy-side-scroll">
            <div class="wy-side-nav-search">
                
                                                                                                    
                                                                                                                                                                        </div>

            <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                                                                                                                                                                                                                                                                                                                            </div>
        </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

                                                        

        <div class="wy-nav-content">                <div class="rst-content">
                                        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">                            <div itemprop="articleBody">
                                    <div class="section">
<h1 id="user-providers">
    User Providers
    <a class="headerlink" href="#user-providers" title="Permalink to this headline">¶</a>
</h1>
<p>User providers (re)load users from a storage (e.g. a database) based on a
&quot;user identifier&quot; (e.g. the user's email address or username). See
<a href="../security.html#security-user-providers" class="reference internal">Security</a> for more detailed information when a user
provider is used.</p>
<p>Symfony provides several user providers:</p>
<dl>
                        <dt><a href="user_providers.html#security-entity-user-provider" class="reference internal">Entity User Provider</a></dt>
        
        <dd>
                            Loads users from a database using <a href="../doctrine.html" class="reference internal">Doctrine</a>;
                    </dd>
                        <dt><a href="ldap.html#security-ldap-user-provider" class="reference internal">LDAP User Provider</a></dt>
        
        <dd>
                            Loads users from a LDAP server;
                    </dd>
                        <dt><a href="user_providers.html#security-memory-user-provider" class="reference internal">Memory User Provider</a></dt>
        
        <dd>
                            Loads users from a configuration file;
                    </dd>
                        <dt><a href="user_providers.html#security-chain-user-provider" class="reference internal">Chain User Provider</a></dt>
        
        <dd>
                            Merges two or more user providers into a new user provider.
                    </dd>
    </dl>
<span id="security-entity-user-provider"></span>
<div class="section">
<h2 id="entity-user-provider">
    Entity User Provider
    <a class="headerlink" href="#entity-user-provider" title="Permalink to this headline">¶</a>
</h2>
<p>This is the most common user provider. Users are stored in a database and
the user provider uses <a href="../doctrine.html" class="reference internal">Doctrine</a> to retrieve them.</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-4f6721fa717a429b9364c57e79199e46d573fb42" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-7b81873e31c3d41ee9356163280bfd051a3a4f33" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-ef9c7a9586f6b4f8baf8eb6d2f92a98a72372d60" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-4f6721fa717a429b9364c57e79199e46d573fb42" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/security.yaml</span>
<span class="hljs-attr">security:</span>
    <span class="hljs-attr">providers:</span>
        <span class="hljs-attr">users:</span>
            <span class="hljs-attr">entity:</span>
                <span class="hljs-comment"># the class of the entity that represents users</span>
                <span class="hljs-attr">class:</span> <span class="hljs-string">'App\Entity\User'</span>
                <span class="hljs-comment"># the property to query by - e.g. email, username, etc</span>
                <span class="hljs-attr">property:</span> <span class="hljs-string">'email'</span>

                <span class="hljs-comment"># optional: if you're using multiple Doctrine entity</span>
                <span class="hljs-comment"># managers, this option defines which one to use</span>
                <span class="hljs-comment">#manager_name: 'customer'</span>

    <span class="hljs-comment"># ...</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-7b81873e31c3d41ee9356163280bfd051a3a4f33" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">srv:container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/security"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:srv</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">config</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">provider</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"users"</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- class:    the class of the entity that represents users
                 property: the property to query by - e.g. email, username, etc--&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">entity</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"App\Entity\User"</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"email"</span>/&gt;</span>

            <span class="hljs-comment">&lt;!-- optional, if you're using multiple Doctrine entity
                 managers, "manager-name" defines which one to use --&gt;</span>
            <span class="hljs-comment">&lt;!-- &lt;entity class="App\Entity\User" property="email"
                         manager-name="customer"/&gt; --&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">provider</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- ... --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">config</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">srv:container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-ef9c7a9586f6b4f8baf8eb6d2f92a98a72372d60" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/packages/security.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Entity</span>\<span class="hljs-title">User</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Config</span>\<span class="hljs-title">SecurityConfig</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>container</span><span class="hljs-operator">-&gt;</span>loadFromExtension(<span class="hljs-string">'security'</span>, [
    <span class="hljs-string">'providers'</span> =&gt; [
        <span class="hljs-string">'users'</span> =&gt; [
            <span class="hljs-string">'entity'</span> =&gt; [
                <span class="hljs-comment">// the class of the entity that represents users</span>
                <span class="hljs-string">'class'</span>    =&gt; User<span class="hljs-operator">::</span>class,
                <span class="hljs-comment">// the property to query by - e.g. email, username, etc</span>
                <span class="hljs-string">'property'</span> =&gt; <span class="hljs-string">'email'</span>,

                <span class="hljs-comment">// optional: if you're using multiple Doctrine entity</span>
                <span class="hljs-comment">// managers, this option defines which one to use</span>
                <span class="hljs-comment">//'manager_name' =&gt; 'customer',</span>
            ],
        ],
    ],

    <span class="hljs-comment">// ...</span>
]);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<span id="authenticating-someone-with-a-custom-entity-provider"></span>
<div class="section">
<h3 id="using-a-custom-query-to-load-the-user">
    Using a Custom Query to Load the User
    <a class="headerlink" href="#using-a-custom-query-to-load-the-user" title="Permalink to this headline">¶</a>
</h3>
<p>The entity provider can only query from one <em>specific</em> field, specified by
the <code translate="no" class="notranslate">property</code> config key. If you want a bit more control over this - e.g. you
want to find a user by <code translate="no" class="notranslate">email</code> <em>or</em> <code translate="no" class="notranslate">username</code>, you can do that by
implementing <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Bridge/Doctrine/Security/User/UserLoaderInterface.php" class="reference external" title="Symfony\Bridge\Doctrine\Security\User\UserLoaderInterface" rel="external noopener noreferrer" target="_blank">UserLoaderInterface</a>
in your <a href="../doctrine.html#doctrine-queries" class="reference internal">Doctrine repository</a> (e.g. <code translate="no" class="notranslate">UserRepository</code>):</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Repository/UserRepository.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Repository</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Entity</span>\<span class="hljs-title">User</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">Bundle</span>\<span class="hljs-title">DoctrineBundle</span>\<span class="hljs-title">Repository</span>\<span class="hljs-title">ServiceEntityRepository</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Bridge</span>\<span class="hljs-title">Doctrine</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">User</span>\<span class="hljs-title">UserLoaderInterface</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ServiceEntityRepository</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserLoaderInterface</span>
</span>{
    <span class="hljs-comment">// ...</span>

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadUserByIdentifier</span><span class="hljs-params">(string <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>usernameOrEmail</span>)</span>: ?<span class="hljs-title">User</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>entityManager</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>getEntityManager();

        <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>entityManager</span><span class="hljs-operator">-&gt;</span>createQuery(
                <span class="hljs-string">'SELECT u
                FROM App\Entity\User u
                WHERE u.username = :query
                OR u.email = :query'</span>
            )
            <span class="hljs-operator">-&gt;</span>setParameter(<span class="hljs-string">'query'</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>usernameOrEmail</span>)
            <span class="hljs-operator">-&gt;</span>getOneOrNullResult();
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>To finish this, remove the <code translate="no" class="notranslate">property</code> key from the user provider in
<code translate="no" class="notranslate">security.yaml</code>:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-53adfc1194b3b01a0ea4725972a394ed78a39108" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-d2a9fe9f0c2bee5134b51d80235f6f8f3393f400" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-ca6f4e88d88f785661142c16b99adebf96a2a430" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-53adfc1194b3b01a0ea4725972a394ed78a39108" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/security.yaml</span>
<span class="hljs-attr">security:</span>
    <span class="hljs-attr">providers:</span>
        <span class="hljs-attr">users:</span>
            <span class="hljs-attr">entity:</span>
                <span class="hljs-attr">class:</span> <span class="hljs-string">App\Entity\User</span>

    <span class="hljs-comment"># ...</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-d2a9fe9f0c2bee5134b51d80235f6f8f3393f400" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">srv:container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/security"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:srv</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd
        http://symfony.com/schema/dic/security
        https://symfony.com/schema/dic/security/security-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">config</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">provider</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"users"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">entity</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"App\Entity\User"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">provider</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- ... --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">config</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">srv:container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-ca6f4e88d88f785661142c16b99adebf96a2a430" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/packages/security.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Entity</span>\<span class="hljs-title">User</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>container</span><span class="hljs-operator">-&gt;</span>loadFromExtension(<span class="hljs-string">'security'</span>, [
    <span class="hljs-string">'providers'</span> =&gt; [
        <span class="hljs-string">'users'</span> =&gt; [
            <span class="hljs-string">'entity'</span> =&gt; [
                <span class="hljs-string">'class'</span> =&gt; User<span class="hljs-operator">::</span>class,
            ],
        ],
    ],

    <span class="hljs-comment">// ...</span>
]);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>Now, whenever Symfony uses the user provider, the <code translate="no" class="notranslate">loadUserByIdentifier()</code>
method on your <code translate="no" class="notranslate">UserRepository</code> will be called.</p>
<span id="security-memory-user-provider"></span>
</div>
</div>
<div class="section">
<h2 id="memory-user-provider">
    Memory User Provider
    <a class="headerlink" href="#memory-user-provider" title="Permalink to this headline">¶</a>
</h2>
<p>It's not recommended to use this provider in real applications because of its
limitations and how difficult it is to manage users. It may be useful in application
prototypes and for limited applications that don't store users in databases.</p>
<p>This user provider stores all user information in a configuration file,
including their passwords. Make sure the passwords are hashed properly. See
<a href="passwords.html" class="reference internal">Password Hashing and Verification</a> for more information.</p>
<p>After setting up hashing, you can configure all the user information in
<code translate="no" class="notranslate">security.yaml</code>:</p>
<div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/security.yaml</span>
<span class="hljs-attr">security:</span>
    <span class="hljs-attr">providers:</span>
        <span class="hljs-attr">backend_users:</span>
            <span class="hljs-attr">memory:</span>
                <span class="hljs-attr">users:</span>
                    <span class="hljs-attr">john_admin:</span> <span class="hljs-string">{</span> <span class="hljs-attr">password:</span> <span class="hljs-string">'$2y$13$jxGxc ... IuqDju'</span><span class="hljs-string">,</span> <span class="hljs-attr">roles:</span> <span class="hljs-string">['ROLE_ADMIN']</span> <span class="hljs-string">}</span>
                    <span class="hljs-attr">jane_admin:</span> <span class="hljs-string">{</span> <span class="hljs-attr">password:</span> <span class="hljs-string">'$2y$13$PFi1I ... rGwXCZ'</span><span class="hljs-string">,</span> <span class="hljs-attr">roles:</span> <span class="hljs-string">['ROLE_ADMIN',</span> <span class="hljs-string">'ROLE_SUPER_ADMIN'</span><span class="hljs-string">]</span> <span class="hljs-string">}</span>

    <span class="hljs-comment"># ...</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-caution ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                <span>Caution</span>
    </p><p>When using a <code translate="no" class="notranslate">memory</code> provider, and not the <code translate="no" class="notranslate">auto</code> algorithm, you have
to choose an encoding without salt (i.e. <code translate="no" class="notranslate">bcrypt</code>).</p>
</div>
<span id="security-chain-user-provider"></span>
</div>
<div class="section">
<h2 id="chain-user-provider">
    Chain User Provider
    <a class="headerlink" href="#chain-user-provider" title="Permalink to this headline">¶</a>
</h2>
<p>This user provider combines two or more of the other providers
to create a new user provider. The order in which
providers are configured is important because Symfony will look for users
starting from the first provider and will keep looking for in the other
providers until the user is found:</p>
<div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/security.yaml</span>
<span class="hljs-attr">security:</span>
    <span class="hljs-comment"># ...</span>
    <span class="hljs-attr">providers:</span>
        <span class="hljs-attr">backend_users:</span>
            <span class="hljs-attr">ldap:</span>
                <span class="hljs-comment"># ...</span>

        <span class="hljs-attr">legacy_users:</span>
            <span class="hljs-attr">entity:</span>
                <span class="hljs-comment"># ...</span>

        <span class="hljs-attr">users:</span>
            <span class="hljs-attr">entity:</span>
                <span class="hljs-comment"># ...</span>

        <span class="hljs-attr">all_users:</span>
            <span class="hljs-attr">chain:</span>
                <span class="hljs-attr">providers:</span> <span class="hljs-string">['legacy_users',</span> <span class="hljs-string">'users'</span><span class="hljs-string">,</span> <span class="hljs-string">'backend_users'</span><span class="hljs-string">]</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<span id="security-custom-user-provider"></span>
</div>
<div class="section">
<h2 id="creating-a-custom-user-provider">
    Creating a Custom User Provider
    <a class="headerlink" href="#creating-a-custom-user-provider" title="Permalink to this headline">¶</a>
</h2>
<p>Most applications don't need to create a custom provider. If you store users in
a database, a LDAP server or a configuration file, Symfony supports that.
However, if you're loading users from a custom location (e.g. via an API or
legacy database connection), you'll need to create a custom user provider.</p>
<p>First, make sure you've followed the <a href="../security.html" class="reference internal">Security Guide</a> to create
your <code translate="no" class="notranslate">User</code> class.</p>
<p>If you used the <code translate="no" class="notranslate">make:user</code> command to create your <code translate="no" class="notranslate">User</code> class (and you
answered the questions indicating that you need a custom user provider), that
command will generate a nice skeleton to get you started:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Security/UserProvider.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Security</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">Exception</span>\<span class="hljs-title">UnsupportedUserException</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">Exception</span>\<span class="hljs-title">UserNotFoundException</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">User</span>\<span class="hljs-title">PasswordAuthenticatedUserInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">User</span>\<span class="hljs-title">PasswordUpgraderInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">User</span>\<span class="hljs-title">UserInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">User</span>\<span class="hljs-title">UserProviderInterface</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserProvider</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserProviderInterface</span>, <span class="hljs-title">PasswordUpgraderInterface</span>
</span>{
    <span class="hljs-comment">/**
     * Symfony calls this method if you use features like switch_user
     * or remember_me. If you're not using these features, you do not
     * need to implement this method.
     *
     * <span class="hljs-doctag">@throws</span> UserNotFoundException if the user is not found
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadUserByIdentifier</span><span class="hljs-params">(string <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>identifier</span>)</span>: <span class="hljs-title">UserInterface</span>
    </span>{
        <span class="hljs-comment">// Load a User object from your data source or throw UserNotFoundException.</span>
        <span class="hljs-comment">// The $identifier argument is whatever value is being returned by the</span>
        <span class="hljs-comment">// getUserIdentifier() method in your User class.</span>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> \<span class="hljs-keyword">Exception</span>(<span class="hljs-string">'TODO: fill in loadUserByIdentifier() inside '</span>.<span class="hljs-keyword">__FILE__</span>);
    }

    <span class="hljs-comment">/**
     * Refreshes the user after being reloaded from the session.
     *
     * When a user is logged in, at the beginning of each request, the
     * User object is loaded from the session and then this method is
     * called. Your job is to make sure the user's data is still fresh by,
     * for example, re-querying for fresh User data.
     *
     * If your firewall is "stateless: true" (for a pure API), this
     * method is not called.
     *
     * <span class="hljs-doctag">@return</span> UserInterface
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">refreshUser</span><span class="hljs-params">(UserInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>user</span>)</span>
    </span>{
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>user</span> <span class="hljs-keyword">instanceof</span> User) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UnsupportedUserException(sprintf(<span class="hljs-string">'Invalid user class "%s".'</span>, get_class(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>user</span>)));
        }

        <span class="hljs-comment">// Return a User object after making sure its data is "fresh".</span>
        <span class="hljs-comment">// Or throw a UserNotFoundException if the user no longer exists.</span>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> \<span class="hljs-keyword">Exception</span>(<span class="hljs-string">'TODO: fill in refreshUser() inside '</span>.<span class="hljs-keyword">__FILE__</span>);
    }

    <span class="hljs-comment">/**
     * Tells Symfony to use this provider for this User class.
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">supportsClass</span><span class="hljs-params">(string <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>class</span>)</span>
    </span>{
        <span class="hljs-keyword">return</span> User<span class="hljs-operator">::</span>class === <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>class</span> || is_subclass_of(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>class</span>, User<span class="hljs-operator">::</span>class);
    }

    <span class="hljs-comment">/**
     * Upgrades the hashed password of a user, typically for using a better hash algorithm.
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upgradePassword</span><span class="hljs-params">(PasswordAuthenticatedUserInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>user</span>, string <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>newHashedPassword</span>)</span>: <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> when hashed passwords are in use, this method should:</span>
        <span class="hljs-comment">// 1. persist the new password in the user storage</span>
        <span class="hljs-comment">// 2. update the $user object with $user-&gt;setPassword($newHashedPassword);</span>
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Most of the work is already done! Read the comments in the code and update the
TODO sections to finish the user provider. When you're done, tell Symfony about
the user provider by adding it in <code translate="no" class="notranslate">security.yaml</code>:</p>
<div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/security.yaml</span>
<span class="hljs-attr">security:</span>
    <span class="hljs-attr">providers:</span>
        <span class="hljs-comment"># the name of your user provider can be anything</span>
        <span class="hljs-attr">your_custom_user_provider:</span>
            <span class="hljs-attr">id:</span> <span class="hljs-string">App\Security\UserProvider</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Lastly, update the <code translate="no" class="notranslate">config/packages/security.yaml</code> file to set the
<code translate="no" class="notranslate">provider</code> key to <code translate="no" class="notranslate">your_custom_user_provider</code> in all the firewalls which
will use this custom user provider.</p>
</div>
</div>

                            </div>                    </div>
                                    </div>        </div>

    </section>

</div>


<script type="text/javascript" src="assets/js/theme.js"></script>
<script type="text/javascript" src="assets/js/badge_only.js"></script>

 
</body>
</html>