        
<!DOCTYPE html>
<!--[if IE 8]>
<html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en"> <!--<![endif]-->
<head><base href="/">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
            
                                
    
    <link rel="stylesheet" href="assets/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/highlightjs.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/badge_only.css" type="text/css" />

</head>

<body class="wy-body-for-nav">
 <div class="wy-grid-for-nav">

        <nav data-toggle="wy-nav-shift" class="wy-nav-side">
        <div class="wy-side-scroll">
            <div class="wy-side-nav-search">
                
                                                                                                    
                                                                                                                                                                        </div>

            <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                                                                                                                                                                                                                                                                                                                            </div>
        </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

                                                        

        <div class="wy-nav-content">                <div class="rst-content">
                                        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">                            <div itemprop="articleBody">
                                    <div class="section">
<h1 id="how-to-impersonate-a-user">
    How to Impersonate a User
    <a class="headerlink" href="#how-to-impersonate-a-user" title="Permalink to this headline">¶</a>
</h1>
<p>Sometimes, it's useful to be able to switch from one user to another without
having to log out and log in again (for instance when you are debugging something
a user sees that you can't reproduce).</p>
<div class="admonition admonition-caution ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                <span>Caution</span>
    </p><p>User impersonation is not compatible with some authentication mechanisms
(e.g. <code translate="no" class="notranslate">REMOTE_USER</code>) where the authentication information is expected to be
sent on each request.</p>
</div>
<p>Impersonating the user can be done by activating the <code translate="no" class="notranslate">switch_user</code> firewall
listener:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-7824ff74d00ce30b46b9ebbadd9b921ffbd650f0" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-9aae5931e16c7bc21f082579ec34d6473e8fc540" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-777b82099b2bd638c33df68bcff395b662af3fbc" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-7824ff74d00ce30b46b9ebbadd9b921ffbd650f0" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/security.yaml</span>
<span class="hljs-attr">security:</span>
    <span class="hljs-comment"># ...</span>

    <span class="hljs-attr">firewalls:</span>
        <span class="hljs-attr">main:</span>
            <span class="hljs-comment"># ...</span>
            <span class="hljs-attr">switch_user:</span> <span class="hljs-literal">true</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-9aae5931e16c7bc21f082579ec34d6473e8fc540" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">srv:container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/security"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:srv</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd
        http://symfony.com/schema/dic/security
        https://symfony.com/schema/dic/security/security-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">config</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- ... --&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">firewall</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"main"</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- ... --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">switch-user</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">firewall</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">config</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">srv:container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-777b82099b2bd638c33df68bcff395b662af3fbc" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/packages/security.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Config</span>\<span class="hljs-title">SecurityConfig</span>;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(SecurityConfig <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span>)</span> </span>{
    <span class="hljs-comment">// ...</span>
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span><span class="hljs-operator">-&gt;</span>firewall(<span class="hljs-string">'main'</span>)
        <span class="hljs-comment">// ...</span>
        <span class="hljs-operator">-&gt;</span>switchUser()
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>To switch to another user, add a query string with the <code translate="no" class="notranslate">_switch_user</code>
parameter and the username (or whatever field our user provider uses to load users)
as the value to the current URL:</p>
<div translate="no" class="highlight-text notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs text">http://example.com/somewhere?_switch_user=thomas</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-tip ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                <span>Tip</span>
    </p><p>Instead of adding a <code translate="no" class="notranslate">_switch_user</code> query string parameter, you can pass
the username in a custom HTTP header by adjusting the <code translate="no" class="notranslate">parameter</code> setting.
For example, to use <code translate="no" class="notranslate">X-Switch-User</code> header (available in PHP as
<code translate="no" class="notranslate">HTTP_X_SWITCH_USER</code>) add this configuration:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-e9220d46ff6abaa048556759d225e755210d5532" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-7415db859b1380d68209177bf93b6a8fe14e9392" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-d62a1048879efe70ba4565a35fcc716042beb833" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-e9220d46ff6abaa048556759d225e755210d5532" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/security.yaml</span>
<span class="hljs-attr">security:</span>
    <span class="hljs-comment"># ...</span>
    <span class="hljs-attr">firewalls:</span>
        <span class="hljs-attr">main:</span>
            <span class="hljs-comment"># ...</span>
            <span class="hljs-attr">switch_user:</span> <span class="hljs-string">{</span> <span class="hljs-attr">parameter:</span> <span class="hljs-string">X-Switch-User</span> <span class="hljs-string">}</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-7415db859b1380d68209177bf93b6a8fe14e9392" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">srv:container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/security"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:srv</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd
        http://symfony.com/schema/dic/security
        https://symfony.com/schema/dic/security/security-1.0.xsd"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">config</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- ... --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">firewall</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"main"</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- ... --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">switch-user</span> <span class="hljs-attr">parameter</span>=<span class="hljs-string">"X-Switch-User"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">firewall</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">config</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">srv:container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-d62a1048879efe70ba4565a35fcc716042beb833" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/packages/security.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Config</span>\<span class="hljs-title">SecurityConfig</span>;
<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(SecurityConfig <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span>)</span> </span>{
    <span class="hljs-comment">// ...</span>
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span><span class="hljs-operator">-&gt;</span>firewall(<span class="hljs-string">'main'</span>)
        <span class="hljs-comment">// ...</span>
        <span class="hljs-operator">-&gt;</span>switchUser()
            <span class="hljs-operator">-&gt;</span>parameter(<span class="hljs-string">'X-Switch-User'</span>)
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
</div>
<p>To switch back to the original user, use the special <code translate="no" class="notranslate">_exit</code> username:</p>
<div translate="no" class="highlight-text notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs text">http://example.com/somewhere?_switch_user=_exit</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>This feature is only available to users with a special role called <code translate="no" class="notranslate">ROLE_ALLOWED_TO_SWITCH</code>.
Using <a href="../security.html#security-role-hierarchy" class="reference internal">role_hierarchy</a> is a great way to give this
role to the users that need it.</p>
<div class="section">
<h2 id="knowing-when-impersonation-is-active">
    Knowing When Impersonation Is Active
    <a class="headerlink" href="#knowing-when-impersonation-is-active" title="Permalink to this headline">¶</a>
</h2>
<p>You can use the special attribute <code translate="no" class="notranslate">IS_IMPERSONATOR</code> to check if the
impersonation is active in this session. Use this special role, for
instance, to show a link to exit impersonation in a template:</p>
<div translate="no" class="highlight-html+twig highlight-twig notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs html+twig twig"><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-keyword">if</span></span> is_granted('IS_IMPERSONATOR') %}</span><span class="xml">
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"</span></span></span><span class="hljs-template-variable">{{ impersonation_exit_path(path('homepage') ) }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span>&gt;</span>Exit impersonation<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-keyword">endif</span></span> %}</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
<div class="section">
<h2 id="finding-the-original-user">
    Finding the Original User
    <a class="headerlink" href="#finding-the-original-user" title="Permalink to this headline">¶</a>
</h2>
<p>In some cases, you may need to get the object that represents the impersonator
user rather than the impersonated user. When a user is impersonated the token
stored in the token storage will be a <code translate="no" class="notranslate">SwitchUserToken</code> instance. Use the
following snippet to obtain the original token which gives you access to
the impersonator user:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Service/SomeService.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Service</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Bundle</span>\<span class="hljs-title">SecurityBundle</span>\<span class="hljs-title">Security</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">Authentication</span>\<span class="hljs-title">Token</span>\<span class="hljs-title">SwitchUserToken</span>;
<span class="hljs-comment">// ...</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SomeService</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(
        private Security <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span>,
    )</span> </span>{
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">someMethod</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-comment">// ...</span>

        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>token</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>security<span class="hljs-operator">-&gt;</span>getToken();

        <span class="hljs-keyword">if</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>token</span> <span class="hljs-keyword">instanceof</span> SwitchUserToken) {
            <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>impersonatorUser</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>token</span><span class="hljs-operator">-&gt;</span>getOriginalToken()<span class="hljs-operator">-&gt;</span>getUser();
        }

        <span class="hljs-comment">// ...</span>
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
<div class="section">
<h2 id="controlling-the-query-parameter">
    Controlling the Query Parameter
    <a class="headerlink" href="#controlling-the-query-parameter" title="Permalink to this headline">¶</a>
</h2>
<p>This feature needs to be available only to a restricted group of users.
By default, access is restricted to users having the <code translate="no" class="notranslate">ROLE_ALLOWED_TO_SWITCH</code>
role. The name of this role can be modified via the <code translate="no" class="notranslate">role</code> setting. You can
also adjust the query parameter name via the <code translate="no" class="notranslate">parameter</code> setting:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-7e0853267d8f491a4e63248695f9f5db2d3dc120" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-e191a0fa1a88f506fc058c478a803785e7d54789" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-c233fb86ab9978a774ddf96174e15d950ac66ba9" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-7e0853267d8f491a4e63248695f9f5db2d3dc120" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/security.yaml</span>
<span class="hljs-attr">security:</span>
    <span class="hljs-comment"># ...</span>

    <span class="hljs-attr">firewalls:</span>
        <span class="hljs-attr">main:</span>
            <span class="hljs-comment"># ...</span>
            <span class="hljs-attr">switch_user:</span> <span class="hljs-string">{</span> <span class="hljs-attr">role:</span> <span class="hljs-string">ROLE_ADMIN,</span> <span class="hljs-attr">parameter:</span> <span class="hljs-string">_want_to_be_this_user</span> <span class="hljs-string">}</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-e191a0fa1a88f506fc058c478a803785e7d54789" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">srv:container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/security"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:srv</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd
        http://symfony.com/schema/dic/security
        https://symfony.com/schema/dic/security/security-1.0.xsd"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">config</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- ... --&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">firewall</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"main"</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- ... --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">switch-user</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"ROLE_ADMIN"</span> <span class="hljs-attr">parameter</span>=<span class="hljs-string">"_want_to_be_this_user"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">firewall</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">config</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">srv:container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-c233fb86ab9978a774ddf96174e15d950ac66ba9" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/packages/security.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Config</span>\<span class="hljs-title">SecurityConfig</span>;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(SecurityConfig <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span>)</span> </span>{
    <span class="hljs-comment">// ...</span>
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span><span class="hljs-operator">-&gt;</span>firewall(<span class="hljs-string">'main'</span>)
        <span class="hljs-comment">// ...</span>
        <span class="hljs-operator">-&gt;</span>switchUser()
            <span class="hljs-operator">-&gt;</span>role(<span class="hljs-string">'ROLE_ADMIN'</span>)
            <span class="hljs-operator">-&gt;</span>parameter(<span class="hljs-string">'_want_to_be_this_user'</span>)
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
</div>
<div class="section">
<h2 id="redirecting-to-a-specific-target-route">
    Redirecting to a Specific Target Route
    <a class="headerlink" href="#redirecting-to-a-specific-target-route" title="Permalink to this headline">¶</a>
</h2>
<div class="admonition admonition-versionadded ">
    <p class="admonition-title">
                                    <span>6.2</span>
    </p><p>The <code translate="no" class="notranslate">target_route</code> configuration option was introduced in Symfony 6.2.</p>
</div>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>It works only in a stateful firewall.</p>
</div>
<p>This feature allows you to control the redirection target route via <code translate="no" class="notranslate">target_route</code>.</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-cd39e78bf0f35cc214de7c3d6ec1b02e6fd849c2" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-0591f62d9525cda1eefaaf4a2c94afaf1f4ae814" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-9655a2e89741e3bb7a73a36c7aa152b059bca429" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-cd39e78bf0f35cc214de7c3d6ec1b02e6fd849c2" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/security.yaml</span>
<span class="hljs-attr">security:</span>
    <span class="hljs-comment"># ...</span>

    <span class="hljs-attr">firewalls:</span>
        <span class="hljs-attr">main:</span>
            <span class="hljs-comment"># ...</span>
            <span class="hljs-attr">switch_user:</span> <span class="hljs-string">{</span> <span class="hljs-attr">target_route:</span> <span class="hljs-string">app_user_dashboard</span> <span class="hljs-string">}</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-0591f62d9525cda1eefaaf4a2c94afaf1f4ae814" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">srv:container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/security"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:srv</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd
        http://symfony.com/schema/dic/security
        https://symfony.com/schema/dic/security/security-1.0.xsd"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">config</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- ... --&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">firewall</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"main"</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- ... --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">switch-user</span> <span class="hljs-attr">target-route</span>=<span class="hljs-string">"app_user_dashboard"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">firewall</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">config</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">srv:container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-9655a2e89741e3bb7a73a36c7aa152b059bca429" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/packages/security.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Config</span>\<span class="hljs-title">SecurityConfig</span>;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(SecurityConfig <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span>)</span> </span>{
    <span class="hljs-comment">// ...</span>
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span><span class="hljs-operator">-&gt;</span>firewall(<span class="hljs-string">'main'</span>)
        <span class="hljs-comment">// ...</span>
        <span class="hljs-operator">-&gt;</span>switchUser()
            <span class="hljs-operator">-&gt;</span>targetRoute(<span class="hljs-string">'app_user_dashboard'</span>)
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
</div>
<div class="section">
<h2 id="limiting-user-switching">
    Limiting User Switching
    <a class="headerlink" href="#limiting-user-switching" title="Permalink to this headline">¶</a>
</h2>
<p>If you need more control over user switching, you can use a security voter. First,
configure <code translate="no" class="notranslate">switch_user</code> to check for some new, custom attribute. This can be
anything, but <em>cannot</em> start with <code translate="no" class="notranslate">ROLE_</code> (to enforce that only your voter will
be called):</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-fb71582e92fbd85c88984ee4237e7ad1e5c5b7b8" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-000b152fe1bed1b87fc138f70e93cd2a3dfd1b4e" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-b1ff743aab81f9789e307db82f25e4535131b602" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-fb71582e92fbd85c88984ee4237e7ad1e5c5b7b8" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/security.yaml</span>
<span class="hljs-attr">security:</span>
    <span class="hljs-comment"># ...</span>

    <span class="hljs-attr">firewalls:</span>
        <span class="hljs-attr">main:</span>
            <span class="hljs-comment"># ...</span>
            <span class="hljs-attr">switch_user:</span> <span class="hljs-string">{</span> <span class="hljs-attr">role:</span> <span class="hljs-string">CAN_SWITCH_USER</span> <span class="hljs-string">}</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-000b152fe1bed1b87fc138f70e93cd2a3dfd1b4e" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">srv:container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/security"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:srv</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd
        http://symfony.com/schema/dic/security
        https://symfony.com/schema/dic/security/security-1.0.xsd"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">config</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- ... --&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">firewall</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"main"</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- ... --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">switch-user</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"CAN_SWITCH_USER"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">firewall</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">config</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">srv:container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-b1ff743aab81f9789e307db82f25e4535131b602" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/packages/security.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Config</span>\<span class="hljs-title">SecurityConfig</span>;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(SecurityConfig <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span>)</span> </span>{
    <span class="hljs-comment">// ...</span>
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span><span class="hljs-operator">-&gt;</span>firewall(<span class="hljs-string">'main'</span>)
        <span class="hljs-comment">// ...</span>
        <span class="hljs-operator">-&gt;</span>switchUser()
            <span class="hljs-operator">-&gt;</span>role(<span class="hljs-string">'CAN_SWITCH_USER'</span>)
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>Then, create a voter class that responds to this role and includes whatever custom
logic you want:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Security/Voter/SwitchToCustomerVoter.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Voter</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Bundle</span>\<span class="hljs-title">SecurityBundle</span>\<span class="hljs-title">Security</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">Authentication</span>\<span class="hljs-title">Token</span>\<span class="hljs-title">TokenInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">Authorization</span>\<span class="hljs-title">Voter</span>\<span class="hljs-title">Voter</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">User</span>\<span class="hljs-title">UserInterface</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SwitchToCustomerVoter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Voter</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(
        private Security <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span>,
    )</span> </span>{
    }

    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">supports</span><span class="hljs-params">(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>attribute</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>subject</span>)</span>: <span class="hljs-title">bool</span>
    </span>{
        <span class="hljs-keyword">return</span> in_array(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>attribute</span>, [<span class="hljs-string">'CAN_SWITCH_USER'</span>])
            &amp;&amp; <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>subject</span> <span class="hljs-keyword">instanceof</span> UserInterface;
    }

    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">voteOnAttribute</span><span class="hljs-params">(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>attribute</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>subject</span>, TokenInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>token</span>)</span>: <span class="hljs-title">bool</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>user</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>token</span><span class="hljs-operator">-&gt;</span>getUser();
        <span class="hljs-comment">// if the user is anonymous or if the subject is not a user, do not grant access</span>
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>user</span> <span class="hljs-keyword">instanceof</span> UserInterface || !<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>subject</span> <span class="hljs-keyword">instanceof</span> UserInterface) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        }

        <span class="hljs-comment">// you can still check for ROLE_ALLOWED_TO_SWITCH</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>security<span class="hljs-operator">-&gt;</span>isGranted(<span class="hljs-string">'ROLE_ALLOWED_TO_SWITCH'</span>)) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
        }

        <span class="hljs-comment">// check for any roles you want</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>security<span class="hljs-operator">-&gt;</span>isGranted(<span class="hljs-string">'ROLE_TECH_SUPPORT'</span>)) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
        }

        <span class="hljs-comment">/*
         * or use some custom data from your User object
        if ($user-&gt;isAllowedToSwitch()) {
            return true;
        }
        */</span>

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>That's it! When switching users, your voter now has full control over whether or
not this is allowed. If your voter isn't called, see <a href="voters.html#declaring-the-voter-as-a-service" class="reference internal">How to Use Voters to Check User Permissions</a>.</p>
</div>
<div class="section">
<h2 id="events">
    Events
    <a class="headerlink" href="#events" title="Permalink to this headline">¶</a>
</h2>
<p>The firewall dispatches the <code translate="no" class="notranslate">security.switch_user</code> event right after the impersonation
is completed. The <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/Security/Http/Event/SwitchUserEvent.php" class="reference external" title="Symfony\Component\Security\Http\Event\SwitchUserEvent" rel="external noopener noreferrer" target="_blank">SwitchUserEvent</a> is
passed to the listener, and you can use this to get the user that you are now impersonating.</p>
<p>The <a href="../session.html#locale-sticky-session" class="reference internal">Sessions</a> section does not update the locale when you
impersonate a user. If you <em>do</em> want to be sure to update the locale when you
switch users, add an event subscriber on this event:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/EventListener/SwitchUserSubscriber.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">EventListener</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">EventDispatcher</span>\<span class="hljs-title">EventSubscriberInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Event</span>\<span class="hljs-title">SwitchUserEvent</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">SecurityEvents</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SwitchUserSubscriber</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">EventSubscriberInterface</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onSwitchUser</span><span class="hljs-params">(SwitchUserEvent <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span>)</span>: <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span><span class="hljs-operator">-&gt;</span>getRequest();

        <span class="hljs-keyword">if</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span><span class="hljs-operator">-&gt;</span>hasSession() &amp;&amp; (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>session</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span><span class="hljs-operator">-&gt;</span>getSession())) {
            <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>session</span><span class="hljs-operator">-&gt;</span>set(
                <span class="hljs-string">'_locale'</span>,
                <span class="hljs-comment">// assuming your User has some getLocale() method</span>
                <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span><span class="hljs-operator">-&gt;</span>getTargetUser()<span class="hljs-operator">-&gt;</span>getLocale()
            );
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSubscribedEvents</span><span class="hljs-params">()</span>: <span class="hljs-title">array</span>
    </span>{
        <span class="hljs-keyword">return</span> [
            <span class="hljs-comment">// constant for security.switch_user</span>
            SecurityEvents<span class="hljs-operator">::</span>SWITCH_USER =&gt; <span class="hljs-string">'onSwitchUser'</span>,
        ];
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>That's it! If you're using the <a href="../service_container.html#service-container-services-load-example" class="reference internal">default services.yaml configuration</a>,
Symfony will automatically discover your service and call <code translate="no" class="notranslate">onSwitchUser</code> whenever
a switch user occurs.</p>
<p>For more details about event subscribers, see <a href="../event_dispatcher.html" class="reference internal">Events and Event Listeners</a>.</p>
</div>
</div>

                            </div>                    </div>
                                    </div>        </div>

    </section>

</div>


<script type="text/javascript" src="assets/js/theme.js"></script>
<script type="text/javascript" src="assets/js/badge_only.js"></script>

 
</body>
</html>