        
<!DOCTYPE html>
<!--[if IE 8]>
<html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en"> <!--<![endif]-->
<head><base href="/">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
            
                                
    
    <link rel="stylesheet" href="assets/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/highlightjs.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/badge_only.css" type="text/css" />

</head>

<body class="wy-body-for-nav">
 <div class="wy-grid-for-nav">

        <nav data-toggle="wy-nav-shift" class="wy-nav-side">
        <div class="wy-side-scroll">
            <div class="wy-side-nav-search">
                
                                                                                                    
                                                                                                                                                                        </div>

            <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                                                                                                                                                                                                                                                                                                                            </div>
        </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

                                                        

        <div class="wy-nav-content">                <div class="rst-content">
                                        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">                            <div itemprop="articleBody">
                                    <span id="symfony2-versus-flat-php"></span>
<div class="section">
<h1 id="symfony-versus-flat-php">
    Symfony versus Flat PHP
    <a class="headerlink" href="#symfony-versus-flat-php" title="Permalink to this headline">¶</a>
</h1>
<p><strong>Why is Symfony better than just opening up a file and writing flat PHP?</strong></p>
<p>If you've never used a PHP framework, aren't familiar with the
<a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller" class="reference external" rel="external noopener noreferrer" target="_blank">Model-View-Controller</a> (MVC) philosophy, or just wonder what all the <em>hype</em>
is around Symfony, this article is for you. Instead of <em>telling</em> you that
Symfony allows you to develop faster and better software than with flat PHP,
you'll see for yourself.</p>
<p>In this article, you'll write a basic application in flat PHP, and then
refactor it to be more organized. You'll travel through time, seeing the
decisions behind why web development has evolved over the past several years
to where it is now.</p>
<p>By the end, you'll see how Symfony can rescue you from mundane tasks and
let you take back control of your code.</p>
<div class="section">
<h2 id="a-basic-blog-in-flat-php">
    A Basic Blog in Flat PHP
    <a class="headerlink" href="#a-basic-blog-in-flat-php" title="Permalink to this headline">¶</a>
</h2>
<p>In this article, you'll build the token blog application using only flat PHP.
To begin, create a single page that displays blog entries that have been
persisted to the database. Writing in flat PHP is quick and dirty:</p>
<div translate="no" class="highlight-html+php highlight-html notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs html+php html"><span class="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">// index.php</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>connection</span> = <span class="hljs-keyword">new</span> PDO(<span class="hljs-string">"mysql:host=localhost;dbname=blog_db"</span>, <span class="hljs-string">'myuser'</span>, <span class="hljs-string">'mypassword'</span>);

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>result</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>connection</span><span class="hljs-operator">-&gt;</span>query(<span class="hljs-string">'SELECT id, title FROM post'</span>);
<span class="hljs-meta">?&gt;</span></span>

<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>List of Posts<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>List of Posts<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
            <span class="php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">while</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>row</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>result</span><span class="hljs-operator">-&gt;</span>fetch(PDO<span class="hljs-operator">::</span>FETCH_ASSOC)): <span class="hljs-meta">?&gt;</span></span>
            <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/show.php?id=&lt;?= $row['id'] ?&gt;"</span>&gt;</span>
                    <span class="php"><span class="hljs-meta">&lt;?</span>= <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>row</span>[<span class="hljs-string">'title'</span>] <span class="hljs-meta">?&gt;</span></span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
            <span class="php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">endwhile</span> <span class="hljs-meta">?&gt;</span></span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>

<span class="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>connection</span> = <span class="hljs-keyword">null</span>;
<span class="hljs-meta">?&gt;</span></span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>That's quick to write, fast to deploy and run, and, as your app grows, impossible
to maintain. There are several problems that need to be addressed:</p>
<ul>
    <li><strong>No error-checking</strong>: What if the connection to the database fails?</li>
<li><strong>Poor organization</strong>: If the application grows, this single file will become
increasingly unmaintainable. Where should you put code to handle a form
submission? How can you validate data? Where should code go for sending
emails?</li>
<li><strong>Difficult to reuse code</strong>: Since everything is in one file, there's no
way to reuse any part of the application for other &quot;pages&quot; of the blog.</li>
</ul>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>Another problem not mentioned here is the fact that the database is
tied to MySQL. Though not covered here, Symfony fully integrates <a href="https://www.doctrine-project.org/" class="reference external" rel="external noopener noreferrer" target="_blank">Doctrine</a>,
a library dedicated to database abstraction and mapping.</p>
</div>
<div class="section">
<h3 id="isolating-the-presentation">
    Isolating the Presentation
    <a class="headerlink" href="#isolating-the-presentation" title="Permalink to this headline">¶</a>
</h3>
<p>The code can immediately gain from separating the application &quot;logic&quot; from
the code that prepares the HTML &quot;presentation&quot;:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// index.php</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>connection</span> = <span class="hljs-keyword">new</span> PDO(<span class="hljs-string">"mysql:host=localhost;dbname=blog_db"</span>, <span class="hljs-string">'myuser'</span>, <span class="hljs-string">'mypassword'</span>);

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>result</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>connection</span><span class="hljs-operator">-&gt;</span>query(<span class="hljs-string">'SELECT id, title FROM post'</span>);

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>posts</span> = [];
<span class="hljs-keyword">while</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>row</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>result</span><span class="hljs-operator">-&gt;</span>fetch(PDO<span class="hljs-operator">::</span>FETCH_ASSOC)) {
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>posts</span>[] = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>row</span>;
}

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>connection</span> = <span class="hljs-keyword">null</span>;

<span class="hljs-comment">// include the HTML presentation code</span>
<span class="hljs-keyword">require</span> <span class="hljs-string">'templates/list.php'</span>;</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>The HTML code is now stored in a separate file <code translate="no" class="notranslate">templates/list.php</code>, which
is primarily an HTML file that uses a template-like PHP syntax:</p>
<div translate="no" class="highlight-html+php highlight-html notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs html+php html"><span class="hljs-comment">&lt;!-- templates/list.php --&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>List of Posts<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>List of Posts<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
            <span class="php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">foreach</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>posts</span> <span class="hljs-keyword">as</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>post</span>): <span class="hljs-meta">?&gt;</span></span>
            <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/show.php?id=&lt;?= $post['id'] ?&gt;"</span>&gt;</span>
                    <span class="php"><span class="hljs-meta">&lt;?</span>= <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>post</span>[<span class="hljs-string">'title'</span>] <span class="hljs-meta">?&gt;</span></span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
            <span class="php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">endforeach</span> <span class="hljs-meta">?&gt;</span></span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>By convention, the file that contains all the application logic - <code translate="no" class="notranslate">index.php</code> -
is known as a &quot;controller&quot;. The term controller is a word you'll hear a lot,
regardless of the language or framework you use. It refers to the area
of <em>your</em> code that processes user input and prepares the response.</p>
<p>In this case, the controller prepares data from the database and then includes
a template to present that data. With the controller isolated, you could
change <em>just</em> the template file if you needed to render the blog
entries in some other format (e.g. <code translate="no" class="notranslate">list.json.php</code> for JSON format).</p>
</div>
<div class="section">
<h3 id="isolating-the-application-domain-logic">
    Isolating the Application (Domain) Logic
    <a class="headerlink" href="#isolating-the-application-domain-logic" title="Permalink to this headline">¶</a>
</h3>
<p>So far the application contains only one page. But what if a second page
needed to use the same database connection, or even the same array of blog
posts? Refactor the code so that the core behavior and data-access functions
of the application are isolated in a new file called <code translate="no" class="notranslate">model.php</code>:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// model.php</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">open_database_connection</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>connection</span> = <span class="hljs-keyword">new</span> PDO(<span class="hljs-string">"mysql:host=localhost;dbname=blog_db"</span>, <span class="hljs-string">'myuser'</span>, <span class="hljs-string">'mypassword'</span>);

    <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>connection</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">close_database_connection</span><span class="hljs-params">(&amp;<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>connection</span>)</span>
</span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>connection</span> = <span class="hljs-keyword">null</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_all_posts</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>connection</span> = open_database_connection();

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>result</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>connection</span><span class="hljs-operator">-&gt;</span>query(<span class="hljs-string">'SELECT id, title FROM post'</span>);

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>posts</span> = [];
    <span class="hljs-keyword">while</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>row</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>result</span><span class="hljs-operator">-&gt;</span>fetch(PDO<span class="hljs-operator">::</span>FETCH_ASSOC)) {
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>posts</span>[] = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>row</span>;
    }
    close_database_connection(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>connection</span>);

    <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>posts</span>;
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-tip ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                <span>Tip</span>
    </p><p>The filename <code translate="no" class="notranslate">model.php</code> is used because the logic and data access of
an application is traditionally known as the &quot;model&quot; layer. In a well-organized
application, the majority of the code representing your &quot;business logic&quot;
should live in the model (as opposed to living in a controller). And unlike
in this example, only a portion (or none) of the model is actually concerned
with accessing a database.</p>
</div>
<p>The controller (<code translate="no" class="notranslate">index.php</code>) is now only a few lines of code:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// index.php</span>
<span class="hljs-keyword">require_once</span> <span class="hljs-string">'model.php'</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>posts</span> = get_all_posts();

<span class="hljs-keyword">require</span> <span class="hljs-string">'templates/list.php'</span>;</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Now, the sole task of the controller is to get data from the model layer of
the application (the model) and to call a template to render that data.
This is a very concise example of the model-view-controller pattern.</p>
</div>
<div class="section">
<h3 id="isolating-the-layout">
    Isolating the Layout
    <a class="headerlink" href="#isolating-the-layout" title="Permalink to this headline">¶</a>
</h3>
<p>At this point, the application has been refactored into three distinct pieces
offering various advantages and the opportunity to reuse almost everything
on different pages.</p>
<p>The only part of the code that <em>can't</em> be reused is the page layout. Fix
that by creating a new <code translate="no" class="notranslate">templates/layout.php</code> file:</p>
<div translate="no" class="highlight-html+php highlight-html notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs html+php html"><span class="hljs-comment">&lt;!-- templates/layout.php --&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span><span class="php"><span class="hljs-meta">&lt;?</span>= <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>title</span> <span class="hljs-meta">?&gt;</span></span><span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        <span class="php"><span class="hljs-meta">&lt;?</span>= <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>content</span> <span class="hljs-meta">?&gt;</span></span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>The template <code translate="no" class="notranslate">templates/list.php</code> can now be simplified to &quot;extend&quot;
the <code translate="no" class="notranslate">templates/layout.php</code>:</p>
<div translate="no" class="highlight-html+php highlight-html notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs html+php html"><span class="hljs-comment">&lt;!-- templates/list.php --&gt;</span>
<span class="php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>title</span> = <span class="hljs-string">'List of Posts'</span> <span class="hljs-meta">?&gt;</span></span>

<span class="php"><span class="hljs-meta">&lt;?php</span> ob_start() <span class="hljs-meta">?&gt;</span></span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>List of Posts<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
        <span class="php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">foreach</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>posts</span> <span class="hljs-keyword">as</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>post</span>): <span class="hljs-meta">?&gt;</span></span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/show.php?id=&lt;?= $post['id'] ?&gt;"</span>&gt;</span>
                <span class="php"><span class="hljs-meta">&lt;?</span>= <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>post</span>[<span class="hljs-string">'title'</span>] <span class="hljs-meta">?&gt;</span></span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">endforeach</span> <span class="hljs-meta">?&gt;</span></span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
<span class="php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>content</span> = ob_get_clean() <span class="hljs-meta">?&gt;</span></span>

<span class="php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">include</span> <span class="hljs-string">'layout.php'</span> <span class="hljs-meta">?&gt;</span></span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>You now have a setup that will allow you to reuse the layout.
Unfortunately, to accomplish this, you're forced to use a few ugly
PHP functions (<code translate="no" class="notranslate">ob_start()</code>, <code translate="no" class="notranslate">ob_get_clean()</code>) in the template. Symfony
solves this using a <a href="https://github.com/symfony/templating" class="reference external" rel="external noopener noreferrer" target="_blank">Templating</a> component. You'll see it in action shortly.</p>
</div>
</div>
<div class="section">
<h2 id="adding-a-blog-show-page">
    Adding a Blog &quot;show&quot; Page
    <a class="headerlink" href="#adding-a-blog-show-page" title="Permalink to this headline">¶</a>
</h2>
<p>The blog &quot;list&quot; page has now been refactored so that the code is better-organized
and reusable. To prove it, add a blog &quot;show&quot; page, which displays an individual
blog post identified by an <code translate="no" class="notranslate">id</code> query parameter.</p>
<p>To begin, create a new function in the <code translate="no" class="notranslate">model.php</code> file that retrieves
an individual blog result based on a given id:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// model.php</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_post_by_id</span><span class="hljs-params">(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>id</span>)</span>
</span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>connection</span> = open_database_connection();

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>query</span> = <span class="hljs-string">'SELECT created_at, title, body FROM post WHERE id=:id'</span>;
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>statement</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>connection</span><span class="hljs-operator">-&gt;</span>prepare(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>query</span>);
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>statement</span><span class="hljs-operator">-&gt;</span>bindValue(<span class="hljs-string">':id'</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>id</span>, PDO<span class="hljs-operator">::</span>PARAM_INT);
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>statement</span><span class="hljs-operator">-&gt;</span>execute();

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>row</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>statement</span><span class="hljs-operator">-&gt;</span>fetch(PDO<span class="hljs-operator">::</span>FETCH_ASSOC);

    close_database_connection(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>connection</span>);

    <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>row</span>;
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Next, create a new file called <code translate="no" class="notranslate">show.php</code> - the controller for this new
page:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// show.php</span>
<span class="hljs-keyword">require_once</span> <span class="hljs-string">'model.php'</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>post</span> = get_post_by_id(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>_GET</span>[<span class="hljs-string">'id'</span>]);

<span class="hljs-keyword">require</span> <span class="hljs-string">'templates/show.php'</span>;</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Finally, create the new template file - <code translate="no" class="notranslate">templates/show.php</code> - to render
the individual blog post:</p>
<div translate="no" class="highlight-html+php highlight-html notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs html+php html"><span class="hljs-comment">&lt;!-- templates/show.php --&gt;</span>
<span class="php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>title</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>post</span>[<span class="hljs-string">'title'</span>] <span class="hljs-meta">?&gt;</span></span>

<span class="php"><span class="hljs-meta">&lt;?php</span> ob_start() <span class="hljs-meta">?&gt;</span></span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><span class="php"><span class="hljs-meta">&lt;?</span>= <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>post</span>[<span class="hljs-string">'title'</span>] <span class="hljs-meta">?&gt;</span></span><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"date"</span>&gt;</span><span class="php"><span class="hljs-meta">&lt;?</span>= <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>post</span>[<span class="hljs-string">'created_at'</span>] <span class="hljs-meta">?&gt;</span></span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"body"</span>&gt;</span>
        <span class="php"><span class="hljs-meta">&lt;?</span>= <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>post</span>[<span class="hljs-string">'body'</span>] <span class="hljs-meta">?&gt;</span></span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>content</span> = ob_get_clean() <span class="hljs-meta">?&gt;</span></span>

<span class="php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">include</span> <span class="hljs-string">'layout.php'</span> <span class="hljs-meta">?&gt;</span></span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Creating the second page now requires very little work and no code is duplicated. Still,
this page introduces even more lingering problems that a framework can solve
for you. For example, a missing or invalid <code translate="no" class="notranslate">id</code> query parameter will cause
the page to crash. It would be better if this caused a 404 page to be rendered,
but this can't really be done yet.</p>
<p>Another major problem is that each individual controller file must include
the <code translate="no" class="notranslate">model.php</code> file. What if each controller file suddenly needed to include
an additional file or perform some other global task (e.g. enforce security)?
As it stands now, that code would need to be added to every controller file.
If you forget to include something in one file, hopefully it doesn't relate
to security...</p>
<span id="from_flat_php-front-controller"></span>
</div>
<div class="section">
<h2 id="a-front-controller-to-the-rescue">
    A &quot;Front Controller&quot; to the Rescue
    <a class="headerlink" href="#a-front-controller-to-the-rescue" title="Permalink to this headline">¶</a>
</h2>
<p>The solution is to use a front controller: a single PHP file through which
<em>all</em> requests are processed. With a front controller, the URIs for the
application change slightly, but start to become more flexible:</p>
<div translate="no" class="highlight-text notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs text">Without a front controller
/index.php          =&gt; Blog post list page (index.php executed)
/show.php           =&gt; Blog post show page (show.php executed)

With index.php as the front controller
/index.php          =&gt; Blog post list page (index.php executed)
/index.php/show     =&gt; Blog post show page (index.php executed)</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-tip ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                <span>Tip</span>
    </p><p>By using rewrite rules in your
<a href="../setup/web_server_configuration.html" class="reference internal">web server configuration</a>,
the <code translate="no" class="notranslate">index.php</code> won't be needed and you will have beautiful, clean URLs
(e.g. <code translate="no" class="notranslate">/show</code>).</p>
</div>
<p>When using a front controller, a single PHP file (<code translate="no" class="notranslate">index.php</code> in this case)
renders <em>every</em> request. For the blog post show page, <code translate="no" class="notranslate">/index.php/show</code> will
actually execute the <code translate="no" class="notranslate">index.php</code> file, which is now responsible for routing
requests internally based on the full URI. As you'll see, a front controller
is a very powerful tool.</p>
<div class="section">
<h3 id="creating-the-front-controller">
    Creating the Front Controller
    <a class="headerlink" href="#creating-the-front-controller" title="Permalink to this headline">¶</a>
</h3>
<p>You're about to take a <strong>big</strong> step with the application. With one file handling
all requests, you can centralize things such as security handling, configuration
loading, and routing. In this application, <code translate="no" class="notranslate">index.php</code> must now be smart
enough to render the blog post list page <em>or</em> the blog post show page based
on the requested URI:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// index.php</span>

<span class="hljs-comment">// load and initialize any global libraries</span>
<span class="hljs-keyword">require_once</span> <span class="hljs-string">'model.php'</span>;
<span class="hljs-keyword">require_once</span> <span class="hljs-string">'controllers.php'</span>;

<span class="hljs-comment">// route the request internally</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>uri</span> = parse_url(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>_SERVER</span>[<span class="hljs-string">'REQUEST_URI'</span>], PHP_URL_PATH);
<span class="hljs-keyword">if</span> (<span class="hljs-string">'/index.php'</span> === <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>uri</span>) {
    list_action();
} <span class="hljs-keyword">elseif</span> (<span class="hljs-string">'/index.php/show'</span> === <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>uri</span> &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>_GET</span>[<span class="hljs-string">'id'</span>])) {
    show_action(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>_GET</span>[<span class="hljs-string">'id'</span>]);
} <span class="hljs-keyword">else</span> {
    header(<span class="hljs-string">'HTTP/1.1 404 Not Found'</span>);
    <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;html&gt;&lt;body&gt;&lt;h1&gt;Page Not Found&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;'</span>;
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>For organization, both controllers (formerly <code translate="no" class="notranslate">/index.php</code> and <code translate="no" class="notranslate">/index.php/show</code>)
are now PHP functions and each has been moved into a separate file named <code translate="no" class="notranslate">controllers.php</code>:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// controllers.php</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">list_action</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>posts</span> = get_all_posts();
    <span class="hljs-keyword">require</span> <span class="hljs-string">'templates/list.php'</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show_action</span><span class="hljs-params">(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>id</span>)</span>
</span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>post</span> = get_post_by_id(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>id</span>);
    <span class="hljs-keyword">require</span> <span class="hljs-string">'templates/show.php'</span>;
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>As a front controller, <code translate="no" class="notranslate">index.php</code> has taken on an entirely new role, one
that includes loading the core libraries and routing the application so that
one of the two controllers (the <code translate="no" class="notranslate">list_action()</code> and <code translate="no" class="notranslate">show_action()</code>
functions) is called. In reality, the front controller is beginning to look and
act a lot like how Symfony handles and routes requests.</p>
<p>But be careful not to confuse the terms <em>front controller</em> and <em>controller</em>. Your
app will usually have only <em>one</em> front controller, which boots your code. You will
have <em>many</em> controller functions: one for each page.</p>
<div class="admonition admonition-tip ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                <span>Tip</span>
    </p><p>Another advantage of a front controller is flexible URLs. Notice that
the URL to the blog post show page could be changed from <code translate="no" class="notranslate">/show</code> to <code translate="no" class="notranslate">/read</code>
by changing code in only one location. Before, an entire file needed to
be renamed. In Symfony, URLs are even more flexible.</p>
</div>
<p>By now, the application has evolved from a single PHP file into a structure
that is organized and allows for code reuse. You should be happier, but far
from being satisfied. For example, the routing system is fickle, and wouldn't
recognize that the list page - <code translate="no" class="notranslate">/index.php</code>  - should be accessible also via <code translate="no" class="notranslate">/</code>
(if Apache rewrite rules were added). Also, instead of developing the blog,
a lot of time is being spent working on the &quot;architecture&quot; of the code (e.g.
routing, calling controllers, templates, etc.). More time will need to be
spent to handle form submissions, input validation, logging and security.
Why should you have to reinvent solutions to all these routine problems?</p>
<span id="add-a-touch-of-symfony2"></span>
</div>
<div class="section">
<h3 id="add-a-touch-of-symfony">
    Add a Touch of Symfony
    <a class="headerlink" href="#add-a-touch-of-symfony" title="Permalink to this headline">¶</a>
</h3>
<p>Symfony to the rescue. Before actually using Symfony, you need to download
it. This can be done by using <a href="https://getcomposer.org" class="reference external" rel="external noopener noreferrer" target="_blank">Composer</a>, which takes care of downloading the
correct version and all its dependencies and provides an autoloader. An
autoloader is a tool that makes it possible to start using PHP classes
without explicitly including the file containing the class.</p>
<p>In your root directory, create a <code translate="no" class="notranslate">composer.json</code> file with the following
content:</p>
<div translate="no" class="highlight-json notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs json">{
    <span class="hljs-attr">"require"</span>: {
        <span class="hljs-attr">"symfony/http-foundation"</span>: <span class="hljs-string">"^4.0"</span>
    },
    <span class="hljs-attr">"autoload"</span>: {
        <span class="hljs-attr">"files"</span>: [<span class="hljs-string">"model.php"</span>,<span class="hljs-string">"controllers.php"</span>]
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Next, <a href="https://getcomposer.org/download/" class="reference external" rel="external noopener noreferrer" target="_blank">download Composer</a> and then run the following command, which will download Symfony
into a <code translate="no" class="notranslate">vendor/</code> directory:</p>
<div translate="no" class="highlight-terminal highlight-bash notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs terminal bash"><span class="hljs-prompt">$ </span>composer install</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Beside downloading your dependencies, Composer generates a <code translate="no" class="notranslate">vendor/autoload.php</code> file,
which takes care of autoloading for all the files in the Symfony Framework as well as
the files mentioned in the autoload section of your <code translate="no" class="notranslate">composer.json</code>.</p>
<p>Core to Symfony's philosophy is the idea that an application's main job is
to interpret each request and return a response. To this end, Symfony provides
both a <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpFoundation/Request.php" class="reference external" title="Symfony\Component\HttpFoundation\Request" rel="external noopener noreferrer" target="_blank">Request</a> and a
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpFoundation/Response.php" class="reference external" title="Symfony\Component\HttpFoundation\Response" rel="external noopener noreferrer" target="_blank">Response</a> class. These classes are
object-oriented representations of the raw HTTP request being processed and
the HTTP response being returned. Use them to improve the blog:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// index.php</span>
<span class="hljs-keyword">require_once</span> <span class="hljs-string">'vendor/autoload.php'</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Request</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Response</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span> = Request<span class="hljs-operator">::</span>createFromGlobals();

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>uri</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span><span class="hljs-operator">-&gt;</span>getPathInfo();
<span class="hljs-keyword">if</span> (<span class="hljs-string">'/'</span> === <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>uri</span>) {
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = list_action();
} <span class="hljs-keyword">elseif</span> (<span class="hljs-string">'/show'</span> === <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>uri</span> &amp;&amp; <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span><span class="hljs-operator">-&gt;</span>query<span class="hljs-operator">-&gt;</span>has(<span class="hljs-string">'id'</span>)) {
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = show_action(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span><span class="hljs-operator">-&gt;</span>query<span class="hljs-operator">-&gt;</span>get(<span class="hljs-string">'id'</span>));
} <span class="hljs-keyword">else</span> {
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>html</span> = <span class="hljs-string">'&lt;html&gt;&lt;body&gt;&lt;h1&gt;Page Not Found&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;'</span>;
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span> = <span class="hljs-keyword">new</span> Response(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>html</span>, Response<span class="hljs-operator">::</span>HTTP_NOT_FOUND);
}

<span class="hljs-comment">// echo the headers and send the response</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>response</span><span class="hljs-operator">-&gt;</span>send();</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>The controllers are now responsible for returning a <code translate="no" class="notranslate">Response</code> object.
To make this easier, you can add a new <code translate="no" class="notranslate">render_template()</code> function, which,
incidentally, acts quite a bit like the Symfony templating engine:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// controllers.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Response</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">list_action</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>posts</span> = get_all_posts();
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>html</span> = render_template(<span class="hljs-string">'templates/list.php'</span>, [<span class="hljs-string">'posts'</span> =&gt; <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>posts</span>]);

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Response(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>html</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show_action</span><span class="hljs-params">(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>id</span>)</span>
</span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>post</span> = get_post_by_id(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>id</span>);
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>html</span> = render_template(<span class="hljs-string">'templates/show.php'</span>, [<span class="hljs-string">'post'</span> =&gt; <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>post</span>]);

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Response(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>html</span>);
}

<span class="hljs-comment">// helper function to render templates</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render_template</span><span class="hljs-params">(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>path</span>, array <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>args</span>)</span>
</span>{
    extract(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>args</span>);
    ob_start();
    <span class="hljs-keyword">require</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>path</span>;
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>html</span> = ob_get_clean();

    <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>html</span>;
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>By bringing in a small part of Symfony, the application is more flexible and
reliable. The <code translate="no" class="notranslate">Request</code> provides a dependable way to access information
about the HTTP request. Specifically, the
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpFoundation/Request.php#method_getPathInfo" class="reference external" title="Symfony\Component\HttpFoundation\Request::getPathInfo()" rel="external noopener noreferrer" target="_blank">getPathInfo()</a> method returns
a cleaned URI (always returning <code translate="no" class="notranslate">/show</code> and never <code translate="no" class="notranslate">/index.php/show</code>).
So, even if the user goes to <code translate="no" class="notranslate">/index.php/show</code>, the application is intelligent
enough to route the request through <code translate="no" class="notranslate">show_action()</code>.</p>
<p>The <code translate="no" class="notranslate">Response</code> object gives flexibility when constructing the HTTP response,
allowing HTTP headers and content to be added via an object-oriented interface.
And while the responses in this application are simple, this flexibility
will pay dividends as your application grows.</p>
<span id="the-sample-application-in-symfony2"></span>
</div>
<div class="section">
<h3 id="the-sample-application-in-symfony">
    The Sample Application in Symfony
    <a class="headerlink" href="#the-sample-application-in-symfony" title="Permalink to this headline">¶</a>
</h3>
<p>The blog has come a <em>long</em> way, but it still contains a lot of code for such
a basic application. Along the way, you've made a basic routing system and
a function using <code translate="no" class="notranslate">ob_start()</code> and <code translate="no" class="notranslate">ob_get_clean()</code> to render templates.
If, for some reason, you needed to continue building this &quot;framework&quot; from
scratch, you could at least use Symfony's standalone <a href="../routing.html" class="reference internal">Routing</a>
component and <a href="../templates.html" class="reference internal">Twig</a>, which already solve these problems.</p>
<p>Instead of re-solving common problems, you can let Symfony take care of
them for you. Here's the same sample application, now built in Symfony:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Controller/BlogController.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Controller</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Entity</span>\<span class="hljs-title">Post</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">Persistence</span>\<span class="hljs-title">ManagerRegistry</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Bundle</span>\<span class="hljs-title">FrameworkBundle</span>\<span class="hljs-title">Controller</span>\<span class="hljs-title">AbstractController</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BlogController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractController</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">list</span><span class="hljs-params">(ManagerRegistry <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>doctrine</span>)</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>posts</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>doctrine</span><span class="hljs-operator">-&gt;</span>getRepository(Post<span class="hljs-operator">::</span>class)<span class="hljs-operator">-&gt;</span>findAll();

        <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>render(<span class="hljs-string">'blog/list.html.twig'</span>, [<span class="hljs-string">'posts'</span> =&gt; <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>posts</span>]);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show</span><span class="hljs-params">(ManagerRegistry <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>doctrine</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>id</span>)</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>post</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>doctrine</span><span class="hljs-operator">-&gt;</span>getRepository(Post<span class="hljs-operator">::</span>class)<span class="hljs-operator">-&gt;</span>find(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>id</span>);

        <span class="hljs-keyword">if</span> (!<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>post</span>) {
            <span class="hljs-comment">// cause the 404 page not found to be displayed</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>createNotFoundException();
        }

        <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>render(<span class="hljs-string">'blog/show.html.twig'</span>, [<span class="hljs-string">'post'</span> =&gt; <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>post</span>]);
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Notice, both controller functions now live inside a &quot;controller class&quot;. This is a
nice way to group related pages. The controller functions are also sometimes called
<em>actions</em>.</p>
<p>The two controllers (or actions) are still lightweight. Each uses the
<a href="../doctrine.html" class="reference internal">Doctrine ORM library</a> to retrieve objects from the
database and the Templating component to render a template and return a
<code translate="no" class="notranslate">Response</code> object. The <code translate="no" class="notranslate">list.html.twig</code> template is now quite a bit simpler,
and uses Twig:</p>
<div translate="no" class="highlight-html+twig highlight-twig notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs html+twig twig"><span class="hljs-comment">{# templates/blog/list.html.twig #}</span><span class="xml">
</span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-keyword">extends</span></span> 'base.html.twig' %}</span><span class="xml">

</span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-keyword">block</span></span> title %}</span><span class="xml">List of Posts</span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-keyword">endblock</span></span> %}</span><span class="xml">

</span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-keyword">block</span></span> body %}</span><span class="xml">
<span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>List of Posts<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
    </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-keyword">for</span></span> post in posts %}</span><span class="xml">
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"</span></span></span><span class="hljs-template-variable">{{ path('blog_show', { id: post.id }) }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span>&gt;</span>
            </span><span class="hljs-template-variable">{{ post.title }}</span><span class="xml">
        <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-keyword">endfor</span></span> %}</span><span class="xml">
<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
</span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-keyword">endblock</span></span> %}</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>The <code translate="no" class="notranslate">layout.php</code> file is nearly identical:</p>
<div translate="no" class="highlight-html+twig highlight-twig notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs html+twig twig"><span class="xml"><span class="hljs-comment">&lt;!-- templates/base.html.twig --&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span></span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-keyword">block</span></span> title %}</span><span class="xml">Welcome!</span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-keyword">endblock</span></span> %}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
        </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-keyword">block</span></span> stylesheets %}</span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-keyword">endblock</span></span> %}</span><span class="xml">
        </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-keyword">block</span></span> javascripts %}</span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-keyword">endblock</span></span> %}</span><span class="xml">
    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-keyword">block</span></span> body %}</span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-keyword">endblock</span></span> %}</span><span class="xml">
    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>The <code translate="no" class="notranslate">show.html.twig</code> template is left as an exercise: updating it should be
really similar to updating the <code translate="no" class="notranslate">list.html.twig</code> template.</p>
</div>
<p>When Symfony's engine (called the Kernel) boots up, it needs a map so
that it knows which controllers to call based on the request information.
A routing configuration map - <code translate="no" class="notranslate">config/routes.yaml</code> - provides this information
in a readable format:</p>
<div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/routes.yaml</span>
<span class="hljs-attr">blog_list:</span>
    <span class="hljs-attr">path:</span>     <span class="hljs-string">/blog</span>
    <span class="hljs-attr">controller:</span> <span class="hljs-string">App\Controller\BlogController::list</span>

<span class="hljs-attr">blog_show:</span>
    <span class="hljs-attr">path:</span>     <span class="hljs-string">/blog/show/{id}</span>
    <span class="hljs-attr">controller:</span> <span class="hljs-string">App\Controller\BlogController::show</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Now that Symfony is handling all the mundane tasks, the front controller
<code translate="no" class="notranslate">public/index.php</code> is reduced to bootstrapping. And since it does so little, you'll never
have to touch it:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// public/index.php</span>
<span class="hljs-keyword">require_once</span> <span class="hljs-keyword">__DIR__</span>.<span class="hljs-string">'/../app/bootstrap.php'</span>;
<span class="hljs-keyword">require_once</span> <span class="hljs-keyword">__DIR__</span>.<span class="hljs-string">'/../src/Kernel.php'</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Request</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>kernel</span> = <span class="hljs-keyword">new</span> Kernel(<span class="hljs-string">'prod'</span>, <span class="hljs-keyword">false</span>);
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>kernel</span><span class="hljs-operator">-&gt;</span>handle(Request<span class="hljs-operator">::</span>createFromGlobals())<span class="hljs-operator">-&gt;</span>send();</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>The front controller's only job is to initialize Symfony's engine (called the
Kernel) and pass it a <code translate="no" class="notranslate">Request</code> object to handle. The Symfony core
asks the router to inspect the request. The router matches the incoming URL
to a specific route and returns information about the route, including the
controller that should be called. The correct controller from the matched
route is called and your code inside the controller creates and returns the
appropriate <code translate="no" class="notranslate">Response</code> object. The HTTP headers and content of the <code translate="no" class="notranslate">Response</code>
object are sent back to the client.</p>
<p>It's a beautiful thing.</p>
<object data="../_images/http/request-flow.svg" type="image/svg+xml"></object>
</div>
</div>
<div class="section">
<h2 id="where-symfony-delivers">
    Where Symfony Delivers
    <a class="headerlink" href="#where-symfony-delivers" title="Permalink to this headline">¶</a>
</h2>
<p>In the rest of the documentation articles, you'll learn more about how each piece of
Symfony works and how you can organize your project. For now, celebrate how
migrating the blog from flat PHP to Symfony has improved your life:</p>
<ul>
    <li>Your application now has <strong>clear and consistently organized code</strong> (though
Symfony doesn't force you into this). This promotes <strong>reusability</strong> and
allows for new developers to be productive in your project more quickly;</li>
<li>100% of the code you write is for <em>your</em> application. You <strong>don't need
to develop or maintain low-level utilities</strong> such as autoloading,
<a href="../routing.html" class="reference internal">routing</a>, or rendering <a href="../controller.html" class="reference internal">controllers</a>;</li>
<li>Symfony gives you <strong>access to open source tools</strong> such as <a href="https://www.doctrine-project.org/" class="reference external" rel="external noopener noreferrer" target="_blank">Doctrine</a> and the
<a href="https://github.com/symfony/templating" class="reference external" rel="external noopener noreferrer" target="_blank">Templating</a>, <a href="../security.html" class="reference internal">Security</a>, <a href="../components/form.html" class="reference internal">Form</a>,
<a href="https://github.com/symfony/validator" class="reference external" rel="external noopener noreferrer" target="_blank">Validator</a> and <a href="https://github.com/symfony/translation" class="reference external" rel="external noopener noreferrer" target="_blank">Translation</a> components (to name a few);</li>
<li>The application now enjoys <strong>fully-flexible URLs</strong> thanks to the Routing
component;</li>
<li>Symfony's HTTP-centric architecture gives you access to powerful tools
such as <strong>HTTP caching</strong> powered by <strong>Symfony's internal HTTP cache</strong> or
more powerful tools such as <a href="https://varnish-cache.org/" class="reference external" rel="external noopener noreferrer" target="_blank">Varnish</a>. This is covered in another article
all about <a href="../http_cache.html" class="reference internal">caching</a>.</li>
</ul>
<p>And perhaps best of all, by using Symfony, you now have access to a whole
set of <strong>high-quality open source tools developed by the Symfony community</strong>!
A good selection of <a href="https://github.com/search?q=topic%3Asymfony-bundle&type=Repositories" class="reference external" rel="external noopener noreferrer" target="_blank">Symfony community tools</a> can be found on GitHub.</p>
</div>
</div>

                            </div>                    </div>
                                    </div>        </div>

    </section>

</div>


<script type="text/javascript" src="assets/js/theme.js"></script>
<script type="text/javascript" src="assets/js/badge_only.js"></script>

 
</body>
</html>