        
<!DOCTYPE html>
<!--[if IE 8]>
<html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en"> <!--<![endif]-->
<head><base href="/">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
            
                                
    
    <link rel="stylesheet" href="assets/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/highlightjs.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/badge_only.css" type="text/css" />

</head>

<body class="wy-body-for-nav">
 <div class="wy-grid-for-nav">

        <nav data-toggle="wy-nav-shift" class="wy-nav-side">
        <div class="wy-side-scroll">
            <div class="wy-side-nav-search">
                
                                                                                                    
                                                                                                                                                                        </div>

            <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                                                                                                                                                                                                                                                                                                                            </div>
        </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

                                                        

        <div class="wy-nav-content">                <div class="rst-content">
                                        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">                            <div itemprop="articleBody">
                                    <div class="section">
<h1 id="how-to-embed-a-collection-of-forms">
    How to Embed a Collection of Forms
    <a class="headerlink" href="#how-to-embed-a-collection-of-forms" title="Permalink to this headline">¶</a>
</h1>
<p>Symfony Forms can embed a collection of many other forms, which is useful to
edit related entities in a single form. In this article, you'll create a form to
edit a <code translate="no" class="notranslate">Task</code> class and, right inside the same form, you'll be able to edit,
create and remove many <code translate="no" class="notranslate">Tag</code> objects related to that Task.</p>
<p>Let's start by creating a <code translate="no" class="notranslate">Task</code> entity:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Entity/Task.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Entity</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">Common</span>\<span class="hljs-title">Collections</span>\<span class="hljs-title">ArrayCollection</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">Common</span>\<span class="hljs-title">Collections</span>\<span class="hljs-title">Collection</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Task</span>
</span>{
    <span class="hljs-keyword">protected</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>description</span>;
    <span class="hljs-keyword">protected</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>tags</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>tags = <span class="hljs-keyword">new</span> ArrayCollection();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getDescription</span><span class="hljs-params">()</span>: <span class="hljs-title">string</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>description;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setDescription</span><span class="hljs-params">(string <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>description</span>)</span>: <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>description = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>description</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getTags</span><span class="hljs-params">()</span>: <span class="hljs-title">Collection</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>tags;
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>The <a href="https://www.doctrine-project.org/projects/doctrine-collections/en/1.6/index.html" class="reference external" rel="external noopener noreferrer" target="_blank">ArrayCollection</a> is specific to Doctrine and is similar to a PHP array
but provides many utility methods.</p>
</div>
<p>Now, create a <code translate="no" class="notranslate">Tag</code> class. As you saw above, a <code translate="no" class="notranslate">Task</code> can have many <code translate="no" class="notranslate">Tag</code>
objects:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Entity/Tag.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Entity</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Tag</span>
</span>{
    <span class="hljs-keyword">private</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>name</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getName</span><span class="hljs-params">()</span>: <span class="hljs-title">string</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setName</span><span class="hljs-params">(string <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>name</span>)</span>: <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>name = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>name</span>;
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Then, create a form class so that a <code translate="no" class="notranslate">Tag</code> object can be modified by the user:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Form/TagType.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Form</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Entity</span>\<span class="hljs-title">Tag</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">AbstractType</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">FormBuilderInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">OptionsResolver</span>\<span class="hljs-title">OptionsResolver</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TagType</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractType</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buildForm</span><span class="hljs-params">(FormBuilderInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span>, array <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>options</span>)</span>: <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span><span class="hljs-operator">-&gt;</span>add(<span class="hljs-string">'name'</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">configureOptions</span><span class="hljs-params">(OptionsResolver <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>resolver</span>)</span>: <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>resolver</span><span class="hljs-operator">-&gt;</span>setDefaults([
            <span class="hljs-string">'data_class'</span> =&gt; Tag<span class="hljs-operator">::</span>class,
        ]);
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Next, let's create a form for the <code translate="no" class="notranslate">Task</code> entity, using a
<a href="../reference/forms/types/collection.html" class="reference internal">CollectionType</a> field of <code translate="no" class="notranslate">TagType</code>
forms. This will allow us to modify all the <code translate="no" class="notranslate">Tag</code> elements of a <code translate="no" class="notranslate">Task</code> right
inside the task form itself:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Form/TaskType.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Form</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Entity</span>\<span class="hljs-title">Task</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">AbstractType</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">Extension</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">Type</span>\<span class="hljs-title">CollectionType</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">FormBuilderInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">OptionsResolver</span>\<span class="hljs-title">OptionsResolver</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TaskType</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractType</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buildForm</span><span class="hljs-params">(FormBuilderInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span>, array <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>options</span>)</span>: <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span><span class="hljs-operator">-&gt;</span>add(<span class="hljs-string">'description'</span>);

        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span><span class="hljs-operator">-&gt;</span>add(<span class="hljs-string">'tags'</span>, CollectionType<span class="hljs-operator">::</span>class, [
            <span class="hljs-string">'entry_type'</span> =&gt; TagType<span class="hljs-operator">::</span>class,
            <span class="hljs-string">'entry_options'</span> =&gt; [<span class="hljs-string">'label'</span> =&gt; <span class="hljs-keyword">false</span>],
        ]);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">configureOptions</span><span class="hljs-params">(OptionsResolver <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>resolver</span>)</span>: <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>resolver</span><span class="hljs-operator">-&gt;</span>setDefaults([
            <span class="hljs-string">'data_class'</span> =&gt; Task<span class="hljs-operator">::</span>class,
        ]);
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>In your controller, you'll create a new form from the <code translate="no" class="notranslate">TaskType</code>:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Controller/TaskController.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Controller</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Entity</span>\<span class="hljs-title">Tag</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Entity</span>\<span class="hljs-title">Task</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">TaskType</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Bundle</span>\<span class="hljs-title">FrameworkBundle</span>\<span class="hljs-title">Controller</span>\<span class="hljs-title">AbstractController</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Request</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Response</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TaskController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractController</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">new</span><span class="hljs-params">(Request <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span>)</span>: <span class="hljs-title">Response</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>task</span> = <span class="hljs-keyword">new</span> Task();

        <span class="hljs-comment">// dummy code - add some example tags to the task</span>
        <span class="hljs-comment">// (otherwise, the template will render an empty list of tags)</span>
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>tag1</span> = <span class="hljs-keyword">new</span> Tag();
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>tag1</span><span class="hljs-operator">-&gt;</span>setName(<span class="hljs-string">'tag1'</span>);
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>task</span><span class="hljs-operator">-&gt;</span>getTags()<span class="hljs-operator">-&gt;</span>add(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>tag1</span>);
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>tag2</span> = <span class="hljs-keyword">new</span> Tag();
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>tag2</span><span class="hljs-operator">-&gt;</span>setName(<span class="hljs-string">'tag2'</span>);
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>task</span><span class="hljs-operator">-&gt;</span>getTags()<span class="hljs-operator">-&gt;</span>add(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>tag2</span>);
        <span class="hljs-comment">// end dummy code</span>

        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>form</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>createForm(TaskType<span class="hljs-operator">::</span>class, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>task</span>);

        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>form</span><span class="hljs-operator">-&gt;</span>handleRequest(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span>);

        <span class="hljs-keyword">if</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>form</span><span class="hljs-operator">-&gt;</span>isSubmitted() &amp;&amp; <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>form</span><span class="hljs-operator">-&gt;</span>isValid()) {
            <span class="hljs-comment">// ... do your form processing, like saving the Task and Tag entities</span>
        }

        <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>render(<span class="hljs-string">'task/new.html.twig'</span>, [
            <span class="hljs-string">'form'</span> =&gt; <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>form</span>,
        ]);
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>In the template, you can now iterate over the existing <code translate="no" class="notranslate">TagType</code> forms
to render them:</p>
<div translate="no" class="highlight-html+twig highlight-twig notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs html+twig twig"><span class="hljs-comment">{# templates/task/new.html.twig #}</span><span class="xml">

</span><span class="hljs-comment">{# ... #}</span><span class="xml">

</span><span class="hljs-template-variable">{{ form_start(form) }}</span><span class="xml">
    </span><span class="hljs-template-variable">{{ form_row(form.description) }}</span><span class="xml">

    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>Tags<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tags"</span>&gt;</span>
        </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-keyword">for</span></span> tag in form.tags %}</span><span class="xml">
            <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span></span><span class="hljs-template-variable">{{ form_row(tag.name) }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-keyword">endfor</span></span> %}</span><span class="xml">
    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
</span><span class="hljs-template-variable">{{ form_end(form) }}</span><span class="xml">

</span><span class="hljs-comment">{# ... #}</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>When the user submits the form, the submitted data for the <code translate="no" class="notranslate">tags</code> field is
used to construct an <code translate="no" class="notranslate">ArrayCollection</code> of <code translate="no" class="notranslate">Tag</code> objects. The collection is
then set on the <code translate="no" class="notranslate">tag</code> field of the <code translate="no" class="notranslate">Task</code> and can be accessed via <code translate="no" class="notranslate">$task-&gt;getTags()</code>.</p>
<p>So far, this works great, but only to edit <em>existing</em> tags. It doesn't allow us
yet to add new tags or delete existing ones.</p>
<div class="admonition admonition-caution ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                <span>Caution</span>
    </p><p>You can embed nested collections as many levels down as you like. However,
if you use Xdebug, you may receive a <code translate="no" class="notranslate">Maximum function nesting level of &#039;100&#039;
reached, aborting!</code> error. To fix this, increase the <code translate="no" class="notranslate">xdebug.max_nesting_level</code>
PHP setting, or render each form field by hand using <code translate="no" class="notranslate">form_row()</code> instead of
rendering the whole form at once (e.g <code translate="no" class="notranslate">form_widget(form)</code>).</p>
</div>
<span id="form-collections-new-prototype"></span>
<div class="section">
<h2 id="allowing-new-tags-with-the-prototype">
    Allowing &quot;new&quot; Tags with the &quot;Prototype&quot;
    <a class="headerlink" href="#allowing-new-tags-with-the-prototype" title="Permalink to this headline">¶</a>
</h2>
<p>Previously you added two tags to your task in the controller. Now let the users
add as many tag forms as they need directly in the browser. This requires a bit
of JavaScript code.</p>
<p>But first, you need to let the form collection know that instead of exactly two,
it will receive an <em>unknown</em> number of tags. Otherwise, you'll see a
<em>&quot;This form should not contain extra fields&quot;</em> error. This is done with the
<code translate="no" class="notranslate">allow_add</code> option:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Form/TaskType.php</span>

<span class="hljs-comment">// ...</span>

<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buildForm</span><span class="hljs-params">(FormBuilderInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span>, array <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>options</span>)</span>: <span class="hljs-title">void</span>
</span>{
    <span class="hljs-comment">// ...</span>

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span><span class="hljs-operator">-&gt;</span>add(<span class="hljs-string">'tags'</span>, CollectionType<span class="hljs-operator">::</span>class, [
        <span class="hljs-string">'entry_type'</span> =&gt; TagType<span class="hljs-operator">::</span>class,
        <span class="hljs-string">'entry_options'</span> =&gt; [<span class="hljs-string">'label'</span> =&gt; <span class="hljs-keyword">false</span>],
        <span class="hljs-string">'allow_add'</span> =&gt; <span class="hljs-keyword">true</span>,
    ]);
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>The <code translate="no" class="notranslate">allow_add</code> option also makes a <code translate="no" class="notranslate">prototype</code> variable available to you.
This &quot;prototype&quot; is a little &quot;template&quot; that contains all the HTML needed to
dynamically create any new &quot;tag&quot; forms with JavaScript.</p>
<p>Let's start with plain JavaScript (Vanilla JS) – if you're using Stimulus, see below.</p>
<p>To render the prototype, add
the following <code translate="no" class="notranslate">data-prototype</code> attribute to the existing <code translate="no" class="notranslate">&lt;ul&gt;</code> in your
template:</p>
<div translate="no" class="highlight-html+twig highlight-twig notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs html+twig twig"><span class="hljs-comment">{# the data-index attribute is required for the JavaScript code below #}</span><span class="xml">
<span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tags"</span>
    <span class="hljs-attr">data-index</span>=<span class="hljs-string">"</span></span></span><span class="hljs-template-variable">{{ form.tags|<span class="hljs-keyword">length</span> &gt; 0 ? form.tags|<span class="hljs-keyword">last</span>.vars.name + 1 : 0 }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span>
    <span class="hljs-attr">data-prototype</span>=<span class="hljs-string">"</span></span></span><span class="hljs-template-variable">{{ form_widget(form.tags.vars.prototype)|e('html_attr') }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span>
&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>On the rendered page, the result will look something like this:</p>
<div translate="no" class="highlight-html notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tags"</span>
    <span class="hljs-attr">data-index</span>=<span class="hljs-string">"0"</span>
    <span class="hljs-attr">data-prototype</span>=<span class="hljs-string">"<span class="hljs-symbol">&amp;lt;</span>div<span class="hljs-symbol">&amp;gt;</span><span class="hljs-symbol">&amp;lt;</span>label class=<span class="hljs-symbol">&amp;quot;</span> required<span class="hljs-symbol">&amp;quot;</span><span class="hljs-symbol">&amp;gt;</span>__name__<span class="hljs-symbol">&amp;lt;</span>/label<span class="hljs-symbol">&amp;gt;</span><span class="hljs-symbol">&amp;lt;</span>div id=<span class="hljs-symbol">&amp;quot;</span>task_tags___name__<span class="hljs-symbol">&amp;quot;</span><span class="hljs-symbol">&amp;gt;</span><span class="hljs-symbol">&amp;lt;</span>div<span class="hljs-symbol">&amp;gt;</span><span class="hljs-symbol">&amp;lt;</span>label for=<span class="hljs-symbol">&amp;quot;</span>task_tags___name___name<span class="hljs-symbol">&amp;quot;</span> class=<span class="hljs-symbol">&amp;quot;</span> required<span class="hljs-symbol">&amp;quot;</span><span class="hljs-symbol">&amp;gt;</span>Name<span class="hljs-symbol">&amp;lt;</span>/label<span class="hljs-symbol">&amp;gt;</span><span class="hljs-symbol">&amp;lt;</span>input type=<span class="hljs-symbol">&amp;quot;</span>text<span class="hljs-symbol">&amp;quot;</span> id=<span class="hljs-symbol">&amp;quot;</span>task_tags___name___name<span class="hljs-symbol">&amp;quot;</span> name=<span class="hljs-symbol">&amp;quot;</span>task[tags][__name__][name]<span class="hljs-symbol">&amp;quot;</span> required=<span class="hljs-symbol">&amp;quot;</span>required<span class="hljs-symbol">&amp;quot;</span> maxlength=<span class="hljs-symbol">&amp;quot;</span>255<span class="hljs-symbol">&amp;quot;</span> /<span class="hljs-symbol">&amp;gt;</span><span class="hljs-symbol">&amp;lt;</span>/div<span class="hljs-symbol">&amp;gt;</span><span class="hljs-symbol">&amp;lt;</span>/div<span class="hljs-symbol">&amp;gt;</span><span class="hljs-symbol">&amp;lt;</span>/div<span class="hljs-symbol">&amp;gt;</span>"</span>
&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Now add a button to dynamically add a new tag:</p>
<div translate="no" class="highlight-html+twig highlight-twig notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs html+twig twig"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"add_item_link"</span> <span class="hljs-attr">data-collection-holder-class</span>=<span class="hljs-string">"tags"</span>&gt;</span>Add a tag<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-seealso ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" /></svg>
                <span>See also</span>
    </p><p>If you want to customize the HTML code in the prototype, see
<a href="form_themes.html#form-custom-prototype" class="reference internal">How to Work with Form Themes</a>.</p>
</div>
<div class="admonition admonition-tip ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                <span>Tip</span>
    </p><p>The <code translate="no" class="notranslate">form.tags.vars.prototype</code> is a form element that looks and feels just
like the individual <code translate="no" class="notranslate">form_widget(tag.*)</code> elements inside your <code translate="no" class="notranslate">for</code> loop.
This means that you can call <code translate="no" class="notranslate">form_widget()</code>, <code translate="no" class="notranslate">form_row()</code> or <code translate="no" class="notranslate">form_label()</code>
on it. You could even choose to render only one of its fields (e.g. the
<code translate="no" class="notranslate">name</code> field):</p>
<div translate="no" class="highlight-twig notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs twig"><span class="hljs-template-variable">{{ form_widget(form.tags.vars.prototype.name)|e }}</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>If you render your whole &quot;tags&quot; sub-form at once (e.g. <code translate="no" class="notranslate">form_row(form.tags)</code>),
the <code translate="no" class="notranslate">data-prototype</code> attribute is automatically added to the containing <code translate="no" class="notranslate">div</code>,
and you need to adjust the following JavaScript accordingly.</p>
</div>
<p>Now add some JavaScript to read this attribute and dynamically add new tag forms
when the user clicks the &quot;Add a tag&quot; link. Add a <code translate="no" class="notranslate">&lt;script&gt;</code> tag somewhere
on your page to include the required functionality with JavaScript:</p>
<div translate="no" class="highlight-javascript notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs javascript"><span class="hljs-built_in">document</span>
  .querySelectorAll(<span class="hljs-string">'.add_item_link'</span>)
  .forEach(<span class="hljs-function"><span class="hljs-params">btn</span> =&gt;</span> {
      btn.addEventListener(<span class="hljs-string">"click"</span>, addFormToCollection)
  });</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>The <code translate="no" class="notranslate">addFormToCollection()</code> function's job will be to use the <code translate="no" class="notranslate">data-prototype</code>
attribute to dynamically add a new form when this link is clicked. The <code translate="no" class="notranslate">data-prototype</code>
HTML contains the tag's <code translate="no" class="notranslate">text</code> input element with a name of <code translate="no" class="notranslate">task[tags][__name__][name]</code>
and id of <code translate="no" class="notranslate">task_tags___name___name</code>. The <code translate="no" class="notranslate">__name__</code> is a placeholder, which
you'll replace with a unique, incrementing number (e.g. <code translate="no" class="notranslate">task[tags][3][name]</code>):</p>
<div translate="no" class="highlight-javascript notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs javascript"><span class="hljs-keyword">const</span> addFormToCollection = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> collectionHolder = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'.'</span> + e.currentTarget.dataset.collectionHolderClass);

  <span class="hljs-keyword">const</span> item = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'li'</span>);

  item.innerHTML = collectionHolder
    .dataset
    .prototype
    .replace(
      <span class="hljs-regexp">/__name__/g</span>,
      collectionHolder.dataset.index
    );

  collectionHolder.appendChild(item);

  collectionHolder.dataset.index++;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Now, each time a user clicks the <code translate="no" class="notranslate">Add a tag</code> link, a new sub form will
appear on the page. When the form is submitted, any new tag forms will be converted
into new <code translate="no" class="notranslate">Tag</code> objects and added to the <code translate="no" class="notranslate">tags</code> property of the <code translate="no" class="notranslate">Task</code> object.</p>
<div class="admonition admonition-seealso ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" /></svg>
                <span>See also</span>
    </p><p>You can find a working example in this <a href="https://jsfiddle.net/ey8ozh6n/" class="reference external" rel="external noopener noreferrer" target="_blank">JSFiddle</a>.</p>
</div>
<div class="section">
<h3 id="javascript-with-stimulus">
    JavaScript with Stimulus
    <a class="headerlink" href="#javascript-with-stimulus" title="Permalink to this headline">¶</a>
</h3>
<p>If you're using <a href="https://symfony.com/doc/current/frontend/encore/simple-example.html#stimulus-symfony-ux" class="reference external">Stimulus</a>, wrap everything in a <code translate="no" class="notranslate">&lt;div&gt;</code>:</p>
<div translate="no" class="highlight-html+twig highlight-twig notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs html+twig twig"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> </span></span><span class="hljs-template-variable">{{ stimulus_controller('form-collection') }}</span><span class="xml"><span class="hljs-tag">
    <span class="hljs-attr">data-form-collection-index-value</span>=<span class="hljs-string">"</span></span></span><span class="hljs-template-variable">{{ form.tags|<span class="hljs-keyword">length</span> &gt; 0 ? form.tags|<span class="hljs-keyword">last</span>.vars.name + 1 : 0 }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span>
    <span class="hljs-attr">data-form-collection-prototype-value</span>=<span class="hljs-string">"</span></span></span><span class="hljs-template-variable">{{ form_widget(form.tags.vars.prototype)|e('html_attr') }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span>
&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> </span></span><span class="hljs-template-variable">{{ stimulus_target('form-collection', 'collectionContainer') }}</span><span class="xml"><span class="hljs-tag">&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> </span></span><span class="hljs-template-variable">{{ stimulus_action('form-collection', 'addCollectionElement') }}</span><span class="xml"><span class="hljs-tag">&gt;</span>Add a tag<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Then create the controller:</p>
<div translate="no" class="highlight-javascript notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs javascript"><span class="hljs-comment">// assets/controllers/form-collection_controller.js</span>

<span class="hljs-keyword">import</span> { Controller } <span class="hljs-keyword">from</span> <span class="hljs-string">'@hotwired/stimulus'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span> </span>{
    <span class="hljs-keyword">static</span> targets = [<span class="hljs-string">"collectionContainer"</span>]

    <span class="hljs-keyword">static</span> values = {
        <span class="hljs-attr">index</span>    : <span class="hljs-built_in">Number</span>,
        <span class="hljs-attr">prototype</span>: <span class="hljs-built_in">String</span>,
    }

    addCollectionElement(event)
    {
        <span class="hljs-keyword">const</span> item = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'li'</span>);
        item.innerHTML = <span class="hljs-keyword">this</span>.prototypeValue.replace(<span class="hljs-regexp">/__name__/g</span>, <span class="hljs-keyword">this</span>.indexValue);
        <span class="hljs-keyword">this</span>.collectionContainerTarget.appendChild(item);
        <span class="hljs-keyword">this</span>.indexValue++;           
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
<div class="section">
<h3 id="handling-the-new-tags-in-php">
    Handling the new Tags in PHP
    <a class="headerlink" href="#handling-the-new-tags-in-php" title="Permalink to this headline">¶</a>
</h3>
<p>To make handling these new tags easier, add an &quot;adder&quot; and a &quot;remover&quot; method
for the tags in the <code translate="no" class="notranslate">Task</code> class:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Entity/Task.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Entity</span>;

<span class="hljs-comment">// ...</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Task</span>
</span>{
    <span class="hljs-comment">// ...</span>

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addTag</span><span class="hljs-params">(Tag <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>tag</span>)</span>: <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>tags<span class="hljs-operator">-&gt;</span>add(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>tag</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removeTag</span><span class="hljs-params">(Tag <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>tag</span>)</span>: <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-comment">// ...</span>
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Next, add a <code translate="no" class="notranslate">by_reference</code> option to the <code translate="no" class="notranslate">tags</code> field and set it to <code translate="no" class="notranslate">false</code>:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Form/TaskType.php</span>

<span class="hljs-comment">// ...</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buildForm</span><span class="hljs-params">(FormBuilderInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span>, array <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>options</span>)</span>: <span class="hljs-title">void</span>
</span>{
    <span class="hljs-comment">// ...</span>

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span><span class="hljs-operator">-&gt;</span>add(<span class="hljs-string">'tags'</span>, CollectionType<span class="hljs-operator">::</span>class, [
        <span class="hljs-comment">// ...</span>
        <span class="hljs-string">'by_reference'</span> =&gt; <span class="hljs-keyword">false</span>,
    ]);
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>With these two changes, when the form is submitted, each new <code translate="no" class="notranslate">Tag</code> object
is added to the <code translate="no" class="notranslate">Task</code> class by calling the <code translate="no" class="notranslate">addTag()</code> method. Before this
change, they were added internally by the form by calling <code translate="no" class="notranslate">$task-&gt;getTags()-&gt;add($tag)</code>.
That was fine, but forcing the use of the &quot;adder&quot; method makes handling
these new <code translate="no" class="notranslate">Tag</code> objects easier (especially if you're using Doctrine, which
you will learn about next!).</p>
<div class="admonition admonition-caution ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                <span>Caution</span>
    </p><p>You have to create <strong>both</strong> <code translate="no" class="notranslate">addTag()</code> and <code translate="no" class="notranslate">removeTag()</code> methods,
otherwise the form will still use <code translate="no" class="notranslate">setTag()</code> even if <code translate="no" class="notranslate">by_reference</code> is <code translate="no" class="notranslate">false</code>.
You'll learn more about the <code translate="no" class="notranslate">removeTag()</code> method later in this article.</p>
</div>
<div class="admonition admonition-caution ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                <span>Caution</span>
    </p><p>Symfony can only make the plural-to-singular conversion (e.g. from the
<code translate="no" class="notranslate">tags</code> property to the <code translate="no" class="notranslate">addTag()</code> method) for English words. Code
written in any other language won't work as expected.</p>
</div>
<div class="admonition-wrapper"><div class="admonition admonition-sidebar"><p class="sidebar-title"><span>Doctrine: Cascading Relations and saving the &quot;Inverse&quot; side</span></p><p>To save the new tags with Doctrine, you need to consider a couple more
things. First, unless you iterate over all of the new <code translate="no" class="notranslate">Tag</code> objects and
call <code translate="no" class="notranslate">$entityManager-&gt;persist($tag)</code> on each, you'll receive an error from
Doctrine:</p>
<div translate="no" class="highlight-text notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs text">A new entity was found through the relationship
``App\Entity\Task#tags`` that was not configured to
cascade persist operations for entity...</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>To fix this, you may choose to &quot;cascade&quot; the persist operation automatically
from the <code translate="no" class="notranslate">Task</code> object to any related tags. To do this, add the <code translate="no" class="notranslate">cascade</code>
option to your <code translate="no" class="notranslate">ManyToMany</code> metadata:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="php-attributes"
                aria-controls="configuration-block-tabpanel-5ad7afe7eb0c946a057462354d775f06b2135e1b" aria-selected="true"
                data-active="true" >
                <span>Attributes</span>
            </button>
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-786154c8e1d3fb7258249852676ba89b90a6c77e" aria-selected="false"
                 tabindex="-1">
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-4d76d2cb91ecc605016a3d87c2a53f622df76c75" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-5ad7afe7eb0c946a057462354d775f06b2135e1b" aria-label="Attributes" class="configuration-codeblock" data-language="php-attributes" style="">
            <div translate="no" class="highlight-php-attributes highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php-attributes php"><span class="hljs-comment">// src/Entity/Task.php</span>

<span class="hljs-comment">// ...</span>

<span class="hljs-comment">#[ORM\ManyToMany(targetEntity: Tag::class, cascade: ['persist'])]</span>
<span class="hljs-keyword">protected</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>tags</span>;</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-786154c8e1d3fb7258249852676ba89b90a6c77e" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="display: none">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># src/Resources/config/doctrine/Task.orm.yaml</span>
<span class="hljs-string">App\Entity\Task:</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">entity</span>
    <span class="hljs-comment"># ...</span>
    <span class="hljs-attr">oneToMany:</span>
        <span class="hljs-attr">tags:</span>
            <span class="hljs-attr">targetEntity:</span> <span class="hljs-string">App\Entity\Tag</span>
            <span class="hljs-attr">cascade:</span>      <span class="hljs-string">[persist]</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-4d76d2cb91ecc605016a3d87c2a53f622df76c75" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- src/Resources/config/doctrine/Task.orm.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">doctrine-mapping</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://doctrine-project.org/schemas/orm/doctrine-mapping"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://doctrine-project.org/schemas/orm/doctrine-mapping
                    https://doctrine-project.org/schemas/orm/doctrine-mapping.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">entity</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"App\Entity\Task"</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- ... --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">one-to-many</span> <span class="hljs-attr">field</span>=<span class="hljs-string">"tags"</span> <span class="hljs-attr">target-entity</span>=<span class="hljs-string">"Tag"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">cascade</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">cascade-persist</span>/&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">cascade</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">one-to-many</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">entity</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">doctrine-mapping</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>A second potential issue deals with the <a href="https://www.doctrine-project.org/projects/doctrine-orm/en/current/reference/unitofwork-associations.html" class="reference external" rel="external noopener noreferrer" target="_blank">Owning Side and Inverse Side</a>
of Doctrine relationships. In this example, if the &quot;owning&quot; side of the
relationship is &quot;Task&quot;, then persistence will work fine as the tags are
properly added to the Task. However, if the owning side is on &quot;Tag&quot;, then
you'll need to do a little bit more work to ensure that the correct side
of the relationship is modified.</p>
<p>The trick is to make sure that the single &quot;Task&quot; is set on each &quot;Tag&quot;.
One way to do this is to add some extra logic to <code translate="no" class="notranslate">addTag()</code>, which
is called by the form type since <code translate="no" class="notranslate">by_reference</code> is set to <code translate="no" class="notranslate">false</code>:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Entity/Task.php</span>

<span class="hljs-comment">// ...</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addTag</span><span class="hljs-params">(Tag <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>tag</span>)</span>: <span class="hljs-title">void</span>
</span>{
    <span class="hljs-comment">// for a many-to-many association:</span>
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>tag</span><span class="hljs-operator">-&gt;</span>addTask(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span>);

    <span class="hljs-comment">// for a many-to-one association:</span>
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>tag</span><span class="hljs-operator">-&gt;</span>setTask(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span>);

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>tags<span class="hljs-operator">-&gt;</span>add(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>tag</span>);
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>If you're going for <code translate="no" class="notranslate">addTask()</code>, make sure you have an appropriate method
that looks something like this:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Entity/Tag.php</span>

<span class="hljs-comment">// ...</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addTask</span><span class="hljs-params">(Task <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>task</span>)</span>: <span class="hljs-title">void</span>
</span>{
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>tasks<span class="hljs-operator">-&gt;</span>contains(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>task</span>)) {
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>tasks<span class="hljs-operator">-&gt;</span>add(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>task</span>);
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div></div>
<span id="form-collections-remove"></span>
</div>
</div>
<div class="section">
<h2 id="allowing-tags-to-be-removed">
    Allowing Tags to be Removed
    <a class="headerlink" href="#allowing-tags-to-be-removed" title="Permalink to this headline">¶</a>
</h2>
<p>The next step is to allow the deletion of a particular item in the collection.
The solution is similar to allowing tags to be added.</p>
<p>Start by adding the <code translate="no" class="notranslate">allow_delete</code> option in the form Type:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Form/TaskType.php</span>

<span class="hljs-comment">// ...</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buildForm</span><span class="hljs-params">(FormBuilderInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span>, array <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>options</span>)</span>: <span class="hljs-title">void</span>
</span>{
    <span class="hljs-comment">// ...</span>

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span><span class="hljs-operator">-&gt;</span>add(<span class="hljs-string">'tags'</span>, CollectionType<span class="hljs-operator">::</span>class, [
        <span class="hljs-comment">// ...</span>
        <span class="hljs-string">'allow_delete'</span> =&gt; <span class="hljs-keyword">true</span>,
    ]);
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Now, you need to put some code into the <code translate="no" class="notranslate">removeTag()</code> method of <code translate="no" class="notranslate">Task</code>:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Entity/Task.php</span>

<span class="hljs-comment">// ...</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Task</span>
</span>{
    <span class="hljs-comment">// ...</span>

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removeTag</span><span class="hljs-params">(Tag <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>tag</span>)</span>: <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>tags<span class="hljs-operator">-&gt;</span>removeElement(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>tag</span>);
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>The <code translate="no" class="notranslate">allow_delete</code> option means that if an item of a collection
isn't sent on submission, the related data is removed from the collection
on the server. In order for this to work in an HTML form, you must remove
the DOM element for the collection item to be removed, before submitting
the form.</p>
<p>First, add a &quot;delete this tag&quot; link to each tag form:</p>
<div translate="no" class="highlight-javascript notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs javascript"><span class="hljs-built_in">document</span>
    .querySelectorAll(<span class="hljs-string">'ul.tags li'</span>)
    .forEach(<span class="hljs-function">(<span class="hljs-params">tag</span>) =&gt;</span> {
        addTagFormDeleteLink(tag)
    })

<span class="hljs-comment">// ... the rest of the block from above</span>

<span class="hljs-keyword">const</span> addFormToCollection = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-comment">// ...</span>

    <span class="hljs-comment">// add a delete link to the new form</span>
    addTagFormDeleteLink(item);
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>The <code translate="no" class="notranslate">addTagFormDeleteLink()</code> function will look something like this:</p>
<div translate="no" class="highlight-javascript notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs javascript"><span class="hljs-keyword">const</span> addTagFormDeleteLink = <span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> removeFormButton = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'button'</span>);
    removeFormButton.innerText = <span class="hljs-string">'Delete this tag'</span>;

    item.append(removeFormButton);

    removeFormButton.addEventListener(<span class="hljs-string">'click'</span>, (e) =&gt; {
        e.preventDefault();
        <span class="hljs-comment">// remove the li for the tag form</span>
        item.remove();
    });
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>When a tag form is removed from the DOM and submitted, the removed <code translate="no" class="notranslate">Tag</code> object
will not be included in the collection passed to <code translate="no" class="notranslate">setTags()</code>. Depending on
your persistence layer, this may or may not be enough to actually remove
the relationship between the removed <code translate="no" class="notranslate">Tag</code> and <code translate="no" class="notranslate">Task</code> object.</p>
<div class="admonition-wrapper"><div class="admonition admonition-sidebar"><p class="sidebar-title"><span>Doctrine: Ensuring the database persistence</span></p><p>When removing objects in this way, you may need to do a little bit more
work to ensure that the relationship between the <code translate="no" class="notranslate">Task</code> and the removed
<code translate="no" class="notranslate">Tag</code> is properly removed.</p>
<p>In Doctrine, you have two sides of the relationship: the owning side and the
inverse side. Normally in this case you'll have a many-to-one relationship
and the deleted tags will disappear and persist correctly (adding new
tags also works effortlessly).</p>
<p>But if you have a one-to-many relationship or a many-to-many relationship with a
<code translate="no" class="notranslate">mappedBy</code> on the Task entity (meaning Task is the &quot;inverse&quot; side),
you'll need to do more work for the removed tags to persist correctly.</p>
<p>In this case, you can modify the controller to remove the relationship
on the removed tag. This assumes that you have some <code translate="no" class="notranslate">edit()</code> action which
is handling the &quot;update&quot; of your Task:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Controller/TaskController.php</span>

<span class="hljs-comment">// ...</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Entity</span>\<span class="hljs-title">Task</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">Common</span>\<span class="hljs-title">Collections</span>\<span class="hljs-title">ArrayCollection</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TaskController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractController</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">edit</span><span class="hljs-params">(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>id</span>, Request <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span>, EntityManagerInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>entityManager</span>)</span>: <span class="hljs-title">Response</span>
    </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> === <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>task</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>entityManager</span><span class="hljs-operator">-&gt;</span>getRepository(Task<span class="hljs-operator">::</span>class)<span class="hljs-operator">-&gt;</span>find(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>id</span>)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>createNotFoundException(<span class="hljs-string">'No task found for id '</span>.<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>id</span>);
        }

        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>originalTags</span> = <span class="hljs-keyword">new</span> ArrayCollection();

        <span class="hljs-comment">// Create an ArrayCollection of the current Tag objects in the database</span>
        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>task</span><span class="hljs-operator">-&gt;</span>getTags() <span class="hljs-keyword">as</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>tag</span>) {
            <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>originalTags</span><span class="hljs-operator">-&gt;</span>add(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>tag</span>);
        }

        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>editForm</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>createForm(TaskType<span class="hljs-operator">::</span>class, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>task</span>);

        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>editForm</span><span class="hljs-operator">-&gt;</span>handleRequest(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span>);

        <span class="hljs-keyword">if</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>editForm</span><span class="hljs-operator">-&gt;</span>isSubmitted() &amp;&amp; <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>editForm</span><span class="hljs-operator">-&gt;</span>isValid()) {
            <span class="hljs-comment">// remove the relationship between the tag and the Task</span>
            <span class="hljs-keyword">foreach</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>originalTags</span> <span class="hljs-keyword">as</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>tag</span>) {
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">false</span> === <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>task</span><span class="hljs-operator">-&gt;</span>getTags()<span class="hljs-operator">-&gt;</span>contains(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>tag</span>)) {
                    <span class="hljs-comment">// remove the Task from the Tag</span>
                    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>tag</span><span class="hljs-operator">-&gt;</span>getTasks()<span class="hljs-operator">-&gt;</span>removeElement(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>task</span>);

                    <span class="hljs-comment">// if it was a many-to-one relationship, remove the relationship like this</span>
                    <span class="hljs-comment">// $tag-&gt;setTask(null);</span>

                    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>entityManager</span><span class="hljs-operator">-&gt;</span>persist(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>tag</span>);

                    <span class="hljs-comment">// if you wanted to delete the Tag entirely, you can also do that</span>
                    <span class="hljs-comment">// $entityManager-&gt;remove($tag);</span>
                }
            }

            <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>entityManager</span><span class="hljs-operator">-&gt;</span>persist(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>task</span>);
            <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>entityManager</span><span class="hljs-operator">-&gt;</span>flush();

            <span class="hljs-comment">// redirect back to some edit page</span>
            <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>redirectToRoute(<span class="hljs-string">'task_edit'</span>, [<span class="hljs-string">'id'</span> =&gt; <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>id</span>]);
        }

        <span class="hljs-comment">// ... render some form template</span>
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>As you can see, adding and removing the elements correctly can be tricky.
Unless you have a many-to-many relationship where Task is the &quot;owning&quot; side,
you'll need to do extra work to make sure that the relationship is properly
updated (whether you're adding new tags or removing existing tags) on
each Tag object itself.</p>
</div></div>
<div class="admonition admonition-seealso ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" /></svg>
                <span>See also</span>
    </p><p>The Symfony community has created some JavaScript packages that provide the
functionality needed to add, edit and delete elements of the collection.
Check out the <a href="https://github.com/a2lix/symfony-collection" class="reference external" rel="external noopener noreferrer" target="_blank">@a2lix/symfony-collection</a> package for modern browsers and
the <a href="https://github.com/ninsuo/symfony-collection" class="reference external" rel="external noopener noreferrer" target="_blank">symfony-collection</a> package based on jQuery for the rest of browsers.</p>
</div>
</div>
</div>

                            </div>                    </div>
                                    </div>        </div>

    </section>

</div>


<script type="text/javascript" src="assets/js/theme.js"></script>
<script type="text/javascript" src="assets/js/badge_only.js"></script>

 
</body>
</html>