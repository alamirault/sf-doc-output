        
<!DOCTYPE html>
<!--[if IE 8]>
<html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en"> <!--<![endif]-->
<head><base href="/">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
            
                                
    
    <link rel="stylesheet" href="assets/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/highlightjs.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/badge_only.css" type="text/css" />

</head>

<body class="wy-body-for-nav">
 <div class="wy-grid-for-nav">

        <nav data-toggle="wy-nav-shift" class="wy-nav-side">
        <div class="wy-side-scroll">
            <div class="wy-side-nav-search">
                
                                                                                                    
                                                                                                                                                                        </div>

            <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                                                                                                                                                                                                                                                                                                                            </div>
        </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

                                                        

        <div class="wy-nav-content">                <div class="rst-content">
                                        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">                            <div itemprop="articleBody">
                                    <div class="section">
<h1 id="how-to-dynamically-modify-forms-using-form-events">
    How to Dynamically Modify Forms Using Form Events
    <a class="headerlink" href="#how-to-dynamically-modify-forms-using-form-events" title="Permalink to this headline">¶</a>
</h1>
<p>Oftentimes, a form can't be created statically. In this article, you'll learn
how to customize your form based on three common use-cases:</p>
<ol class="arabic">
    <li><p><a href="dynamic_form_modification.html#form-events-underlying-data" class="reference internal">Customizing your Form Based on the Underlying Data</a></p>
<p>Example: you have a &quot;Product&quot; form and need to modify/add/remove a field
based on the data on the underlying Product being edited.</p></li>
<li><p><a href="dynamic_form_modification.html#form-events-user-data" class="reference internal">How to dynamically Generate Forms Based on user Data</a></p>
<p>Example: you create a &quot;Friend Message&quot; form and need to build a drop-down
that contains only users that are friends with the <em>current</em> authenticated
user.</p></li>
<li><p><a href="dynamic_form_modification.html#form-events-submitted-data" class="reference internal">Dynamic Generation for Submitted Forms</a></p>
<p>Example: on a registration form, you have a &quot;country&quot; field and a &quot;state&quot;
field which should populate dynamically based on the value in the &quot;country&quot;
field.</p></li>
</ol>
<p>If you wish to learn more about the basics behind form events, you can
take a look at the <a href="events.html" class="reference internal">Form Events</a> documentation.</p>
<span id="form-events-underlying-data"></span>
<div class="section">
<h2 id="customizing-your-form-based-on-the-underlying-data">
    Customizing your Form Based on the Underlying Data
    <a class="headerlink" href="#customizing-your-form-based-on-the-underlying-data" title="Permalink to this headline">¶</a>
</h2>
<p>Before starting with dynamic form generation, remember what
a bare form class looks like:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Form/Type/ProductType.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">Type</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Entity</span>\<span class="hljs-title">Product</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">AbstractType</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">FormBuilderInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">OptionsResolver</span>\<span class="hljs-title">OptionsResolver</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProductType</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractType</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buildForm</span><span class="hljs-params">(FormBuilderInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span>, array <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>options</span>)</span>: <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span><span class="hljs-operator">-&gt;</span>add(<span class="hljs-string">'name'</span>);
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span><span class="hljs-operator">-&gt;</span>add(<span class="hljs-string">'price'</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">configureOptions</span><span class="hljs-params">(OptionsResolver <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>resolver</span>)</span>: <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>resolver</span><span class="hljs-operator">-&gt;</span>setDefaults([
            <span class="hljs-string">'data_class'</span> =&gt; Product<span class="hljs-operator">::</span>class,
        ]);
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>If this particular section of code isn't already familiar to you, you
probably need to take a step back and first review the <a href="../forms.html" class="reference internal">Forms article</a>
before proceeding.</p>
</div>
<p>Assume for a moment that this form utilizes an imaginary &quot;Product&quot; class
that has only two properties (&quot;name&quot; and &quot;price&quot;). The form generated from
this class will look the exact same regardless if a new Product is being created
or if an existing product is being edited (e.g. a product fetched from the database).</p>
<p>Suppose now, that you don't want the user to be able to change the <code translate="no" class="notranslate">name</code> value
once the object has been created. To do this, you can rely on Symfony's
<a href="../components/event_dispatcher.html" class="reference internal">EventDispatcher component</a>
system to analyze the data on the object and modify the form based on the
Product object's data. In this article, you'll learn how to add this level of
flexibility to your forms.</p>
<div class="section">
<h3 id="adding-an-event-listener-to-a-form-class">
    Adding an Event Listener to a Form Class
    <a class="headerlink" href="#adding-an-event-listener-to-a-form-class" title="Permalink to this headline">¶</a>
</h3>
<p>So, instead of directly adding that <code translate="no" class="notranslate">name</code> widget, the responsibility of
creating that particular field is delegated to an event listener:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Form/Type/ProductType.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">Type</span>;

<span class="hljs-comment">// ...</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">FormEvent</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">FormEvents</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProductType</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractType</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buildForm</span><span class="hljs-params">(FormBuilderInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span>, array <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>options</span>)</span>: <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span><span class="hljs-operator">-&gt;</span>add(<span class="hljs-string">'price'</span>);

        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span><span class="hljs-operator">-&gt;</span>addEventListener(FormEvents<span class="hljs-operator">::</span>PRE_SET_DATA, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(FormEvent <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span>)</span> </span>{
            <span class="hljs-comment">// ... adding the name field if needed</span>
        });
    }

    <span class="hljs-comment">// ...</span>
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>The goal is to create a <code translate="no" class="notranslate">name</code> field <em>only</em> if the underlying <code translate="no" class="notranslate">Product</code>
object is new (e.g. hasn't been persisted to the database). Based on that,
the event listener might look like the following:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// ...</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buildForm</span><span class="hljs-params">(FormBuilderInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span>, array <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>options</span>)</span>: <span class="hljs-title">void</span>
</span>{
    <span class="hljs-comment">// ...</span>
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span><span class="hljs-operator">-&gt;</span>addEventListener(FormEvents<span class="hljs-operator">::</span>PRE_SET_DATA, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(FormEvent <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span>)</span> </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>product</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span><span class="hljs-operator">-&gt;</span>getData();
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>form</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span><span class="hljs-operator">-&gt;</span>getForm();

        <span class="hljs-comment">// checks if the Product object is "new"</span>
        <span class="hljs-comment">// If no data is passed to the form, the data is "null".</span>
        <span class="hljs-comment">// This should be considered a new "Product"</span>
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>product</span> || <span class="hljs-keyword">null</span> === <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>product</span><span class="hljs-operator">-&gt;</span>getId()) {
            <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>form</span><span class="hljs-operator">-&gt;</span>add(<span class="hljs-string">'name'</span>, TextType<span class="hljs-operator">::</span>class);
        }
    });
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>The <code translate="no" class="notranslate">FormEvents::PRE_SET_DATA</code> line actually resolves to the string
<code translate="no" class="notranslate">form.pre_set_data</code>. <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/Form/FormEvents.php" class="reference external" title="Symfony\Component\Form\FormEvents" rel="external noopener noreferrer" target="_blank">FormEvents</a>
serves an organizational purpose. It is a centralized location in which
you can find all of the various form events available. You can view the
full list of form events via the
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/Form/FormEvents.php" class="reference external" title="Symfony\Component\Form\FormEvents" rel="external noopener noreferrer" target="_blank">FormEvents</a> class.</p>
</div>
</div>
<div class="section">
<h3 id="adding-an-event-subscriber-to-a-form-class">
    Adding an Event Subscriber to a Form Class
    <a class="headerlink" href="#adding-an-event-subscriber-to-a-form-class" title="Permalink to this headline">¶</a>
</h3>
<p>For better reusability or if there is some heavy logic in your event listener,
you can also move the logic for creating the <code translate="no" class="notranslate">name</code> field to an
<a href="../components/event_dispatcher.html#event_dispatcher-using-event-subscribers" class="reference internal">event subscriber</a>:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Form/EventListener/AddNameFieldSubscriber.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">EventListener</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">EventDispatcher</span>\<span class="hljs-title">EventSubscriberInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">Extension</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">Type</span>\<span class="hljs-title">TextType</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">FormEvent</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">FormEvents</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AddNameFieldSubscriber</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">EventSubscriberInterface</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSubscribedEvents</span><span class="hljs-params">()</span>: <span class="hljs-title">array</span>
    </span>{
        <span class="hljs-comment">// Tells the dispatcher that you want to listen on the form.pre_set_data</span>
        <span class="hljs-comment">// event and that the preSetData method should be called.</span>
        <span class="hljs-keyword">return</span> [FormEvents<span class="hljs-operator">::</span>PRE_SET_DATA =&gt; <span class="hljs-string">'preSetData'</span>];
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">preSetData</span><span class="hljs-params">(FormEvent <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span>)</span>: <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>product</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span><span class="hljs-operator">-&gt;</span>getData();
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>form</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span><span class="hljs-operator">-&gt;</span>getForm();

        <span class="hljs-keyword">if</span> (!<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>product</span> || <span class="hljs-keyword">null</span> === <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>product</span><span class="hljs-operator">-&gt;</span>getId()) {
            <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>form</span><span class="hljs-operator">-&gt;</span>add(<span class="hljs-string">'name'</span>, TextType<span class="hljs-operator">::</span>class);
        }
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Great! Now use that in your form class:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Form/Type/ProductType.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">Type</span>;

<span class="hljs-comment">// ...</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">EventListener</span>\<span class="hljs-title">AddNameFieldSubscriber</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProductType</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractType</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buildForm</span><span class="hljs-params">(FormBuilderInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span>, array <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>options</span>)</span>: <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span><span class="hljs-operator">-&gt;</span>add(<span class="hljs-string">'price'</span>);

        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span><span class="hljs-operator">-&gt;</span>addEventSubscriber(<span class="hljs-keyword">new</span> AddNameFieldSubscriber());
    }

    <span class="hljs-comment">// ...</span>
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<span id="form-events-user-data"></span>
</div>
</div>
<div class="section">
<h2 id="how-to-dynamically-generate-forms-based-on-user-data">
    How to dynamically Generate Forms Based on user Data
    <a class="headerlink" href="#how-to-dynamically-generate-forms-based-on-user-data" title="Permalink to this headline">¶</a>
</h2>
<p>Sometimes you want a form to be generated dynamically based not only on data
from the form but also on something else - like some data from the current user.
Suppose you have a social website where a user can only message people marked
as friends on the website. In this case, a &quot;choice list&quot; of whom to message
should only contain users that are the current user's friends.</p>
<div class="section">
<h3 id="creating-the-form-type">
    Creating the Form Type
    <a class="headerlink" href="#creating-the-form-type" title="Permalink to this headline">¶</a>
</h3>
<p>Using an event listener, your form might look like this:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Form/Type/FriendMessageFormType.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">Type</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">AbstractType</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">Extension</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">Type</span>\<span class="hljs-title">TextareaType</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">Extension</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">Type</span>\<span class="hljs-title">TextType</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">FormBuilderInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">FormEvent</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">FormEvents</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FriendMessageFormType</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractType</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buildForm</span><span class="hljs-params">(FormBuilderInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span>, array <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>options</span>)</span>: <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span>
            <span class="hljs-operator">-&gt;</span>add(<span class="hljs-string">'subject'</span>, TextType<span class="hljs-operator">::</span>class)
            <span class="hljs-operator">-&gt;</span>add(<span class="hljs-string">'body'</span>, TextareaType<span class="hljs-operator">::</span>class)
        ;
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span><span class="hljs-operator">-&gt;</span>addEventListener(FormEvents<span class="hljs-operator">::</span>PRE_SET_DATA, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(FormEvent <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span>)</span> </span>{
            <span class="hljs-comment">// ... add a choice list of friends of the current application user</span>
        });
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>The problem is now to get the current user and create a choice field that
contains only this user's friends. This can be done by injecting the <code translate="no" class="notranslate">Security</code>
service into the form type so you can get the current user object:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Bundle</span>\<span class="hljs-title">SecurityBundle</span>\<span class="hljs-title">Security</span>;
<span class="hljs-comment">// ...</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FriendMessageFormType</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractType</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(
        private Security <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span>,
    )</span> </span>{
    }

    <span class="hljs-comment">// ....</span>
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
<div class="section">
<h3 id="customizing-the-form-type">
    Customizing the Form Type
    <a class="headerlink" href="#customizing-the-form-type" title="Permalink to this headline">¶</a>
</h3>
<p>Now that you have all the basics in place you can use the features of the
security helper to fill in the listener logic:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Form/Type/FriendMessageFormType.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">Type</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Entity</span>\<span class="hljs-title">User</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">ORM</span>\<span class="hljs-title">EntityRepository</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Bridge</span>\<span class="hljs-title">Doctrine</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">Type</span>\<span class="hljs-title">EntityType</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Bundle</span>\<span class="hljs-title">SecurityBundle</span>\<span class="hljs-title">Security</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">Extension</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">Type</span>\<span class="hljs-title">TextareaType</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">Extension</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">Type</span>\<span class="hljs-title">TextType</span>;
<span class="hljs-comment">// ...</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FriendMessageFormType</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractType</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(
        private Security <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span>,
    )</span> </span>{
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buildForm</span><span class="hljs-params">(FormBuilderInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span>, array <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>options</span>)</span>: <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span>
            <span class="hljs-operator">-&gt;</span>add(<span class="hljs-string">'subject'</span>, TextType<span class="hljs-operator">::</span>class)
            <span class="hljs-operator">-&gt;</span>add(<span class="hljs-string">'body'</span>, TextareaType<span class="hljs-operator">::</span>class)
        ;

        <span class="hljs-comment">// grab the user, do a quick sanity check that one exists</span>
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>user</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>security<span class="hljs-operator">-&gt;</span>getUser();
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>user</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> \LogicException(
                <span class="hljs-string">'The FriendMessageFormType cannot be used without an authenticated user!'</span>
            );
        }

        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span><span class="hljs-operator">-&gt;</span>addEventListener(FormEvents<span class="hljs-operator">::</span>PRE_SET_DATA, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(FormEvent <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span>)</span> <span class="hljs-title">use</span> <span class="hljs-params">(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>user</span>)</span> </span>{
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> !== <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span><span class="hljs-operator">-&gt;</span>getData()<span class="hljs-operator">-&gt;</span>getFriend()) {
                <span class="hljs-comment">// we don't need to add the friend field because</span>
                <span class="hljs-comment">// the message will be addressed to a fixed friend</span>
                <span class="hljs-keyword">return</span>;
            }

            <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>form</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span><span class="hljs-operator">-&gt;</span>getForm();

            <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>formOptions</span> = [
                <span class="hljs-string">'class'</span> =&gt; User<span class="hljs-operator">::</span>class,
                <span class="hljs-string">'choice_label'</span> =&gt; <span class="hljs-string">'fullName'</span>,
                <span class="hljs-string">'query_builder'</span> =&gt; <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(UserRepository <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>userRepository</span>)</span> <span class="hljs-title">use</span> <span class="hljs-params">(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>user</span>)</span> </span>{
                    <span class="hljs-comment">// call a method on your repository that returns the query builder</span>
                    <span class="hljs-comment">// return $userRepository-&gt;createFriendsQueryBuilder($user);</span>
                },
            ];

            <span class="hljs-comment">// create the field, this is similar the $builder-&gt;add()</span>
            <span class="hljs-comment">// field name, field type, field options</span>
            <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>form</span><span class="hljs-operator">-&gt;</span>add(<span class="hljs-string">'friend'</span>, EntityType<span class="hljs-operator">::</span>class, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>formOptions</span>);
        });
    }

    <span class="hljs-comment">// ...</span>
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>You might wonder, now that you have access to the <code translate="no" class="notranslate">User</code> object, why not
just use it directly in <code translate="no" class="notranslate">buildForm()</code> and omit the event listener? This is
because doing so in the <code translate="no" class="notranslate">buildForm()</code> method would result in the whole
form type being modified and not just this one form instance. This may not
usually be a problem, but technically a single form type could be used on a
single request to create many forms or fields.</p>
</div>
</div>
<div class="section">
<h3 id="using-the-form">
    Using the Form
    <a class="headerlink" href="#using-the-form" title="Permalink to this headline">¶</a>
</h3>
<p>If you're using the <a href="../service_container.html#service-container-services-load-example" class="reference internal">default services.yaml configuration</a>,
your form is ready to be used thanks to <a href="../service_container.html#services-autowire" class="reference internal">autowire</a> and
<a href="../service_container.html#services-autoconfigure" class="reference internal">autoconfigure</a>.
Otherwise, <a href="../service_container.html#service-container-creating-service" class="reference internal">register the form class as a service</a>
and <a href="../service_container/tags.html" class="reference internal">tag it</a> with the <code translate="no" class="notranslate">form.type</code> tag.</p>
<p>In a controller, create the form like normal:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Bundle</span>\<span class="hljs-title">FrameworkBundle</span>\<span class="hljs-title">Controller</span>\<span class="hljs-title">AbstractController</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Request</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Response</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FriendMessageController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractController</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">new</span><span class="hljs-params">(Request <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span>)</span>: <span class="hljs-title">Response</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>form</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>createForm(FriendMessageFormType<span class="hljs-operator">::</span>class);

        <span class="hljs-comment">// ...</span>
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>You can also  embed the form type into another form:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// inside some other "form type" class</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buildForm</span><span class="hljs-params">(FormBuilderInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span>, array <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>options</span>)</span>: <span class="hljs-title">void</span>
</span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span><span class="hljs-operator">-&gt;</span>add(<span class="hljs-string">'message'</span>, FriendMessageFormType<span class="hljs-operator">::</span>class);
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<span id="form-events-submitted-data"></span>
</div>
</div>
<div class="section">
<h2 id="dynamic-generation-for-submitted-forms">
    Dynamic Generation for Submitted Forms
    <a class="headerlink" href="#dynamic-generation-for-submitted-forms" title="Permalink to this headline">¶</a>
</h2>
<p>Another case that can appear is that you want to customize the form specific to
the data that was submitted by the user. For example, imagine you have a registration
form for sports gatherings. Some events will allow you to specify your preferred
position on the field. This would be a <code translate="no" class="notranslate">choice</code> field for example. However, the
possible choices will depend on each sport. Football will have attack, defense,
goalkeeper etc... Baseball will have a pitcher but will not have a goalkeeper. You
will need the correct options in order for validation to pass.</p>
<p>The meetup is passed as an entity field to the form. So we can access each
sport like this:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Form/Type/SportMeetupType.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">Type</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Entity</span>\<span class="hljs-title">Position</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Entity</span>\<span class="hljs-title">Sport</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Bridge</span>\<span class="hljs-title">Doctrine</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">Type</span>\<span class="hljs-title">EntityType</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">AbstractType</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">FormBuilderInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">FormEvent</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">FormEvents</span>;
<span class="hljs-comment">// ...</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SportMeetupType</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractType</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buildForm</span><span class="hljs-params">(FormBuilderInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span>, array <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>options</span>)</span>: <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span>
            <span class="hljs-operator">-&gt;</span>add(<span class="hljs-string">'sport'</span>, EntityType<span class="hljs-operator">::</span>class, [
                <span class="hljs-string">'class'</span> =&gt; Sport<span class="hljs-operator">::</span>class,
                <span class="hljs-string">'placeholder'</span> =&gt; <span class="hljs-string">''</span>,
            ])
        ;

        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span><span class="hljs-operator">-&gt;</span>addEventListener(
            FormEvents<span class="hljs-operator">::</span>PRE_SET_DATA,
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(FormEvent <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span>)</span> </span>{
                <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>form</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span><span class="hljs-operator">-&gt;</span>getForm();

                <span class="hljs-comment">// this would be your entity, i.e. SportMeetup</span>
                <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>data</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span><span class="hljs-operator">-&gt;</span>getData();

                <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>sport</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>data</span><span class="hljs-operator">-&gt;</span>getSport();
                <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>positions</span> = <span class="hljs-keyword">null</span> === <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>sport</span> ? [] : <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>sport</span><span class="hljs-operator">-&gt;</span>getAvailablePositions();

                <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>form</span><span class="hljs-operator">-&gt;</span>add(<span class="hljs-string">'position'</span>, EntityType<span class="hljs-operator">::</span>class, [
                    <span class="hljs-string">'class'</span> =&gt; Position<span class="hljs-operator">::</span>class,
                    <span class="hljs-string">'placeholder'</span> =&gt; <span class="hljs-string">''</span>,
                    <span class="hljs-string">'choices'</span> =&gt; <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>positions</span>,
                ]);
            }
        );
    }

    <span class="hljs-comment">// ...</span>
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>When you're building this form to display to the user for the first time,
then this example works perfectly.</p>
<p>However, things get more difficult when you handle the form submission. This
is because the <code translate="no" class="notranslate">PRE_SET_DATA</code> event tells us the data that you're starting
with (e.g. an empty <code translate="no" class="notranslate">SportMeetup</code> object), <em>not</em> the submitted data.</p>
<p>On a form, we can usually listen to the following events:</p>
<ul>
    <li><code translate="no" class="notranslate">PRE_SET_DATA</code></li>
<li><code translate="no" class="notranslate">POST_SET_DATA</code></li>
<li><code translate="no" class="notranslate">PRE_SUBMIT</code></li>
<li><code translate="no" class="notranslate">SUBMIT</code></li>
<li><code translate="no" class="notranslate">POST_SUBMIT</code></li>
</ul>
<p>The key is to add a <code translate="no" class="notranslate">POST_SUBMIT</code> listener to the field that your new field
depends on. If you add a <code translate="no" class="notranslate">POST_SUBMIT</code> listener to a form child (e.g. <code translate="no" class="notranslate">sport</code>),
and add new children to the parent form, the Form component will detect the
new field automatically and map it to the submitted client data.</p>
<p>The type would now look like:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Form/Type/SportMeetupType.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">Type</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Entity</span>\<span class="hljs-title">Position</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Entity</span>\<span class="hljs-title">Sport</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Bridge</span>\<span class="hljs-title">Doctrine</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">Type</span>\<span class="hljs-title">EntityType</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">FormInterface</span>;
<span class="hljs-comment">// ...</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SportMeetupType</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractType</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buildForm</span><span class="hljs-params">(FormBuilderInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span>, array <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>options</span>)</span>: <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span>
            <span class="hljs-operator">-&gt;</span>add(<span class="hljs-string">'sport'</span>, EntityType<span class="hljs-operator">::</span>class, [
                <span class="hljs-string">'class'</span> =&gt; Sport<span class="hljs-operator">::</span>class,
                <span class="hljs-string">'placeholder'</span> =&gt; <span class="hljs-string">''</span>,
            ])
        ;

        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>formModifier</span> = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(FormInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>form</span>, Sport <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>sport</span> = null)</span> </span>{
            <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>positions</span> = <span class="hljs-keyword">null</span> === <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>sport</span> ? [] : <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>sport</span><span class="hljs-operator">-&gt;</span>getAvailablePositions();

            <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>form</span><span class="hljs-operator">-&gt;</span>add(<span class="hljs-string">'position'</span>, EntityType<span class="hljs-operator">::</span>class, [
                <span class="hljs-string">'class'</span> =&gt; Position<span class="hljs-operator">::</span>class,
                <span class="hljs-string">'placeholder'</span> =&gt; <span class="hljs-string">''</span>,
                <span class="hljs-string">'choices'</span> =&gt; <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>positions</span>,
            ]);
        };

        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span><span class="hljs-operator">-&gt;</span>addEventListener(
            FormEvents<span class="hljs-operator">::</span>PRE_SET_DATA,
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(FormEvent <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span>)</span> <span class="hljs-title">use</span> <span class="hljs-params">(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>formModifier</span>)</span> </span>{
                <span class="hljs-comment">// this would be your entity, i.e. SportMeetup</span>
                <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>data</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span><span class="hljs-operator">-&gt;</span>getData();

                <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>formModifier</span>(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span><span class="hljs-operator">-&gt;</span>getForm(), <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>data</span><span class="hljs-operator">-&gt;</span>getSport());
            }
        );

        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>builder</span><span class="hljs-operator">-&gt;</span>get(<span class="hljs-string">'sport'</span>)<span class="hljs-operator">-&gt;</span>addEventListener(
            FormEvents<span class="hljs-operator">::</span>POST_SUBMIT,
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(FormEvent <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span>)</span> <span class="hljs-title">use</span> <span class="hljs-params">(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>formModifier</span>)</span> </span>{
                <span class="hljs-comment">// It's important here to fetch $event-&gt;getForm()-&gt;getData(), as</span>
                <span class="hljs-comment">// $event-&gt;getData() will get you the client data (that is, the ID)</span>
                <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>sport</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span><span class="hljs-operator">-&gt;</span>getForm()<span class="hljs-operator">-&gt;</span>getData();

                <span class="hljs-comment">// since we've added the listener to the child, we'll have to pass on</span>
                <span class="hljs-comment">// the parent to the callback function!</span>
                <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>formModifier</span>(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span><span class="hljs-operator">-&gt;</span>getForm()<span class="hljs-operator">-&gt;</span>getParent(), <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>sport</span>);
            }
        );
    }

    <span class="hljs-comment">// ...</span>
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>You can see that you need to listen on these two events and have different
callbacks only because in two different scenarios, the data that you can use is
available in different events. Other than that, the listeners always perform
exactly the same things on a given form.</p>
<div class="admonition admonition-tip ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                <span>Tip</span>
    </p><p>The <code translate="no" class="notranslate">FormEvents::POST_SUBMIT</code> event does not allow modifications to the form
the listener is bound to, but it allows modifications to its parent.</p>
</div>
<p>One piece that is still missing is the client-side updating of your form after
the sport is selected. This should be handled by making an AJAX callback to
your application. Assume that you have a sport meetup creation controller:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Controller/MeetupController.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Controller</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Entity</span>\<span class="hljs-title">SportMeetup</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">Type</span>\<span class="hljs-title">SportMeetupType</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Bundle</span>\<span class="hljs-title">FrameworkBundle</span>\<span class="hljs-title">Controller</span>\<span class="hljs-title">AbstractController</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Request</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Response</span>;
<span class="hljs-comment">// ...</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MeetupController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractController</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">create</span><span class="hljs-params">(Request <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span>)</span>: <span class="hljs-title">Response</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>meetup</span> = <span class="hljs-keyword">new</span> SportMeetup();
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>form</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>createForm(SportMeetupType<span class="hljs-operator">::</span>class, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>meetup</span>);
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>form</span><span class="hljs-operator">-&gt;</span>handleRequest(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span>);
        <span class="hljs-keyword">if</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>form</span><span class="hljs-operator">-&gt;</span>isSubmitted() &amp;&amp; <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>form</span><span class="hljs-operator">-&gt;</span>isValid()) {
            <span class="hljs-comment">// ... save the meetup, redirect etc.</span>
        }

        <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>render(<span class="hljs-string">'meetup/create.html.twig'</span>, [
            <span class="hljs-string">'form'</span> =&gt; <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>form</span>,
        ]);
    }

    <span class="hljs-comment">// ...</span>
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>The associated template uses some JavaScript to update the <code translate="no" class="notranslate">position</code> form
field according to the current selection in the <code translate="no" class="notranslate">sport</code> field:</p>
<div translate="no" class="highlight-html+twig highlight-twig notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs html+twig twig"><span class="hljs-comment">{# templates/meetup/create.html.twig #}</span><span class="xml">
</span><span class="hljs-template-variable">{{ form_start(form) }}</span><span class="xml">
    </span><span class="hljs-template-variable">{{ form_row(form.sport) }}</span><span class="xml">    </span><span class="hljs-comment">{# &lt;select id="meetup_sport" ... #}</span><span class="xml">
    </span><span class="hljs-template-variable">{{ form_row(form.position) }}</span><span class="xml"> </span><span class="hljs-comment">{# &lt;select id="meetup_position" ... #}</span><span class="xml">
    </span><span class="hljs-comment">{# ... #}</span><span class="xml">
</span><span class="hljs-template-variable">{{ form_end(form) }}</span><span class="xml">

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">var</span> $sport = $(<span class="hljs-string">'#meetup_sport'</span>);
<span class="hljs-comment">// When sport gets selected ...</span>
$sport.change(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-comment">// ... retrieve the corresponding form.</span>
  <span class="hljs-keyword">var</span> $form = $(<span class="hljs-keyword">this</span>).closest(<span class="hljs-string">'form'</span>);
  <span class="hljs-comment">// Simulate form data, but only include the selected sport value.</span>
  <span class="hljs-keyword">var</span> data = {};
  data[$sport.attr(<span class="hljs-string">'name'</span>)] = $sport.val();
  <span class="hljs-comment">// Submit data via AJAX to the form's action path.</span>
  $.ajax({
    <span class="hljs-attr">url</span> : $form.attr(<span class="hljs-string">'action'</span>),
    <span class="hljs-attr">type</span>: $form.attr(<span class="hljs-string">'method'</span>),
    <span class="hljs-attr">data</span> : data,
    <span class="hljs-attr">complete</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">html</span>) </span>{
      <span class="hljs-comment">// Replace current position field ...</span>
      $(<span class="hljs-string">'#meetup_position'</span>).replaceWith(
        <span class="hljs-comment">// ... with the returned one from the AJAX response.</span>
        $(html.responseText).find(<span class="hljs-string">'#meetup_position'</span>)
      );
      <span class="hljs-comment">// Position field now displays the appropriate positions.</span>
    }
  });
});
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>The major benefit of submitting the whole form to just extract the updated
<code translate="no" class="notranslate">position</code> field is that no additional server-side code is needed; all the
code from above to generate the submitted form can be reused.</p>
</div>
</div>

                            </div>                    </div>
                                    </div>        </div>

    </section>

</div>


<script type="text/javascript" src="assets/js/theme.js"></script>
<script type="text/javascript" src="assets/js/badge_only.js"></script>

 
</body>
</html>