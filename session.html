        
<!DOCTYPE html>
<!--[if IE 8]>
<html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en"> <!--<![endif]-->
<head><base href="/">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
            
                                
    
    <link rel="stylesheet" href="assets/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/highlightjs.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/badge_only.css" type="text/css" />

</head>

<body class="wy-body-for-nav">
 <div class="wy-grid-for-nav">

        <nav data-toggle="wy-nav-shift" class="wy-nav-side">
        <div class="wy-side-scroll">
            <div class="wy-side-nav-search">
                
                                                                                                    
                                                                                                                                                                        </div>

            <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                                                                                                                                                                                                                                                                                                                            </div>
        </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

                                                        

        <div class="wy-nav-content">                <div class="rst-content">
                                        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">                            <div itemprop="articleBody">
                                    <div class="section">
<h1 id="sessions">
    Sessions
    <a class="headerlink" href="#sessions" title="Permalink to this headline">¶</a>
</h1>
<p>The Symfony HttpFoundation component has a very powerful and flexible session
subsystem which is designed to provide session management that you can use to
store information about the user between requests through a clear
object-oriented interface using a variety of session storage drivers.</p>
<p>Symfony sessions are designed to replace the usage of the <code translate="no" class="notranslate">$_SESSION</code> super
global and native PHP functions related to manipulating the session like
<code translate="no" class="notranslate">session_start()</code>, <code translate="no" class="notranslate">session_regenerate_id()</code>, <code translate="no" class="notranslate">session_id()</code>,
<code translate="no" class="notranslate">session_name()</code>, and <code translate="no" class="notranslate">session_destroy()</code>.</p>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>Sessions are only started if you read or write from it.</p>
</div>
<div class="section">
<h2 id="installation">
    Installation
    <a class="headerlink" href="#installation" title="Permalink to this headline">¶</a>
</h2>
<p>You need to install the HttpFoundation component to handle sessions:</p>
<div translate="no" class="highlight-terminal highlight-bash notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs terminal bash"><span class="hljs-prompt">$ </span>composer require symfony/http-foundation</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<span id="session-intro"></span>
</div>
<div class="section">
<h2 id="basic-usage">
    Basic Usage
    <a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a>
</h2>
<p>The session is available through the <code translate="no" class="notranslate">Request</code> object and the <code translate="no" class="notranslate">RequestStack</code>
service. Symfony injects the <code translate="no" class="notranslate">request_stack</code> service in services and controllers
if you type-hint an argument with <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpFoundation/RequestStack.php" class="reference external" title="Symfony\Component\HttpFoundation\RequestStack" rel="external noopener noreferrer" target="_blank">RequestStack</a>:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-2">
                    <button role="tab" type="button" data-language="php-symfony"
                aria-controls="configuration-block-tabpanel-d0666b34925fd77ea065d9f577545b388f72bee2" aria-selected="true"
                data-active="true" >
                <span>Framework Use</span>
            </button>
                    <button role="tab" type="button" data-language="php-standalone"
                aria-controls="configuration-block-tabpanel-153893cf8693aae3afc83ab472446926a246e3a3" aria-selected="false"
                 tabindex="-1">
                <span>Standalone Use</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-d0666b34925fd77ea065d9f577545b388f72bee2" aria-label="Framework Use" class="configuration-codeblock" data-language="php-symfony" style="">
            <div translate="no" class="highlight-php-symfony highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php-symfony php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">RequestStack</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SomeService</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(
        private RequestStack <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>requestStack</span>,
    )</span> </span>{
        <span class="hljs-comment">// Accessing the session in the constructor is *NOT* recommended, since</span>
        <span class="hljs-comment">// it might not be accessible yet or lead to unwanted side-effects</span>
        <span class="hljs-comment">// $this-&gt;session = $requestStack-&gt;getSession();</span>
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">someMethod</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>session</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>requestStack<span class="hljs-operator">-&gt;</span>getSession();

        <span class="hljs-comment">// ...</span>
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-153893cf8693aae3afc83ab472446926a246e3a3" aria-label="Standalone Use" class="configuration-codeblock" data-language="php-standalone" style="display: none">
            <div translate="no" class="highlight-php-standalone highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php-standalone php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Session</span>\<span class="hljs-title">Session</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>session</span> = <span class="hljs-keyword">new</span> Session();
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>session</span><span class="hljs-operator">-&gt;</span>start();</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>From a Symfony controller, you can also type-hint an argument with
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpFoundation/Request.php" class="reference external" title="Symfony\Component\HttpFoundation\Request" rel="external noopener noreferrer" target="_blank">Request</a>:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Request</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Response</span>;

<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span><span class="hljs-params">(Request <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span>)</span>: <span class="hljs-title">Response</span>
</span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>session</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span><span class="hljs-operator">-&gt;</span>getSession();

    <span class="hljs-comment">// ...</span>
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
<div class="section">
<h2 id="session-attributes">
    Session Attributes
    <a class="headerlink" href="#session-attributes" title="Permalink to this headline">¶</a>
</h2>
<p>PHP's session management requires the use of the <code translate="no" class="notranslate">$_SESSION</code> super-global.
However, this interferes with code testability and encapsulation in an OOP
paradigm. To help overcome this, Symfony uses <em>session bags</em> linked to the
session to encapsulate a specific dataset of <strong>attributes</strong>.</p>
<p>This approach mitigates namespace pollution within the <code translate="no" class="notranslate">$_SESSION</code>
super-global because each bag stores all its data under a unique namespace.
This allows Symfony to peacefully co-exist with other applications or libraries
that might use the <code translate="no" class="notranslate">$_SESSION</code> super-global and all data remains completely
compatible with Symfony's session management.</p>
<p>A session bag is a PHP object that acts like an array:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// stores an attribute for reuse during a later user request</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>session</span><span class="hljs-operator">-&gt;</span>set(<span class="hljs-string">'attribute-name'</span>, <span class="hljs-string">'attribute-value'</span>);

<span class="hljs-comment">// gets an attribute by name</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>foo</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>session</span><span class="hljs-operator">-&gt;</span>get(<span class="hljs-string">'foo'</span>);

<span class="hljs-comment">// the second argument is the value returned when the attribute doesn't exist</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>filters</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>session</span><span class="hljs-operator">-&gt;</span>get(<span class="hljs-string">'filters'</span>, []);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Stored attributes remain in the session for the remainder of that user's session.
By default, session attributes are key-value pairs managed with the
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpFoundation/Session/Attribute/AttributeBag.php" class="reference external" title="Symfony\Component\HttpFoundation\Session\Attribute\AttributeBag" rel="external noopener noreferrer" target="_blank">AttributeBag</a>
class.</p>
<div class="admonition admonition-tip ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                <span>Tip</span>
    </p><p>Sessions are automatically started whenever you read, write or even check
for the existence of data in the session. This may hurt your application
performance because all users will receive a session cookie. In order to
prevent starting sessions for anonymous users, you must <em>completely</em> avoid
accessing the session.</p>
</div>
<span id="flash-messages"></span>
</div>
<div class="section">
<h2 id="flash-messages">
    Flash Messages
    <a class="headerlink" href="#flash-messages" title="Permalink to this headline">¶</a>
</h2>
<p>You can store special messages, called &quot;flash&quot; messages, on the user's session.
By design, flash messages are meant to be used exactly once: they vanish from
the session automatically as soon as you retrieve them. This feature makes
&quot;flash&quot; messages particularly great for storing user notifications.</p>
<p>For example, imagine you're processing a <a href="forms.html" class="reference internal">form</a> submission:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-2">
                    <button role="tab" type="button" data-language="php-symfony"
                aria-controls="configuration-block-tabpanel-8cecaa99b046f6c213dd517edbda16e29e5cc154" aria-selected="true"
                data-active="true" >
                <span>Framework Use</span>
            </button>
                    <button role="tab" type="button" data-language="php-standalone"
                aria-controls="configuration-block-tabpanel-bce31e142f0f4b8b721d74c85a9185f533213588" aria-selected="false"
                 tabindex="-1">
                <span>Standalone Use</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-8cecaa99b046f6c213dd517edbda16e29e5cc154" aria-label="Framework Use" class="configuration-codeblock" data-language="php-symfony" style="">
            <div translate="no" class="highlight-php-symfony highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php-symfony php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Request</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Response</span>;
<span class="hljs-comment">// ...</span>

<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span><span class="hljs-params">(Request <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span>)</span>: <span class="hljs-title">Response</span>
</span>{
    <span class="hljs-comment">// ...</span>

    <span class="hljs-keyword">if</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>form</span><span class="hljs-operator">-&gt;</span>isSubmitted() &amp;&amp; <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>form</span><span class="hljs-operator">-&gt;</span>isValid()) {
        <span class="hljs-comment">// do some sort of processing</span>

        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>addFlash(
            <span class="hljs-string">'notice'</span>,
            <span class="hljs-string">'Your changes were saved!'</span>
        );
        <span class="hljs-comment">// $this-&gt;addFlash() is equivalent to $request-&gt;getSession()-&gt;getFlashBag()-&gt;add()</span>

        <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>redirectToRoute(<span class="hljs-comment">/* ... */</span>);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>render(<span class="hljs-comment">/* ... */</span>);
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-bce31e142f0f4b8b721d74c85a9185f533213588" aria-label="Standalone Use" class="configuration-codeblock" data-language="php-standalone" style="display: none">
            <div translate="no" class="highlight-php-standalone highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php-standalone php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Session</span>\<span class="hljs-title">Session</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>session</span> = <span class="hljs-keyword">new</span> Session();
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>session</span><span class="hljs-operator">-&gt;</span>start();

<span class="hljs-comment">// retrieve the flash messages bag</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>flashes</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>session</span><span class="hljs-operator">-&gt;</span>getFlashBag();

<span class="hljs-comment">// add flash messages</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>flashes</span><span class="hljs-operator">-&gt;</span>add(
    <span class="hljs-string">'warning'</span>,
    <span class="hljs-string">'Your config file is writable, it should be set read-only'</span>
);
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>flashes</span><span class="hljs-operator">-&gt;</span>add(<span class="hljs-string">'error'</span>, <span class="hljs-string">'Failed to update name'</span>);
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>flashes</span><span class="hljs-operator">-&gt;</span>add(<span class="hljs-string">'error'</span>, <span class="hljs-string">'Another error'</span>);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>After processing the request, the controller sets a flash message in the session
and then redirects. The message key (<code translate="no" class="notranslate">notice</code> in this example) can be anything:
you'll use this key to retrieve the message.</p>
<p>In the template of the next page (or even better, in your base layout template),
read any flash messages from the session using the <code translate="no" class="notranslate">flashes()</code> method provided
by the <a href="templates.html#twig-app-variable" class="reference internal">Twig global app variable</a>:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-2">
                    <button role="tab" type="button" data-language="html+twig"
                aria-controls="configuration-block-tabpanel-81bbc5ebcb9533ce89320bc92b1125b6c18dac91" aria-selected="true"
                data-active="true" >
                <span>Twig</span>
            </button>
                    <button role="tab" type="button" data-language="php-standalone"
                aria-controls="configuration-block-tabpanel-0956d951fc047fe3617a29893c31b5975933b5b9" aria-selected="false"
                 tabindex="-1">
                <span>Standalone Use</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-81bbc5ebcb9533ce89320bc92b1125b6c18dac91" aria-label="Twig" class="configuration-codeblock" data-language="html+twig" style="">
            <div translate="no" class="highlight-html+twig highlight-twig notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs html+twig twig"><span class="hljs-comment">{# templates/base.html.twig #}</span><span class="xml">

</span><span class="hljs-comment">{# read and display just one flash message type #}</span><span class="xml">
</span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-keyword">for</span></span> message in app.flashes('notice') %}</span><span class="xml">
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flash-notice"</span>&gt;</span>
        </span><span class="hljs-template-variable">{{ message }}</span><span class="xml">
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-keyword">endfor</span></span> %}</span><span class="xml">

</span><span class="hljs-comment">{# read and display several types of flash messages #}</span><span class="xml">
</span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-keyword">for</span></span> label, messages in app.flashes(['success', 'warning']) %}</span><span class="xml">
    </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-keyword">for</span></span> message in messages %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flash-</span></span></span><span class="hljs-template-variable">{{ label }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span>&gt;</span>
            </span><span class="hljs-template-variable">{{ message }}</span><span class="xml">
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-keyword">endfor</span></span> %}</span><span class="xml">
</span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-keyword">endfor</span></span> %}</span><span class="xml">

</span><span class="hljs-comment">{# read and display all flash messages #}</span><span class="xml">
</span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-keyword">for</span></span> label, messages in app.flashes %}</span><span class="xml">
    </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-keyword">for</span></span> message in messages %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flash-</span></span></span><span class="hljs-template-variable">{{ label }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span>&gt;</span>
            </span><span class="hljs-template-variable">{{ message }}</span><span class="xml">
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-keyword">endfor</span></span> %}</span><span class="xml">
</span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-keyword">endfor</span></span> %}</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-0956d951fc047fe3617a29893c31b5975933b5b9" aria-label="Standalone Use" class="configuration-codeblock" data-language="php-standalone" style="display: none">
            <div translate="no" class="highlight-php-standalone highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php-standalone php"><span class="hljs-comment">// display warnings</span>
<span class="hljs-keyword">foreach</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>session</span><span class="hljs-operator">-&gt;</span>getFlashBag()<span class="hljs-operator">-&gt;</span>get(<span class="hljs-string">'warning'</span>, []) <span class="hljs-keyword">as</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>message</span>) {
    <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;div class="flash-warning"&gt;'</span>.<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>message</span>.<span class="hljs-string">'&lt;/div&gt;'</span>;
}

<span class="hljs-comment">// display errors</span>
<span class="hljs-keyword">foreach</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>session</span><span class="hljs-operator">-&gt;</span>getFlashBag()<span class="hljs-operator">-&gt;</span>get(<span class="hljs-string">'error'</span>, []) <span class="hljs-keyword">as</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>message</span>) {
    <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;div class="flash-error"&gt;'</span>.<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>message</span>.<span class="hljs-string">'&lt;/div&gt;'</span>;
}

<span class="hljs-comment">// display all flashes at once</span>
<span class="hljs-keyword">foreach</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>session</span><span class="hljs-operator">-&gt;</span>getFlashBag()<span class="hljs-operator">-&gt;</span>all() <span class="hljs-keyword">as</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>type</span> =&gt; <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>messages</span>) {
    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>messages</span> <span class="hljs-keyword">as</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>message</span>) {
        <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;div class="flash-'</span>.<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>type</span>.<span class="hljs-string">'"&gt;'</span>.<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>message</span>.<span class="hljs-string">'&lt;/div&gt;'</span>;
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>It's common to use <code translate="no" class="notranslate">notice</code>, <code translate="no" class="notranslate">warning</code> and <code translate="no" class="notranslate">error</code> as the keys of the
different types of flash messages, but you can use any key that fits your
needs.</p>
<div class="admonition admonition-tip ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                <span>Tip</span>
    </p><p>You can use the
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpFoundation/Session/Flash/FlashBagInterface.php#method_peek" class="reference external" title="Symfony\Component\HttpFoundation\Session\Flash\FlashBagInterface::peek()" rel="external noopener noreferrer" target="_blank">peek()</a>
method instead to retrieve the message while keeping it in the bag.</p>
</div>
</div>
<div class="section">
<h2 id="configuration">
    Configuration
    <a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a>
</h2>
<p>In the Symfony framework, sessions are enabled by default. Session storage and
other configuration can be controlled under the <a href="reference/configuration/framework.html#config-framework-session" class="reference internal">framework.session
configuration</a> in
<code translate="no" class="notranslate">config/packages/framework.yaml</code>:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-4">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-02784be64cee3d440fd271518638b8a53d0614f6" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-0c7b2c99d71056834ad8ec3380c87befab0a879f" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-9232d5ee95995071c605a76a802c0d0884118ba2" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
                    <button role="tab" type="button" data-language="php-standalone"
                aria-controls="configuration-block-tabpanel-c7fd1c82c5d46bbb870c586703bde100bd0943b3" aria-selected="false"
                 tabindex="-1">
                <span>Standalone Use</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-02784be64cee3d440fd271518638b8a53d0614f6" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/framework.yaml</span>
<span class="hljs-attr">framework:</span>
    <span class="hljs-comment"># Enables session support. Note that the session will ONLY be started if you read or write from it.</span>
    <span class="hljs-comment"># Remove or comment this section to explicitly disable session support.</span>
    <span class="hljs-attr">session:</span>
        <span class="hljs-comment"># ID of the service used for session storage</span>
        <span class="hljs-comment"># NULL means that Symfony uses PHP default session mechanism</span>
        <span class="hljs-attr">handler_id:</span> <span class="hljs-literal">null</span>
        <span class="hljs-comment"># improves the security of the cookies used for sessions</span>
        <span class="hljs-attr">cookie_secure:</span> <span class="hljs-string">auto</span>
        <span class="hljs-attr">cookie_samesite:</span> <span class="hljs-string">lax</span>
        <span class="hljs-attr">storage_factory_id:</span> <span class="hljs-string">session.storage.factory.native</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-0c7b2c99d71056834ad8ec3380c87befab0a879f" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/packages/framework.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:framework</span>=<span class="hljs-string">"http://symfony.com/schema/dic/symfony"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd
        http://symfony.com/schema/dic/symfony https://symfony.com/schema/dic/symfony/symfony-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">framework:config</span>&gt;</span>
        <span class="hljs-comment">&lt;!--
            Enables session support. Note that the session will ONLY be started if you read or write from it.
            Remove or comment this section to explicitly disable session support.
            handler-id: ID of the service used for session storage
                        NULL means that Symfony uses PHP default session mechanism
            cookie-secure and cookie-samesite: improves the security of the cookies used for sessions
        --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">framework:session</span> <span class="hljs-attr">handler-id</span>=<span class="hljs-string">"null"</span>
                           <span class="hljs-attr">cookie-secure</span>=<span class="hljs-string">"auto"</span>
                           <span class="hljs-attr">cookie-samesite</span>=<span class="hljs-string">"lax"</span>
                           <span class="hljs-attr">storage_factory_id</span>=<span class="hljs-string">"session.storage.factory.native"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">framework:config</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-9232d5ee95995071c605a76a802c0d0884118ba2" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/packages/framework.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Cookie</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Config</span>\<span class="hljs-title">FrameworkConfig</span>;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(FrameworkConfig <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span><span class="hljs-operator">-&gt;</span>session()
        <span class="hljs-comment">// Enables session support. Note that the session will ONLY be started if you read or write from it.</span>
        <span class="hljs-comment">// Remove or comment this section to explicitly disable session support.</span>
        <span class="hljs-operator">-&gt;</span>enabled(<span class="hljs-keyword">true</span>)
        <span class="hljs-comment">// ID of the service used for session storage</span>
        <span class="hljs-comment">// NULL means that Symfony uses PHP default session mechanism</span>
        <span class="hljs-operator">-&gt;</span>handlerId(<span class="hljs-keyword">null</span>)
        <span class="hljs-comment">// improves the security of the cookies used for sessions</span>
        <span class="hljs-operator">-&gt;</span>cookieSecure(<span class="hljs-string">'auto'</span>)
        <span class="hljs-operator">-&gt;</span>cookieSamesite(Cookie<span class="hljs-operator">::</span>SAMESITE_LAX)
        <span class="hljs-operator">-&gt;</span>storageFactoryId(<span class="hljs-string">'session.storage.factory.native'</span>)
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-c7fd1c82c5d46bbb870c586703bde100bd0943b3" aria-label="Standalone Use" class="configuration-codeblock" data-language="php-standalone" style="display: none">
            <div translate="no" class="highlight-php-standalone highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php-standalone php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Cookie</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Session</span>\<span class="hljs-title">Attribute</span>\<span class="hljs-title">AttributeBag</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Session</span>\<span class="hljs-title">Session</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Session</span>\<span class="hljs-title">Storage</span>\<span class="hljs-title">NativeSessionStorage</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>storage</span> = <span class="hljs-keyword">new</span> NativeSessionStorage([
    <span class="hljs-string">'cookie_secure'</span> =&gt; <span class="hljs-string">'auto'</span>,
    <span class="hljs-string">'cookie_samesite'</span> =&gt; Cookie<span class="hljs-operator">::</span>SAMESITE_LAX,
]);
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>session</span> = <span class="hljs-keyword">new</span> Session(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>storage</span>);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>Setting the <code translate="no" class="notranslate">handler_id</code> config option to <code translate="no" class="notranslate">null</code> means that Symfony will
use the native PHP session mechanism. The session metadata files will be stored
outside of the Symfony application, in a directory controlled by PHP. Although
this usually simplifies things, some session expiration related options may not
work as expected if other applications that write to the same directory have
short max lifetime settings.</p>
<p>If you prefer, you can use the <code translate="no" class="notranslate">session.handler.native_file</code> service as
<code translate="no" class="notranslate">handler_id</code> to let Symfony manage the sessions itself. Another useful option
is <code translate="no" class="notranslate">save_path</code>, which defines the directory where Symfony will store the
session metadata files:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-4">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-4e4dc9d3c9b95fd8ec272c26e0dc4d73c507b1f8" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-6ed5597444ed9bb2ccf77d8823f8929bd49a784b" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-88f80bc5dd6336cfd1f5e4b53b3f47421769571f" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
                    <button role="tab" type="button" data-language="php-standalone"
                aria-controls="configuration-block-tabpanel-c6d2505e8b4d07f1e7dfe9ad86d85f393724e53c" aria-selected="false"
                 tabindex="-1">
                <span>Standalone Use</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-4e4dc9d3c9b95fd8ec272c26e0dc4d73c507b1f8" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/framework.yaml</span>
<span class="hljs-attr">framework:</span>
    <span class="hljs-attr">session:</span>
        <span class="hljs-comment"># ...</span>
        <span class="hljs-attr">handler_id:</span> <span class="hljs-string">'session.handler.native_file'</span>
        <span class="hljs-attr">save_path:</span> <span class="hljs-string">'%kernel.project_dir%/var/sessions/%kernel.environment%'</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-6ed5597444ed9bb2ccf77d8823f8929bd49a784b" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/packages/framework.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:framework</span>=<span class="hljs-string">"http://symfony.com/schema/dic/symfony"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd
        http://symfony.com/schema/dic/symfony https://symfony.com/schema/dic/symfony/symfony-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">framework:config</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">framework:session</span> <span class="hljs-attr">enabled</span>=<span class="hljs-string">"true"</span>
                           <span class="hljs-attr">handler-id</span>=<span class="hljs-string">"session.handler.native_file"</span>
                           <span class="hljs-attr">save-path</span>=<span class="hljs-string">"%kernel.project_dir%/var/sessions/%kernel.environment%"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">framework:config</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-88f80bc5dd6336cfd1f5e4b53b3f47421769571f" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/packages/framework.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Config</span>\<span class="hljs-title">FrameworkConfig</span>;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(FrameworkConfig <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span><span class="hljs-operator">-&gt;</span>session()
        <span class="hljs-comment">// ...</span>
        <span class="hljs-operator">-&gt;</span>handlerId(<span class="hljs-string">'session.handler.native_file'</span>)
        <span class="hljs-operator">-&gt;</span>savePath(<span class="hljs-string">'%kernel.project_dir%/var/sessions/%kernel.environment%'</span>)
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-c6d2505e8b4d07f1e7dfe9ad86d85f393724e53c" aria-label="Standalone Use" class="configuration-codeblock" data-language="php-standalone" style="display: none">
            <div translate="no" class="highlight-php-standalone highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php-standalone php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Cookie</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Session</span>\<span class="hljs-title">Attribute</span>\<span class="hljs-title">AttributeBag</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Session</span>\<span class="hljs-title">Session</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Session</span>\<span class="hljs-title">Storage</span>\<span class="hljs-title">Handler</span>\<span class="hljs-title">NativeFileSessionHandler</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Session</span>\<span class="hljs-title">Storage</span>\<span class="hljs-title">NativeSessionStorage</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>handler</span> = <span class="hljs-keyword">new</span> NativeFileSessionHandler(<span class="hljs-string">'/var/sessions'</span>);
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>storage</span> = <span class="hljs-keyword">new</span> NativeSessionStorage([], <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>handler</span>);
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>session</span> = <span class="hljs-keyword">new</span> Session(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>storage</span>);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>Check out the Symfony config reference to learn more about the other available
<a href="reference/configuration/framework.html#config-framework-session" class="reference internal">Session configuration options</a>.</p>
<div class="admonition admonition-caution ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                <span>Caution</span>
    </p><p>Symfony sessions are incompatible with <code translate="no" class="notranslate">php.ini</code> directive
<code translate="no" class="notranslate">session.auto_start = 1</code> This directive should be turned off in
<code translate="no" class="notranslate">php.ini</code>, in the web server directives or in <code translate="no" class="notranslate">.htaccess</code>.</p>
</div>
<div class="section">
<h3 id="session-idle-time-keep-alive">
    Session Idle Time/Keep Alive
    <a class="headerlink" href="#session-idle-time-keep-alive" title="Permalink to this headline">¶</a>
</h3>
<p>There are often circumstances where you may want to protect, or minimize
unauthorized use of a session when a user steps away from their terminal while
logged in by destroying the session after a certain period of idle time. For
example, it is common for banking applications to log the user out after just
5 to 10 minutes of inactivity. Setting the cookie lifetime here is not
appropriate because that can be manipulated by the client, so we must do the expiry
on the server side. The easiest way is to implement this via garbage collection
which runs reasonably frequently. The <code translate="no" class="notranslate">cookie_lifetime</code> would be set to a
relatively high value, and the garbage collection <code translate="no" class="notranslate">gc_maxlifetime</code> would be set
to destroy sessions at whatever the desired idle period is.</p>
<p>The other option is specifically check if a session has expired after the
session is started. The session can be destroyed as required. This method of
processing can allow the expiry of sessions to be integrated into the user
experience, for example, by displaying a message.</p>
<p>Symfony records some metadata about each session to give you fine control over
the security settings:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>session</span><span class="hljs-operator">-&gt;</span>getMetadataBag()<span class="hljs-operator">-&gt;</span>getCreated();
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>session</span><span class="hljs-operator">-&gt;</span>getMetadataBag()<span class="hljs-operator">-&gt;</span>getLastUsed();</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Both methods return a Unix timestamp (relative to the server).</p>
<p>This metadata can be used to explicitly expire a session on access:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>session</span><span class="hljs-operator">-&gt;</span>start();
<span class="hljs-keyword">if</span> (time() - <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>session</span><span class="hljs-operator">-&gt;</span>getMetadataBag()<span class="hljs-operator">-&gt;</span>getLastUsed() &gt; <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>maxIdleTime</span>) {
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>session</span><span class="hljs-operator">-&gt;</span>invalidate();
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> SessionExpired(); <span class="hljs-comment">// redirect to expired session page</span>
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>It is also possible to tell what the <code translate="no" class="notranslate">cookie_lifetime</code> was set to for a
particular cookie by reading the <code translate="no" class="notranslate">getLifetime()</code> method:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>session</span><span class="hljs-operator">-&gt;</span>getMetadataBag()<span class="hljs-operator">-&gt;</span>getLifetime();</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>The expiry time of the cookie can be determined by adding the created
timestamp and the lifetime.</p>
<span id="session-database"></span>
</div>
</div>
<div class="section">
<h2 id="store-sessions-in-a-database">
    Store Sessions in a Database
    <a class="headerlink" href="#store-sessions-in-a-database" title="Permalink to this headline">¶</a>
</h2>
<p>Symfony stores sessions in files by default. If your application is served by
multiple servers, you'll need to use a database instead to make sessions work
across different servers.</p>
<p>Symfony can store sessions in all kinds of databases (relational, NoSQL and
key-value) but recommends key-value databases like Redis to get best
performance.</p>
<div class="section">
<h3 id="store-sessions-in-a-key-value-database-redis">
    Store Sessions in a key-value Database (Redis)
    <a class="headerlink" href="#store-sessions-in-a-key-value-database-redis" title="Permalink to this headline">¶</a>
</h3>
<p>This section assumes that you have a fully-working Redis server and have also
installed and configured the <a href="https://github.com/phpredis/phpredis" class="reference external" rel="external noopener noreferrer" target="_blank">phpredis extension</a>.</p>
<p>You have two different options to use Redis to store sessions:</p>
<p>The first PHP-based option is to configure Redis session handler directly
in the server <code translate="no" class="notranslate">php.ini</code> file:</p>
<div translate="no" class="highlight-ini notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs ini"><span class="hljs-comment">; php.ini</span>
<span class="hljs-attr">session.save_handler</span> = redis
<span class="hljs-attr">session.save_path</span> = <span class="hljs-string">"tcp://192.168.0.178:6379?auth=REDIS_PASSWORD"</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>The second option is to configure Redis sessions in Symfony. First, define
a Symfony service for the connection to the Redis server:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-2">
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-e34defbcf5fea0ff00cb8ebee45f4009d40496b4" aria-selected="true"
                data-active="true" >
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-8e737ce5ffeb8c7cf7c46abccd5384658bbc4ca6" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-e34defbcf5fea0ff00cb8ebee45f4009d40496b4" aria-label="XML" class="configuration-codeblock" data-language="xml" style="">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services https://symfony.com/schema/dic/services/services-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">services</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- you can also use \RedisArray, \RedisCluster, \Relay\Relay or \Predis\Client classes --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Redis"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"Redis"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">call</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"connect"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">argument</span>&gt;</span>%env(REDIS_HOST)%<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">argument</span>&gt;</span>%env(int:REDIS_PORT)%<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">call</span>&gt;</span>

            <span class="hljs-comment">&lt;!-- uncomment the following if your Redis server requires a password:
            &lt;call method="auth"&gt;
                &lt;argument&gt;%env(REDIS_PASSWORD)%&lt;/argument&gt;
            &lt;/call&gt; --&gt;</span>

            <span class="hljs-comment">&lt;!-- uncomment the following if your Redis server requires a user and a password (when user is not default):
            &lt;call method="auth"&gt;
                &lt;argument&gt;%env(REDIS_USER)%&lt;/argument&gt;
                &lt;argument&gt;%env(REDIS_PASSWORD)%&lt;/argument&gt;
            &lt;/call&gt; --&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Symfony\Component\HttpFoundation\Session\Storage\Handler\RedisSessionHandler"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"service"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Redis"</span>/&gt;</span>
            <span class="hljs-comment">&lt;!-- you can optionally pass an array of options. The only options are 'prefix' and 'ttl',
                 which define the prefix to use for the keys to avoid collision on the Redis server
                 and the expiration time for any given entry (in seconds), defaults are 'sf_s' and null:
            &lt;argument type="collection"&gt;
                &lt;argument key="prefix"&gt;my_prefix&lt;/argument&gt;
                &lt;argument key="ttl"&gt;600&lt;/argument&gt;
            &lt;/argument&gt; --&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">services</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-8e737ce5ffeb8c7cf7c46abccd5384658bbc4ca6" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/services.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Reference</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Session</span>\<span class="hljs-title">Storage</span>\<span class="hljs-title">Handler</span>\<span class="hljs-title">RedisSessionHandler</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>container</span>
    <span class="hljs-comment">// you can also use \RedisArray, \RedisCluster, \Relay\Relay or \Predis\Client classes</span>
    <span class="hljs-operator">-&gt;</span>register(<span class="hljs-string">'Redis'</span>, \Redis<span class="hljs-operator">::</span>class)
    <span class="hljs-operator">-&gt;</span>addMethodCall(<span class="hljs-string">'connect'</span>, [<span class="hljs-string">'%env(REDIS_HOST)%'</span>, <span class="hljs-string">'%env(int:REDIS_PORT)%'</span>])
    <span class="hljs-comment">// uncomment the following if your Redis server requires a password:</span>
    <span class="hljs-comment">// -&gt;addMethodCall('auth', ['%env(REDIS_PASSWORD)%'])</span>
    <span class="hljs-comment">// uncomment the following if your Redis server requires a user and a password (when user is not default):</span>
    <span class="hljs-comment">// -&gt;addMethodCall('auth', ['%env(REDIS_USER)%', '%env(REDIS_PASSWORD)%'])</span>

    <span class="hljs-operator">-&gt;</span>register(RedisSessionHandler<span class="hljs-operator">::</span>class)
    <span class="hljs-operator">-&gt;</span>addArgument(
        <span class="hljs-keyword">new</span> Reference(<span class="hljs-string">'Redis'</span>),
        <span class="hljs-comment">// you can optionally pass an array of options. The only options are 'prefix' and 'ttl',</span>
        <span class="hljs-comment">// which define the prefix to use for the keys to avoid collision on the Redis server</span>
        <span class="hljs-comment">// and the expiration time for any given entry (in seconds), defaults are 'sf_s' and null:</span>
        <span class="hljs-comment">// ['prefix' =&gt; 'my_prefix', 'ttl' =&gt; 600],</span>
    )
;</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>Next, use the <a href="reference/configuration/framework.html#config-framework-session-handler-id" class="reference internal">handler_id</a>
configuration option to tell Symfony to use this service as the session handler:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-68dd83e3618f9ed2ef1b4f3e47c0ad69f5f804b7" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-4bb3f686376cbc03a2774d517fd04812c86b95b3" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-1d9e3e626a18fcb2e346e1a77e33729ef921f413" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-68dd83e3618f9ed2ef1b4f3e47c0ad69f5f804b7" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/framework.yaml</span>
<span class="hljs-attr">framework:</span>
    <span class="hljs-comment"># ...</span>
    <span class="hljs-attr">session:</span>
        <span class="hljs-attr">handler_id:</span> <span class="hljs-string">Symfony\Component\HttpFoundation\Session\Storage\Handler\RedisSessionHandler</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-4bb3f686376cbc03a2774d517fd04812c86b95b3" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/packages/framework.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:framework</span>=<span class="hljs-string">"http://symfony.com/schema/dic/symfony"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd
        http://symfony.com/schema/dic/symfony
        https://symfony.com/schema/dic/symfony/symfony-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">framework:config</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- ... --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">framework:session</span> <span class="hljs-attr">handler-id</span>=<span class="hljs-string">"Symfony\Component\HttpFoundation\Session\Storage\Handler\RedisSessionHandler"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">framework:config</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-1d9e3e626a18fcb2e346e1a77e33729ef921f413" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/packages/framework.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Session</span>\<span class="hljs-title">Storage</span>\<span class="hljs-title">Handler</span>\<span class="hljs-title">RedisSessionHandler</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Config</span>\<span class="hljs-title">FrameworkConfig</span>;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(FrameworkConfig <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span>)</span> </span>{
    <span class="hljs-comment">// ...</span>
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span><span class="hljs-operator">-&gt;</span>session()
        <span class="hljs-operator">-&gt;</span>handlerId(RedisSessionHandler<span class="hljs-operator">::</span>class)
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>Symfony will now use your Redis server to read and write the session data. The
main drawback of this solution is that Redis does not perform session locking,
so you can face <em>race conditions</em> when accessing sessions. For example, you may
see an <em>&quot;Invalid CSRF token&quot;</em> error because two requests were made in parallel
and only the first one stored the CSRF token in the session.</p>
<div class="admonition admonition-seealso ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" /></svg>
                <span>See also</span>
    </p><p>If you use Memcached instead of Redis, follow a similar approach but
replace <code translate="no" class="notranslate">RedisSessionHandler</code> by
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpFoundation/Session/Storage/Handler/MemcachedSessionHandler.php" class="reference external" title="Symfony\Component\HttpFoundation\Session\Storage\Handler\MemcachedSessionHandler" rel="external noopener noreferrer" target="_blank">MemcachedSessionHandler</a>.</p>
</div>
<span id="session-database-pdo"></span>
</div>
<div class="section">
<h3 id="store-sessions-in-a-relational-database-mariadb-mysql-postgresql">
    Store Sessions in a Relational Database (MariaDB, MySQL, PostgreSQL)
    <a class="headerlink" href="#store-sessions-in-a-relational-database-mariadb-mysql-postgresql" title="Permalink to this headline">¶</a>
</h3>
<p>Symfony includes a
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpFoundation/Session/Storage/Handler/PdoSessionHandler.php" class="reference external" title="Symfony\Component\HttpFoundation\Session\Storage\Handler\PdoSessionHandler" rel="external noopener noreferrer" target="_blank">PdoSessionHandler</a>
to store sessions in relational databases like MariaDB, MySQL and PostgreSQL.
To use it, first register a new handler service with your database credentials:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-fd2c819b6664ea32682b03ffdb7677eeb8e2f396" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-c83a6b9eb3b200d1505bf9b8037304b620736f2d" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-934771a29daf1be1d7a9f2a688cf2eda29885d24" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-fd2c819b6664ea32682b03ffdb7677eeb8e2f396" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/services.yaml</span>
<span class="hljs-attr">services:</span>
    <span class="hljs-comment"># ...</span>

    <span class="hljs-string">Symfony\Component\HttpFoundation\Session\Storage\Handler\PdoSessionHandler:</span>
        <span class="hljs-attr">arguments:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">'%env(DATABASE_URL)%'</span>

            <span class="hljs-comment"># you can also use PDO configuration, but requires passing two arguments</span>
            <span class="hljs-comment"># - 'mysql:dbname=mydatabase; host=myhost; port=myport'</span>
            <span class="hljs-comment"># - { db_username: myuser, db_password: mypassword }</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-c83a6b9eb3b200d1505bf9b8037304b620736f2d" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/services.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:framework</span>=<span class="hljs-string">"http://symfony.com/schema/dic/symfony"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd
        https://symfony.com/schema/dic/symfony/symfony-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">services</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Symfony\Component\HttpFoundation\Session\Storage\Handler\PdoSessionHandler"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span>&gt;</span>%env(DATABASE_URL)%<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>

            <span class="hljs-comment">&lt;!-- you can also use PDO configuration, but requires passing two arguments: --&gt;</span>
            <span class="hljs-comment">&lt;!-- &lt;argument&gt;mysql:dbname=mydatabase; host=myhost; port=myport&lt;/argument&gt;
                &lt;argument type="collection"&gt;
                    &lt;argument key="db_username"&gt;myuser&lt;/argument&gt;
                    &lt;argument key="db_password"&gt;mypassword&lt;/argument&gt;
                &lt;/argument&gt; --&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">services</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-934771a29daf1be1d7a9f2a688cf2eda29885d24" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/services.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Loader</span>\<span class="hljs-title">Configurator</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Session</span>\<span class="hljs-title">Storage</span>\<span class="hljs-title">Handler</span>\<span class="hljs-title">PdoSessionHandler</span>;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ContainerConfigurator <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span><span class="hljs-operator">-&gt;</span>services();

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span><span class="hljs-operator">-&gt;</span>set(PdoSessionHandler<span class="hljs-operator">::</span>class)
        <span class="hljs-operator">-&gt;</span>args([
            env(<span class="hljs-string">'DATABASE_URL'</span>),
            <span class="hljs-comment">// you can also use PDO configuration, but requires passing two arguments:</span>
            <span class="hljs-comment">// 'mysql:dbname=mydatabase; host=myhost; port=myport',</span>
            <span class="hljs-comment">// ['db_username' =&gt; 'myuser', 'db_password' =&gt; 'mypassword'],</span>
        ])
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<div class="admonition admonition-tip ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                <span>Tip</span>
    </p><p>When using MySQL as the database, the DSN defined in <code translate="no" class="notranslate">DATABASE_URL</code> can
contain the <code translate="no" class="notranslate">charset</code> and <code translate="no" class="notranslate">unix_socket</code> options as query string parameters.</p>
</div>
<p>Next, use the <a href="reference/configuration/framework.html#config-framework-session-handler-id" class="reference internal">handler_id</a>
configuration option to tell Symfony to use this service as the session handler:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-25577aed4fc2c3844cc08f38641f0964d2ea295c" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-1ae46315785f7031ca9cd5c8904de166a915d49e" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-c40077662cebff42a920e53e3701cc8f3c2109e8" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-25577aed4fc2c3844cc08f38641f0964d2ea295c" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/framework.yaml</span>
<span class="hljs-attr">framework:</span>
    <span class="hljs-attr">session:</span>
        <span class="hljs-comment"># ...</span>
        <span class="hljs-attr">handler_id:</span> <span class="hljs-string">Symfony\Component\HttpFoundation\Session\Storage\Handler\PdoSessionHandler</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-1ae46315785f7031ca9cd5c8904de166a915d49e" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/packages/framework.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:framework</span>=<span class="hljs-string">"http://symfony.com/schema/dic/symfony"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd
        http://symfony.com/schema/dic/symfony
        https://symfony.com/schema/dic/symfony/symfony-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">framework:config</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- ... --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">framework:session</span>
            <span class="hljs-attr">handler-id</span>=<span class="hljs-string">"Symfony\Component\HttpFoundation\Session\Storage\Handler\PdoSessionHandler"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">framework:config</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-c40077662cebff42a920e53e3701cc8f3c2109e8" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/packages/framework.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Session</span>\<span class="hljs-title">Storage</span>\<span class="hljs-title">Handler</span>\<span class="hljs-title">PdoSessionHandler</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Config</span>\<span class="hljs-title">FrameworkConfig</span>;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(FrameworkConfig <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span>)</span> </span>{
    <span class="hljs-comment">// ...</span>
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span><span class="hljs-operator">-&gt;</span>session()
        <span class="hljs-operator">-&gt;</span>handlerId(PdoSessionHandler<span class="hljs-operator">::</span>class)
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<div class="section">
<h4 id="configuring-the-session-table-and-column-names">
    Configuring the Session Table and Column Names
    <a class="headerlink" href="#configuring-the-session-table-and-column-names" title="Permalink to this headline">¶</a>
</h4>
<p>The table used to store sessions is called <code translate="no" class="notranslate">sessions</code> by default and defines
certain column names. You can configure these values with the second argument
passed to the <code translate="no" class="notranslate">PdoSessionHandler</code> service:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-c73f50a0bb87050e6bf5150d104e6e5d117a1a5b" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-cf4a158d66db14fa9e3c1b00d131f7d5af55a181" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-07c4eca1b5481baef8c8af2183368e6200fb3488" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-c73f50a0bb87050e6bf5150d104e6e5d117a1a5b" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/services.yaml</span>
<span class="hljs-attr">services:</span>
    <span class="hljs-comment"># ...</span>

    <span class="hljs-string">Symfony\Component\HttpFoundation\Session\Storage\Handler\PdoSessionHandler:</span>
        <span class="hljs-attr">arguments:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">'%env(DATABASE_URL)%'</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">{</span> <span class="hljs-attr">db_table:</span> <span class="hljs-string">'customer_session'</span><span class="hljs-string">,</span> <span class="hljs-attr">db_id_col:</span> <span class="hljs-string">'guid'</span> <span class="hljs-string">}</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-cf4a158d66db14fa9e3c1b00d131f7d5af55a181" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/services.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">services</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Symfony\Component\HttpFoundation\Session\Storage\Handler\PdoSessionHandler"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span>&gt;</span>%env(DATABASE_URL)%<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"collection"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"db_table"</span>&gt;</span>customer_session<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"db_id_col"</span>&gt;</span>guid<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">services</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-07c4eca1b5481baef8c8af2183368e6200fb3488" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/services.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Loader</span>\<span class="hljs-title">Configurator</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Session</span>\<span class="hljs-title">Storage</span>\<span class="hljs-title">Handler</span>\<span class="hljs-title">PdoSessionHandler</span>;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ContainerConfigurator <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span><span class="hljs-operator">-&gt;</span>services();

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span><span class="hljs-operator">-&gt;</span>set(PdoSessionHandler<span class="hljs-operator">::</span>class)
        <span class="hljs-operator">-&gt;</span>args([
            env(<span class="hljs-string">'DATABASE_URL'</span>),
            [<span class="hljs-string">'db_table'</span> =&gt; <span class="hljs-string">'customer_session'</span>, <span class="hljs-string">'db_id_col'</span> =&gt; <span class="hljs-string">'guid'</span>],
        ])
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>These are parameters that you can configure:</p>
<dl>
                        <dt><code translate="no" class="notranslate">db_table</code> (default <code translate="no" class="notranslate">sessions</code>):</dt>
        
        <dd>
                            The name of the session table in your database;
                    </dd>
                        <dt><code translate="no" class="notranslate">db_username</code>: (default: <code translate="no" class="notranslate">&#039;&#039;</code>)</dt>
        
        <dd>
                            The username used to connect when using the PDO configuration (when using
the connection based on the <code translate="no" class="notranslate">DATABASE_URL</code> env var, it overrides the
username defined in the env var).
                    </dd>
                        <dt><code translate="no" class="notranslate">db_password</code>: (default: <code translate="no" class="notranslate">&#039;&#039;</code>)</dt>
        
        <dd>
                            The password used to connect when using the PDO configuration (when using
the connection based on the <code translate="no" class="notranslate">DATABASE_URL</code> env var, it overrides the
password defined in the env var).
                    </dd>
                        <dt><code translate="no" class="notranslate">db_id_col</code> (default <code translate="no" class="notranslate">sess_id</code>):</dt>
        
        <dd>
                            The name of the column where to store the session ID (column type: <code translate="no" class="notranslate">VARCHAR(128)</code>);
                    </dd>
                        <dt><code translate="no" class="notranslate">db_data_col</code> (default <code translate="no" class="notranslate">sess_data</code>):</dt>
        
        <dd>
                            The name of the column where to store the session data (column type: <code translate="no" class="notranslate">BLOB</code>);
                    </dd>
                        <dt><code translate="no" class="notranslate">db_time_col</code> (default <code translate="no" class="notranslate">sess_time</code>):</dt>
        
        <dd>
                            The name of the column where to store the session creation timestamp (column type: <code translate="no" class="notranslate">INTEGER</code>);
                    </dd>
                        <dt><code translate="no" class="notranslate">db_lifetime_col</code> (default <code translate="no" class="notranslate">sess_lifetime</code>):</dt>
        
        <dd>
                            The name of the column where to store the session lifetime (column type: <code translate="no" class="notranslate">INTEGER</code>);
                    </dd>
                        <dt><code translate="no" class="notranslate">db_connection_options</code> (default: <code translate="no" class="notranslate">[]</code>)</dt>
        
        <dd>
                            An array of driver-specific connection options;
                    </dd>
                        <dt><code translate="no" class="notranslate">lock_mode</code> (default: <code translate="no" class="notranslate">LOCK_TRANSACTIONAL</code>)</dt>
        
        <dd>
                            The strategy for locking the database to avoid <em>race conditions</em>. Possible
values are <code translate="no" class="notranslate">LOCK_NONE</code> (no locking), <code translate="no" class="notranslate">LOCK_ADVISORY</code> (application-level
locking) and <code translate="no" class="notranslate">LOCK_TRANSACTIONAL</code> (row-level locking).
                    </dd>
    </dl>
</div>
<div class="section">
<h4 id="preparing-the-database-to-store-sessions">
    Preparing the Database to Store Sessions
    <a class="headerlink" href="#preparing-the-database-to-store-sessions" title="Permalink to this headline">¶</a>
</h4>
<p>Before storing sessions in the database, you must create the table that stores
the information. The session handler provides a method called
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpFoundation/Session/Storage/Handler/PdoSessionHandler.php#method_createTable" class="reference external" title="Symfony\Component\HttpFoundation\Session\Storage\Handler\PdoSessionHandler::createTable()" rel="external noopener noreferrer" target="_blank">createTable()</a>
to set up this table for you according to the database engine used:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">try</span> {
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>sessionHandlerService</span><span class="hljs-operator">-&gt;</span>createTable();
} <span class="hljs-keyword">catch</span> (\PDOException <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>exception</span>) {
    <span class="hljs-comment">// the table could not be created for some reason</span>
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>If you prefer to set up the table yourself, it's recommended to generate an
empty database migration with the following command:</p>
<div translate="no" class="highlight-terminal highlight-bash notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs terminal bash"><span class="hljs-prompt">$ </span>php bin/console doctrine:migrations:generate</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Then, find the appropriate SQL for your database below, add it to the migration
file and run the migration with the following command:</p>
<div translate="no" class="highlight-terminal highlight-bash notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs terminal bash"><span class="hljs-prompt">$ </span>php bin/console doctrine:migrations:migrate</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<span id="mysql"></span>
<div class="section">
<h5 id="mariadb-mysql">
    MariaDB/MySQL
    <a class="headerlink" href="#mariadb-mysql" title="Permalink to this headline">¶</a>
</h5>
<div translate="no" class="highlight-sql notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`sessions`</span> (
    <span class="hljs-string">`sess_id`</span> VARBINARY(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> PRIMARY <span class="hljs-keyword">KEY</span>,
    <span class="hljs-string">`sess_data`</span> <span class="hljs-built_in">BLOB</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
    <span class="hljs-string">`sess_lifetime`</span> <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">UNSIGNED</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
    <span class="hljs-string">`sess_time`</span> <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">UNSIGNED</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
    <span class="hljs-keyword">INDEX</span> <span class="hljs-string">`sessions_sess_lifetime_idx`</span> (<span class="hljs-string">`sess_lifetime`</span>)
) <span class="hljs-keyword">COLLATE</span> utf8mb4_bin, <span class="hljs-keyword">ENGINE</span> = <span class="hljs-keyword">InnoDB</span>;</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>A <code translate="no" class="notranslate">BLOB</code> column type (which is the one used by default by <code translate="no" class="notranslate">createTable()</code>)
stores up to 64 kb. If the user session data exceeds this, an exception may
be thrown or their session will be silently reset. Consider using a <code translate="no" class="notranslate">MEDIUMBLOB</code>
if you need more space.</p>
</div>
</div>
<div class="section">
<h5 id="postgresql">
    PostgreSQL
    <a class="headerlink" href="#postgresql" title="Permalink to this headline">¶</a>
</h5>
<div translate="no" class="highlight-sql notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> sessions (
    sess_id <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> PRIMARY <span class="hljs-keyword">KEY</span>,
    sess_data BYTEA <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
    sess_lifetime <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
    sess_time <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>
);
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> sessions_sess_lifetime_idx <span class="hljs-keyword">ON</span> sessions (sess_lifetime);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
<div class="section">
<h5 id="microsoft-sql-server">
    Microsoft SQL Server
    <a class="headerlink" href="#microsoft-sql-server" title="Permalink to this headline">¶</a>
</h5>
<div translate="no" class="highlight-sql notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> sessions (
    sess_id <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> PRIMARY <span class="hljs-keyword">KEY</span>,
    sess_data <span class="hljs-keyword">NVARCHAR</span>(<span class="hljs-keyword">MAX</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
    sess_lifetime <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
    sess_time <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
    <span class="hljs-keyword">INDEX</span> sessions_sess_lifetime_idx (sess_lifetime)
);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<span id="session-database-mongodb"></span>
</div>
</div>
</div>
<div class="section">
<h3 id="store-sessions-in-a-nosql-database-mongodb">
    Store Sessions in a NoSQL Database (MongoDB)
    <a class="headerlink" href="#store-sessions-in-a-nosql-database-mongodb" title="Permalink to this headline">¶</a>
</h3>
<p>Symfony includes a
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpFoundation/Session/Storage/Handler/MongoDbSessionHandler.php" class="reference external" title="Symfony\Component\HttpFoundation\Session\Storage\Handler\MongoDbSessionHandler" rel="external noopener noreferrer" target="_blank">MongoDbSessionHandler</a>
to store sessions in the MongoDB NoSQL database. First, make sure to have a
working MongoDB connection in your Symfony application as explained in the
<a href="https://symfony.com/doc/master/bundles/DoctrineMongoDBBundle/config.html" class="reference external">DoctrineMongoDBBundle configuration</a> article.</p>
<p>Then, register a new handler service for <code translate="no" class="notranslate">MongoDbSessionHandler</code> and pass it
the MongoDB connection as argument:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-51c26b2ae63b190c49dafc57a3b452252e7565d4" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-8f7b72655611fe175112620fd207684f785ec370" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-17b68ffdf913e0fb5ae6aaa3bdec9c643c5c69b5" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-51c26b2ae63b190c49dafc57a3b452252e7565d4" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/services.yaml</span>
<span class="hljs-attr">services:</span>
    <span class="hljs-comment"># ...</span>

    <span class="hljs-string">Symfony\Component\HttpFoundation\Session\Storage\Handler\MongoDbSessionHandler:</span>
        <span class="hljs-attr">arguments:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">'@doctrine_mongodb.odm.default_connection'</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-8f7b72655611fe175112620fd207684f785ec370" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/services.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:framework</span>=<span class="hljs-string">"http://symfony.com/schema/dic/symfony"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd
        https://symfony.com/schema/dic/symfony/symfony-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">services</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Symfony\Component\HttpFoundation\Session\Storage\Handler\MongoDbSessionHandler"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"service"</span>&gt;</span>doctrine_mongodb.odm.default_connection<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">services</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-17b68ffdf913e0fb5ae6aaa3bdec9c643c5c69b5" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/services.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Loader</span>\<span class="hljs-title">Configurator</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Session</span>\<span class="hljs-title">Storage</span>\<span class="hljs-title">Handler</span>\<span class="hljs-title">MongoDbSessionHandler</span>;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ContainerConfigurator <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span><span class="hljs-operator">-&gt;</span>services();

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span><span class="hljs-operator">-&gt;</span>set(MongoDbSessionHandler<span class="hljs-operator">::</span>class)
        <span class="hljs-operator">-&gt;</span>args([
            service(<span class="hljs-string">'doctrine_mongodb.odm.default_connection'</span>),
        ])
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>Next, use the <a href="reference/configuration/framework.html#config-framework-session-handler-id" class="reference internal">handler_id</a>
configuration option to tell Symfony to use this service as the session handler:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-95d5306ebfc46a03e58eb8cedae8c28925e0ae18" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-f1651a798a1840d385b5fa3ab9bf30b19029812e" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-9f014a999f5d1164476ca29f28d00cb8d5745149" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-95d5306ebfc46a03e58eb8cedae8c28925e0ae18" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/framework.yaml</span>
<span class="hljs-attr">framework:</span>
    <span class="hljs-attr">session:</span>
        <span class="hljs-comment"># ...</span>
        <span class="hljs-attr">handler_id:</span> <span class="hljs-string">Symfony\Component\HttpFoundation\Session\Storage\Handler\MongoDbSessionHandler</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-f1651a798a1840d385b5fa3ab9bf30b19029812e" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/packages/framework.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:framework</span>=<span class="hljs-string">"http://symfony.com/schema/dic/symfony"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd
        http://symfony.com/schema/dic/symfony
        https://symfony.com/schema/dic/symfony/symfony-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">framework:config</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- ... --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">framework:session</span>
            <span class="hljs-attr">handler-id</span>=<span class="hljs-string">"Symfony\Component\HttpFoundation\Session\Storage\Handler\MongoDbSessionHandler"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">framework:config</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-9f014a999f5d1164476ca29f28d00cb8d5745149" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/packages/framework.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Session</span>\<span class="hljs-title">Storage</span>\<span class="hljs-title">Handler</span>\<span class="hljs-title">MongoDbSessionHandler</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Config</span>\<span class="hljs-title">FrameworkConfig</span>;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(FrameworkConfig <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span>)</span> </span>{
    <span class="hljs-comment">// ...</span>
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span><span class="hljs-operator">-&gt;</span>session()
        <span class="hljs-operator">-&gt;</span>handlerId(MongoDbSessionHandler<span class="hljs-operator">::</span>class)
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>MongoDB ODM 1.x only works with the legacy driver, which is no longer
supported by the Symfony session class. Install the <code translate="no" class="notranslate">alcaeus/mongo-php-adapter</code>
package to retrieve the underlying <code translate="no" class="notranslate">\MongoDB\Client</code> object or upgrade to
MongoDB ODM 2.0.</p>
</div>
<p>That's all! Symfony will now use your MongoDB server to read and write the
session data. You do not need to do anything to initialize your session
collection. However, you may want to add an index to improve garbage collection
performance. Run this from the <a href="https://docs.mongodb.com/manual/mongo/" class="reference external" rel="external noopener noreferrer" target="_blank">MongoDB shell</a>:</p>
<div translate="no" class="highlight-javascript notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs javascript">use session_db
db.session.createIndex( { <span class="hljs-string">"expires_at"</span>: <span class="hljs-number">1</span> }, { <span class="hljs-attr">expireAfterSeconds</span>: <span class="hljs-number">0</span> } )</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="section">
<h4 id="configuring-the-session-field-names">
    Configuring the Session Field Names
    <a class="headerlink" href="#configuring-the-session-field-names" title="Permalink to this headline">¶</a>
</h4>
<p>The collection used to store sessions defines certain field names. You can
configure these values with the second argument passed to the
<code translate="no" class="notranslate">MongoDbSessionHandler</code> service:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-5e84d71c2a6a5cdb1caf684e713b3db4854fd385" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-3391cf7d3360b56ddca26c22fcc2e7e53a604201" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-1932ea8389e8e6330cffb8a488df26c73438944e" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-5e84d71c2a6a5cdb1caf684e713b3db4854fd385" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/services.yaml</span>
<span class="hljs-attr">services:</span>
    <span class="hljs-comment"># ...</span>

    <span class="hljs-string">Symfony\Component\HttpFoundation\Session\Storage\Handler\MongoDbSessionHandler:</span>
        <span class="hljs-attr">arguments:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">'@doctrine_mongodb.odm.default_connection'</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">{</span> <span class="hljs-attr">id_field:</span> <span class="hljs-string">'_guid'</span><span class="hljs-string">,</span> <span class="hljs-attr">'expiry_field':</span> <span class="hljs-string">'eol'</span> <span class="hljs-string">}</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-3391cf7d3360b56ddca26c22fcc2e7e53a604201" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/services.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">services</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Symfony\Component\HttpFoundation\Session\Storage\Handler\MongoDbSessionHandler"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"service"</span>&gt;</span>doctrine_mongodb.odm.default_connection<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"collection"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"id_field"</span>&gt;</span>_guid<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"expiry_field"</span>&gt;</span>eol<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">services</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-1932ea8389e8e6330cffb8a488df26c73438944e" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/services.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Loader</span>\<span class="hljs-title">Configurator</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Session</span>\<span class="hljs-title">Storage</span>\<span class="hljs-title">Handler</span>\<span class="hljs-title">MongoDbSessionHandler</span>;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ContainerConfigurator <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerConfigurator</span><span class="hljs-operator">-&gt;</span>services();

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span><span class="hljs-operator">-&gt;</span>set(MongoDbSessionHandler<span class="hljs-operator">::</span>class)
        <span class="hljs-operator">-&gt;</span>args([
            service(<span class="hljs-string">'doctrine_mongodb.odm.default_connection'</span>),
            [<span class="hljs-string">'id_field'</span> =&gt; <span class="hljs-string">'_guid'</span>, <span class="hljs-string">'expiry_field'</span> =&gt; <span class="hljs-string">'eol'</span>],
        ])
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>These are parameters that you can configure:</p>
<dl>
                        <dt><code translate="no" class="notranslate">id_field</code> (default <code translate="no" class="notranslate">_id</code>):</dt>
        
        <dd>
                            The name of the field where to store the session ID;
                    </dd>
                        <dt><code translate="no" class="notranslate">data_field</code> (default <code translate="no" class="notranslate">data</code>):</dt>
        
        <dd>
                            The name of the field where to store the session data;
                    </dd>
                        <dt><code translate="no" class="notranslate">time_field</code> (default <code translate="no" class="notranslate">time</code>):</dt>
        
        <dd>
                            The name of the field where to store the session creation timestamp;
                    </dd>
                        <dt><code translate="no" class="notranslate">expiry_field</code> (default <code translate="no" class="notranslate">expires_at</code>):</dt>
        
        <dd>
                            The name of the field where to store the session lifetime.
                    </dd>
    </dl>
</div>
</div>
<div class="section">
<h3 id="migrating-between-session-handlers">
    Migrating Between Session Handlers
    <a class="headerlink" href="#migrating-between-session-handlers" title="Permalink to this headline">¶</a>
</h3>
<p>If your application changes the way sessions are stored, use the
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpFoundation/Session/Storage/Handler/MigratingSessionHandler.php" class="reference external" title="Symfony\Component\HttpFoundation\Session\Storage\Handler\MigratingSessionHandler" rel="external noopener noreferrer" target="_blank">MigratingSessionHandler</a>
to migrate between old and new save handlers without losing session data.</p>
<p>This is the recommended migration workflow:</p>
<ol class="arabic">
    <li><p>Switch to the migrating handler, with your new handler as the write-only one.
The old handler behaves as usual and sessions get written to the new one:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>sessionStorage</span> = <span class="hljs-keyword">new</span> MigratingSessionHandler(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>oldSessionStorage</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>newSessionStorage</span>);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div></li>
<li>After your session gc period, verify that the data in the new handler is correct.</li>
<li><p>Update the migrating handler to use the old handler as the write-only one, so
the sessions will now be read from the new handler. This step allows easier rollbacks:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>sessionStorage</span> = <span class="hljs-keyword">new</span> MigratingSessionHandler(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>newSessionStorage</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>oldSessionStorage</span>);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div></li>
<li>After verifying that the sessions in your application are working, switch
from the migrating handler to the new handler.</li>
</ol>
<span id="session-configure-ttl"></span>
</div>
<div class="section">
<h3 id="configuring-the-session-ttl">
    Configuring the Session TTL
    <a class="headerlink" href="#configuring-the-session-ttl" title="Permalink to this headline">¶</a>
</h3>
<p>Symfony by default will use PHP's ini setting <code translate="no" class="notranslate">session.gc_maxlifetime</code> as
session lifetime. When you store sessions in a database, you can also
configure your own TTL in the framework configuration or even at runtime.</p>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>Changing the ini setting is not possible once the session is started so
if you want to use a different TTL depending on which user is logged
in, you must do it at runtime using the callback method below.</p>
</div>
<div class="section">
<h4 id="configure-the-ttl">
    Configure the TTL
    <a class="headerlink" href="#configure-the-ttl" title="Permalink to this headline">¶</a>
</h4>
<p>You need to pass the TTL in the options array of the session handler you are using:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-c93a1d7136a799fe726d53ac6d0addaa48771352" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-47421709731406494598d31b632d6a16e9484c2d" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-f96656a2a0e1cc5e406d8fe182fa84a766e89703" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-c93a1d7136a799fe726d53ac6d0addaa48771352" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/services.yaml</span>
<span class="hljs-attr">services:</span>
    <span class="hljs-comment"># ...</span>
    <span class="hljs-string">Symfony\Component\HttpFoundation\Session\Storage\Handler\RedisSessionHandler:</span>
        <span class="hljs-attr">arguments:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">'@Redis'</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">{</span> <span class="hljs-attr">'ttl':</span> <span class="hljs-number">600</span> <span class="hljs-string">}</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-47421709731406494598d31b632d6a16e9484c2d" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/services.xml --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">services</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Symfony\Component\HttpFoundation\Session\Storage\Handler\RedisSessionHandler"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"service"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Redis"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"collection"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"ttl"</span>&gt;</span>600<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">services</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-f96656a2a0e1cc5e406d8fe182fa84a766e89703" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/services.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Session</span>\<span class="hljs-title">Storage</span>\<span class="hljs-title">Handler</span>\<span class="hljs-title">RedisSessionHandler</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span>
    <span class="hljs-operator">-&gt;</span>set(RedisSessionHandler<span class="hljs-operator">::</span>class)
    <span class="hljs-operator">-&gt;</span>args([
        service(<span class="hljs-string">'Redis'</span>),
        [<span class="hljs-string">'ttl'</span> =&gt; <span class="hljs-number">600</span>],
    ]);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
</div>
<div class="section">
<h4 id="configure-the-ttl-dynamically-at-runtime">
    Configure the TTL Dynamically at Runtime
    <a class="headerlink" href="#configure-the-ttl-dynamically-at-runtime" title="Permalink to this headline">¶</a>
</h4>
<p>If you would like to have a different TTL for different users or sessions
for whatever reason, this is also possible by passing a callback as the TTL
value. The callback will be called right before the session is written and
has to return an integer which will be used as TTL.</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-1cdaa5abb65d4b5f4706395cec3ff0421d199dbf" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-aff82fa0eb5c8bc10a46551797ef56d26dcb6488" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-565edcfe24f96f7d1bf72fbfde01316a8ed8bc4f" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-1cdaa5abb65d4b5f4706395cec3ff0421d199dbf" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/services.yaml</span>
<span class="hljs-attr">services:</span>
    <span class="hljs-comment"># ...</span>
    <span class="hljs-string">Symfony\Component\HttpFoundation\Session\Storage\Handler\RedisSessionHandler:</span>
        <span class="hljs-attr">arguments:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">'@Redis'</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">{</span> <span class="hljs-attr">'ttl':</span> <span class="hljs-type">!closure</span> <span class="hljs-string">'@my.ttl.handler'</span> <span class="hljs-string">}</span>

    <span class="hljs-attr">my.ttl.handler:</span>
        <span class="hljs-attr">class:</span> <span class="hljs-string">Some\InvokableClass</span> <span class="hljs-comment"># some class with an __invoke() method</span>
        <span class="hljs-attr">arguments:</span>
            <span class="hljs-comment"># Inject whatever dependencies you need to be able to resolve a TTL for the current session</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">'@security'</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-aff82fa0eb5c8bc10a46551797ef56d26dcb6488" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/services.xml --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">services</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Symfony\Component\HttpFoundation\Session\Storage\Handler\RedisSessionHandler"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"service"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Redis"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"collection"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"ttl"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"closure"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"my.ttl.handler"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- some class with an __invoke() method --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"my.ttl.handler"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"Some\InvokableClass"</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Inject whatever dependencies you need to be able to resolve a TTL for the current session --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">argument</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"service"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"security"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">services</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-565edcfe24f96f7d1bf72fbfde01316a8ed8bc4f" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/services.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Session</span>\<span class="hljs-title">Storage</span>\<span class="hljs-title">Handler</span>\<span class="hljs-title">RedisSessionHandler</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span>
    <span class="hljs-operator">-&gt;</span>set(RedisSessionHandler<span class="hljs-operator">::</span>class)
    <span class="hljs-operator">-&gt;</span>args([
        service(<span class="hljs-string">'Redis'</span>),
        [<span class="hljs-string">'ttl'</span> =&gt; closure(service(<span class="hljs-string">'my.ttl.handler'</span>))],
    ]);

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span>
    <span class="hljs-comment">// some class with an __invoke() method</span>
    <span class="hljs-operator">-&gt;</span>set(<span class="hljs-string">'my.ttl.handler'</span>, <span class="hljs-string">'Some\InvokableClass'</span>)
    <span class="hljs-comment">// Inject whatever dependencies you need to be able to resolve a TTL for the current session</span>
    <span class="hljs-operator">-&gt;</span>args([service(<span class="hljs-string">'security'</span>)]);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<span id="locale-sticky-session"></span>
</div>
</div>
</div>
<div class="section">
<h2 id="making-the-locale-sticky-during-a-user-s-session">
    Making the Locale &quot;Sticky&quot; during a User's Session
    <a class="headerlink" href="#making-the-locale-sticky-during-a-user-s-session" title="Permalink to this headline">¶</a>
</h2>
<p>Symfony stores the locale setting in the Request, which means that this setting
is not automatically saved (&quot;sticky&quot;) across requests. But, you <em>can</em> store the
locale in the session, so that it's used on subsequent requests.</p>
<div class="section">
<h3 id="creating-a-localesubscriber">
    Creating a LocaleSubscriber
    <a class="headerlink" href="#creating-a-localesubscriber" title="Permalink to this headline">¶</a>
</h3>
<p>Create a <a href="event_dispatcher.html#events-subscriber" class="reference internal">new event subscriber</a>. Typically,
<code translate="no" class="notranslate">_locale</code> is used as a routing parameter to signify the locale, though you
can determine the correct locale however you want:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/EventSubscriber/LocaleSubscriber.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">EventSubscriber</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">EventDispatcher</span>\<span class="hljs-title">EventSubscriberInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpKernel</span>\<span class="hljs-title">Event</span>\<span class="hljs-title">RequestEvent</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpKernel</span>\<span class="hljs-title">KernelEvents</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LocaleSubscriber</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">EventSubscriberInterface</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(
        private string <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>defaultLocale</span> = <span class="hljs-string">'en'</span>,
    )</span> </span>{
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onKernelRequest</span><span class="hljs-params">(RequestEvent <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span>)</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span><span class="hljs-operator">-&gt;</span>getRequest();
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span><span class="hljs-operator">-&gt;</span>hasPreviousSession()) {
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-comment">// try to see if the locale has been set as a _locale routing parameter</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>locale</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span><span class="hljs-operator">-&gt;</span>attributes<span class="hljs-operator">-&gt;</span>get(<span class="hljs-string">'_locale'</span>)) {
            <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span><span class="hljs-operator">-&gt;</span>getSession()<span class="hljs-operator">-&gt;</span>set(<span class="hljs-string">'_locale'</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>locale</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// if no explicit locale has been set on this request, use one from the session</span>
            <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span><span class="hljs-operator">-&gt;</span>setLocale(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span><span class="hljs-operator">-&gt;</span>getSession()<span class="hljs-operator">-&gt;</span>get(<span class="hljs-string">'_locale'</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>defaultLocale));
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSubscribedEvents</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">return</span> [
            <span class="hljs-comment">// must be registered before (i.e. with a higher priority than) the default Locale listener</span>
            KernelEvents<span class="hljs-operator">::</span>REQUEST =&gt; [[<span class="hljs-string">'onKernelRequest'</span>, <span class="hljs-number">20</span>]],
        ];
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>If you're using the <a href="service_container.html#service-container-services-load-example" class="reference internal">default services.yaml configuration</a>, you're done! Symfony will
automatically know about the event subscriber and call the <code translate="no" class="notranslate">onKernelRequest</code>
method on each request.</p>
<p>To see it working, either set the <code translate="no" class="notranslate">_locale</code> key on the session manually (e.g.
via some &quot;Change Locale&quot; route &amp; controller), or create a route with the
<a href="translation.html#translation-locale-url" class="reference internal">_locale default</a>.</p>
<div class="admonition-wrapper"><div class="admonition admonition-sidebar"><p class="sidebar-title"><span>Explicitly Configure the Subscriber</span></p><p>You can also explicitly configure it, in order to pass in the
<a href="reference/configuration/framework.html#config-framework-default_locale" class="reference internal">default_locale</a>:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-c75cd028eb7f49b854f8a7d50502e6d882b572e4" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-5002ae1238ae61d720ffed475f5c8764db4b2ff6" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-2e8ebf934047ff163ef651c2f1a0c43f075f06f3" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-c75cd028eb7f49b854f8a7d50502e6d882b572e4" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/services.yaml</span>
<span class="hljs-attr">services:</span>
    <span class="hljs-comment"># ...</span>

    <span class="hljs-string">App\EventSubscriber\LocaleSubscriber:</span>
        <span class="hljs-attr">arguments:</span> <span class="hljs-string">['%kernel.default_locale%']</span>
        <span class="hljs-comment"># uncomment the next line if you are not using autoconfigure</span>
        <span class="hljs-comment"># tags: [kernel.event_subscriber]</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-5002ae1238ae61d720ffed475f5c8764db4b2ff6" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/services.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">services</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"App\EventSubscriber\LocaleSubscriber"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span>&gt;</span>%kernel.default_locale%<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>

            <span class="hljs-comment">&lt;!-- uncomment the next line if you are not using autoconfigure --&gt;</span>
            <span class="hljs-comment">&lt;!-- &lt;tag name="kernel.event_subscriber"/&gt; --&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">services</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-2e8ebf934047ff163ef651c2f1a0c43f075f06f3" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/services.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">EventSubscriber</span>\<span class="hljs-title">LocaleSubscriber</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>container</span><span class="hljs-operator">-&gt;</span>register(LocaleSubscriber<span class="hljs-operator">::</span>class)
    <span class="hljs-operator">-&gt;</span>addArgument(<span class="hljs-string">'%kernel.default_locale%'</span>)
    <span class="hljs-comment">// uncomment the next line if you are not using autoconfigure</span>
    <span class="hljs-comment">// -&gt;addTag('kernel.event_subscriber')</span>
;</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
</div></div>
<p>Now celebrate by changing the user's locale and seeing that it's sticky
throughout the request.</p>
<p>Remember, to get the user's locale, always use the <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpFoundation/Request.php#method_getLocale" class="reference external" title="Symfony\Component\HttpFoundation\Request::getLocale()" rel="external noopener noreferrer" target="_blank">Request::getLocale</a> method:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// from a controller...</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Request</span>;

<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span><span class="hljs-params">(Request <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span>)</span>
</span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>locale</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>request</span><span class="hljs-operator">-&gt;</span>getLocale();
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
<div class="section">
<h3 id="setting-the-locale-based-on-the-user-s-preferences">
    Setting the Locale Based on the User's Preferences
    <a class="headerlink" href="#setting-the-locale-based-on-the-user-s-preferences" title="Permalink to this headline">¶</a>
</h3>
<p>You might want to improve this technique even further and define the locale
based on the user entity of the logged in user. However, since the
<code translate="no" class="notranslate">LocaleSubscriber</code> is called before the <code translate="no" class="notranslate">FirewallListener</code>, which is
responsible for handling authentication and setting the user token on the
<code translate="no" class="notranslate">TokenStorage</code>, you have no access to the user which is logged in.</p>
<p>Suppose you have a <code translate="no" class="notranslate">locale</code> property on your <code translate="no" class="notranslate">User</code> entity and want to use
this as the locale for the given user. To accomplish this, you can hook into
the login process and update the user's session with this locale value before
they are redirected to their first page.</p>
<p>To do this, you need an event subscriber on the <code translate="no" class="notranslate">security.interactive_login</code>
event:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/EventSubscriber/UserLocaleSubscriber.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">EventSubscriber</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">EventDispatcher</span>\<span class="hljs-title">EventSubscriberInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">RequestStack</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Event</span>\<span class="hljs-title">InteractiveLoginEvent</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">SecurityEvents</span>;

<span class="hljs-comment">/**
 * Stores the locale of the user in the session after the
 * login. This can be used by the LocaleSubscriber afterwards.
 */</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserLocaleSubscriber</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">EventSubscriberInterface</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(
        private RequestStack <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>requestStack</span>,
    )</span> </span>{
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onInteractiveLogin</span><span class="hljs-params">(InteractiveLoginEvent <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span>)</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>user</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span><span class="hljs-operator">-&gt;</span>getAuthenticationToken()<span class="hljs-operator">-&gt;</span>getUser();

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> !== <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>user</span><span class="hljs-operator">-&gt;</span>getLocale()) {
            <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>requestStack<span class="hljs-operator">-&gt;</span>getSession()<span class="hljs-operator">-&gt;</span>set(<span class="hljs-string">'_locale'</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>user</span><span class="hljs-operator">-&gt;</span>getLocale());
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSubscribedEvents</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">return</span> [
            SecurityEvents<span class="hljs-operator">::</span>INTERACTIVE_LOGIN =&gt; <span class="hljs-string">'onInteractiveLogin'</span>,
        ];
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-caution ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                <span>Caution</span>
    </p><p>In order to update the language immediately after a user has changed their
language preferences, you also need to update the session when you change
the <code translate="no" class="notranslate">User</code> entity.</p>
</div>
</div>
</div>
<div class="section">
<h2 id="session-proxies">
    Session Proxies
    <a class="headerlink" href="#session-proxies" title="Permalink to this headline">¶</a>
</h2>
<p>The session proxy mechanism has a variety of uses and this article demonstrates
two common ones. Rather than using the regular session handler, you can create
a custom save handler by defining a class that extends the
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpFoundation/Session/Storage/Proxy/SessionHandlerProxy.php" class="reference external" title="Symfony\Component\HttpFoundation\Session\Storage\Proxy\SessionHandlerProxy" rel="external noopener noreferrer" target="_blank">SessionHandlerProxy</a>
class.</p>
<p>Then, define the class as a <a href="service_container.html#service-container-creating-service" class="reference internal">service</a>. If you're using the <a href="service_container.html#service-container-services-load-example" class="reference internal">default
services.yaml configuration</a>, that
happens automatically.</p>
<p>Finally, use the <code translate="no" class="notranslate">framework.session.handler_id</code> configuration option to tell
Symfony to use your session handler instead of the default one:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-f0eab784167804e16c5e693a23da3e54502fa411" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-a10f64aecec166969a006bbc128178f0526325c1" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-f6b8a08bac601430437c32138ebca0e960071443" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-f0eab784167804e16c5e693a23da3e54502fa411" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/framework.yaml</span>
<span class="hljs-attr">framework:</span>
    <span class="hljs-attr">session:</span>
        <span class="hljs-comment"># ...</span>
        <span class="hljs-attr">handler_id:</span> <span class="hljs-string">App\Session\CustomSessionHandler</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-a10f64aecec166969a006bbc128178f0526325c1" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/packages/framework.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:framework</span>=<span class="hljs-string">"http://symfony.com/schema/dic/symfony"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">framework:config</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">framework:session</span> <span class="hljs-attr">handler-id</span>=<span class="hljs-string">"App\Session\CustomSessionHandler"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">framework:config</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-f6b8a08bac601430437c32138ebca0e960071443" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/packages/framework.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Session</span>\<span class="hljs-title">CustomSessionHandler</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Config</span>\<span class="hljs-title">FrameworkConfig</span>;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(FrameworkConfig <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span>)</span> </span>{
    <span class="hljs-comment">// ...</span>
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span><span class="hljs-operator">-&gt;</span>session()
        <span class="hljs-operator">-&gt;</span>handlerId(CustomSessionHandler<span class="hljs-operator">::</span>class)
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>Keep reading the next sections to learn how to use the session handlers in
practice to solve two common use cases: encrypt session information and define
read-only guest sessions.</p>
<div class="section">
<h3 id="encryption-of-session-data">
    Encryption of Session Data
    <a class="headerlink" href="#encryption-of-session-data" title="Permalink to this headline">¶</a>
</h3>
<p>If you want to encrypt the session data, you can use the proxy to encrypt and
decrypt the session as required. The following example uses the <a href="https://github.com/defuse/php-encryption" class="reference external" rel="external noopener noreferrer" target="_blank">php-encryption</a>
library, but you can adapt it to any other library that you may be using:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Session/EncryptedSessionProxy.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Session</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Defuse</span>\<span class="hljs-title">Crypto</span>\<span class="hljs-title">Crypto</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Defuse</span>\<span class="hljs-title">Crypto</span>\<span class="hljs-title">Key</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Session</span>\<span class="hljs-title">Storage</span>\<span class="hljs-title">Proxy</span>\<span class="hljs-title">SessionHandlerProxy</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EncryptedSessionProxy</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SessionHandlerProxy</span>
</span>{
    <span class="hljs-keyword">private</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>key</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(\SessionHandlerInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>handler</span>, Key <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>key</span>)</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>key = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>key</span>;

        <span class="hljs-keyword">parent</span><span class="hljs-operator">::</span>__construct(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>handler</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">read</span><span class="hljs-params">(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>id</span>)</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>data</span> = <span class="hljs-keyword">parent</span><span class="hljs-operator">::</span>read(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>id</span>);

        <span class="hljs-keyword">return</span> Crypto<span class="hljs-operator">::</span>decrypt(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>data</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>key);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">write</span><span class="hljs-params">(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>id</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>data</span>)</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>data</span> = Crypto<span class="hljs-operator">::</span>encrypt(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>data</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>key);

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">parent</span><span class="hljs-operator">::</span>write(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>id</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>data</span>);
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
<div class="section">
<h3 id="read-only-guest-sessions">
    Read-only Guest Sessions
    <a class="headerlink" href="#read-only-guest-sessions" title="Permalink to this headline">¶</a>
</h3>
<p>There are some applications where a session is required for guest users, but
where there is no particular need to persist the session. In this case you can
intercept the session before it is written:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Session/ReadOnlySessionProxy.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Session</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Entity</span>\<span class="hljs-title">User</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Bundle</span>\<span class="hljs-title">SecurityBundle</span>\<span class="hljs-title">Security</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Session</span>\<span class="hljs-title">Storage</span>\<span class="hljs-title">Proxy</span>\<span class="hljs-title">SessionHandlerProxy</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ReadOnlySessionProxy</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SessionHandlerProxy</span>
</span>{
    <span class="hljs-keyword">private</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(\SessionHandlerInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>handler</span>, Security <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span>)</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>security = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>security</span>;

        <span class="hljs-keyword">parent</span><span class="hljs-operator">::</span>__construct(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>handler</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">write</span><span class="hljs-params">(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>id</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>data</span>)</span>
    </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>getUser() &amp;&amp; <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>getUser()<span class="hljs-operator">-&gt;</span>isGuest()) {
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">parent</span><span class="hljs-operator">::</span>write(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>id</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>data</span>);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUser</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>user</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>security<span class="hljs-operator">-&gt;</span>getUser();
        <span class="hljs-keyword">if</span> (is_object(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>user</span>)) {
            <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>user</span>;
        }
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<span id="session-avoid-start"></span>
</div>
</div>
<div class="section">
<h2 id="integrating-with-legacy-applications">
    Integrating with Legacy Applications
    <a class="headerlink" href="#integrating-with-legacy-applications" title="Permalink to this headline">¶</a>
</h2>
<p>If you're integrating the Symfony full-stack Framework into a legacy
application that starts the session with <code translate="no" class="notranslate">session_start()</code>, you may still be
able to use Symfony's session management by using the PHP Bridge session.</p>
<p>If the application has its own PHP save handler, you can specify <code translate="no" class="notranslate">null</code>
for the <code translate="no" class="notranslate">handler_id</code>:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-4">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-4f8db6e01d14b5f6bb172c03960f81577a8a18f0" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-36d47379ff2ece958511b74791f7d86b8f9ad575" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-f8af5623f049972a9abee162e4ab5c1dc9acff78" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
                    <button role="tab" type="button" data-language="php-standalone"
                aria-controls="configuration-block-tabpanel-7c28c392a480a774fa7a696fae01c619b5f20ee5" aria-selected="false"
                 tabindex="-1">
                <span>Standalone Use</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-4f8db6e01d14b5f6bb172c03960f81577a8a18f0" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/framework.yaml</span>
<span class="hljs-attr">framework:</span>
    <span class="hljs-attr">session:</span>
        <span class="hljs-attr">storage_factory_id:</span> <span class="hljs-string">session.storage.factory.php_bridge</span>
        <span class="hljs-attr">handler_id:</span> <span class="hljs-string">~</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-36d47379ff2ece958511b74791f7d86b8f9ad575" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/packages/framework.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:framework</span>=<span class="hljs-string">"http://symfony.com/schema/dic/symfony"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">framework:config</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">framework:session</span> <span class="hljs-attr">storage-factory-id</span>=<span class="hljs-string">"session.storage.factory.php_bridge"</span>
            <span class="hljs-attr">handler-id</span>=<span class="hljs-string">"null"</span>
        /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">framework:config</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-f8af5623f049972a9abee162e4ab5c1dc9acff78" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/packages/framework.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Config</span>\<span class="hljs-title">FrameworkConfig</span>;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(FrameworkConfig <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span><span class="hljs-operator">-&gt;</span>session()
        <span class="hljs-operator">-&gt;</span>storageFactoryId(<span class="hljs-string">'session.storage.factory.php_bridge'</span>)
        <span class="hljs-operator">-&gt;</span>handlerId(<span class="hljs-keyword">null</span>)
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-7c28c392a480a774fa7a696fae01c619b5f20ee5" aria-label="Standalone Use" class="configuration-codeblock" data-language="php-standalone" style="display: none">
            <div translate="no" class="highlight-php-standalone highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php-standalone php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Session</span>\<span class="hljs-title">Session</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Session</span>\<span class="hljs-title">Storage</span>\<span class="hljs-title">PhpBridgeSessionStorage</span>;

<span class="hljs-comment">// legacy application configures session</span>
ini_set(<span class="hljs-string">'session.save_handler'</span>, <span class="hljs-string">'files'</span>);
ini_set(<span class="hljs-string">'session.save_path'</span>, <span class="hljs-string">'/tmp'</span>);
session_start();

<span class="hljs-comment">// Get Symfony to interface with this existing session</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>session</span> = <span class="hljs-keyword">new</span> Session(<span class="hljs-keyword">new</span> PhpBridgeSessionStorage());

<span class="hljs-comment">// symfony will now interface with the existing PHP session</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>session</span><span class="hljs-operator">-&gt;</span>start();</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<p>Otherwise, if the problem is that you cannot avoid the application
starting the session with <code translate="no" class="notranslate">session_start()</code>, you can still make use of
a Symfony based session save handler by specifying the save handler as in
the example below:</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-c41a9568ccb695b208a35fb2ec0285e1e000b5e0" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-75df2f6db3789ec526084063b23be3e02f53ca72" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-e3bcdcb75f7756dba9bb72b689efb30ffaa5881f" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-c41a9568ccb695b208a35fb2ec0285e1e000b5e0" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/packages/framework.yaml</span>
<span class="hljs-attr">framework:</span>
    <span class="hljs-attr">session:</span>
        <span class="hljs-attr">storage_factory_id:</span> <span class="hljs-string">session.storage.factory.php_bridge</span>
        <span class="hljs-attr">handler_id:</span> <span class="hljs-string">session.handler.native_file</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-75df2f6db3789ec526084063b23be3e02f53ca72" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/packages/framework.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:framework</span>=<span class="hljs-string">"http://symfony.com/schema/dic/symfony"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">framework:config</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">framework:session</span> <span class="hljs-attr">storage-id</span>=<span class="hljs-string">"session.storage.php_bridge"</span>
            <span class="hljs-attr">handler-id</span>=<span class="hljs-string">"session.storage.native_file"</span>
        /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">framework:config</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-e3bcdcb75f7756dba9bb72b689efb30ffaa5881f" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/packages/framework.php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Config</span>\<span class="hljs-title">FrameworkConfig</span>;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(FrameworkConfig <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span>)</span> </span>{
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>framework</span><span class="hljs-operator">-&gt;</span>session()
        <span class="hljs-operator">-&gt;</span>storageFactoryId(<span class="hljs-string">'session.storage.factory.php_bridge'</span>)
        <span class="hljs-operator">-&gt;</span>handlerId(<span class="hljs-string">'session.storage.native_file'</span>)
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>If the legacy application requires its own session save handler, do not
override this. Instead set <code translate="no" class="notranslate">handler_id: ~</code>. Note that a save handler
cannot be changed once the session has been started. If the application
starts the session before Symfony is initialized, the save handler will
have already been set. In this case, you will need <code translate="no" class="notranslate">handler_id: ~</code>.
Only override the save handler if you are sure the legacy application
can use the Symfony save handler without side effects and that the session
has not been started before Symfony is initialized.</p>
</div>
</div>
</div>

                            </div>                    </div>
                                    </div>        </div>

    </section>

</div>


<script type="text/javascript" src="assets/js/theme.js"></script>
<script type="text/javascript" src="assets/js/badge_only.js"></script>

 
</body>
</html>