        
<!DOCTYPE html>
<!--[if IE 8]>
<html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en"> <!--<![endif]-->
<head><base href="/">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
            
                                
    
    <link rel="stylesheet" href="assets/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/highlightjs.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/badge_only.css" type="text/css" />

</head>

<body class="wy-body-for-nav">
 <div class="wy-grid-for-nav">

        <nav data-toggle="wy-nav-shift" class="wy-nav-side">
        <div class="wy-side-scroll">
            <div class="wy-side-nav-search">
                
                                                                                                    
                                                                                                                                                                        </div>

            <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                                                                                                                                                                                                                                                                                                                            </div>
        </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

                                                        

        <div class="wy-nav-content">                <div class="rst-content">
                                        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">                            <div itemprop="articleBody">
                                    <div class="section">
<h1 id="the-eventdispatcher-component">
    The EventDispatcher Component
    <a class="headerlink" href="#the-eventdispatcher-component" title="Permalink to this headline">¶</a>
</h1>
<blockquote><p>The EventDispatcher component provides tools that allow your application
components to communicate with each other by dispatching events and
listening to them.</p>
</blockquote>
<div class="section">
<h2 id="introduction">
    Introduction
    <a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a>
</h2>
<p>Object-oriented code has gone a long way to ensuring code extensibility.
By creating classes that have well-defined responsibilities, your code becomes
more flexible and a developer can extend them with subclasses to modify
their behaviors. But if they want to share the changes with other developers
who have also made their own subclasses, code inheritance is no longer the
answer.</p>
<p>Consider the real-world example where you want to provide a plugin system
for your project. A plugin should be able to add methods, or do something
before or after a method is executed, without interfering with other plugins.
This is not an easy problem to solve with single inheritance, and even if
multiple inheritance was possible with PHP, it comes with its own drawbacks.</p>
<p>The Symfony EventDispatcher component implements the <a href="https://en.wikipedia.org/wiki/Mediator_pattern" class="reference external" rel="external noopener noreferrer" target="_blank">Mediator</a> and <a href="https://en.wikipedia.org/wiki/Observer_pattern" class="reference external" rel="external noopener noreferrer" target="_blank">Observer</a>
design patterns to make all these things possible and to make your projects
truly extensible.</p>
<p>Take an example from <a href="http_kernel.html" class="reference internal">the HttpKernel component</a>.
Once a <code translate="no" class="notranslate">Response</code> object has been created, it may be useful to allow other
elements in the system to modify it (e.g. add some cache headers) before
it's actually used. To make this possible, the Symfony kernel throws an
event - <code translate="no" class="notranslate">kernel.response</code>. Here's how it works:</p>
<ul>
    <li>A <em>listener</em> (PHP object) tells a central <em>dispatcher</em> object that it
wants to listen to the <code translate="no" class="notranslate">kernel.response</code> event;</li>
<li>At some point, the Symfony kernel tells the <em>dispatcher</em> object to dispatch
the <code translate="no" class="notranslate">kernel.response</code> event, passing with it an <code translate="no" class="notranslate">Event</code> object that
has access to the <code translate="no" class="notranslate">Response</code> object;</li>
<li>The dispatcher notifies (i.e. calls a method on) all listeners of the
<code translate="no" class="notranslate">kernel.response</code> event, allowing each of them to make modifications
to the <code translate="no" class="notranslate">Response</code> object.</li>
</ul>
</div>
<div class="section">
<h2 id="installation">
    Installation
    <a class="headerlink" href="#installation" title="Permalink to this headline">¶</a>
</h2>
<div translate="no" class="highlight-terminal highlight-bash notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs terminal bash"><span class="hljs-prompt">$ </span>composer require symfony/event-dispatcher</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>If you install this component outside of a Symfony application, you must
require the <code translate="no" class="notranslate">vendor/autoload.php</code> file in your code to enable the class
autoloading mechanism provided by Composer. Read
<a href="using_components.html" class="reference internal">this article</a> for more details.</p>
</div>
</div>
<div class="section">
<h2 id="usage">
    Usage
    <a class="headerlink" href="#usage" title="Permalink to this headline">¶</a>
</h2>
<div class="admonition admonition-seealso ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" /></svg>
                <span>See also</span>
    </p><p>This article explains how to use the EventDispatcher features as an
independent component in any PHP application. Read the <a href="../event_dispatcher.html" class="reference internal">Events and Event Listeners</a>
article to learn about how to use it in Symfony applications.</p>
</div>
<div class="section">
<h3 id="events">
    Events
    <a class="headerlink" href="#events" title="Permalink to this headline">¶</a>
</h3>
<p>When an event is dispatched, it's identified by a unique name (e.g.
<code translate="no" class="notranslate">kernel.response</code>), which any number of listeners might be listening to.
An <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Contracts/EventDispatcher/Event.php" class="reference external" title="Symfony\Contracts\EventDispatcher\Event" rel="external noopener noreferrer" target="_blank">Event</a> instance is also
created and passed to all of the listeners. As you'll see later, the <code translate="no" class="notranslate">Event</code>
object itself often contains data about the event being dispatched.</p>
<div class="section">
<h4 id="naming-conventions">
    Naming Conventions
    <a class="headerlink" href="#naming-conventions" title="Permalink to this headline">¶</a>
</h4>
<p>The unique event name can be any string, but optionally follows a few
naming conventions:</p>
<ul>
    <li>Use only lowercase letters, numbers, dots (<code translate="no" class="notranslate">.</code>) and underscores (<code translate="no" class="notranslate">_</code>);</li>
<li>Prefix names with a namespace followed by a dot (e.g. <code translate="no" class="notranslate">order.*</code>, <code translate="no" class="notranslate">user.*</code>);</li>
<li>End names with a verb that indicates what action has been taken (e.g.
<code translate="no" class="notranslate">order.placed</code>).</li>
</ul>
</div>
<div class="section">
<h4 id="event-names-and-event-objects">
    Event Names and Event Objects
    <a class="headerlink" href="#event-names-and-event-objects" title="Permalink to this headline">¶</a>
</h4>
<p>When the dispatcher notifies listeners, it passes an actual <code translate="no" class="notranslate">Event</code> object
to those listeners. The base <code translate="no" class="notranslate">Event</code> class contains a method for stopping
<a href="event_dispatcher.html#event_dispatcher-event-propagation" class="reference internal">event propagation</a>, but not much
else.</p>
<div class="admonition admonition-seealso ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" /></svg>
                <span>See also</span>
    </p><p>Read &quot;<a href="../components/event_dispatcher/generic_event.html" class="reference internal">The Generic Event Object</a>&quot; for more
information about this base event object.</p>
</div>
<p>Often times, data about a specific event needs to be passed along with the
<code translate="no" class="notranslate">Event</code> object so that the listeners have the needed information. In such
case, a special subclass that has additional methods for retrieving and
overriding information can be passed when dispatching an event. For example,
the <code translate="no" class="notranslate">kernel.response</code> event uses a
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpKernel/Event/ResponseEvent.php" class="reference external" title="Symfony\Component\HttpKernel\Event\ResponseEvent" rel="external noopener noreferrer" target="_blank">ResponseEvent</a>, which
contains methods to get and even replace the <code translate="no" class="notranslate">Response</code> object.</p>
</div>
</div>
<div class="section">
<h3 id="the-dispatcher">
    The Dispatcher
    <a class="headerlink" href="#the-dispatcher" title="Permalink to this headline">¶</a>
</h3>
<p>The dispatcher is the central object of the event dispatcher system. In
general, a single dispatcher is created, which maintains a registry of
listeners. When an event is dispatched via the dispatcher, it notifies all
listeners registered with that event:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">EventDispatcher</span>\<span class="hljs-title">EventDispatcher</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>dispatcher</span> = <span class="hljs-keyword">new</span> EventDispatcher();</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
<div class="section">
<h3 id="connecting-listeners">
    Connecting Listeners
    <a class="headerlink" href="#connecting-listeners" title="Permalink to this headline">¶</a>
</h3>
<p>To take advantage of an existing event, you need to connect a listener to
the dispatcher so that it can be notified when the event is dispatched.
A call to the dispatcher's <code translate="no" class="notranslate">addListener()</code> method associates any valid
PHP callable to an event:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>listener</span> = <span class="hljs-keyword">new</span> AcmeListener();
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>dispatcher</span><span class="hljs-operator">-&gt;</span>addListener(<span class="hljs-string">'acme.foo.action'</span>, [<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>listener</span>, <span class="hljs-string">'onFooAction'</span>]);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>The <code translate="no" class="notranslate">addListener()</code> method takes up to three arguments:</p>
<ol class="arabic">
    <li>The event name (string) that this listener wants to listen to;</li>
<li>A PHP callable that will be executed when the specified event is dispatched;</li>
<li>An optional priority, defined as a positive or negative integer (defaults to
<code translate="no" class="notranslate">0</code>). The higher the number, the earlier the listener is called. If two
listeners have the same priority, they are executed in the order that they
were added to the dispatcher.</li>
</ol>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>A <a href="https://www.php.net/manual/en/language.types.callable.php" class="reference external" rel="external noopener noreferrer" target="_blank">PHP callable</a> is a PHP variable that can be used by the
<code translate="no" class="notranslate">call_user_func()</code> function and returns <code translate="no" class="notranslate">true</code> when passed to the
<code translate="no" class="notranslate">is_callable()</code> function. It can be a <code translate="no" class="notranslate">\Closure</code> instance, an object
implementing an <code translate="no" class="notranslate">__invoke()</code> method (which is what closures are in fact),
a string representing a function or an array representing an object
method or a class method.</p>
<p>So far, you've seen how PHP objects can be registered as listeners.
You can also register PHP <a href="https://www.php.net/manual/en/functions.anonymous.php" class="reference external" rel="external noopener noreferrer" target="_blank">Closures</a> as event listeners:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">EventDispatcher</span>\<span class="hljs-title">Event</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>dispatcher</span><span class="hljs-operator">-&gt;</span>addListener(<span class="hljs-string">'acme.foo.action'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(Event <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span>)</span> </span>{
    <span class="hljs-comment">// will be executed when the acme.foo.action event is dispatched</span>
});</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
<p>Once a listener is registered with the dispatcher, it waits until the event
is notified. In the above example, when the <code translate="no" class="notranslate">acme.foo.action</code> event is dispatched,
the dispatcher calls the <code translate="no" class="notranslate">AcmeListener::onFooAction()</code> method and passes
the <code translate="no" class="notranslate">Event</code> object as the single argument:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">EventDispatcher</span>\<span class="hljs-title">Event</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AcmeListener</span>
</span>{
    <span class="hljs-comment">// ...</span>

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onFooAction</span><span class="hljs-params">(Event <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span>)</span>
    </span>{
        <span class="hljs-comment">// ... do something</span>
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>The <code translate="no" class="notranslate">$event</code> argument is the event object that was passed when dispatching the
event. In many cases, a special event subclass is passed with extra
information. You can check the documentation or implementation of each event to
determine which instance is passed.</p>
<div class="admonition-wrapper"><div class="admonition admonition-sidebar"><p class="sidebar-title"><span>Registering Event Listeners and Subscribers in the Service Container</span></p><p>Registering service definitions and tagging them with the
<code translate="no" class="notranslate">kernel.event_listener</code> and <code translate="no" class="notranslate">kernel.event_subscriber</code> tags is not enough
to enable the event listeners and event subscribers. You must also register
a compiler pass called <code translate="no" class="notranslate">RegisterListenersPass()</code> in the container builder:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">ContainerBuilder</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">ParameterBag</span>\<span class="hljs-title">ParameterBag</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Reference</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">EventDispatcher</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">RegisterListenersPass</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">EventDispatcher</span>\<span class="hljs-title">EventDispatcher</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerBuilder</span> = <span class="hljs-keyword">new</span> ContainerBuilder(<span class="hljs-keyword">new</span> ParameterBag());
<span class="hljs-comment">// register the compiler pass that handles the 'kernel.event_listener'</span>
<span class="hljs-comment">// and 'kernel.event_subscriber' service tags</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerBuilder</span><span class="hljs-operator">-&gt;</span>addCompilerPass(<span class="hljs-keyword">new</span> RegisterListenersPass());

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerBuilder</span><span class="hljs-operator">-&gt;</span>register(<span class="hljs-string">'event_dispatcher'</span>, EventDispatcher<span class="hljs-operator">::</span>class);

<span class="hljs-comment">// registers an event listener</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerBuilder</span><span class="hljs-operator">-&gt;</span>register(<span class="hljs-string">'listener_service_id'</span>, \AcmeListener<span class="hljs-operator">::</span>class)
    <span class="hljs-operator">-&gt;</span>addTag(<span class="hljs-string">'kernel.event_listener'</span>, [
        <span class="hljs-string">'event'</span> =&gt; <span class="hljs-string">'acme.foo.action'</span>,
        <span class="hljs-string">'method'</span> =&gt; <span class="hljs-string">'onFooAction'</span>,
    ]);

<span class="hljs-comment">// registers an event subscriber</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerBuilder</span><span class="hljs-operator">-&gt;</span>register(<span class="hljs-string">'subscriber_service_id'</span>, \AcmeSubscriber<span class="hljs-operator">::</span>class)
    <span class="hljs-operator">-&gt;</span>addTag(<span class="hljs-string">'kernel.event_subscriber'</span>);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p><code translate="no" class="notranslate">RegisterListenersPass</code> resolves aliased class names which for instance
allows to refer to an event via the fully qualified class name (FQCN) of the
event class. The pass will read the alias mapping from a dedicated container
parameter. This parameter can be extended by registering another compiler pass,
<code translate="no" class="notranslate">AddEventAliasesPass</code>:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Compiler</span>\<span class="hljs-title">PassConfig</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">ContainerBuilder</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">ParameterBag</span>\<span class="hljs-title">ParameterBag</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Reference</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">EventDispatcher</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">AddEventAliasesPass</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">EventDispatcher</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">RegisterListenersPass</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">EventDispatcher</span>\<span class="hljs-title">EventDispatcher</span>;

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerBuilder</span> = <span class="hljs-keyword">new</span> ContainerBuilder(<span class="hljs-keyword">new</span> ParameterBag());
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerBuilder</span><span class="hljs-operator">-&gt;</span>addCompilerPass(<span class="hljs-keyword">new</span> AddEventAliasesPass([
    \AcmeFooActionEvent<span class="hljs-operator">::</span>class =&gt; <span class="hljs-string">'acme.foo.action'</span>,
]));
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerBuilder</span><span class="hljs-operator">-&gt;</span>addCompilerPass(<span class="hljs-keyword">new</span> RegisterListenersPass(), PassConfig<span class="hljs-operator">::</span>TYPE_BEFORE_REMOVING);

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerBuilder</span><span class="hljs-operator">-&gt;</span>register(<span class="hljs-string">'event_dispatcher'</span>, EventDispatcher<span class="hljs-operator">::</span>class);

<span class="hljs-comment">// registers an event listener</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>containerBuilder</span><span class="hljs-operator">-&gt;</span>register(<span class="hljs-string">'listener_service_id'</span>, \AcmeListener<span class="hljs-operator">::</span>class)
    <span class="hljs-operator">-&gt;</span>addTag(<span class="hljs-string">'kernel.event_listener'</span>, [
        <span class="hljs-comment">// will be translated to 'acme.foo.action' by RegisterListenersPass.</span>
        <span class="hljs-string">'event'</span> =&gt; \AcmeFooActionEvent<span class="hljs-operator">::</span>class,
        <span class="hljs-string">'method'</span> =&gt; <span class="hljs-string">'onFooAction'</span>,
    ]);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>Note that <code translate="no" class="notranslate">AddEventAliasesPass</code> has to be processed before <code translate="no" class="notranslate">RegisterListenersPass</code>.</p>
</div>
<p>The listeners pass assumes that the event dispatcher's service
id is <code translate="no" class="notranslate">event_dispatcher</code>, that event listeners are tagged with the
<code translate="no" class="notranslate">kernel.event_listener</code> tag, that event subscribers are tagged
with the <code translate="no" class="notranslate">kernel.event_subscriber</code> tag and that the alias mapping is
stored as parameter <code translate="no" class="notranslate">event_dispatcher.event_aliases</code>.</p>
</div></div>
<span id="event_dispatcher-closures-as-listeners"></span>
</div>
<div class="section">
<h3 id="creating-and-dispatching-an-event">
    Creating and Dispatching an Event
    <a class="headerlink" href="#creating-and-dispatching-an-event" title="Permalink to this headline">¶</a>
</h3>
<p>In addition to registering listeners with existing events, you can create
and dispatch your own events. This is useful when creating third-party
libraries and also when you want to keep different components of your own
system flexible and decoupled.</p>
<span id="creating-an-event-object"></span>
<div class="section">
<h4 id="creating-an-event-class">
    Creating an Event Class
    <a class="headerlink" href="#creating-an-event-class" title="Permalink to this headline">¶</a>
</h4>
<p>Suppose you want to create a new event - <code translate="no" class="notranslate">order.placed</code> - that is dispatched
each time a customer orders a product with your application. When dispatching
this event, you'll pass a custom event instance that has access to the placed
order. Start by creating this custom event class and documenting it:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">Acme</span>\<span class="hljs-title">Store</span>\<span class="hljs-title">Event</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Acme</span>\<span class="hljs-title">Store</span>\<span class="hljs-title">Order</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">EventDispatcher</span>\<span class="hljs-title">Event</span>;

<span class="hljs-comment">/**
 * The order.placed event is dispatched each time an order is created
 * in the system.
 */</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OrderPlacedEvent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Event</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> NAME = <span class="hljs-string">'order.placed'</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(
        protected Order <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>order</span>,
    )</span> </span>{
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getOrder</span><span class="hljs-params">()</span>: <span class="hljs-title">Order</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span><span class="hljs-operator">-&gt;</span>order;
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Each listener now has access to the order via the <code translate="no" class="notranslate">getOrder()</code> method.</p>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>If you don't need to pass any additional data to the event listeners, you
can also use the default
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Contracts/EventDispatcher/Event.php" class="reference external" title="Symfony\Contracts\EventDispatcher\Event" rel="external noopener noreferrer" target="_blank">Event</a> class. In such case,
you can document the event and its name in a generic <code translate="no" class="notranslate">StoreEvents</code> class,
similar to the <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/HttpKernel/KernelEvents.php" class="reference external" title="Symfony\Component\HttpKernel\KernelEvents" rel="external noopener noreferrer" target="_blank">KernelEvents</a>
class.</p>
</div>
</div>
<div class="section">
<h4 id="dispatch-the-event">
    Dispatch the Event
    <a class="headerlink" href="#dispatch-the-event" title="Permalink to this headline">¶</a>
</h4>
<p>The <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/EventDispatcher/EventDispatcher.php#method_dispatch" class="reference external" title="Symfony\Component\EventDispatcher\EventDispatcher::dispatch()" rel="external noopener noreferrer" target="_blank">dispatch()</a>
method notifies all listeners of the given event. It takes two arguments:
the <code translate="no" class="notranslate">Event</code> instance to pass to each listener of that event and the name
of the event to dispatch:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Acme</span>\<span class="hljs-title">Store</span>\<span class="hljs-title">Event</span>\<span class="hljs-title">OrderPlacedEvent</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Acme</span>\<span class="hljs-title">Store</span>\<span class="hljs-title">Order</span>;

<span class="hljs-comment">// the order is somehow created or retrieved</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>order</span> = <span class="hljs-keyword">new</span> Order();
<span class="hljs-comment">// ...</span>

<span class="hljs-comment">// creates the OrderPlacedEvent and dispatches it</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span> = <span class="hljs-keyword">new</span> OrderPlacedEvent(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>order</span>);
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>dispatcher</span><span class="hljs-operator">-&gt;</span>dispatch(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span>, OrderPlacedEvent<span class="hljs-operator">::</span>NAME);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Notice that the special <code translate="no" class="notranslate">OrderPlacedEvent</code> object is created and passed to
the <code translate="no" class="notranslate">dispatch()</code> method. Now, any listener to the <code translate="no" class="notranslate">order.placed</code>
event will receive the <code translate="no" class="notranslate">OrderPlacedEvent</code>.</p>
<span id="event_dispatcher-using-event-subscribers"></span>
</div>
</div>
<div class="section">
<h3 id="using-event-subscribers">
    Using Event Subscribers
    <a class="headerlink" href="#using-event-subscribers" title="Permalink to this headline">¶</a>
</h3>
<p>The most common way to listen to an event is to register an <em>event listener</em>
with the dispatcher. This listener can listen to one or more events and
is notified each time those events are dispatched.</p>
<p>Another way to listen to events is via an <em>event subscriber</em>. An event
subscriber is a PHP class that's able to tell the dispatcher exactly which
events it should subscribe to. It implements the
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/EventDispatcher/EventSubscriberInterface.php" class="reference external" title="Symfony\Component\EventDispatcher\EventSubscriberInterface" rel="external noopener noreferrer" target="_blank">EventSubscriberInterface</a>
interface, which requires a single static method called
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/EventDispatcher/EventSubscriberInterface.php#method_getSubscribedEvents" class="reference external" title="Symfony\Component\EventDispatcher\EventSubscriberInterface::getSubscribedEvents()" rel="external noopener noreferrer" target="_blank">getSubscribedEvents()</a>.
Take the following example of a subscriber that subscribes to the
<code translate="no" class="notranslate">kernel.response</code> and <code translate="no" class="notranslate">order.placed</code> events:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">Acme</span>\<span class="hljs-title">Store</span>\<span class="hljs-title">Event</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Acme</span>\<span class="hljs-title">Store</span>\<span class="hljs-title">Event</span>\<span class="hljs-title">OrderPlacedEvent</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">EventDispatcher</span>\<span class="hljs-title">EventSubscriberInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpKernel</span>\<span class="hljs-title">Event</span>\<span class="hljs-title">ResponseEvent</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpKernel</span>\<span class="hljs-title">KernelEvents</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StoreSubscriber</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">EventSubscriberInterface</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSubscribedEvents</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">return</span> [
            KernelEvents<span class="hljs-operator">::</span>RESPONSE =&gt; [
                [<span class="hljs-string">'onKernelResponsePre'</span>, <span class="hljs-number">10</span>],
                [<span class="hljs-string">'onKernelResponsePost'</span>, <span class="hljs-number">-10</span>],
            ],
            OrderPlacedEvent<span class="hljs-operator">::</span>NAME =&gt; <span class="hljs-string">'onStoreOrder'</span>,
        ];
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onKernelResponsePre</span><span class="hljs-params">(ResponseEvent <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span>)</span>
    </span>{
        <span class="hljs-comment">// ...</span>
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onKernelResponsePost</span><span class="hljs-params">(ResponseEvent <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span>)</span>
    </span>{
        <span class="hljs-comment">// ...</span>
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onStoreOrder</span><span class="hljs-params">(OrderPlacedEvent <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span>)</span>
    </span>{
        <span class="hljs-comment">// ...</span>
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>This is very similar to a listener class, except that the class itself can
tell the dispatcher which events it should listen to. To register a subscriber
with the dispatcher, use the
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/EventDispatcher/EventDispatcher.php#method_addSubscriber" class="reference external" title="Symfony\Component\EventDispatcher\EventDispatcher::addSubscriber()" rel="external noopener noreferrer" target="_blank">addSubscriber()</a>
method:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Acme</span>\<span class="hljs-title">Store</span>\<span class="hljs-title">Event</span>\<span class="hljs-title">StoreSubscriber</span>;
<span class="hljs-comment">// ...</span>

<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>subscriber</span> = <span class="hljs-keyword">new</span> StoreSubscriber();
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>dispatcher</span><span class="hljs-operator">-&gt;</span>addSubscriber(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>subscriber</span>);</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>The dispatcher will automatically register the subscriber for each event
returned by the <code translate="no" class="notranslate">getSubscribedEvents()</code> method. This method returns an array
indexed by event names and whose values are either the method name to call
or an array composed of the method name to call and a priority (a positive or
negative integer that defaults to <code translate="no" class="notranslate">0</code>).</p>
<p>The example above shows how to register several listener methods for the same
event in subscriber and also shows how to pass the priority of each listener
method. The higher the number, the earlier the method is called. In the above
example, when the <code translate="no" class="notranslate">kernel.response</code> event is triggered, the methods
<code translate="no" class="notranslate">onKernelResponsePre()</code> and <code translate="no" class="notranslate">onKernelResponsePost()</code> are called in that
order.</p>
<span id="event_dispatcher-event-propagation"></span>
</div>
<div class="section">
<h3 id="stopping-event-flow-propagation">
    Stopping Event Flow/Propagation
    <a class="headerlink" href="#stopping-event-flow-propagation" title="Permalink to this headline">¶</a>
</h3>
<p>In some cases, it may make sense for a listener to prevent any other listeners
from being called. In other words, the listener needs to be able to tell
the dispatcher to stop all propagation of the event to future listeners
(i.e. to not notify any more listeners). This can be accomplished from
inside a listener via the
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Contracts/EventDispatcher/Event.php#method_stopPropagation" class="reference external" title="Symfony\Contracts\EventDispatcher\Event::stopPropagation()" rel="external noopener noreferrer" target="_blank">stopPropagation()</a> method:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Acme</span>\<span class="hljs-title">Store</span>\<span class="hljs-title">Event</span>\<span class="hljs-title">OrderPlacedEvent</span>;

<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onStoreOrder</span><span class="hljs-params">(OrderPlacedEvent <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span>)</span>
</span>{
    <span class="hljs-comment">// ...</span>

    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span><span class="hljs-operator">-&gt;</span>stopPropagation();
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<p>Now, any listeners to <code translate="no" class="notranslate">order.placed</code> that have not yet been called will
<em>not</em> be called.</p>
<p>It is possible to detect if an event was stopped by using the
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Contracts/EventDispatcher/Event.php#method_isPropagationStopped" class="reference external" title="Symfony\Contracts\EventDispatcher\Event::isPropagationStopped()" rel="external noopener noreferrer" target="_blank">isPropagationStopped()</a>
method which returns a boolean value:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// ...</span>
<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>dispatcher</span><span class="hljs-operator">-&gt;</span>dispatch(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span>, <span class="hljs-string">'foo.event'</span>);
<span class="hljs-keyword">if</span> (<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span><span class="hljs-operator">-&gt;</span>isPropagationStopped()) {
    <span class="hljs-comment">// ...</span>
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<span id="event_dispatcher-dispatcher-aware-events"></span>
</div>
<div class="section">
<h3 id="eventdispatcher-aware-events-and-listeners">
    EventDispatcher Aware Events and Listeners
    <a class="headerlink" href="#eventdispatcher-aware-events-and-listeners" title="Permalink to this headline">¶</a>
</h3>
<p>The <code translate="no" class="notranslate">EventDispatcher</code> always passes the dispatched event, the event's
name and a reference to itself to the listeners. This can lead to some advanced
applications of the <code translate="no" class="notranslate">EventDispatcher</code> including dispatching other events inside
listeners, chaining events or even lazy loading listeners into the dispatcher object.</p>
<span id="event_dispatcher-event-name-introspection"></span>
</div>
<div class="section">
<h3 id="event-name-introspection">
    Event Name Introspection
    <a class="headerlink" href="#event-name-introspection" title="Permalink to this headline">¶</a>
</h3>
<p>The <code translate="no" class="notranslate">EventDispatcher</code> instance, as well as the name of the event that
is dispatched, are passed as arguments to the listener:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">EventDispatcher</span>\<span class="hljs-title">Event</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">EventDispatcher</span>\<span class="hljs-title">EventDispatcherInterface</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyListener</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myEventListener</span><span class="hljs-params">(Event <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>event</span>, string <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>eventName</span>, EventDispatcherInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>dispatcher</span>)</span>
    </span>{
        <span class="hljs-comment">// ... do something with the event name</span>
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
</div>
<div class="section">
<h2 id="other-dispatchers">
    Other Dispatchers
    <a class="headerlink" href="#other-dispatchers" title="Permalink to this headline">¶</a>
</h2>
<p>Besides the commonly used <code translate="no" class="notranslate">EventDispatcher</code>, the component comes
with some other dispatchers:</p>
<ul>
    <li><a href="../components/event_dispatcher/immutable_dispatcher.html" class="reference internal">The Immutable Event Dispatcher</a></li>
<li><a href="../components/event_dispatcher/traceable_dispatcher.html" class="reference internal">The Traceable Event Dispatcher</a></li>
</ul>
</div>
<div class="section">
<h2 id="learn-more">
    Learn More
    <a class="headerlink" href="#learn-more" title="Permalink to this headline">¶</a>
</h2>
<div class="toctree-wrapper toc-size-md"><ul class="toctree toctree-level-1 toctree-length-1"><li><a href="event_dispatcher.html">The EventDispatcher Component</a></li></ul></div>
<ul>
    <li><a href="../reference/dic_tags.html#dic-tags-kernel-event-listener" class="reference internal">The kernel.event_listener tag</a></li>
<li><a href="../reference/dic_tags.html#dic-tags-kernel-event-subscriber" class="reference internal">The kernel.event_subscriber tag</a></li>
</ul>
</div>
</div>

                            </div>                    </div>
                                    </div>        </div>

    </section>

</div>


<script type="text/javascript" src="assets/js/theme.js"></script>
<script type="text/javascript" src="assets/js/badge_only.js"></script>

 
</body>
</html>